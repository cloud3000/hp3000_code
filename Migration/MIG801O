001000$CONTROL POST85, BOUNDS, LINES=59, LIST, MAP, CROSSREF            080831ma
001100******************************************************************080702MA
001200*   COPYRIGHT 2007 - 2009 J3K Solutions All rights reserved.      080702MA
001300*                                                                 080830ma
001400*                ****************************                     080830ma
001500*                  FORMSPEC export utility                        081215ma
001600*                ****************************                     080830ma
001700*                                                                 080830ma
001800*  This program will add the following VPLUS data to MIGDB.       080902ma
001900*                                                                 080902ma
002000*  Data Fields and all their properties.                          080830ma
002100*  Processing Specs for each field.                               080830ma
002200*  Screen enhancements.                                           080830ma
002300*  Line Drawing characters.                                       080830ma
002400*  Descriptive Text on the screen, and text properties.           080830ma
002500*  The Function Keys that were painted as text on the screen      080830ma
002600*  design (row 1 and 2) using screen escape sequences.            080830ma
002700*  The Function Key Labels (f1 thru f8) as entered in the         080830ma
002800*  FKEY screen in formspec.                                       080830ma
002900*                                                                 080828MA
003000*   http://www.j3ksolutions.com                                   080702MA
003100*   mailto:support@j3ksolutions.com                               080702MA
003200******************************************************************080702MA
003300 IDENTIFICATION DIVISION.                                                 
003400 PROGRAM-ID.     MIG801.                                          080902ma
003500 AUTHOR.     MICHAEL ANDERSON.                                            
003600 ENVIRONMENT DIVISION.                                            060615MA
003700 CONFIGURATION SECTION.                                           060615MA
003800 SOURCE-COMPUTER. HP-3000.                                        MA081219
003900*  SOURCE-COMPUTER. HP-3000 WITH DEBUGGING MODE.                  MA081219
004000 OBJECT-COMPUTER. HP-3000.                                        080828MA
004100*                                                                 060615MA
004200 INPUT-OUTPUT SECTION.                                            060615MA
004300 FILE-CONTROL.                                                    060615MA
004400*                                                                 060615MA
004500     SELECT PRINT-FILE      ASSIGN TO "DMG014,,,LP(SDTL)".        060706MA
004600     SELECT SORTFILE        ASSIGN TO "DMG01SRT,,,,9000000".      060706MA
004700     SELECT EXTFILE1        ASSIGN TO "DMG01A1,,,,9000000".       060706MA
004800     SELECT EXTFILE2        ASSIGN TO "DMG01A2,,,,9000000".       060706MA
004900     SELECT DMG01A3-FILE    ASSIGN TO "VPLUSRR,,,,9000000".       080422MA
005000     SELECT DMGXML-FILE     ASSIGN TO "DMGXML,,,,9000000"         MA090526
005100            FILE STATUS IS XML-STATUS.                            MA090526
005200     SELECT FORMA-FILE      ASSIGN TO "FORM,,,DISC"               080813ma
005300            FILE STATUS IS FORMFILE-STATUS.                       080813ma
005400     SELECT G-FILE      ASSIGN TO "GFILE,,,DISC"                  080830ma
005500            FILE STATUS IS GFILE-STATUS.                          080830ma
005600*                                                                 060615MA
005700 DATA DIVISION.                                                   060615MA
005800 FILE SECTION.                                                    060615MA
005900                                                                  060615MA
006000                                                                  060615MA
006100 FD  PRINT-FILE                                                   060615MA
006200     RECORD CONTAINS 132 CHARACTERS                               060615MA
006300     BLOCK CONTAINS 1 RECORDS                                     060615MA
006400     LABEL RECORDS ARE OMITTED.                                   060615MA
006500 01  PRINT-LINE.                                                  060615MA
006600     02  CLEAR-OUT                   PIC X(132).                  060615MA
006700                                                                  060615MA
006800 FD  EXTFILE2 DATA RECORD IS EXT-REC                              060615MA
006900     RECORD CONTAINS 62 CHARACTERS.                               060615MA
007000 01  EXT-REC2.                                                    060615MA
007100     05  FILLER                PIC X(62).                         060615MA
007200                                                                  060615MA
007300 FD  EXTFILE1 DATA RECORD IS EXT-REC                              060615MA
007400     RECORD CONTAINS 62 CHARACTERS.                               060615MA
007500 01  EXT-REC.                                                     060615MA
007600     05  FILLER                PIC X(62).                         060615MA
007700                                                                  060615MA
007800 SD  SORTFILE DATA RECORD IS SORT-REC                             060615MA
007900          RECORD CONTAINS 62 CHARACTERS.                          060615MA
008000 01  SORT-REC.                                                    060615MA
008100     02 SORT-KEY PIC X(62).                                       060615MA
008200 FD  DMG01A3-FILE                                                 060713MA
008300     RECORD CONTAINS 256 CHARACTERS                               080422MA
008400     DATA RECORD IS Script-File.                                  060713MA
008500 01  Script-File.                                                 060619MA
008600     05  Script-Str                     PIC X(256).               080422MA
008700                                                                  060713MA
008800 FD  DMGXML-FILE                                                  MA090526
008900     RECORD CONTAINS 256 CHARACTERS                               060713MA
009000     DATA RECORD IS XML-File.                                     MA090526
009100 01  XML-File.                                                    MA090526
009200     05  XML-Str                     PIC X(256).                  MA090526
009300 FD  FORMA-FILE                                                   080813ma
009400     RECORD CONTAINS 256 CHARACTERS                               080813ma
009500     DATA RECORD IS Form-File.                                    080813ma
009600 01  Form-File.                                                   080813ma
009700     05  Form-Rec                     PIC X(256).                 080813ma
009800*                                                                 080830ma
009900 FD  G-File                                                       080830ma
010000     RECORD CONTAINS 1540 CHARACTERS                              080830ma
010100     DATA RECORD is G-REC.                                        080830ma
010200 01  G-REC                            PIC X(1540).                080830ma
010300                                                                  080830ma
010400$PAGE "WORKING STORAGE"                                           060615MA
010500 WORKING-STORAGE SECTION.                                         060615MA
010600***************************************************************** 080813ma
010700 01  FILE-ERROR-DATA.                                             080813ma
010800     05 ERROR-NUMBER        PIC XX    VALUE SPACES.               080830ma
010900     05 FNAME               PIC X(8)  VALUE SPACES.               080830ma
011000     05 FILE-ERROR-RECORD   PIC X(79) VALUE SPACES.               080830ma
011100                                                                  MA090526
011200 01  XML-data             PIC X(256)  VALUE SPACES.               MA090526
011300 01  XML-STATUS           PIC XX    VALUE SPACES.                 MA090526
011400 01  XMLIDX               PIC S9(4) COMP VALUE 0.                 MA090526
011500 01  XmlPtr               PIC S9(4) COMP VALUE 0.                 MA090526
011600 01  XMLLEN               PIC S9(4) COMP VALUE 0.                 MA090526
011700 01  XMLLEVEL             PIC S9(4) COMP VALUE 0.                 MA090526
011800 01  XML-COUNT            PIC S9(9) COMP VALUE 0.                 MA090526
011900 01  XML-RCOUNT           PIC S9(9) COMP VALUE 0.                 MA090526
012000 01  XML-FLAG             PIC XX    VALUE SPACES.                 MA090526
012100     88 XML-CLOSED        VALUE SPACES.                           MA090526
012200     88 XML-OPENED        VALUE "02".                             MA090526
012300     88 XML-EOF           VALUE "99".                             MA090526
012400                                                                  MA090526
012500                                                                  080830ma
012600 01  GFILE-STATUS           PIC XX    VALUE SPACES.               080830ma
012700 01  GFILE-COUNT            PIC S9(9) COMP VALUE 0.               080830ma
012800 01  GFILE-RCOUNT           PIC S9(9) COMP VALUE 0.               080830ma
012900 01  GFILE-FLAG             PIC XX    VALUE SPACES.               080830ma
013000     88 GFILE-CLOSED        VALUE SPACES.                         080830ma
013100     88 GFILE-OPENED-INPUT  VALUE "01".                           080830ma
013200     88 GFILE-OPENED-OUTPUT VALUE "02".                           080830ma
013300     88 GFILE-EOF           VALUE "99".                           080830ma
013400                                                                  080830ma
013500 01  FORMFILE-STATUS        PIC XX    VALUE SPACES.               080830ma
013600 01  FORMFILE-COUNT         PIC S9(9) COMP VALUE 0.               080813ma
013700 01  FORMFILE-FLAG          PIC XX    VALUE SPACES.               080813ma
013800     88 FORMFILE-CLOSED        VALUE SPACES.                      080830ma
013900     88 FORMFILE-OPENED-INPUT  VALUE "01".                        080813ma
014000     88 FORMFILE-OPENED-OUTPUT VALUE "02".                        080813ma
014100     88 FORMFILE-EOF           VALUE "99".                        080830ma
014200 01  X2                    PIC S9(4) COMP VALUE 0.                081114ma
014300 01  NEXIDX                PIC S9(4) COMP VALUE 0.                081114ma
014400 01  I                     PIC S9(4) COMP VALUE 0.                080820MA
014500 01  X                     PIC S9(4) COMP VALUE 0.                080820MA
014600 01  FCNT                  PIC S9(4) COMP VALUE 0.                080820MA
014700 01  FX                    PIC S9(4) COMP VALUE 0.                080820MA
014800 01 Esc-len                PIC S9(4) COMP VALUE 0.                080813ma
014900 01 ld-IDX                 PIC S9(4) COMP VALUE 0.                080828MA
015000 01 ld-len                 PIC S9(4) COMP VALUE 0.                080828MA
015100 01  Ascii-Value           PIC S9(4) COMP VALUE 0.                080813ma
015200 01  ASCII-CHARACTER       REDEFINES Ascii-Value.                 080813ma
015300     02 ASCII-BYTE1        PIC X.                                 080813ma
015400     02 ASCII-BYTE2        PIC X.                                 080813ma
015500 01  LAST-FORMFILE          PIC S9(4) COMP VALUE 1.               080813ma
015600 01  HPVAR-NAME        PIC X(20) VALUE "ITOSQLS_STATUS~  ".       060614MA
015700 01  HPVAR-ITEM        PIC S9(9) COMP VALUE -1.                           
015800 01  HPVAR-ITEMNUM     PIC S9(9) COMP VALUE 1.                            
015900 01  HPVAR-STAT        PIC S9(9) COMP VALUE 0.                            
016000 01  DS-IDX            PIC S9(9) COMP VALUE 0.                    060621MA
016100 01  DI-IDX            PIC S9(9) COMP VALUE 0.                    060621MA
016200 01 forms-data.                                                   080813ma
016300    05 frdidx pic s9(9) comp value 0.                             080813ma
016400    05 frdptr pic s9(9) comp value 0.                             080813ma
016500    05 PRCptr pic s9(9) comp value 0.                             080813ma
016600    05 frdcnt pic s9(9) comp value 0.                             080813ma
016700    05 PRCcnt pic s9(9) comp value 0.                             080813ma
016800    05 frd-table.                                                 080813ma
016900       10 frd-entries OCCURS 32767  times.                        080813ma
017000          20 frdstr pic x(256).                                   080813ma
017100 01 S1       PIC S9(9) COMP VALUE 0.                              080813ma
017200 01 S2       PIC S9(9) COMP VALUE 0.                              080813ma
017300 01 end-of-tag-sw pic x value "0".                                MA090526
017400 01 next-tag-sw   pic x value "0".                                MA090526
017500 01 CD-Syntax     pic x value "0".                                MA090526
017600                                                                  MA090526
017700 01 SAVE-FLD-TABLE.                                               MA081215
017800    05 SF-BUFLEN  pic s9(4) comp.                                 MA081215
017900    05 SFIDX      pic s9(4) comp.                                 MA081219
018000    05 SFCNT      pic s9(4) comp.                                 MA081219
018100    05 SFT-ENTRIES OCCURS 64.                                     MA081215
018200       10 SF-FLD  PIC X(16).                                      MA081215
018300       10 SF-LEN  PIC 9(4).                                       MA081215
018400       10 SF-TYPE PIC X(4).                                       MA081215
018500       10 SF-INIT PIC X(80).                                      MA081215
018600                                                                  MA081215
018700                                                                  MA081215
018800 01 FORMSFILE-SW PIC X VALUE "0".                                 080813ma
018900    88 END-OF-FORMSFILE VALUE "1".                                080813ma
019000 01 end-of-specs-sw pic x value "0".                              080828MA
019100    88 end-of-specs value "1".                                    080828MA
019200 01 FORMFILES-REC-TYPE-SW PIC X VALUE "~".                        080813ma
019300    88 Type-is-Valid VALUES ARE                                   080813ma
019400    "V" "F".                                                      080813ma
019500*    "K" "G" "E" "H" "V" "F" "N" "T" "W" "S" "A" "O".             080813ma
019600                                                                  080820MA
019700 01 T-RECORD.                                                     080813ma
019800    02 TIDX          PIC S9(4) COMP VALUE 0.                      080820MA
019900    02 T-LEN         PIC S9(9) COMP VALUE 0.                      080820MA
020000    02 T-STRT        PIC S9(9) COMP VALUE 0.                      080820MA
020100    02 T-END         PIC S9(9) COMP VALUE 0.                      080820MA
020200    02 T-HEADER PIC X(40).                                        080813ma
020300    02 T-FLD-ENTRIES OCCURS 256 TIMES.                            080813ma
020400       05 T-FIELD PIC X(62).                                      080813ma
020500 01 T-HEADER-FORMAT.                                              080813ma
020600    05 THF-LENGTH PIC S9(4) COMP.                                 080813ma
020700    05 THF-TYPE   PIC X.                                          080813ma
020800    05 THF-FORM   PIC X(15).                                      080813ma
020900    05 THF-CNT1   PIC S9(4) COMP.                                 080813ma
021000    05 THF-CNT2   PIC S9(4) COMP.                                 080813ma
021100    05 FILLER     PIC X(18).                                      080813ma
021200                                                                  080813ma
021300 01 T-FIELD-FORMAT.                                               080813ma
021400    05 TFF-FLD1 PIC X(15).                                        080813ma
021500    05 TFF-FLD2 PIC X(15).                                        080813ma
021600    05 TFF-ENH   PIC X(4).                                        080813ma
021700    05 TFF-ESCVAL    PIC X.                                       080813ma
021800    05 TFF-A     PIC X.                                           080813ma
021900    05 TFF-FLDNUM  PIC S9(4) COMP.                                080813ma
022000    05 TFF-SCRNODR  PIC S9(4) COMP.                               080813ma
022100    05 FILLER  PIC S9(4) COMP.                                    080813ma
022200    05 FILLER  PIC S9(4) COMP.                                    080813ma
022300    05 TFF-LEN   PIC S9(4) COMP.                                  080813ma
022400    05 TFF-ROW   PIC S9(4) COMP.                                  080813ma
022500    05 TFF-COL   PIC S9(4) COMP.                                  080813ma
022600                                                                  080813ma
022700 01 D-RECORD.                                                     080813ma
022800    02 DIDX          PIC S9(4) COMP VALUE 0.                      080820MA
022900    02 D-LEN         PIC S9(9) COMP VALUE 0.                      080820MA
023000    02 D-STRT        PIC S9(9) COMP VALUE 0.                      080820MA
023100    02 D-END         PIC S9(9) COMP VALUE 0.                      080820MA
023200    02 D-RECORD-ENTRIES OCCURS 256 TIMES.                         080813ma
023300       05 D-HEADER PIC X(3).                                      080813ma
023400       05 D-FIELD PIC X(99).                                      080813ma
023500                                                                  080813ma
023600 01 D-HEADER-FORMAT.                                              080813ma
023700    05 DHF-LENGTH PIC S9(4) COMP.                                 080813ma
023800    05 DHF-TYPE   PIC X.                                          080813ma
023900                                                                  080813ma
024000 01 D-FIELD-FORMAT.                                               080813ma
024100    05 DFF-FLD1    PIC X(15).                                     080813ma
024200    05 DFF-FLD2    PIC X(15).                                     080813ma
024300    05 DFF-LEN     PIC XXX.                                       080813ma
024400    05 DFF-DTYPE   PIC XXXX.                                      080813ma
024500    05 DFF-INIT    PIC X(62).                                     080813ma
024600                                                                  080813ma
024700 01 E-RECORD.                                                     080813ma
024800    02 EIDX          PIC S9(4) COMP VALUE 0.                      080820MA
024900    02 ECNT          PIC S9(4) COMP VALUE 0.                      080820MA
025000    02 E-LEN         PIC S9(9) COMP VALUE 0.                      080820MA
025100    02 E-STRT        PIC S9(9) COMP VALUE 0.                      080820MA
025200    02 E-END         PIC S9(9) COMP VALUE 0.                      080820MA
025300    02 E-RECORD-ENTRIES OCCURS 2048 TIMES.                        080813ma
025400       05 E-HEADER PIC X(3).                                      080813ma
025500       05 E-DATA.                                                 080813ma
025600          10 E-FORM1             PIC X(15).                       080813ma
025700          10 E-FORM2             PIC X(15).                       080813ma
025800          10 E-REPEAT-OPTION     PIC X.                           080813ma
025900          10 E-NFORM-OPTION      PIC X.                           080813ma
026000          10 E-NFORM             PIC X(15).                       080813ma
026100          10 E-FKEY-DEF          PIC X.                           080813ma
026200          10 E-REPRODUCED-FR     PIC X(15).                       080813ma
026300          10 E-COMMENTS          PIC X(50).                       080813ma
026400                                                                  080813ma
026500 01 GSIDX          PIC S9(4) COMP VALUE 0.                        080831ma
026600 01 GSCNT          PIC S9(4) COMP VALUE 0.                        080831ma
026700 01 G-SCREEN-DATA.                                                080831ma
026800    02 G-SCREEN-ARRAY.                                            080831ma
026900       05 G-SCREEN-ENTRIES OCCURS 260 TIMES.                      080831ma
027000          10 GS-HEADER PIC XXX.                                   080831ma
027100          10 GS-FIELD  PIC X(1537).                               080831ma
027200 01 G-DATA-STORAGE.                                               080831ma
027300    02 GIDX          PIC S9(4) COMP VALUE 0.                      080831ma
027400    02 GCNT          PIC S9(4) COMP VALUE 0.                      080831ma
027500    02 G-LEN         PIC S9(9) COMP VALUE 0.                      080820MA
027600    02 G-STRT        PIC S9(9) COMP VALUE 0.                      080820MA
027700    02 G-END         PIC S9(9) COMP VALUE 0.                      080820MA
027800    02 G-RECORD.                                                  080831ma
027900       05 G-HEADER PIC X(3).                                      080813ma
028000       05 G-FIELD PIC X(1536).                                    080813ma
028100                                                                  080813ma
028200 01 G-HEADER-FORMAT.                                              080813ma
028300    05 GHF-LENGTH    PIC S9(4) COMP.                              080813ma
028400    05 GHF-TYPE      PIC X.                                       080813ma
028500                                                                  080830ma
028600 01 G-FIELD-FORMAT.                                               080813ma
028700    05 GFF-FORM      PIC X(15).                                   080813ma
028800    05 GFF-FIELD     PIC X(15).                                   080813ma
028900    05 GFF-NUM       PIC X(4).                                    080813ma
029000    05 GFF-LEN       PIC X(4).                                    080813ma
029100    05 GFF-FIELD2    PIC X(15).                                   080813ma
029200    05 GFF-ENH       PIC X(4).                                    080813ma
029300    05 GFF-FTYPE     PIC X.                                       080813ma
029400    05 GFF-DTYPE     PIC X(4).                                    080813ma
029500    05 GFF-INIT      PIC X(65).                                   080813ma
029600    05 GFF-PROCSPECS PIC X(1300).                                 080831ma
029700                                                                  080813ma
029800                                                                  080813ma
029900                                                                  080813ma
030000 01 FILE-DATA.                                                    080813ma
030100    02 FILE-ERR-ENH PIC X(4) VALUE SPACES.                        080813ma
030200    02 FILE-FLD-ENH PIC X(4) VALUE SPACES.                        080813ma
030300    02 FILE-VERSION PIC X(8) VALUE SPACES.                        080813ma
030400 01 HP-Enhancements.                                              080813ma
030500    02 FILLER  PIC X value "@".                                   080813ma
030600    02 FILLER  PIC X value "A".                                   080813ma
030700    02 FILLER  PIC X value "B".                                   080813ma
030800    02 FILLER  PIC X value "C".                                   080813ma
030900    02 FILLER  PIC X value "D".                                   080813ma
031000    02 FILLER  PIC X value "E".                                   080813ma
031100    02 FILLER  PIC X value "F".                                   080813ma
031200    02 FILLER  PIC X value "G".                                   080813ma
031300    02 FILLER  PIC X value "H".                                   080813ma
031400    02 FILLER  PIC X value "I".                                   080813ma
031500    02 FILLER  PIC X value "J".                                   080813ma
031600    02 FILLER  PIC X value "K".                                   080813ma
031700    02 FILLER  PIC X value "L".                                   080813ma
031800    02 FILLER  PIC X value "M".                                   080813ma
031900    02 FILLER  PIC X value "N".                                   080813ma
032000    02 FILLER  PIC X value "O".                                   080813ma
032100    02 FILLER  PIC X value "S".                                   080813ma
032200    02 FILLER  PIC X VALUE "Z".                                   080813ma
032300 01 HPENH-TABLE REDEFINES HP-Enhancements.                        080813ma
032400    02 HPENH-ENTRIES OCCURS 18 TIMEs.                             080813ma
032500       05 HPENH PIC X.                                            080813ma
032600                                                                  080813ma
032700 01 ENHIDX PIC S9(4) COMP VALUE 0.                                080813ma
032800                                                                  080813ma
032900 01 VPLUS-Enhancements.                                           080813ma
033000    02 FILLER PIC X(4) VALUE "NONE".                              080813ma
033100    02 FILLER PIC X(4) VALUE "B   ".                              080813ma
033200    02 FILLER PIC X(4) VALUE "I   ".                              080813ma
033300    02 FILLER PIC X(4) VALUE "BI  ".                              080813ma
033400    02 FILLER PIC X(4) VALUE "U   ".                              080813ma
033500    02 FILLER PIC X(4) VALUE "BU  ".                              080813ma
033600    02 FILLER PIC X(4) VALUE "IU  ".                              080813ma
033700    02 FILLER PIC X(4) VALUE "BIU ".                              080813ma
033800    02 FILLER PIC X(4) VALUE "H   ".                              080813ma
033900    02 FILLER PIC X(4) VALUE "BH  ".                              080813ma
034000    02 FILLER PIC X(4) VALUE "IH  ".                              080813ma
034100    02 FILLER PIC X(4) VALUE "BIH ".                              080813ma
034200    02 FILLER PIC X(4) VALUE "UH  ".                              080813ma
034300    02 FILLER PIC X(4) VALUE "BUH ".                              080813ma
034400    02 FILLER PIC X(4) VALUE "IUH ".                              080813ma
034500    02 FILLER PIC X(4) VALUE "BIUH".                              080813ma
034600    02 FILLER PIC X(4) VALUE "S   ".                              080813ma
034700    02 FILLER PIC X(4) VALUE "ERR ".                              080813ma
034800 01 VPLUSENH-TABLE REDEFINES VPLUS-Enhancements.                  080813ma
034900    02 VPLUSENH-ENTRIES OCCURS 18 TIMEs.                          080813ma
035000       05 VPLUSENH PIC X(4).                                      080813ma
035100                                                                  080813ma
035200 01 ALL-ROWS.                                                     080813ma
035300    02 FORM-SCRNORD PIC S9(4) COMP.                               080813ma
035400    02 ODFLEN       PIC S9(4) COMP.                               080813ma
035500    02 ODF          PIC S9(4) COMP.                               080813ma
035600    02 ROWIDX       PIC S9(4) COMP VALUE 0.                       080813ma
035700    02 ROWCNT       PIC S9(4) COMP VALUE 0.                       080813ma
035800    02 ROWMAX       PIC S9(4) COMP VALUE 26.                      080813ma
035900    02 ROWSTART     PIC S9(4) COMP VALUE 1.                       080813ma
036000    02 ROWEND       PIC S9(4) COMP VALUE 0.                       080813ma
036100    02 ROWLEN       PIC S9(4) COMP VALUE 0.                       080813ma
036200    02 ROW-COLUMN       PIC S9(4) COMP VALUE 0.                   080813ma
036300    02 ROW-ENTRIES OCCURS 40 TIMES.                               080813ma
036400       05 ROWSTR PIC X(256).                                      080813ma
036500       05 OBJIDX PIC S9(4) COMP.                                  080813ma
036600       05 OBJCNT PIC S9(4) COMP.                                  080813ma
036700       05 ROW-OBJECTS OCCURS 80.                                  080813ma
036800          10 OBJ-TYPE     PIC XX.                                 ma080814
036900          10 OBJ-fTYPE    PIC X.                                  ma080814
037000          10 OBJ-dTYPE    PIC XxxX.                               ma080814
037100          10 OBJ-Enh      PIC X.                                  ma080814
037200          10 OBJ-NAME     PIC X(16).                              ma080814
037300          10 OBJ-SRNORD   PIC S9(4) COMP.                         ma080814
037400          10 OBJ-STRTCOL  PIC S9(4) COMP.                         ma080814
037500          10 OBJ-STRTROW  PIC S9(4) COMP.                         ma080814
037600          10 OBJ-ENDCOL   PIC S9(4) COMP.                         ma080814
037700          10 OBJ-ENDROW   PIC S9(4) COMP.                         ma080814
037800          10 OBJ-VALUE    PIC X(80).                              ma080814
037900          10 OBJ-FLDNUM   PIC S9(4) COMP.                         ma080814
038000          10 OBJ-LEN      PIC S9(4) COMP.                         ma080814
038100                                                                  ma080814
038200                                                                  080813ma
038300 01 NEW-TEXT-AREA.                                                080813ma
038400    05 END-ROW-SW     PIC X VALUE "0".                            080813ma
038500       88 END-OF-ROW  VALUE "1".                                  080813ma
038600    05 TEXT-COLUMN       PIC S9(4) COMP VALUE 0.                  080813ma
038700    05 TEXT-ROW          PIC S9(4) COMP VALUE 0.                  080813ma
038800    05 TXIDX             PIC S9(4) COMP VALUE 0.                  080813ma
038900    05 TEXT-CHAR         PIC S9(4) COMP VALUE 0.                  080813ma
039000    05 TEXT-FIELDS.                                               080813ma
039100       10 TXPTR-START          PIC S9(4) COMP VALUE 0.            080813ma
039200       10 TXPTR                PIC S9(4) COMP VALUE 0.            080813ma
039300       10 TEXT-ENH             PIC X  VALUE "@".                  080813ma
039400       10 NON-TEXT-SW          PIC X  VALUE "0".                  080813ma
039500          88 IN-TEXT-AREA   VALUE "0".                            080813ma
039600          88 IN-NON-TEXT    VALUE "1".                            080813ma
039700       10 NEW-TEXT-FOUND-SW    PIC X  VALUE "0".                  080813ma
039800          88 NEW-TEXT-FOUND VALUE "1".                            080813ma
039900       10 TEXT-FLDCNT          PIC S9(4) COMP VALUE 0.            080813ma
040000       10 TEXT-FIELD-ENTRIES OCCURS 40 TIMES.                     080813ma
040100          20 TEXT-FLDCOL    PIC S9(4) COMP.                       080813ma
040200          20 TEXT-FLDROW    PIC S9(4) COMP.                       080813ma
040300          20 TEXT-FLDENH    PIC X.                                080813ma
040400          20 TEXT-FLDSTR    PIC X(80).                            080813ma
040500          20 TEXT-FLDLEN    PIC S9(4) COMP.                       080813ma
040600                                                                  080825MA
040700 01 btnrow-data.                                                  080825MA
040800    05 brwidx     pic s9(4) comp value 0.                         080825MA
040900    05 brwcnt     pic s9(4) comp value 0.                         080825MA
041000    05 nxkey-x    pic s9(4) comp value 0.                         080825MA
041100    05 nxkey-y    pic s9(4) comp value 0.                         080825MA
041200    05 nxchr-cnt  pic s9(4) comp value 0.                         080825MA
041300    05 nxlbl      pic x(32) value spaces.                         080828MA
041400    05 Next-Label pic x(8)  value spaces.                         080825MA
041500    05 ALL-8-LABELS.                                              081114ma
041600       10 btn        pic x(8) OCCURS 8.                           081114ma
041700                                                                  080825MA
041800 01 TEXT-BUTTONS.                                                 080821MA
041900       10 TEXT-BTNCNT          PIC S9(4) COMP VALUE 0.            080813ma
042000       10 TEXT-Button-ENTRIES OCCURS 8 TIMES.                     080813ma
042100          20 TEXT-BTNCOL    PIC S9(4) COMP.                       080813ma
042200          20 TEXT-BTNROW    PIC S9(4) COMP.                       080813ma
042300          20 TEXT-BTNENH    PIC X.                                080813ma
042400          20 TEXT-BTNSTR    PIC X(16).                            080813ma
042500          20 TEXT-BTNLEN    PIC S9(4) COMP.                       080813ma
042600       10 Text-Keys.                                              080813ma
042700          15 Txkey1-1 Pic X(8) Value Spaces.                      080813ma
042800          15 Txkey2-1 Pic X(8) Value Spaces.                      080813ma
042900          15 Txkey3-1 Pic X(8) Value Spaces.                      080813ma
043000          15 Txkey4-1 Pic X(8) Value Spaces.                      080813ma
043100          15 Txkey5-1 Pic X(8) Value Spaces.                      080813ma
043200          15 Txkey6-1 Pic X(8) Value Spaces.                      080813ma
043300          15 Txkey7-1 Pic X(8) Value Spaces.                      080813ma
043400          15 Txkey8-1 Pic X(8) Value Spaces.                      080813ma
043500          15 Txkey1-2 Pic X(8) Value Spaces.                      080813ma
043600          15 Txkey2-2 Pic X(8) Value Spaces.                      080813ma
043700          15 Txkey3-2 Pic X(8) Value Spaces.                      080813ma
043800          15 Txkey4-2 Pic X(8) Value Spaces.                      080813ma
043900          15 Txkey5-2 Pic X(8) Value Spaces.                      080813ma
044000          15 Txkey6-2 Pic X(8) Value Spaces.                      080813ma
044100          15 Txkey7-2 Pic X(8) Value Spaces.                      080813ma
044200          15 Txkey8-2 Pic X(8) Value Spaces.                      080813ma
044300                                                                  080813ma
044400 01 Design-Area.                                                  080813ma
044500    02 Design-name        Pic X(16).                              080813ma
044600    02 Deslen             Pic S9(9) Comp.                         080813ma
044700    02 F-DESIGN-LEN       Pic S9(9) Comp.                         080813ma
044800    02 F-Design           Pic X(16384).                           080830ma
044900    02 F-DESIGN-POINTERS.                                         080813ma
045000       05 FDPIDX PIC S9(4) COMP VALUE 0.                          080813ma
045100       05 FDPCNT PIC S9(4) COMP VALUE 0.                          080813ma
045200       05 FDP-ARRAY OCCURS 110 TIMES.                             080830ma
045300          10 FDP-LEN  PIC S9(9) COMP.                             080813ma
045400          10 FDP-STRT PIC S9(9) COMP.                             080813ma
045500          10 FDP-END  PIC S9(9) COMP.                             080813ma
045600    02 V-DESIGN-LEN       Pic S9(9) Comp.                         080813ma
045700    02 V-Design           Pic X(16384).                           080830ma
045800    02 V-DESIGN-POINTERS.                                         080813ma
045900       05 VDPIDX PIC S9(4) COMP VALUE 0.                          080813ma
046000       05 VDPCNT PIC S9(4) COMP VALUE 0.                          080813ma
046100       05 VDP-ARRAY OCCURS 110 TIMES.                             080830ma
046200          10 VDP-LEN  PIC S9(9) COMP.                             080813ma
046300          10 VDP-STRT PIC S9(9) COMP.                             080813ma
046400          10 VDP-END  PIC S9(9) COMP.                             080813ma
046500    02 startx             Pic S9(9) Comp.                         080813ma
046600    02 endx               Pic S9(9) Comp.                         080813ma
046700    02 xidx               Pic S9(9) Comp.                         080813ma
046800    02 V-xlen             Pic S9(4) Comp.                         080813ma
046900    02 F-xlen             Pic S9(4) Comp.                         080813ma
047000                                                                  080813ma
047100 01 Field-x-y.                                                    080813ma
047200    02 Field-Name    Pic x(16) Value Spaces.                      080813ma
047300    02 Field-Column  Pic S9(4) Comp Value 0.                      080813ma
047400    02 Field-Row     Pic S9(4) Comp Value 0.                      080813ma
047500    02 F1            Pic S9(4) Comp Value 0.                      080813ma
047600    02 Found-len     Pic S9(4) Comp Value 0.                      080813ma
047700    02 F-idx         Pic S9(4) Comp Value 0.                      080813ma
047800 01 Formname.                                                     MA090526
047900     02 formname-name pic xxxx.                                   MA090526
048000     02 formname-number pic 9999.                                 MA090526
048100                                                                  MA090526
048200 01 Form-File-Data.                                               080820MA
048300   02 FDATA-TIMESTAMP      PIC X(32) VALUE SPACES.                080830ma
048400   02 Form-Data-Record.                                           080830ma
048500      05  FDATA-FUNCTION-KEYS.                                    080820MA
048600         10 FKEY OCCURS 8 TIMES.                                  080813ma
048700            15 FKEY-LINE1 PIC X(8).                               080813ma
048800            15 FKEY-LINE2 PIC X(8).                               080813ma
048900 01  GETINFO-DATA.                                                080813ma
049000    05  GINFO-LEN                PIC S9(4) COMP.                  080813ma
049100    05  GINFO-STR                PIC X(128).                      080813ma
049200    05  GINFO-PARM               PIC S9(4) COMP.                  080813ma
049300 01  PARSED-DATA.                                                 080813ma
049400    05  ITEMS-PARSED             PIC S9(4) COMP.                  080813ma
049500        88 PARSE-IS-COMPLETE VALUES ARE 8 THRU 99.                080813ma
049600    05  PARSED-STRING            PIC X(128).                      080813ma
049700    05  NEXT-STRING              PIC X(256).                      080825MA
049800    05  STRING-POINTER             PIC S9(4) COMP.                080813ma
049900    05  GX                       PIC S9(4) COMP.                  080813ma
050000    05  GY                       PIC S9(4) COMP.                  080813ma
050100    05  PX                       PIC S9(4) COMP.                  080813ma
050200 01 ITEM-1                  PIC S9(9)  COMP VALUE 1.              080813ma
050300 01 ITEM-2                  PIC S9(9)  COMP VALUE 2.              080813ma
050400 01 ITEM-11                 PIC S9(9)  COMP VALUE 11.             080813ma
050500 01 VAR-VALUE                PIC 9(3)       VALUE ZERO.           080813ma
050600 01 VAR-NAME                PIC X(15)       VALUE SPACES.         080813ma
050700 01 VAR-STATUS              PIC S9(9)  COMP VALUE 0.              080813ma
050800 01 VAR-VALUE-I             PIC S9(9)  COMP VALUE 0.              080813ma
050900 01 VAR-VALUE-S             PIC X(20)       VALUE SPACES.         080813ma
051000 01 VAR-VALUE-S-SIZE        PIC S9(9)  COMP VALUE 20.             080813ma
051100 01 FLDIDX                 PIC S9(4) COMP.                        080813ma
051200 01 FRMIDX                 PIC S9(4) COMP.                        080813ma
051300 01 MY-NEW-FILCNT          pic s9(9) comp value 0.                080828MA
051400 01 MY-NEW-frmCNT          pic s9(9) comp value 0.                080828MA
051500 01 MY-NEW-fldCNT          pic s9(9) comp value 0.                080828MA
051600 01 MY-NEW-spcCNT          pic s9(9) comp value 0.                080828MA
051700 01 DISP-N2                PIC ZZZ9.                              080813ma
051800 01  FULL-CURRENT-DATE.                                           080813ma
051900         05  C-DATE.                                              080813ma
052000             10  C-YEAR       PIC 9(4).                           080813ma
052100             10  C-MONTH      PIC 99.                             080813ma
052200             10  C-DAY        PIC 99.                             080813ma
052300         05  C-TIME.                                              080813ma
052400             10  C-HOUR       PIC 99.                             080813ma
052500             10  C-MINUTES    PIC 99.                             080813ma
052600             10  C-SECONDS    PIC 99.                             080813ma
052700             10  C-SEC-HUND   PIC 99.                             080813ma
052800         05  C-TIME-DIFF.                                         080813ma
052900             10  O-GMT-DIR    PIC X.                              080813ma
053000             10  O-HOUR       PIC 99.                             080813ma
053100             10  O-MINUTES    PIC 99.                             080813ma
053200 01 ERROR-MSG                PIC X(80) VALUE SPACES.              080813ma
053300 01 CALLTYPE                 PIC X(20) VALUE SPACES.              080813ma
053400                                                                  080813ma
053500 01 NUMDEC                 PIC S9(4) COMP.                        080813ma
053600 01 NUMERR                 PIC S9(4) COMP.                        080813ma
053700 01 NUM1                   PIC X(14).                             080813ma
053800 01 NUM2                   PIC S9(14).                            080902ma
053900 01  FIRST-TIME-SW         PIC X.                                 080813ma
054000     88  FIRST-TIME        VALUE "1".                             080813ma
054100                                                                  080820MA
054200 01  E-Record-Found-Sw     Pic X Value "0".                       080820MA
054300     88 E-Record-Found           Value "1".                       080820MA
054400                                                                  080820MA
054500 01  POINTER-LINK-SW         PIC X.                               080813ma
054600     88  POINTERS-LINKED        VALUE "1".                        080813ma
054700                                                                  081114ma
054800 01  HAVE-FKEYS-SW                PIC X VALUE "9".                081114ma
054900     88 HARDWARE-FKEYS  VALUE "H".                                081114ma
055000     88 PAINTED-FKEYS   VALUE "P".                                081114ma
055100     88 NO-FKEYS-YET    VALUE "N".                                081114ma
055200                                                                  080813ma
055300 01  VALID-T-SW         PIC X.                                    080813ma
055400     88  VALID-T        VALUE "1".                                080813ma
055500                                                                  080813ma
055600 01  VALID-D-SW         PIC X.                                    080813ma
055700     88  VALID-D        VALUE "1".                                080813ma
055800                                                                  080813ma
055900 01  VALID-G-SW         PIC X.                                    080813ma
056000     88  VALID-G        VALUE "1".                                080813ma
056100                                                                  080813ma
056200 01  FIRST-TIME-SW         PIC X.                                 080813ma
056300     88  FIRST-TIME        VALUE "1".                             080813ma
056400 01  infield-sw         PIC X.                                    080813ma
056500     88  infield        VALUE "1".                                080813ma
056600                                                                  080813ma
056700*01  ERRORS-SW             PIC X.                                 080813ma
056800*    88  ERRORS            VALUE "1".                             080813ma
056900                                                                  080813ma
057000 01  NONBLANK-SW         PIC X.                                   080813ma
057100     88  NONBLANK        VALUE "1".                               080813ma
057200                                                                  080813ma
057300 01  MATCH-SW        PIC X.                                       080813ma
057400     88  MATCH-FOUND       VALUE "1".                             080813ma
057500                                                                  080813ma
057600 01  FMMSTR-SW        PIC X.                                      081114ma
057700     88  FMMSTR-FOUND       VALUE "1".                            081114ma
057800                                                                  081114ma
057900 01  EDIT-ERRORS-SW        PIC X.                                 080813ma
058000     88  EDIT-ERRORS       VALUE "1".                             080813ma
058100                                                                  080813ma
058200 01  BAD-KEY-SW            PIC X.                                 080813ma
058300     88  BAD-KEY           VALUE "1".                             080813ma
058400                                                                  080813ma
058500 01  Last-Column-SW       PIC X.                                  080813ma
058600     88  Last-Column      VALUE "1".                              080813ma
058700                                                                  080813ma
058800 01  X-FLOWTEST-JCW          PIC X(8) VALUE "FLOWTEST".           080813ma
058900 01  X-FLOWTEST-VALUE        PIC S9(4) COMP VALUE 0.              080813ma
059000     88  X-FLOWTEST          VALUE 1.                             080813ma
059100                                                                  080813ma
059200 01 TARGET-FIELD                    PIC X(64) VALUE SPACES.       080813ma
059300 01 DWNSHFT-SW                      PIC X.                        080813ma
059400    88 OK-TO-DOWNSHIFT VALUE "1".                                 080813ma
059500 01 MYIDX                           PIC S9(4) COMP VALUE 0.       080813ma
059600 01 SOURCE-FIELD                    PIC X(64) VALUE SPACES.       080813ma
059700 01 ASCII-CHARACTERS.                                             080813ma
059800    02 TWO-BYTES                    PIC XX VALUE SPACES.          080813ma
059900    02 SIXTEEN-BITS REDEFINES TWO-BYTES.                          080813ma
060000       05 ASCII-INT                 PIC S9(4) COMP.               080813ma
060100    02 TWO-CHARS    REDEFINES TWO-BYTES.                          080813ma
060200       05 FILLER                    PIC X.                        080813ma
060300       05 ASCII-CHAR                PIC X.                        080813ma
060400                                                                  080813ma
060500 01  MY-TIMESTAMP             PIC X(28) VALUE SPACES.             ma080814
060600                                                                  ma080814
060700 01 ABORT-SWITCHES.                                               080813ma
060800    02 ON-VPLUS-ERRORS     PIC X VALUE "0".                       080813ma
060900       88 ABORT-ON-VPLUS-ERRORS  VALUE "9".                       080813ma
061000                                                                  080813ma
061100     01  SAVE-STATUS.                                             080813ma
061200         03  CONDITION-SAVED   PIC S9(4) COMP.                    080813ma
061300         03  SAVED-LENGTH      PIC S9(4) COMP.                    080813ma
061400         03  SAVED-NUMBER      PIC S9(9) COMP.                    080813ma
061500         03  SAVED-IN-CHAIN    PIC S9(9) COMP.                    080813ma
061600         03  PREV-SAVED-NO     PIC S9(9) COMP.                    080813ma
061700         03  NEXT-SAVED-NO     PIC S9(9) COMP.                    080813ma
061800                                                                  080813ma
061900 01 A-TABLE-SW               PIC X VALUE "0".                     080813ma
062000    88 ITS-A-TABLE    VALUE "1".                                  080813ma
062100 01 DOW                      PIC S9(4) COMP  VALUE 0.             080813ma
062200 01  MYDB     PIC S9(4) COMP VALUE  9.                            080813ma
062300 01  MIGDB-STATUS.                                                080813ma
062400     03  FILLER    PIC S9(4) COMP VALUE  0.                       080813ma
062500     03  FILLER    PIC S9(4) COMP VALUE  0.                       080813ma
062600     03  FILLER    PIC S9(9) COMP VALUE  0.                       080813ma
062700     03  FILLER    PIC S9(9) COMP VALUE  0.                       080813ma
062800     03  FILLER    PIC S9(9) COMP VALUE  0.                       080813ma
062900     03  FILLER    PIC S9(9) COMP VALUE  0.                       080813ma
063000 01 INSPECT-IDX              PIC S9(4) COMP  VALUE 0.             080813ma
063100 01 NUMDATE                  PIC S9(9) COMP  VALUE 0.             080813ma
063200                                                                  080813ma
063300 01 WHO-INTRINSIC-PARMS.                                          080813ma
063400    15  WHO-TERM-DEV-NO        PIC S9999 COMP.                    080813ma
063500    15  WHO-MODE               PIC S9999 COMP.                    080813ma
063600    15  WHO-CAPABILITY         PIC S9(6) COMP.                    080813ma
063700    15  WHO-LATTR              PIC S9(6) COMP.                    080813ma
063800    15  WHO-USERN.                                                080813ma
063900        20 BYTE1-6             PIC X(6).                          080813ma
064000        20 SCHOOL-NUMBER       PIC XX.                            080813ma
064100    15  WHO-GROUPN             PIC X(8).                          080813ma
064200    15  WHO-ACCTN              PIC X(8).                          080813ma
064300    15  WHO-HOMEN              PIC X(8).                          080813ma
064400                                                                  080813ma
064500 01 DP-IDX                  PIC S9(9) COMP  VALUE 0.              080813ma
064600 01 MyHpSusan               PIC S9(9) COMP  VALUE 0.              080813ma
064700 01 MyCREATOR               PIC X(8)   VALUE SPACES.              080813ma
064800 01 MYACCOUNT               PIC X(8)   VALUE SPACES.              080813ma
064900 01 MYGROUP               PIC X(8)   VALUE SPACES.                080813ma
065000 01 LINK-USER  PIC X(8) VALUE SPACES.                             080813ma
065100 01 LINK-UPASS PIC X(8) VALUE SPACES.                             080813ma
065200 01 LINK-ACCT  PIC X(8) VALUE SPACES.                             080813ma
065300 01 LINK-APASS PIC X(8) VALUE SPACES.                             080813ma
065400 01 LINK-GROUP PIC X(8) VALUE SPACES.                             080813ma
065500 01 LINK-GPASS PIC X(8) VALUE SPACES.                             080813ma
065600 01  speclen               PIC S9(4) COMP.                        080813ma
065700 01  specidx               pic s9(4) comp.                        080828MA
065800 01 chrcnt                 pic s9(4) comp.                        080828MA
065900 01 chridx                 pic s9(4) comp.                        080828MA
066000 01  DATA-LEN              PIC S9(4) COMP.                        080813ma
066100                                                                  080813ma
066200 01 MYCOST      PIC S9(18) COMP VALUE 0.                          080813ma
066300 01 TOTAL-FILES      PIC S9(18) COMP VALUE 0.                     080813ma
066400 01 TOTAL-FORMS       PIC S9(18) COMP VALUE 0.                    080813ma
066500 01 TOTAL-FIELDS     PIC S9(18) COMP VALUE 0.                     080813ma
066600 01 CAPACITY-FILES   PIC S9(18) COMP VALUE 0.                     080813ma
066700 01 CAPACITY-SPECS   pic s9(18) comp value 0.                     080828MA
066800 01 CAPACITY-FORMS    PIC S9(18) COMP VALUE 0.                    080813ma
066900 01 CAPACITY-FIELDS  PIC S9(18) COMP VALUE 0.                     080813ma
067000 01 MYMONEY     PIC S9(18) COMP VALUE 0.                          080813ma
067100 01 MYBYTES     PIC S9(18) COMP VALUE 0.                          080813ma
067200 01 MYMSG                   PIC X(79) VALUE SPACES.               080813ma
067300 01 SI-IDX                  PIC S9(9) COMP  VALUE 0.              MA090330
067400 01 bufpos                  PIC S9(4) COMP  VALUE 0.              MA090330
067500 01 CMD                     PIC X(255)      VALUE SPACES.         080813ma
067600 01 M               Pic X(78) Value Spaces.                       080813ma
067700 01 CSTR                     PIC X(255)      VALUE SPACES.        080813ma
067800 01 CERR                     PIC S9(4) COMP  VALUE 0.             080813ma
067900 01 CPARM                    PIC S9(4) COMP  VALUE 0.             080813ma
068000 01 CMSG                     PIC S9(4) COMP  VALUE 2.             080813ma
068100 01 STR-PTR                  PIC S9(4) COMP  VALUE 0.             080813ma
068200 01 OCCURS-VALUE             PIC S9(4) COMP  VALUE 0.             080813ma
068300 01  EXTFILE-STATUS            PIC X   VALUE "0".                 080813ma
068400     88 EXTFILE-EOF                    VALUE "9".                 080813ma
068500 01 OCCURS-LAST              PIC S9(4) COMP  VALUE 0.             080813ma
068600 01 My-BaseName              Pic X(6) Value Spaces.               080813ma
068700 01 OCCURS-PTR               PIC S9(4) COMP  VALUE 0.             080813ma
068800 01 NUM-X                    PIC S9(4) COMP  VALUE 0.             080813ma
068900 01 MYINCREMENT              PIC S9(4) COMP  VALUE 0.             080813ma
069000                                                                  080813ma
069100 01 My-Bytes                  pic S9(4) Comp  Value 0.            080813ma
069200 01 DASH-PTR                 PIC S9(4) COMP  VALUE 0.             080813ma
069300 01 VAR-LEN                  PIC S9(4) COMP  VALUE 0.             080813ma
069400 01 SHOWTIME-STR.                                                 080813ma
069500    02 FILLER PIC X(8) VALUE "SHOWTIME".                          080813ma
069600    02 FILLER PIC X    VALUE %15.                                 080813ma
069700 01 DATE-EDITING.                                                 080813ma
069800    05 RAW-DATE.                                                  080813ma
069900       10 D1     PIC X   VALUE SPACES.                            080813ma
070000       10 D2     PIC X   VALUE SPACES.                            080813ma
070100       10 D3     PIC X   VALUE SPACES.                            080813ma
070200       10 D4     PIC X   VALUE SPACES.                            080813ma
070300       10 D5     PIC X   VALUE SPACES.                            080813ma
070400       10 D6     PIC X   VALUE SPACES.                            080813ma
070500       10 D7     PIC X   VALUE SPACES.                            080813ma
070600       10 D8     PIC X   VALUE SPACES.                            080813ma
070700    05 EDITED-DATE.                                               080813ma
070800       10 D5     PIC X   VALUE SPACES.                            080813ma
070900       10 D6     PIC X   VALUE SPACES.                            080813ma
071000       10 FILLER PIC X   VALUE "/".                               080813ma
071100       10 D7     PIC X   VALUE SPACES.                            080813ma
071200       10 D8     PIC X   VALUE SPACES.                            080813ma
071300       10 FILLER PIC X   VALUE "/".                               080813ma
071400       10 D1     PIC X   VALUE SPACES.                            080813ma
071500       10 D2     PIC X   VALUE SPACES.                            080813ma
071600       10 D3     PIC X   VALUE SPACES.                            080813ma
071700       10 D4     PIC X   VALUE SPACES.                            080813ma
071800                                                                  080813ma
071900                                                                  080813ma
072000 01 Db-Info-406-Word-17.                                          080813ma
072100    05  BIT1             PIC 9.                                   080813ma
072200    05  BIT2             PIC 9.                                   080813ma
072300    05  BIT3             PIC 9.                                   080813ma
072400    05  BIT4             PIC 9.                                   080813ma
072500    05  BIT5             PIC 9.                                   080813ma
072600    05  BIT6             PIC 9.                                   080813ma
072700    05  BIT7             PIC 9.                                   080813ma
072800    05  BIT8             PIC 9.                                   080813ma
072900    05  BIT9             PIC 9.                                   080813ma
073000        88 Database-Newlimits Value 1.                            080813ma
073100        88 Database-Oldlimits Value 0.                            080813ma
073200    05  BIT10            PIC 9.                                   080813ma
073300        88 Database-Entrynumber-Format Value 1.                   080813ma
073400        88 Database-Entryname-Format   Value 0.                   080813ma
073500    05  BIT11            PIC 9.                                   080813ma
073600    05  BIT12            PIC 9.                                   080813ma
073700        88 Expandable-Master-Dataset     Value 1.                 080813ma
073800        88 No-Expandable-Master-Dataset   Value 0.                080813ma
073900    05  BIT13            PIC 9.                                   080813ma
074000        88 B-Tree      Value 1.                                   080813ma
074100        88 No-B-Tree   Value 0.                                   080813ma
074200    05  BIT14            PIC 9.                                   080813ma
074300    05  BIT15            PIC 9.                                   080813ma
074400    05  BIT16            PIC 9.                                   080813ma
074500 01  BINARY-VALUE.                                                080813ma
074600     05 BIT-ZERO                     PIC 9.                       080813ma
074700     05 BIT OCCURS 15 TIMES          PIC 9.                       080813ma
074800 01 REPORT-BUFFER.                                                080813ma
074900    05 RPT-VFLD-NAME       PIC X(15).                             080813ma
075000    05 FILLER PIC XX VALUE SPACE.                                 080813ma
075100    05 RPT-BUF-X           PIC ZZZ9.                              080813ma
075200    05 FILLER PIC XX VALUE SPACE.                                 080813ma
075300    05 RPT-BUF-Y           PIC ZZZ9.                              080813ma
075400    05 FILLER PIC XX VALUE SPACE.                                 080813ma
075500    05 RPT-SRN-X           PIC Z9.                                080813ma
075600    05 FILLER PIC XX VALUE SPACE.                                 080813ma
075700    05 RPT-SRN-Y           PIC Z9.                                080813ma
075800    05 FILLER PIC XX VALUE SPACE.                                 080813ma
075900    05 RPT-SRN-ORD-NUM     PIC ZZ9.                               080813ma
076000    05 FILLER PIC XX VALUE SPACE.                                 080813ma
076100    05 RPT-VFLD-NUM        PIC ZZ9.                               080813ma
076200    05 FILLER PIC XX VALUE SPACE.                                 080813ma
076300    05 RPT-VFLD-LENGTH     PIC ZZZ9.                              MA090303
076400    05 FILLER PIC XX VALUE SPACE.                                 080813ma
076500    05 RPT-VFLD-POSITION   PIC ZZZ9.                              080813ma
076600    05 FILLER PIC XX VALUE SPACE.                                 080813ma
076700    05 RPT-VFLD-ENHANCE    PIC XXXX.                              080813ma
076800    05 FILLER PIC XX VALUE SPACE.                                 080813ma
076900    05 RPT-VFLD-TYPE       PIC XX.                                080813ma
077000    05 FILLER PIC XX VALUE SPACE.                                 080813ma
077100    05 RPT-VFLD-DATATYPE   PIC XXXX.                              080813ma
077200 01 REPORT-HEADER.                                                080813ma
077300    05 FILLER       PIC X(15) VALUE "FIELD NAME".                 080813ma
077400    05 FILLER PIC XX VALUE SPACE.                                 080813ma
077500    05 FILLER           PIC XXXX VALUE " BFX".                    080813ma
077600    05 FILLER PIC XX VALUE SPACE.                                 080813ma
077700    05 FILLER           PIC XXXX VALUE " BFY".                    080813ma
077800    05 FILLER PIC XX VALUE SPACE.                                 080813ma
077900    05 FILLER           PIC XX VALUE " X".                        080813ma
078000    05 FILLER PIC XX VALUE SPACE.                                 080813ma
078100    05 FILLER           PIC XX VALUE "Y".                         080813ma
078200    05 FILLER PIC XX VALUE SPACE.                                 080813ma
078300    05 FILLER     PIC XXX VALUE "ORD".                            080813ma
078400    05 FILLER PIC XX VALUE SPACE.                                 080813ma
078500    05 FILLER        PIC XXX VALUE "NUM".                         080813ma
078600    05 FILLER PIC XX VALUE SPACE.                                 080813ma
078700    05 FILLER     PIC XXXX VALUE "LEN".                           MA090303
078800    05 FILLER PIC XX VALUE SPACE.                                 080813ma
078900    05 FILLER   PIC XXXX VALUE " POS".                            080813ma
079000    05 FILLER PIC XX VALUE SPACE.                                 080813ma
079100    05 FILLER    PIC XXXX VALUE "ENH".                            080813ma
079200    05 FILLER PIC XX VALUE SPACE.                                 080813ma
079300    05 FILLER       PIC XX VALUE "TY".                            080813ma
079400    05 FILLER PIC XX VALUE SPACE.                                 080813ma
079500    05 FILLER   PIC XXXX VALUE "DATA".                            080813ma
079600                                                                  080813ma
079700 01 NUMERIC-EDITS.                                                080813ma
079800    02 Split-Word        Pic S9(4) Comp.                          080813ma
079900    02 Splating-a-word Redefines Split-Word.                      080813ma
080000       05 Split-Word-1 Pic x.                                     080813ma
080100       05 Split-Word-2 Pic x.                                     080813ma
080200    02 CHR3              PIC XXX.                                 080813ma
080300    02 Y1                PIC 9.                                   080813ma
080400    02 Y2                PIC 99.                                  080813ma
080500    02 Y3                PIC 999.                                 080813ma
080600    02 Y4                PIC 9999.                                080813ma
080700    02 Y5                PIC 99999.                               080813ma
080800    02 CHR6              PIC XXXXXX.                              080813ma
080900    02 Z1                PIC 9.                                   080813ma
081000    02 Z2                PIC 99.                                  080813ma
081100    02 Z3                PIC 999.                                 080813ma
081200    02 Z4                PIC 9999.                                080813ma
081300    02 Z5                PIC 99999.                               080813ma
081400    02 COLUMN-BYTES    PIC S9(4) COMP.                            080813ma
081500                                                                  080813ma
081600 01 FILE-INFOBUF.                                                 080813ma
081700    05 FILE-NUMBER-OF-ENTRIES      PIC S9(4) COMP.                080813ma
081800    05 FILE-ENTRY-LENGTH           PIC S9(4) COMP.                080813ma
081900    05 FILE-ENTRY-TABLE OCCURS 1 TIMES.                           080813ma
082000       10 IN-FILE-VERSION          PIC S9(8) COMP.                080813ma
082100       10 FILE-NUMBER-OF-FORMS     PIC S9(4) COMP.                080813ma
082200       10 FILE-MAX-FIELDS          PIC S9(4) COMP.                080813ma
082300       10 FILE-MAX-BUFSIZE         PIC S9(4) COMP.                080813ma
082400       10 FILE-SAVE-FIELDS         PIC S9(4) COMP.                080813ma
082500       10 FILE-HEAD-FORM           PIC X(15).                     080813ma
082600       10 FILE-FILLER              PIC X.                         080813ma
082700       10 FILE-ERROR-ENHANCE       PIC X(4).                      080813ma
082800       10 FILE-WINDOW-ENHANCE      PIC X(4).                      080813ma
082900       10 FILE-WINDOW-POSITION     PIC S9(4) COMP.                080813ma
083000 01 FILE-INFOBUFLEN           PIC S9(4) COMP VALUE 21.            080813ma
083100***************************************** VGETFILEINFO EXAMPLE    080813ma
083200*     MOVE SPACES TO FILE-INFOBUF.                                080813ma
083300*     MOVE 1 TO FILE-NUMBER-OF-ENTRIES.                           080813ma
083400*     MOVE 19 TO FILE-ENTRY-LENGTH.                               080813ma
083500*     CALL "VGETFILEINFO" USING SCREEN-COMAREA,                   080813ma
083600*                               FILE-INFOBUF, FILE-INFOBUFLEN.    080813ma
083700*     IF VPLUS-ERRORS PERFORM 9000-VPLUS-ERROR.                   080813ma
083800                                                                  080813ma
083900 01 SPECTABLE.                                                    081120ma
084000    02 SPECTABLE-ENTRIES OCCURS 20.                               081120ma
084100       10 SPEC PIC X(80).                                         081120ma
084200                                                                  081120ma
084300                                                                  081120ma
084400 01 FORM-INFOBUF.                                                 080813ma
084500   05 FORM-NUMBER-OF-ENTRIES  PIC S9(4) COMP.                     080813ma
084600   05 FORM-ENTRY-LENGTH       PIC S9(4) COMP.                     080813ma
084700   05 FORM-ENTRY-TABLE OCCURS 256 TIMES.                          080813ma
084800      10 FORM-FORM-NAME            PIC X(15).                     080813ma
084900      10 FORM-FILLER1              PIC X.                         080813ma
085000      10 FORM-FORM-NUMBER          PIC S9(4) COMP.                080813ma
085100      10 FORM-NUMBER-OF-FIELDS     PIC S9(4) COMP.                080813ma
085200      10 FORM-BUF-LENGTH           PIC S9(4) COMP.                080813ma
085300      10 FORM-NEXT-FORM            PIC X(15).                     080813ma
085400      10 FORM-FILLER2              PIC X.                         080813ma
085500      10 FORM-REPEAT-OPTION        PIC X.                         080813ma
085600      10 FORM-NFORM-OPTION         PIC X.                         080813ma
085700 01 FORM-INFOBUFLEN            PIC S9(4) COMP VALUE 62.           080813ma
085800                                                                  080813ma
085900 01 ACTUAL-FORM-COUNT pic s9(4) comp value 0.                     ma080814
086000                                                                  080813ma
086100***************************************** VGETFORMINFO EXAMPLE    080813ma
086200*MOVE SPACES TO FORM-INFOBUF.                                     080813ma
086300*:                                                                080813ma
086400*MOVE 3 TO FORM-NUMBER-OF-ENTRIES.                                080813ma
086500*MOVE 20 TO FORM-ENTRY-LENGTH.                                    080813ma
086600*MOVE "FORM1 " TO FORM-FORM-NAME.                                 080813ma
086700*CALL "VGETFORMINFO" USING SCREEN-COMAREA,                        080813ma
086800*                          FORM-INFOBUF, FORM-INFOBUFLEN.         080813ma
086900                                                                  080813ma
087000                                                                  080813ma
087100 01 SPECIDX1              PIC S9(4) COMP VALUE 0.                 080813ma
087200 01 SPECIDX2              PIC S9(4) COMP VALUE 0.                 080813ma
087300 01 SPECIDX3              PIC S9(4) COMP VALUE 0.                 080813ma
087400 01 FIELD-SPECBUFLEN      PIC S9(4) COMP VALUE 0.                 080813ma
087500 01 FIELD-SPECBUF.                                                080813ma
087600    05 SPECBUFF-ENTRIES OCCURS 512 TIMES.                         080813ma
087700       10 SCRN-ODR-FLDNBR PIC S9(4) COMP.                         080813ma
087800       10 CHGTYP          PIC S9(4) COMP.                         080813ma
087900       10 FLD-SPEC        PIC XXXX.                               080813ma
088000                                                                  080813ma
088100 01 FIELD-INFOBUF.                                                080813ma
088200    05 FIELD-NUMBER-OF-ENTRIES PIC S9(4) COMP.                    080813ma
088300    05 FIELD-ENTRY-LENGTH      PIC S9(4) COMP.                    080813ma
088400    05 FIELD-FORM-NAME         PIC X(15).                         080813ma
088500    05 FIELD-FILLER            PIC X.                             080813ma
088600    05 FIELD-ENTRY-TABLE OCCURS 128 TIMES.                        080813ma
088700       10 FIELD-FIELD-NAME     PIC X(15).                         080813ma
088800       10 FIELD-FILLER         PIC X.                             080813ma
088900       10 FIELD-SCREEN-ORD-NUM PIC S9(4) COMP.                    080813ma
089000       10 FIELD-NUM            PIC S9(4) COMP.                    080813ma
089100       10 FIELD-LENGTH         PIC S9(4) COMP.                    080813ma
089200       10 FIELD-POSITION       PIC S9(4) COMP.                    080813ma
089300       10 FIELD-ENHANCE        PIC X(4).                          080813ma
089400 01 FIELD-INFOBUFLEN           PIC S9(4) COMP VALUE 80.           080813ma
089500 01  THIS-TIMESTAMP.                                              ma080814
089600     05 TS-LAYOUT.                                                ma080814
089700        10 VTIMESTAMP     PIC S9(9) COMP.                         ma080814
089800        10 VTS-BYTES REDEFINES VTIMESTAMP.                        ma080814
089900         12 VTS-WORD1 PIC S9(4) COMP.                             ma080814
090000         12 VTS-WORD1-BIT REDEFINES VTS-WORD1 PIC XX.             ma080814
090100         12 VTS-WORD2 PIC S9(4) COMP.                             ma080814
090200         12 VTS-WORD2-BIT REDEFINES VTS-WORD2 PIC XX.             ma080814
090300        10 CALENDAR-PARM.                                         ma080814
090400            15 CAL-INT    PIC S9(4) COMP.                         ma080814
090500        10 CLOCK-PARM.                                            ma080814
090600            15 CLOCK-DINT PIC S9(9) COMP.                         ma080814
090700        10 THIS-CLOCK REDEFINES  CLOCK-PARM.                      ma080814
090800         12 CLK-WORD1 PIC S9(4) COMP.                             ma080814
090900         12 CLK-WORD1-BIT REDEFINES CLK-WORD1 PIC XX.             ma080814
091000         12 CLK-WORD2 PIC S9(4) COMP.                             ma080814
091100         12 CLK-WORD1-BIT REDEFINES CLK-WORD2 PIC XX.             ma080814
091200                                                                  ma080814
091300                                                                  ma080814
091400 01 Collate-Str          Pic x(64).                               080813ma
091500 01  TDAY                PIC X(8)  VALUE SPACES.                  080813ma
091600 01  TNUMDAY             PIC S9(9) COMP VALUE 0.                  080813ma
091700 01  TDOW                PIC S9(4) COMP VALUE 0.                  080813ma
091800 01  DDAY                PIC X(8)  VALUE SPACES.                  080813ma
091900 01  DNUMDAY             PIC S9(9) COMP VALUE 0.                  080813ma
092000 01  DDOW                PIC S9(4) COMP VALUE 0.                  080813ma
092100 01  DCNT                PIC S9(4) COMP VALUE 0.                  080813ma
092200 01  PICZ5 PIC Z,ZZZ.                                             080813ma
092300 01  WS-LOGON-DESC                       VALUE SPACES.            080813ma
092400     05  WS-LD-JOB-NAME      PIC  X(16).                          080813ma
092500     05  WS-LD-ACCT-NAME     PIC  X(16).                          080813ma
092600     05  WS-LD-ACCT-PASS     PIC  X(16).                          080813ma
092700     05  WS-LD-USER-NAME     PIC  X(16).                          080813ma
092800     05  WS-LD-USER-PASS     PIC  X(16).                          080813ma
092900     05  WS-LD-GROUP-NAME    PIC  X(16).                          080813ma
093000     05  WS-LD-GROUP-PASS    PIC  X(16).                          080813ma
093100 01  WS-ERR PIC S9(4) COMP VALUE 0.                               080813ma
093200 01  WS-ERR-MSG PIC X(80) VALUE SPACES.                           080813ma
093300 01  LAST-CREATOR  PIC X(30) VALUE SPACES.                        080813ma
093400 01  THIS-CREATOR  PIC X(30) VALUE SPACES.                        080813ma
093500 01  IDX           PIC S9(4) COMP VALUE 0.                        080813ma
093600 01  DBMSTR-RECNO  PIC S9(9) COMP VALUE 0.                        080813ma
093700 01  MYTALLY             PIC S9(9) COMP VALUE 0.                  080813ma
093800* 01  TDAY                PIC X(8)  VALUE SPACES.                 080813ma
093900* 01  TNUMDAY             PIC S9(9) COMP VALUE 0.                 080813ma
094000* 01  TDOW                PIC S9(4) COMP VALUE 0.                 080813ma
094100* 01  DDAY                PIC X(8)  VALUE SPACES.                 080813ma
094200* 01  DNUMDAY             PIC S9(9) COMP VALUE 0.                 080813ma
094300* 01  DDOW                PIC S9(4) COMP VALUE 0.                 080813ma
094400 01 OLD-FDFCNT PIC S9(4) COMP VALUE 0.                            080813ma
094500 01  Y                PIC S9(4) COMP VALUE 0.                     080813ma
094600 01 clearscreen.                                                  080813ma
094700    02 filler pic x value %33.                                    080813ma
094800    02 filler pic x value "E".                                    080813ma
094900 01 FKEY-TEST1 PIC X(100) VALUE SPACES.                           080813ma
095000 01 FKEY-TEST2 PIC X(100) VALUE SPACES.                           080813ma
095100 01  DECIMAL-VALUE         PIC S9(4) COMP VALUE 0.                080813ma
095200 01  DISP-N                PIC ZZZ9 VALUE ZERO.                   080813ma
095300 01 EDIT-MESSAGE           PIC X(120).                            080813ma
095400 01 THISFORM-FLDCNT   PIC S9(18) COMP VALUE 0.                    ma080814
095500 01 THISFILE-FRMCNT   PIC S9(18) COMP VALUE 0.                    ma080814
095600 01 IROW                  PIC S9(4) COMP  VALUE 0.                ma080814
095700 01 XCOL                  PIC S9(4) COMP  VALUE 0.                ma080814
095800 COPY NXUNIQ  OF J3KLIB.                                          080902ma
095900 COPY DBSTAT  OF J3KLIB.                                          080902ma
096000 COPY FFFLDS  OF J3KLIB.                                          080813ma
096100 COPY FFMSTR  OF J3KLIB.                                          080813ma
096200 COPY FMMSTR  OF J3KLIB.                                          080828MA
096300 01 FMMSAV-BUFFER.                                                081114ma
096400    02 FMMSAV-VFIL-UNIQUE                PIC S9(09) COMP VALUE 0. 081114ma
096500    02 FMMSAV-FM-UNIQUE                  PIC S9(09) COMP VALUE 0. 081114ma
096600    02 FMMSAV-SVR-UNIQUE                 PIC S9(09) COMP VALUE 0. 081114ma
096700    02 FMMSAV-FRM-NAME                   PIC X(016) VALUE SPACES. 081114ma
096800    02 FMMSAV-PAN-NAME                   PIC X(016) VALUE SPACES. 081114ma
096900    02 FMMSAV-PAN-TYPE                   PIC X(006) VALUE SPACES. 081114ma
097000    02 FMMSAV-FRM-NUMBER                 PIC S9(09) COMP VALUE 0. 081114ma
097100    02 FMMSAV-FLDCNT                     PIC S9(18) COMP VALUE 0. 081114ma
097200    02 FMMSAV-BUF-LEN                    PIC S9(18) COMP VALUE 0. 081114ma
097300    02 FMMSAV-NEXT-FRM                   PIC X(016) VALUE SPACES. 081114ma
097400    02 FMMSAV-REPEAT-OPT                 PIC X(002) VALUE SPACES. 081114ma
097500    02 FMMSAV-NFORM-OPT                  PIC X(002) VALUE SPACES. 081114ma
097600    02 FMMSAV-REPRODUCED-FR              PIC X(16) VALUE SPACES.  081114ma
097700    02 FMMSAV-FKEY-DEF                   PIC X(2) VALUE SPACES.   081114ma
097800    02 FMMSAV-COMMENT                    PIC X(80) VALUE SPACES.  081114ma
097900 COPY prspec  OF J3KLIB.                                          080902ma
098000 COPY SRVMST  OF J3KLIB.                                          080902ma
098100 COPY AMSCOMM OF J3KLIB.                                          080813ma
098200                                                                  080813ma
098300*=================================================================080813ma
098400$PAGE  "Main logical flow"                                        080813ma
098500*=================================================================080813ma
098600 PROCEDURE DIVISION.                                              080813ma
098700 BEGIN-0000.                                                      080813ma
098800     CALL   INTRINSIC "WHO"                                       080813ma
098900     USING  WHO-MODE WHO-CAPABILITY WHO-LATTR WHO-USERN           080813ma
099000            WHO-GROUPN WHO-ACCTN WHO-HOMEN WHO-TERM-DEV-NO.       080813ma
099100     MOVE WHO-MODE TO USER-MODE.                                  080813ma
099200     IF WHO-ACCTN(1:3) <> "SYS" OR                                080813ma
099300        WHO-USERN(1:7) <> "MANAGER" OR                            080813ma
099400        WHO-GROUPN(1:3) <> "J3K"                                  080813ma
099500       DISPLAY "PLEASE LOGON AS MANAGER.SYS,J3K"                  080813ma
099600       DISPLAY "This program will not run as "                    080813ma
099700               WHO-USERN "." WHO-ACCTN "," WHO-GROUPN             080813ma
099800       STOP RUN.                                                  080813ma
099900     MOVE "VPLUS Documentation Tool version C.7.3" TO M.          080813ma
100000     PERFORM MSG-PROCESS                                          080813ma
100100     MOVE "------------------------------------------------" TO M.080813ma
100200     PERFORM MSG-PROCESS                                          080813ma
100300     MOVE "***            MIG801.PUB.J3K                ***" TO M.080902ma
100400     PERFORM MSG-PROCESS                                          080813ma
100500     MOVE "***                                          ***" TO M.080813ma
100600     PERFORM MSG-PROCESS                                          080813ma
100700     MOVE "***    Adding VPLUS data to MIGDB.PUB.J3K    ***" TO M.080902ma
100800     PERFORM MSG-PROCESS                                          080813ma
100900     MOVE "***                                          ***" TO M.080813ma
101000     PERFORM MSG-PROCESS                                          080813ma
101100     MOVE "------------------------------------------------" TO M.080813ma
101200     PERFORM MSG-PROCESS                                          080813ma
101300     CALL "GETCURRENT" USING TDAY TNUMDAY TDOW.                   080813ma
101400     PERFORM INITIALIZATION.                                      080813ma
101500     PERFORM Process-File.                                        ma080814
101600     PERFORM PROCESS-COMPLETION.                                  081120ma
101700*---------------------------------------------------------------- 080831ma
101800 Process-Completion.                                              080831ma
101900     DISPLAY "files:     " MY-NEW-FILCNT.                         080828MA
102000     DISPLAY "forms:     " MY-NEW-frmCNT.                         080828MA
102100     DISPLAY "fields:    " MY-NEW-fldCNT.                         080828MA
102200     DISPLAY "Procspecs: " MY-NEW-spcCNT.                         080828MA
102300     COMPUTE CAPACITY-FILES                                       080813ma
102400     = (MY-NEW-FILCNT * 0.2) + MY-NEW-FILCNT.                     080828MA
102500     COMPUTE CAPACITY-FORMS                                       080813ma
102600     = (MY-NEW-frmCNT * 0.2) + MY-NEW-frmCNT.                     080828MA
102700     COMPUTE CAPACITY-FIELDS                                      080828MA
102800     = (MY-NEW-fldCNT * 0.2) + MY-NEW-fldCNT.                     080828MA
102900     COMPUTE CAPACITY-SPECS                                       080828MA
103000     = (MY-NEW-spcCNT * 0.2) + MY-NEW-spcCNT.                     080828MA
103100     MOVE "MIG_FM_FILES~" TO VAR-NAME.                            080813ma
103200     MOVE CAPACITY-FILES TO VAR-VALUE-I.                          MA081215
103300     DISPLAY CAPACITY-FILES.                                      080828MA
103400     PERFORM PUT-NUMVAR.                                          080813ma
103500     DISPLAY CAPACITY-FORMS.                                      080813ma
103600     MOVE "MIG_FM_FORMS~" TO VAR-NAME.                            080813ma
103700     MOVE CAPACITY-FORMS TO VAR-VALUE-I.                          080813ma
103800     PERFORM PUT-NUMVAR.                                          080813ma
103900     DISPLAY CAPACITY-FIELDS.                                     080813ma
104000     MOVE "MIG_FM_FIELDS~" TO VAR-NAME.                           080813ma
104100     MOVE CAPACITY-FIELDS TO VAR-VALUE-I.                         080813ma
104200     PERFORM PUT-NUMVAR.                                          080813ma
104300     MOVE "MIG_FM_SPECS~" TO VAR-NAME.                            080828MA
104400     MOVE CAPACITY-SPECS TO VAR-VALUE-I.                          080828MA
104500     DISPLAY CAPACITY-SPECS.                                      081124ma
104600     PERFORM PUT-NUMVAR.                                          080828MA
104700     Go To 9999-RETURN.                                           080813ma
104800*=================================================================080813ma
104900$PAGE  "Major SubParagraphs"                                      080813ma
105000*=================================================================080813ma
105100 INITIALIZATION.                                                  080813ma
105200D    DISPLAY "INITIALIZATION".                                    080831ma
105300     MOVE FUNCTION CURRENT-DATE TO FULL-CURRENT-DATE.             080813ma
105400     OPEN OUTPUT DMG01A3-FILE.                                    080813ma
105500     MOVE C-DATE TO RAW-DATE.                                     080813ma
105600     MOVE CORR RAW-DATE TO EDITED-DATE.                           080813ma
105700     CALL   INTRINSIC "WHO"                                       080813ma
105800     USING  WHO-MODE WHO-CAPABILITY WHO-LATTR WHO-USERN           080813ma
105900            WHO-GROUPN WHO-ACCTN WHO-HOMEN WHO-TERM-DEV-NO.       080813ma
106000     INITIALIZE TOTAL-FILES TOTAL-FORMS TOTAL-FIELDS CSTR.        080813ma
106100     Perform ShowTime.                                            080813ma
106200     PERFORM GET-HPSUSAN.                                         080813ma
106300     Initialize DATABASE-TABLE My-BaseName.                       080813ma
106400     Initialize DATABASE-TABLE My-BaseName.                       080902ma
106500     MOVE 128 TO GINFO-LEN.                                       080902ma
106600     INITIALIZE GINFO-STR GINFO-PARM.                             080902ma
106700     MOVE 9 TO MIGDB.                                             080902ma
106800     MOVE "MIGDB.PUB.J3K" TO DbName(MIGDB)                        080902ma
106900     MOVE "J3K;" TO SEARCH-ITEM.                                  080902ma
107000     CALL "DBOPEN" USING                                          080902ma
107100      DATA-BASE-NAME(MIGDB) SEARCH-ITEM MODE-1 STATUS-AREA.       080902ma
107200     IF IMAGE-ERRORS PERFORM 9000-IMAGE-ERROR.                    080902ma
107300     MOVE STATUS-AREA TO MIGDB-STATUS.                            080902ma
107400     INITIALIZE SrvMST-BUFFER.                                    080902ma
107500     MOVE ";" TO NULL-ITEM.                                       080902ma
107600     Move 1 to SEARCH-KEY-I2.                                     080902ma
107700     Perform Get-SRVMST-Keyed.                                    080902ma
107800     If No-Entry                                                  080902ma
107900      Display "No server record found"                            080902ma
108000      Call Intrinsic "QUIT" Using \1\.                            080902ma
108100     MOVE FUNCTION CURRENT-DATE TO FULL-CURRENT-DATE.             080902ma
108200     MOVE C-DATE TO RAW-DATE.                                     080902ma
108300     MOVE CORR RAW-DATE TO EDITED-DATE.                           080902ma
108400     perform GET-HPSUSAN.                                         080902ma
108500     IF SRVMST-SVR-SUSAN <> MYHPSUSAN                             080902ma
108600      DISPLAY "****************************"                      080902ma
108700      DISPLAY "* INSTALLATION PROBLEM     *"                      080902ma
108800      DISPLAY "*                          *"                      080902ma
108900      DISPLAY "* Invalid License          *"                      080902ma
109000      DISPLAY "****************************"                      080902ma
109100      Call Intrinsic "QUIT" Using \1\.                            080902ma
109200*     Display  "Server: " SRVMST-SVR-NAME.                        080902ma
109300*     Display  "HPSUSAN: " SRVMST-SVR-SUSAN.                      080902ma
109400*     Display  "MPE/iX version: " SRVMST-SVR-MPEVERSION.          080902ma
109500     Initialize MYCOST MYMONEY MYBYTES CSTR CERR CPARM CMSG.      080902ma
109600     MOVE 128 TO GINFO-LEN.                                       080813ma
109700     INITIALIZE GINFO-STR GINFO-PARM.                             080813ma
109800     INITIALIZE GINFO-STR GINFO-PARM.                             080831ma
109900     CALL INTRINSIC "GETINFO" USING GINFO-STR GINFO-LEN           080831ma
110000                                    GINFO-PARM.                   080831ma
110100     IF GINFO-LEN > 0                                             080831ma
110200D       DISPLAY "INFO LEN= [" GINFO-LEN  "]"                      080831ma
110300        MOVE GINFO-STR(1:GINFO-LEN) TO SCREEN-FORMS-FILE          080831ma
110400        PERFORM VGETINFO                                          080831ma
110500        PERFORM Process-Completion                                080831ma
110600        Go To 9999-RETURN.                                        080831ma
110700                                                                  080831ma
110800     Initialize MYCOST MYMONEY MYBYTES CSTR CERR CPARM CMSG.      080813ma
110900     Initialize Script-Str.                                       080813ma
111000     Initialize CSTR CERR CPARM CMSG.                             080813ma
111100     MOVE "Purge DMG01A1,Temp" to CMD.                            080813ma
111200     Perform MPE-COMMAND.                                         080813ma
111300                                                                  080813ma
111400     MOVE "Purge DMG01A1" to CMD.                                 080813ma
111500     Perform MPE-COMMAND.                                         080813ma
111600                                                                  080813ma
111700     MOVE "Purge DMG01A2" to CMD.                                 080813ma
111800     Perform MPE-COMMAND.                                         080813ma
111900                                                                  080813ma
112000     MOVE "Purge DMG01A2,Temp" to CMD.                            080813ma
112100     Perform MPE-COMMAND.                                         080813ma
112200                                                                  080813ma
112300     MOVE "File DMG01A1;rec=-62,1,f,ascii;disc=16384;save" to CMD.080813ma
112400     Perform MPE-COMMAND.                                         080813ma
112500     MOVE SPACES TO CMD.                                          081208ma
112600     STRING "LISTFILE @.@.@;Seleq=[CODE=1035]"                    MA090330
112700            ";format=qualify >>*DMG01A1"                          081208ma
112800      DELIMITED BY SIZE INto CMD.                                 081208ma
112900     Perform MPE-COMMAND.                                         080813ma
113000     MOVE "File DMG01A1=DMG01A1,OLD" TO CMD.                      080813ma
113100     Perform MPE-COMMAND.                                         080813ma
113200*    MOVE                                                         080813ma
113300*     "LISTFILE @.@.@;Seleq=[CODE=1035];format=qualify >>*DMG01A1"080813ma
113400*     to CMD.                                                     080813ma
113500*    Perform MPE-COMMAND.                                         080813ma
113600     Initialize CMD.                                              080813ma
113700                                                                  080813ma
113800     Sort SortFile ASCENDING KEY SORT-KEY                         080813ma
113900       Using ExtFile1 Giving ExtFile2.                            080813ma
114000                                                                  080813ma
114100     Open Input ExtFile2.                                         080813ma
114200                                                                  080813ma
114300*-----------------------------------------------------------------080813ma
114400 Process-File.                                                    ma080814
114500D    DISPLAY "Process-File".                                      080831ma
114600     MOVE 1 TO Db-Ptr.                                            080813ma
114700     MOVE 0 TO DB-CNT.                                            080813ma
114800     Perform varying DB-Idx From 1 By 1                           080813ma
114900       Until ( EXTFILE-EOF ) Or ( DB-Idx > 9999 )                 080813ma
115000      READ EXTFILE2                                               080813ma
115100       AT END                                                     080813ma
115200        MOVE "9" TO EXTFILE-STATUS                                080813ma
115300       NOT AT END                                                 080813ma
115400       ADD 1 TO DB-CNT                                            080813ma
115500       INITIALIZE FFMSTR-BUFFER                                   080813ma
115600       Move EXT-REC2 To SCREEN-FORMS-FILE                         ma080814
115700       Display SCREEN-FORMS-FILE WITH NO ADVANCING                080902ma
115800       MOVE "SHOWTIME" TO CMD                                     080831ma
115900       PERFORM MPE-COMMAND                                        080831ma
116000       PERFORM VGETINFO                                           080820MA
116100* N O T E:  The above perform "VGETINFO" has loaded the           080820MA
116200*           Forms-File-Data area using the VGET__INFO intrinsics. 080820MA
116300       If SCREEN-CSTATUS <> 0                                     080820MA
116400        Display "*  Error occured " SCREEN-CSTATUS                080820MA
116500        Display "* Skipping FORMSFILE"                            080820MA
116600        MOVE 0 TO SCREEN-CSTATUS                                  080820MA
116700       END-IF                                                     080830ma
116800      End-Read                                                    080830ma
116900     End-Perform.                                                 080813ma
117000*=================================================================080813ma
117100$page "MISC SubParagraphs"                                        080813ma
117200*=================================================================080813ma
117300 GET-NUM.                                                         080813ma
117400D    DISPLAY "GET-NUM".                                           080813ma
117500     INITIALIZE NUM2 NUMDEC NUMERR.                               080813ma
117600     CALL "NUMGET" USING NUM1 NUM2 NUMDEC NUMERR.                 080813ma
117700     IF NUMERR NOT = 0 MOVE 0 TO NUM2.                            080813ma
117800     IF NUMDEC NOT = 0 MOVE 0 TO NUM2.                            080813ma
117900*---------------------------------------------------------        080813ma
118000 MPE-COMMAND.                                                     080813ma
118100D    DISPLAY "MPE-COMMAND".                                       080813ma
118200     INITIALIZE CSTR.                                             080813ma
118300     STRING CMD DELIMITED BY "  " %15                             MA090526
118400      DELIMITED BY SIZE INTO CSTR.                                MA090526
118500     Move 2 To CMSG.                                              080813ma
118600D    DISPLAY CMD(1:79).                                           080813ma
118700     CALL INTRINSIC "HPCICOMMAND" USING                           080813ma
118800          CSTR CERR CPARM CMSG.                                   080813ma
118900     IF CERR <> 0                                                 MA090526
119000      DISPLAY CERR                                                MA090526
119100      DISPLAY CMD                                                 MA090526
119200      DISPLAY CMSG.                                               MA090526
119300     INITIALIZE CMD.                                              080813ma
119400*---------------------------------------------------------        080813ma
119500 SHOWTIME.                                                        080813ma
119600     CALL INTRINSIC "HPCICOMMAND" USING                           080813ma
119700          SHOWTIME-STR CERR CPARM CMSG.                           080813ma
119800*--------------------------------------------------------         080813ma
119900 GET-HPSUSAN.                                                     080813ma
120000     MOVE "HPSUSAN~" TO HPVAR-NAME.                               080813ma
120100     MOVE 1 TO HPVAR-ITEMNUM.                                     080813ma
120200     INITIALIZE MYHPSUSAN HPVAR-ITEM HPVAR-STAT.                  080813ma
120300     CALL INTRINSIC "HPCIGETVAR" USING HPVAR-NAME                 080813ma
120400         HPVAR-STAT HPVAR-ITEMNUM MYHPSUSAN.                      080813ma
120500*     DISPLAY "HPSUSAN: " MYHPSUSAN.                              080813ma
120600*------------------------------------------------------------     080813ma
120700 MSG-PROCESS.                                                     080813ma
120800*      DISPLAY "MSG-PROCESS".                                     080831ma
120900     DISPLAY M.                                                   080813ma
121000     INITIALIZE CSTR.                                             080813ma
121100     STRING "TELLOP " M  %15 DELIMITED BY SIZE INTO CSTR.         080813ma
121200     Move 2 To CMSG.                                              080813ma
121300     IF BATCH-PROCESS OR NOT-INTERACTIVE                          080813ma
121400      CALL INTRINSIC "HPCICOMMAND" USING                          080813ma
121500           CSTR CERR CPARM CMSG.                                  080813ma
121600     INITIALIZE M CMD.                                            080813ma
121700*--------------------------------------------------------------   080813ma
121800 PUT-NUMVAR.                                                      080813ma
121900     MOVE ZEROS TO VAR-STATUS.                                    080813ma
122000     CALL INTRINSIC "HPCIPUTVAR" USING VAR-NAME VAR-STATUS ITEM-1 080813ma
122100       VAR-VALUE-I.                                               080813ma
122200     IF VAR-STATUS NOT = ZERO                                     080813ma
122300       DISPLAY "Error calling HPCIPUTVAR: " VAR-STATUS.           080813ma
122400*----------------------------                                     080813ma
122500 Load-Form-Source.                                                ma080814
122600D    Display " Load-Form-Source.".                                081124ma
122700     INITIALIZE CMD forms-data.                                   080813ma
122800     Perform Fopen-Formsfile.                                     080813ma
122900     MOVE 256 TO DATA-LEN.                                        080813ma
123000     Perform varying DB-Idx From 1 By 1                           080813ma
123100       Until ( EXTFILE-EOF ) Or ( DB-Idx > 32766 )                080813ma
123200      Read Forma-File                                             080813ma
123300          At End     Move '1' To Formsfile-Sw                     080813ma
123400          Not At End                                              080813ma
123500       Move '0' To Formsfile-Sw                                   080813ma
123600       Add 1 to frdcnt                                            080813ma
123700       Move Form-Rec to frdstr(frdcnt)                            080813ma
123800       Move Frdstr(frdcnt)(1:2) To Ascii-Character                080813ma
123900       MOVE Frdstr(frdcnt)(3:1) TO FORMFILES-REC-TYPE-SW          080813ma
124000      End-Read                                                    080813ma
124100     End-Perform.                                                 080813ma
124200     CLOSE FORMA-FILE.                                            080813ma
124300D    Display SCREEN-FORMS-FILE "Records : " frdcnt.               081124ma
124400*--------------------------------                                 080813ma
124500 Fopen-Formsfile.                                                 080813ma
124600D    DISPLAY "Fopen-Formsfile".                                   081008ma
124700     MOVE 1 TO S1.                                                080813ma
124800     INSPECT SCREEN-FORMS-FILE                                    ma080814
124900      TALLYING S1 FOR CHARACTERS BEFORE ' '.                      080813ma
125000     IF S1 > 28 MOVE 28 TO S1.                                    080813ma
125100     MOVE 'FILE FORM='           TO CMD.                          080813ma
125200     MOVE SCREEN-FORMS-FILE(1:S1) TO CMD(11:).                    ma080814
125300     Perform MPE-COMMAND.                                         080813ma
125400     MOVE "FORMFILE" TO FNAME.                                    080813ma
125500     OPEN INPUT FORMA-FILE.                                       080813ma
125600     IF FORMFILE-STATUS <> "00"                                   080813ma
125700        PERFORM 9001-FILE-ERROR.                                  080813ma
125800     MOVE ZERO TO FORMFILE-COUNT.                                 080813ma
125900     MOVE "01" TO  FORMFILE-FLAG.                                 080813ma
126000*--------------------------------                                 080830ma
126100 OPEN-GFILE-OUTPUT.                                               080830ma
126200*    DISPLAY "OPEN-GFILE-OUTPUT".                                 080831ma
126300     MOVE 'FILE GFILE=GFILE,OLD'  TO CMD.                         080830ma
126400     Perform MPE-COMMAND.                                         080830ma
126500     MOVE 'PURGE GFILE'           TO CMD.                         080830ma
126600     Perform MPE-COMMAND.                                         080830ma
126700     MOVE 'PURGE GFILE'           TO CMD.                         080830ma
126800     Perform MPE-COMMAND.                                         080830ma
126900     MOVE 'BUILD GFILE;REC=-1540,1,F,BINARY;DISC=16384' TO CMD.   080830ma
127000     Perform MPE-COMMAND.                                         080830ma
127100     MOVE "GFILE" TO FNAME.                                       080830ma
127200     OPEN OUTPUT G-FILE.                                          080830ma
127300     IF GFILE-STATUS <> "00" PERFORM 9001-FILE-ERROR.             080830ma
127400     MOVE ZERO TO GFILE-RCOUNT GFILE-COUNT.                       080830ma
127500     MOVE "02" TO GFILE-FLAG.                                     080830ma
127600*--------------------------------                                 080830ma
127700 OPEN-GFILE-INPUT.                                                080830ma
127800*    DISPLAY "OPEN-GFILE-INPUT ".                                 080831ma
127900     MOVE "GFILE" TO FNAME.                                       080830ma
128000     OPEN INPUT G-FILE.                                           080830ma
128100     IF GFILE-STATUS <> "00" PERFORM 9001-FILE-ERROR.             080830ma
128200     MOVE ZERO   TO GFILE-RCOUNT.                                 080830ma
128300     MOVE "01" TO GFILE-FLAG.                                     080830ma
128400*--------------------------------                                 080830ma
128500 READ-GFILE.                                                      080830ma
128600*    DISPLAY "READ-GFILE ".                                       080831ma
128700     MOVE "GFILE" TO FNAME.                                       080830ma
128800     Read G-File                                                  080830ma
128900      At End                                                      080830ma
129000          INITIALIZE G-RECORD                                     080831ma
129100          Move '99' To GFILE-FLAG                                 080830ma
129200      Not At End                                                  080830ma
129300        IF GFILE-STATUS <> "00"                                   080830ma
129400         PERFORM 9001-FILE-ERROR                                  080830ma
129500        END-IF                                                    080830ma
129600        ADD 1 TO GFILE-RCOUNT                                     080830ma
129700        Move G-REC TO G-RECORD.                                   080831ma
129800*--------------------------------                                 080830ma
129900 WRITE-GFILE.                                                     080830ma
130000*    DISPLAY "WRITE-GFILE ".                                      080831ma
130100     MOVE "GFILE" TO FNAME.                                       080830ma
130200     MOVE G-RECORD TO G-REC.                                      080831ma
130300     WRITE G-REC.                                                 080830ma
130400     IF GFILE-STATUS <> "00" PERFORM 9001-FILE-ERROR.             080830ma
130500     ADD 1 TO GFILE-COUNT.                                        080830ma
130600*--------------------------------                                 080830ma
130700 CLOSE-GFILE.                                                     080830ma
130800*    DISPLAY "CLOSE-GFILE ".                                      080831ma
130900     MOVE "GFILE" TO FNAME.                                       080830ma
131000     CLOSE G-FILE.                                                080830ma
131100     MOVE SPACES TO GFILE-FLAG.                                   080830ma
131200                                                                  080820MA
131300*                                                                 080813ma
131400*---------------------------------------------------------------  080820MA
131500 Link-VF-Pointers.                                                080820MA
131600*                                                                 080830ma
131700* If an "E" record type is found, then this is a valid form.      080830ma
131800*                                                                 080830ma
131900*           Now go get the design form records.                   080830ma
132000*                                                                 080830ma
132100* The design form screen in formspec stores the screen data       080830ma
132200* in two separate records, the "V" and "F" record types.          080830ma
132300* If both records are not found with the same record length       080830ma
132400* then this is not a valid form.                                  080830ma
132500*                                                                 080830ma
132600* -- N O T E --                                                   080813ma
132700*            If FDATA-REPRODUCED-FR is not blank, then this       080813ma
132800*            form will not have a "V" and "F" record type.        080813ma
132900*            Instead find the "V" and "F" records where the       080813ma
133000*            Design-Name matches the value in FDATA-REPRODUCED-FR.080813ma
133100*                                                                 080813ma
133200*                                                                 080813ma
133300* L O A D    F D E S I G N    P O I N T E R S                     080813ma
133400d    display "load fdesign".                                      080831ma
133500D    DISPLAY "FMMSTR-REPRODUCED-FR: [" FMMSTR-REPRODUCED-FR "]".  080831ma
133600D    DISPLAY "FMMSTR-FRM-NAME:      [" FMMSTR-FRM-NAME "]".       080831ma
133700     If FMMSTR-REPRODUCED-FR > SPACES                             080831ma
133800      Move FMMSTR-REPRODUCED-FR to Design-name                    080830ma
133900     ELSE                                                         080820MA
134000      MOVE FMMSTR-FRM-NAME TO Design-name.                        080831ma
134100     Move 16 To i.                                                080831ma
134200     Perform varying i from 16 by -1                              080831ma
134300       until i < 2 or Design-name(i:1) > " "                      080831ma
134400      Continue                                                    080831ma
134500     End-Perform                                                  080831ma
134600     Move i To deslen.                                            080831ma
134700     IF DESLEN < 1 MOVE 1 TO DESLEN.                              080831ma
134800     IF DESLEN < 15 MOVE 15 TO DESLEN.                            080831ma
134900     INITIALIZE F-DESIGN-POINTERS.                                080813ma
135000D    DISPLAY "DESIGN-NAME(1:DESLEN):      ["                      080831ma
135100D             DESIGN-NAME(1:DESLEN) "]".                          080831ma
135200     Perform Varying Frdidx From 1 By 1                           080813ma
135300       Until ( Frdidx > Frdcnt ) or (FDPCNT > 109)                080813ma
135400      Move Frdstr(Frdidx)(1:2) To Ascii-Character                 080813ma
135500      If (Frdstr(Frdidx)(4:deslen) = Design-name(1:deslen))       080813ma
135600          And (Frdstr(Frdidx)(3:1) = "F")                         080813ma
135700          And ( Ascii-Value > 0 )                                 080813ma
135800       ADD 1 TO FDPCNT                                            080813ma
135900       Compute FDP-STRT(FDPCNT) =                                 080813ma
136000        18 + ((Frdidx * 256) - 255 )                              080813ma
136100       End-compute                                                080813ma
136200       Compute FDP-END(FDPCNT) =                                  080813ma
136300        FDP-STRT(FDPCNT) + (Ascii-Value - 20)                     080813ma
136400       End-Compute                                                080813ma
136500       Move Ascii-Value To FDP-LEN(FDPCNT)                        080813ma
136600D       DISPLAY Design-name(1:deslen) "  "                        080831ma
136700D        " F S=" FDP-STRT(FDPCNT)                                 080831ma
136800D        " F E=" FDP-END(FDPCNT)                                  080831ma
136900D        " F L=" FDP-LEN(FDPCNT)                                  080831ma
137000      END-IF                                                      080813ma
137100     END-Perform.                                                 080813ma
137200*                                                                 080813ma
137300* L O A D    V D E S I G N    P O I N T E R S                     080813ma
137400*                                                                 080813ma
137500d    display "load Vdesign".                                      080831ma
137600     INITIALIZE V-DESIGN-POINTERS.                                080813ma
137700     Perform Varying Frdidx From 1 By 1                           080813ma
137800       Until ( Frdidx > Frdcnt ) or (VDPCNT > 109)                080813ma
137900      Move Frdstr(Frdidx)(1:2) To Ascii-Character                 080813ma
138000      If (Frdstr(Frdidx)(4:deslen) = Design-name(1:deslen))       080813ma
138100          And (Frdstr(Frdidx)(3:1) = "V")                         080813ma
138200          And ( Ascii-Value > 0 )                                 080813ma
138300       ADD 1 TO VDPCNT                                            080813ma
138400       Compute VDP-STRT(VDPCNT) =                                 080813ma
138500        18 + ((Frdidx * 256) - 255 )                              080813ma
138600       End-compute                                                080813ma
138700       Compute VDP-END(VDPCNT) =                                  080813ma
138800        VDP-STRT(VDPCNT) + (Ascii-Value - 20)                     080825MA
138900       End-Compute                                                080813ma
139000       Move Ascii-Value To VDP-LEN(VDPCNT)                        080813ma
139100D       DISPLAY Design-name(1:deslen) "  "                        080831ma
139200D        " V S=" VDP-STRT(VDPCNT)                                 080831ma
139300D        " V E=" VDP-END(VDPCNT)                                  080831ma
139400D        " V L=" VDP-LEN(VDPCNT)                                  080831ma
139500      END-IF                                                      080813ma
139600     END-Perform.                                                 080813ma
139700*                                                                 080813ma
139800* L I N K   " F "   A N D    " V "   P O I N T E R S              080813ma
139900*                                                                 080813ma
140000     MOVE "0" TO POINTER-LINK-SW.                                 080825MA
140100     If FDPCNT > 0 and VDPCNT > 0                                 080825MA
140200      PERFORM VARYING FDPIDX FROM 1 BY 1                          080825MA
140300        UNTIL (POINTERS-LINKED) OR (FDPIDX > FDPCNT)              080825MA
140400       PERFORM VARYING VDPIDX FROM 1 BY 1                         080825MA
140500         UNTIL (POINTERS-LINKED) OR (VDPIDX > VDPCNT)             080825MA
140600        IF FDP-LEN(FDPIDX) = VDP-LEN(VDPIDX)                      080825MA
140700         MOVE "1" TO POINTER-LINK-SW                              080825MA
140800         MOVE FDPIDX TO FDPCNT                                    080825MA
140900        END-IF                                                    080825MA
141000       END-PERFORM                                                080825MA
141100      END-PERFORM.                                                080825MA
141200*---------------------------------------------------------        080813ma
141300 GET-SCREEN-OBJECTS.                                              ma080814
141400D    display "GET-SCREEN-OBJECTS.".                               080828MA
141500     Initialize TEXT-BUTTONS.                                     080821MA
141600     MOVE FDP-STRT(FDPCNT) TO startx.                             080813ma
141700     MOVE FDP-END(FDPCNT)  TO endx.                               080813ma
141800     Move FDP-LEN(FDPCNT)  To F-Design-Len.                       080813ma
141900     Initialize F-xlen F-Design.                                  080813ma
142000     Perform Varying xidx from Startx by 1                        080813ma
142100       Until ( xidx > Endx )                                      080813ma
142200          OR ( F-xlen > 16382 )                                   080830ma
142300      Add 1 to F-xlen                                             080813ma
142400      Move frd-table(xidx:1) to F-Design(F-xlen:1)                080813ma
142500D     display f-xlen "[" F-Design(F-xlen:1) "]"                   080831ma
142600     End-Perform.                                                 080813ma
142700D    ACCEPT NUM1.                                                 080831ma
142800D    COMPUTE Y = F-xlen * -1.                                     080831ma
142900D    CALL INTRINSIC "FWRITE" USING \1\ clearscreen \-2\ \0\.      080831ma
143000D    MOVE "PAUSE 2" TO CMD.                                       080831ma
143100D    PERFORM MPE-COMMAND.                                         080831ma
143200D    CALL INTRINSIC "FWRITE" USING \1\ F-Design Y \0\.            080831ma
143300D    ACCEPT NUM1.                                                 080831ma
143400D    Display " ".                                                 080902ma
143500D    Display "Formsfile: [" FFMSTR-VFIL-NAME "]".                 080902ma
143600D    Display "FORM:      [" FMMSTR-FRM-NAME "]".                  080902ma
143700     MOVE "N" TO HAVE-FKEYS-SW.                                   081114ma
143800     Perform GET-ROWS.                                            080813ma
143900* // Now find the Function Key values, if any!                    080813ma
144000     Initialize FKEY-TEST1 FKEY-TEST2 FDATA-FUNCTION-KEYS.        080830ma
144100     If FMMSTR-FKEY-DEF = "X"                                     081114ma
144200      Perform Varying Frdidx From 1 By 1                          081114ma
144300        Until ( Frdidx > Frdcnt )                                 080813ma
144400       Move Frdstr(Frdidx)(1:2) To Ascii-Character                080813ma
144500       If   (Frdstr(Frdidx)(4:S1) = FMMSTR-FRM-NAME(1:S1))        080830ma
144600             And (Frdstr(Frdidx)(3:1) = "H")                      080813ma
144700             And (Ascii-Value  >  140)                            080813ma
144800             And (Ascii-Value  <  180)                            080813ma
144900        Move Frdstr(Frdidx)(19:128) To FDATA-FUNCTION-KEYS        080830ma
145000       End-If                                                     080813ma
145100      End-Perform.                                                081114ma
145200     IF (Fkey(1) > SPACES OR                                      081114ma
145300         Fkey(2) > SPACES OR                                      081114ma
145400         Fkey(3) > SPACES OR                                      081114ma
145500         Fkey(4) > SPACES OR                                      081114ma
145600         Fkey(5) > SPACES OR                                      081114ma
145700         Fkey(6) > SPACES OR                                      081114ma
145800         Fkey(7) > SPACES OR                                      081114ma
145900         Fkey(8) > SPACES )                                       081114ma
146000      MOVE "H" TO HAVE-FKEYS-SW                                   081114ma
146100     END-IF                                                       081114ma
146200     IF ( NO-FKEYS-YET ) AND                                      081114ma
146300        (Text-BtnStr(1) > SPACES OR                               081114ma
146400         Text-BtnStr(2) > SPACES OR                               081114ma
146500         Text-BtnStr(3) > SPACES OR                               081114ma
146600         Text-BtnStr(4) > SPACES OR                               081114ma
146700         Text-BtnStr(5) > SPACES OR                               081114ma
146800         Text-BtnStr(6) > SPACES OR                               081114ma
146900         Text-BtnStr(7) > SPACES OR                               081114ma
147000         Text-BtnStr(8) > SPACES )                                081114ma
147100      MOVE "P" TO HAVE-FKEYS-SW                                   081114ma
147200      PERFORM VARYING X FROM 1 BY 1 UNTIL X > 8                   080820MA
147300       Move Text-BtnStr(x) To Fkey(x)                             080830ma
147400      END-PERFORM.                                                081114ma
147500     IF HARDWARE-FKEYS OR PAINTED-FKEYS                           081114ma
147600      PERFORM VARYING X FROM 1 BY 1 UNTIL X > 8                   081114ma
147700D      Display " _______ "                                        081114ma
147800D      Display "|" FKEY-LINE1(x) "|"                              081114ma
147900D      Display "|" FKEY-LINE2(x) "|"                              081114ma
148000D      Display " _______ "                                        081114ma
148100       Perform ADD-OBJ-FKEY                                       081114ma
148200      END-PERFORM.                                                081114ma
148300*----------------                                                 080813ma
148400 GET-FIELD-DATA.                                                  ma080814
148500D   display " GET-FIELD-DATA.".                                   080828MA
148600     Move 0 To i.                                                 080813ma
148700     Perform varying i from 15 by -1                              080813ma
148800       until i < 2 or FMMSTR-FRM-NAME(i:1) > " "                  080830ma
148900      Continue                                                    080813ma
149000     End-Perform.                                                 080813ma
149100     Move i To S1.                                                080813ma
149200     Move 0 To i.                                                 080813ma
149300     Perform varying i from 15 by -1                              080813ma
149400       until i < 2 or FFFLDS-VFLD-NAME(i:1) > " "                 080830ma
149500      Continue                                                    080813ma
149600     End-Perform.                                                 080813ma
149700     Move i To S2.                                                080813ma
149800     IF S1 > 15 MOVE 15 TO S1.                                    080813ma
149900     IF S2 > 15 MOVE 15 TO S2.                                    080813ma
150000*    Display "SCREEN-NAME [" FMMSTR-FRM-NAME(1:s1) "]"            080831ma
150100*    Display "FIELD-FIELD-NAME [" FFFLDS-VFLD-NAME(1:s2) "]"      080831ma
150200     MOVE "0" TO VALID-G-SW.                                      080831ma
150300     Perform Varying GSIDX From 1 By 1                            080831ma
150400       Until VALID-G OR ( GSIDX > GSCNT )                         080831ma
150500      MOVE GS-FIELD(GSIDX) TO G-FIELD-FORMAT                      080831ma
150600      Move GS-HEADER(GSIDX) to G-HEADER-FORMAT                    080831ma
150700      MOVE 0 TO MYTALLY                                           080831ma
150800*       DISPLAY "GFF " GFF-FORM GFF-FIELD GFF-NUM                 MA081215
150900*       DISPLAY GFF-ENH GFF-FTYPE GFF-DTYPE                       MA081215
151000*       DISPLAY FMMSTR-FRM-NAME FFFLDS-VFLD-NUM                   MA081215
151100      Initialize  num2 numdec numerr                              080831ma
151200      MOVE GFF-NUM TO num1                                        080831ma
151300      call "numget" using num1 num2 numdec numerr                 080831ma
151400      If (NUMERR = 0)                                             080831ma
151500        And (GFF-FORM = FMMSTR-FRM-NAME(1:S1))                    080831ma
151600        And (num2 = FFFLDS-VFLD-NUM)                              080831ma
151700       Initialize  num2 numdec numerr                             080831ma
151800       MOVE GFF-LEN  TO num1                                      080831ma
151900       call "numget" using num1 num2 numdec numerr                080831ma
152000*      IF NUM2 = FFFLDS-VFLD-LENGTH                               MA090303
152100        IF GHF-LENGTH < 1540                                      080831ma
152200         MOVE "1" TO VALID-G-SW                                   080831ma
152300         MOVE GFF-FTYPE          TO FFFLDS-VFLD-TYPE              080831ma
152400         MOVE GFF-DTYPE          TO FFFLDS-VFLD-DATATYPE          080831ma
152500         move GFF-INIT           to FFFLDS-VFLD-INITVAL           080831ma
152600         Perform Get-ProcSpecs                                    080831ma
152700        end-if                                                    080831ma
152800*      END-IF                                                     MA090303
152900      End-If                                                      080831ma
153000     End-Perform.                                                 080813ma
153100     Add 1 to FFFLDS-VFLD-POSITION.                               080830ma
153200     MOVE  FFFLDS-VFLD-POSITION   TO FFFLDS-BUF-X.                080830ma
153300     MOVE  OBJ-STRTCOL(Irow,Xcol) TO FFFLDS-SRN-X RPT-SRN-X.      080830ma
153400     MOVE  OBJ-STRTROW(Irow,Xcol) TO FFFLDS-SRN-Y RPT-SRN-Y.      080830ma
153500     Compute                                                      080830ma
153600      FFFLDS-BUF-Y = FFFLDS-BUF-X + (FFFLDS-VFLD-LENGTH - 1).     080830ma
153700     perform add-field.                                           080828MA
153800     IF VALID-G AND Speclen > 1                                   081120ma
153900      COMPUTE Y = Speclen * -1 END-COMPUTE                        081120ma
154000*     CALL INTRINSIC "FWRITE" USING \1\ GFF-PROCSPECS Y \0\       081120ma
154100      Perform Add-ProcSpecs                                       081124ma
154200     ELSE                                                         081124ma
154300      MOVE SPACES TO FFFLDS-SPECS.                                081124ma
154400     Perform Field-To-Xml.                                        MA090526
154500*---------------------------------------------------              080813ma
154600 Get-ProcSpecs.                                                   080813ma
154700D    Display "Get-ProcSpecs".                                     080831ma
154800     move 1280 to Speclen.                                        080831ma
154900     Move "0" to nonblank-sw.                                     080813ma
155000     If Speclen > 1                                               080831ma
155100      Initialize xidx                                             080831ma
155200      Perform Varying xidx from Speclen by -1                     080831ma
155300        Until ( GFF-PROCSPECS(xidx:1) > Spaces )                  080831ma
155400           or ( xidx < 2 )                                        080831ma
155500       Continue                                                   080831ma
155600      End-Perform.                                                080831ma
155700     Move xidx to Speclen.                                        ma080814
155800*-----------------------------------------------------------      080813ma
155900 GET-ROWS.                                                        080813ma
156000D    Display "GET-ROWS".                                          080831ma
156100* //                                                              080813ma
156200*    The screen image is processed 1 character at a time. As each 080813ma
156300*    character is processed 1 is added to the column value.       080813ma
156400*    In this paragraph F-idx is used to point to 1 character.     080813ma
156500*                                                                 080813ma
156600*    When terminal commands are incountered the appropriate value 080813ma
156700*    will be subtracted from the column value, because commands   080813ma
156800*    do not use any space on the screen.                          080813ma
156900*    When CR/LF is incountered or the column value reaches 80,    080813ma
157000*    then 1 is added to the row value, and the column value is    080813ma
157100*    set to zero.                                                 080813ma
157200*                                                                 080813ma
157300*    Maximum of 32 rows, and 80 columns.                          080813ma
157400*                                                                 080813ma
157500* NOTE: The V/Plus message window, is inserted into the           080813ma
157600*       screen based on the forms file window position setting.   080813ma
157700*                                                                 080813ma
157800* ****  Terminal commands supported in this paragraph:  ****      080821MA
157900                                                                  080821MA
158000*    1.ESC [  Start of a data field                               080821MA
158100*    2.ESC ]  End of a data field                                 080821MA
158200*    3.Ascii decimal value 14; Start line drawing character set.  080821MA
158300*    4.Ascii decimal value 15; End line drawing character set.    080821MA
158400*    5.ESC &d < and one of the following upper case characters >  080821MA
158500*                                                                 080813ma
158600*      CHAR Description                        V/Plus Equivalence 080813ma
158700*         @ End Enhancement                     NONE              080813ma
158800*         A Blink                               B                 080813ma
158900*         B Inverse                             I                 080813ma
159000*         C Blink, Inverse                      BI                080813ma
159100*         D Underline                           U                 080813ma
159200*         E Blink, Underline                    BU                080813ma
159300*         F Inverse, Underline                  IU                080813ma
159400*         G Blink, Inverse, Underline           BIU               080813ma
159500*         H HalfBright                          H                 080813ma
159600*         I Blink, Half Bright                  BH                080813ma
159700*         J Inverse, Half Bright                IH                080813ma
159800*         K Blink, Inverse, Half Bright         BIH               080813ma
159900*         L Underline, Half Bright              UH                080813ma
160000*         M Blink, Underine, HBright            BUH               080813ma
160100*         N Inverse, Underline, HBright         IUH               080813ma
160200*         O Blink, Inverse, Underline, HBright  BIUH              080813ma
160300*         S Secure Field {Newer terminals HP700/XX}               080813ma
160400*                                                                 080813ma
160500     Initialize ALL-ROWS.                                         080813ma
160600     MOVE 33 TO ROWMAX.                                           MA090303
160700     MOVE 1  TO ROWCNT ROWSTART.                                  080813ma
160800* Check if window position is before all rows.                    080813ma
160900     IF FILE-WINDOW-POSITION(1) = 0                               ma080814
161000      PERFORM ADD-OBJ-SCRNMSG                                     080813ma
161100      ADD 1 TO ROWCNT                                             080813ma
161200D     DISPLAY "START NEW ROW" ROWCNT                              MA090323
161300     END-IF                                                       080813ma
161400* Start iterations through screen image                           080813ma
161500     Perform Varying F-idx from 1 by 1                            080813ma
161600       until (F-idx > F-xlen)                                     080813ma
161700          or (ROWCNT > 39)                                        080813ma
161800      ADD 1 TO ROW-COLUMN                                         080813ma
161900* Check for end of line conditions                                080813ma
162000      IF ((F-Design(F-idx:1) = %15)                               080813ma
162100          AND (F-Design(F-idx + 1:1) = %12))                      080813ma
162200        OR ROW-COLUMN > 80                                        080813ma
162300       MOVE F-idx TO ROWEND                                       080813ma
162400       COMPUTE ROWLEN =  ROWEND - ROWSTART END-COMPUTE            080813ma
162500       IF ROWLEN < 1 MOVE 1 TO ROWLEN END-IF                      080813ma
162600       MOVE F-Design(ROWSTART:ROWLEN) TO ROWSTR(ROWCNT)           080813ma
162700D      DISPLAY "SAVING ROW" ROWCNT                                MA090323
162800D      display "[" F-Design(ROWSTART:ROWLEN) "]"                  MA090323
162900       PERFORM GET-TEXT                                           080813ma
163000       COMPUTE ROWSTART = F-idx + 2 END-COMPUTE                   080813ma
163100       move 0 to ROW-COLUMN                                       080813ma
163200       IF ROWCNT > 38                                             080831ma
163300        DISPLAY "MORE THAN 38 ROWS; NOT SUPPORTED"                080831ma
163400       ELSE                                                       080831ma
163500        ADD 1 TO ROWCNT F-idx                                     080831ma
163600D       DISPLAY "START NEW ROW" ROWCNT                            MA090323
163700       END-IF                                                     080831ma
163800* NEW ROW: Check window position                                  080813ma
163900       INITIALIZE ROW-ENTRIES(ROWCNT)                             080813ma
164000      END-IF                                                      080813ma
164100* NOT AT END OF LINE                                              080813ma
164200*                                                                 080813ma
164300* Check for Escaped DATA FIELD                                    080813ma
164400*                                                                 080813ma
164500      IF ((F-Design(F-idx:1) = %33)                               080831ma
164600          AND (F-Design(F-idx + 1:1) = "[" or "{" OR "]" or "}")) 081008ma
164700*       OR (F-Design(F-idx:1) = "[" or "{")                       081008ma
164800       SUBTRACT 2 FROM ROW-COLUMN                                 080813ma
164900      IF (((F-Design(F-idx:1) = %33)                              080831ma
165000       AND (F-Design(F-idx + 1:1) = "[" or "{" ))                 081008ma
165100          OR (F-Design(F-idx:1) = "[" or "{" ))                   081008ma
165200       AND F-Design(F-idx + 2:1) <> "."                           080813ma
165300        PERFORM ADD-OBJ-DATAFIELD                                 080813ma
165400       END-IF                                                     080813ma
165500      ELSE                                                        080813ma
165600       IF (F-Design(F-idx:1) = %33)                               080813ma
165700        PERFORM GET-ESCAPE-SEQ-LENGTH                             080813ma
165800        SUBTRACT ESC-LEN FROM ROW-COLUMN                          080813ma
165900       END-IF                                                     080813ma
166000      END-IF                                                      080813ma
166100*                                                                 080813ma
166200* Check for Line Drawing Character set                            080813ma
166300*                                                                 080813ma
166400      IF (F-Design(F-idx:1) = %17 OR %16)                         080813ma
166500        SUBTRACT 1 FROM ROW-COLUMN                                080813ma
166600      END-IF                                                      080813ma
166700      IF (F-Design(F-idx:1) = %17)                                080813ma
166800        PERFORM GET-Linedrawing                                   080813ma
166900      END-IF                                                      080813ma
167000*     DISPLAY "SHOW CHAR DATA"                                    080813ma
167100      Move LOW-VALUE          to ASCII-BYTE1                      MA090512
167200      Move  F-Design(F-idx:1) To ASCII-BYTE2                      MA090512
167300*     Display "Chr [" F-Design(F-idx:1) "] idx=" f-idx            MA090512
167400*      " row=" rowcnt  " col=" ROW-COLUMN " ASCII= " Ascii-Value  MA090512
167500     End-Perform.                                                 080828MA
167600                                                                  080828MA
167700     MOVE F-idx TO ROWEND.                                        080825MA
167800     COMPUTE ROWLEN =  ROWEND - ROWSTART                          080825MA
167900     If ROWLEN > 1                                                080825MA
168000      ADD 1 TO ROWCNT                                             MA090303
168100      MOVE F-Design(ROWSTART:ROWLEN) TO ROWSTR(ROWCNT)            080825MA
168200D     DISPLAY "SAVING LAST ROW" ROWCNT                            MA090323
168300D     display "[" F-Design(ROWSTART:ROWLEN) "]"                   MA090323
168400      PERFORM GET-TEXT                                            080825MA
168500      COMPUTE ROWSTART = F-idx + 2 END-COMPUTE                    080825MA
168600      move 0 to ROW-COLUMN.                                       080825MA
168700* End iterations through screen image                             080813ma
168800     If FILE-WINDOW-POSITION(1) > 1                               ma080814
168900*     ADD 1 TO ROWCNT                                             MA090512
169000D     DISPLAY "START NEW ROW" ROWCNT                              MA090323
169100      IF ROWCNT <= FILE-WINDOW-POSITION(1)                        ma080814
169200       Move FILE-WINDOW-POSITION(1) to ROWCNT                     ma080814
169300      End-If                                                      080813ma
169400      PERFORM ADD-OBJ-SCRNMSG.                                    081114ma
169500*------------------------------------------------                 080813ma
169600 GET-TEXT.                                                        080813ma
169700D    DISPLAY "GET-TEXT".                                          080828MA
169800     INITIALIZE next-string NEW-TEXT-AREA.                        080828MA
169900     MOVE "0"        TO END-ROW-SW.                               080813ma
170000     MOVE "0"        TO NON-TEXT-SW.                              080813ma
170100     MOVE 1          TO TEXT-COLUMN.                              080813ma
170200     MOVE 1          TO TXPTR-START.                              080813ma
170300     MOVE "@"        TO TEXT-ENH.                                 080813ma
170400     Initialize INSPECT-IDX.                                      080831ma
170500     Inspect ROWSTR(ROWCNT) tallying INSPECT-IDX for all %33.     080831ma
170600     If (FILE-WINDOW-POSITION(1) > 22) and                        080831ma
170700        (rowcnt = 2 or 3) AND                                     080831ma
170800        (INSPECT-IDX >= 7)                                        080831ma
170900      Move "1" to End-Row-Sw                                      080813ma
171000     If rowcnt = 2                                                080831ma
171100       move RowStr(Rowcnt) To next-string                         080825MA
171200       Perform Extract-Labels                                     080825MA
171300       Move btn(1) To Txkey1-1                                    080825MA
171400       Move btn(2) To Txkey2-1                                    080825MA
171500       Move btn(3) To Txkey3-1                                    080825MA
171600       Move btn(4) To Txkey4-1                                    080825MA
171700       Move btn(5) To Txkey5-1                                    080825MA
171800       Move btn(6) To Txkey6-1                                    080825MA
171900       Move btn(7) To Txkey7-1                                    080825MA
172000       Move btn(8) To Txkey8-1                                    080831ma
172100     END-IF                                                       080831ma
172200     If rowcnt = 3                                                080831ma
172300       move RowStr(Rowcnt) To next-string                         080825MA
172400       Perform Extract-Labels                                     080825MA
172500       Move btn(1) To Txkey1-2                                    080825MA
172600       Move btn(2) To Txkey2-2                                    080825MA
172700       Move btn(3) To Txkey3-2                                    080825MA
172800       Move btn(4) To Txkey4-2                                    080825MA
172900       Move btn(5) To Txkey5-2                                    080825MA
173000       Move btn(6) To Txkey6-2                                    080825MA
173100       Move btn(7) To Txkey7-2                                    080825MA
173200       Move btn(8) To Txkey8-2                                    080831ma
173300     END-IF                                                       080831ma
173400     If (FILE-WINDOW-POSITION(1) > 22) and (rowcnt = 2 or 3)      ma080814
173500      String Txkey1-1 Txkey1-2                                    080813ma
173600       Delimited by size into TEXT-BTNSTR(1)                      080813ma
173700       End-String                                                 080813ma
173800      String Txkey2-1 Txkey2-2                                    080813ma
173900       Delimited by size into TEXT-BTNSTR(2)                      080813ma
174000       End-String                                                 080813ma
174100      String Txkey3-1 Txkey3-2                                    080813ma
174200       Delimited by size into TEXT-BTNSTR(3)                      080813ma
174300       End-String                                                 080813ma
174400      String Txkey4-1 Txkey4-2                                    080813ma
174500       Delimited by size into TEXT-BTNSTR(4)                      080813ma
174600       End-String                                                 080813ma
174700      String Txkey5-1 Txkey5-2                                    080813ma
174800       Delimited by size into TEXT-BTNSTR(5)                      080813ma
174900       End-String                                                 080813ma
175000      String Txkey6-1 Txkey6-2                                    080813ma
175100       Delimited by size into TEXT-BTNSTR(6)                      080813ma
175200       End-String                                                 080813ma
175300      String Txkey7-1 Txkey7-2                                    080813ma
175400       Delimited by size into TEXT-BTNSTR(7)                      080813ma
175500       End-String                                                 080813ma
175600      String Txkey8-1 Txkey8-2                                    080813ma
175700       Delimited by size into TEXT-BTNSTR(8)                      080813ma
175800       End-String.                                                080813ma
175900                                                                  080813ma
176000     PERFORM VARYING TXPTR FROM TXPTR-START BY 1                  080813ma
176100        UNTIL END-OF-ROW                                          080813ma
176200           OR (TXPTR > ROWLEN)                                    080813ma
176300           Or (text-char > 80)                                    080813ma
176400      MOVE "0" TO NEW-TEXT-FOUND-SW                               080813ma
176500      IF ((ROWSTR(ROWCNT)(TXPTR:1) = %15)                         080813ma
176600          AND (ROWSTR(ROWCNT)(TXPTR + 1:1) = %12))                080813ma
176700        OR (ROWSTR(ROWCNT)(TXPTR:1) = %0)                         080813ma
176800        OR (TXPTR > ROWLEN)                                       080813ma
176900        Or (text-char > 81)                                       MA090303
177000       MOVE "1" TO END-ROW-SW                                     080813ma
177100      END-IF                                                      080813ma
177200      IF NOT END-OF-ROW                                           080813ma
177300       IF  ( ROWSTR(ROWCNT)(TXPTR:1)     = %33 ) AND              080813ma
177400           ( ROWSTR(ROWCNT)(TXPTR + 1:1) = %46 ) AND              080813ma
177500           ( ROWSTR(ROWCNT)(TXPTR + 2:1) = %144)                  080813ma
177600        MOVE ROWSTR(ROWCNT)(TXPTR + 3:1) TO TEXT-ENH              080813ma
177700        ADD 4 TO TXPTR                                            080813ma
177800*       IF TXPTR > ROWLEN                                         MA090303
177900*        MOVE ROWLEN TO TXPTR                                     MA090303
178000*       END-IF                                                    MA090303
178100       END-IF                                                     080813ma
178200       IF  ( ROWSTR(ROWCNT)(TXPTR:1)     = %33 ) AND              080828MA
178300           ( ROWSTR(ROWCNT)(TXPTR + 1:1) = ")" ) AND              080828MA
178400           ( ROWSTR(ROWCNT)(TXPTR + 2:1) = "B")                   080828MA
178500        ADD 3 TO TXPTR                                            080828MA
178600*       IF TXPTR > ROWLEN                                         MA090303
178700*        MOVE ROWLEN TO TXPTR                                     MA090303
178800*       END-IF                                                    MA090303
178900       END-IF                                                     080828MA
179000       IF ((ROWSTR(ROWCNT)(TXPTR:1) = %33) AND                    080831ma
179100            (ROWSTR(ROWCNT)(TXPTR + 1:1) = %133 or %173 ))        081008ma
179200         OR (ROWSTR(ROWCNT)(TXPTR:1) = %133 or %173)              081008ma
179300        If text-char > 0                                          080813ma
179400         MOVE "1" TO NEW-TEXT-FOUND-SW                            080813ma
179500         MOVE TEXT-CHAR TO TEXT-FLDLEN(TEXT-FLDCNT)               080813ma
179600         MOVE ROWCNT    TO TEXT-FLDROW(TEXT-FLDCNT)               080813ma
179700*         DISPLAY "TEXT: " TEXT-FLDCOL(TEXT-FLDCNT)               080828MA
179800*                          TEXT-FLDROW(TEXT-FLDCNT)               080828MA
179900*                     " "  TEXT-FLDENH(TEXT-FLDCNT)               080828MA
180000*         " [" TEXT-FLDSTR(TEXT-FLDCNT)(1:TEXT-CHAR) "]"          080828MA
180100         perform ADD-OBJ-text                                     ma080814
180200         MOVE 0 TO TEXT-CHAR                                      080813ma
180300        End-If                                                    080813ma
180400        MOVE "1" TO NON-TEXT-SW                                   080813ma
180500        Add 2 To TxPtr                                            080813ma
180600       END-IF                                                     080813ma
180700       IF ((ROWSTR(ROWCNT)(TXPTR:1) = %33)                        080831ma
180800           AND (ROWSTR(ROWCNT)(TXPTR + 1:1) = %135 ))             080831ma
180900          OR (ROWSTR(ROWCNT)(TXPTR:1) = %135)                     080831ma
181000         MOVE "0" TO NON-TEXT-SW                                  080813ma
181100         Add 2 To TxPtr                                           080813ma
181200       END-IF                                                     080813ma
181300       IF (ROWSTR(ROWCNT)(TXPTR:1) = %16)                         080813ma
181400        If text-char > 0                                          080813ma
181500         MOVE "1" TO NEW-TEXT-FOUND-SW                            080813ma
181600         MOVE TEXT-CHAR TO TEXT-FLDLEN(TEXT-FLDCNT)               080813ma
181700         MOVE ROWCNT    TO TEXT-FLDROW(TEXT-FLDCNT)               080813ma
181800*         DISPLAY "TEXT: " TEXT-FLDCOL(TEXT-FLDCNT)               080828MA
181900*                          TEXT-FLDROW(TEXT-FLDCNT)               080828MA
182000*                     " "  TEXT-FLDENH(TEXT-FLDCNT)               080828MA
182100*         " [" TEXT-FLDSTR(TEXT-FLDCNT)(1:TEXT-CHAR) "]"          080828MA
182200         perform ADD-OBJ-text                                     ma080814
182300         MOVE 0 TO TEXT-CHAR                                      080813ma
182400        End-If                                                    080813ma
182500        MOVE "1" TO NON-TEXT-SW                                   080813ma
182600        Add 1 To TxPtr                                            080813ma
182700       END-IF                                                     080813ma
182800       IF (ROWSTR(ROWCNT)(TXPTR:1) = %17)                         080813ma
182900        MOVE "0" TO NON-TEXT-SW                                   080813ma
183000        Add 1 To TxPtr                                            080813ma
183100       END-IF                                                     080813ma
183200       IF (IN-TEXT-AREA) AND ( TEXT-CHAR > 0 ) AND                080813ma
183300         ( (( ROWSTR(ROWCNT)(TXPTR:1)     = %40 ) AND             080813ma
183400           ( ROWSTR(ROWCNT)(TXPTR + 1:1) = %40 ))                 080813ma
183500          or                                                      080813ma
183600           (( ROWSTR(ROWCNT)(TXPTR:1)     = %0 ) AND              080813ma
183700           ( ROWSTR(ROWCNT)(TXPTR + 1:1) = %0 ))                  080813ma
183800          or                                                      080813ma
183900           ( text-char > 79 ) )                                   080813ma
184000        MOVE "1" TO NEW-TEXT-FOUND-SW                             080813ma
184100        MOVE TEXT-CHAR TO TEXT-FLDLEN(TEXT-FLDCNT)                080813ma
184200        MOVE ROWCNT    TO TEXT-FLDROW(TEXT-FLDCNT)                080813ma
184300*       DISPLAY "TEXT: " TEXT-FLDCOL(TEXT-FLDCNT)                 080828MA
184400*                        TEXT-FLDROW(TEXT-FLDCNT)                 080828MA
184500*                   " "  TEXT-FLDENH(TEXT-FLDCNT)                 080828MA
184600*       " [" TEXT-FLDSTR(TEXT-FLDCNT)(1:TEXT-CHAR) "]"            080828MA
184700         perform ADD-OBJ-text                                     ma080814
184800        MOVE 0 TO TEXT-CHAR                                       080813ma
184900       END-IF                                                     080813ma
185000       IF (IN-TEXT-AREA) AND ( NOT NEW-TEXT-FOUND ) AND           080813ma
185100          (((ROWSTR(ROWCNT)(TXPTR:1) > %37) AND TEXT-CHAR > 0)    080813ma
185200           OR                                                     080813ma
185300           ((ROWSTR(ROWCNT)(TXPTR:1) > %40) AND TEXT-CHAR = 0))   080813ma
185400        ADD 1 TO TEXT-CHAR                                        080813ma
185500        IF TEXT-CHAR = 1                                          080813ma
185600         ADD 1 TO TEXT-FLDCNT                                     080813ma
185700         MOVE TEXT-COLUMN TO TEXT-FLDCOL(TEXT-FLDCNT)             080813ma
185800         MOVE ROWCNT      TO TEXT-FLDROW(TEXT-FLDCNT)             080813ma
185900         MOVE TEXT-ENH    TO TEXT-FLDENH(TEXT-FLDCNT)             080813ma
186000        END-IF                                                    080813ma
186100        IF TEXT-CHAR < 81                                         080828MA
186200         MOVE ROWSTR(ROWCNT)(TXPTR:1)                             080828MA
186300           TO TEXT-FLDSTR(TEXT-FLDCNT)(TEXT-CHAR:1)               080828MA
186400        End-If                                                    080828MA
186500       END-IF                                                     080813ma
186600*      display "in=" NON-TEXT-SW "[" ROWSTR(ROWCNT)(TXPTR:1)      080828MA
186700*        "] txptr=" txptr                                         080828MA
186800*        " text column=" TEXT-COLUMN " text char=" TEXT-CHAR      080828MA
186900       ADD 1 TO TEXT-COLUMN                                       080813ma
187000      END-IF                                                      080813ma
187100     END-PERFORM.                                                 080813ma
187200     IF TEXT-CHAR > 0                                             080813ma
187300      MOVE TEXT-CHAR TO TEXT-FLDLEN(TEXT-FLDCNT)                  080813ma
187400      COMPUTE TEXT-FLDROW(TEXT-FLDCNT)                            MA090512
187500       = (ROWCNT - 1)                                             MA090512
187600      END-COMPUTE                                                 MA090512
187700      perform ADD-OBJ-text.                                       080828MA
187800*      DISPLAY "TEXT: " TEXT-FLDCOL(TEXT-FLDCNT)                  080828MA
187900*                       TEXT-FLDROW(TEXT-FLDCNT)                  080828MA
188000*                  " "  TEXT-FLDENH(TEXT-FLDCNT)                  080828MA
188100*        " [" TEXT-FLDSTR(TEXT-FLDCNT)(1:TEXT-CHAR) "]".          080828MA
188200*------------------------------------------------                 080813ma
188300 ADD-OBJ-DATAFIELD.                                               080813ma
188400D    DISPLAY "ADD-OBJ-DATAFIELD".                                 080828MA
188500     ADD 1 TO OBJCNT(ROWCNT).                                     080813ma
188600     ADD 1 TO FORM-SCRNORD.                                       080813ma
188700     COMPUTE ODF = F-idx + 2.                                     080813ma
188800     PERFORM VARYING ODF FROM ODF BY 1                            080813ma
188900       UNTIL ODF > F-xlen                                         080813ma
189000            or F-Design(ODF:1) > ' '                              080813ma
189100      CONTINUE                                                    080813ma
189200     END-PERFORM.                                                 080813ma
189300     PERFORM VARYING ODF FROM ODF BY 1                            080813ma
189400       UNTIL ODF > F-xlen                                         080813ma
189500            or F-Design(ODF:1) = %33                              080813ma
189600            or F-Design(ODF:1) = ' '                              080813ma
189700            or F-Design(ODF:1) = ']'                              080813ma
189800            or F-Design(ODF:1) = '.'                              080813ma
189900            or F-Design(ODF:1) = %0                               080813ma
190000      CONTINUE                                                    080813ma
190100     END-PERFORM.                                                 080813ma
190200     COMPUTE ODFLEN = (ODF - (F-idx + 2)).                        080813ma
190300     COMPUTE ODF = F-idx + 2.                                     080813ma
190400D    DISPLAY "ODFLEN=" ODFLEN.                                    080902ma
190500D    DISPLAY "ODF=" ODF.                                          080902ma
190600     IF ODF > 0 AND ODFLEN > 0                                    080831ma
190700D     DISPLAY "F-Design(ODF:ODFLEN) [" F-Design(ODF:ODFLEN) "]"   080902ma
190800      MOVE OBJCNT(ROWCNT) TO X                                    080831ma
190900      MOVE "DA"                 TO OBJ-TYPE(ROWCNT,X)             080831ma
191000      MOVE F-Design(ODF:ODFLEN) TO OBJ-NAME(ROWCNT,X)             080831ma
191100      MOVE FORM-SCRNORD         TO OBJ-SRNORD(ROWCNT,X)           080831ma
191200      MOVE ROWCNT               TO OBJ-STRTROW(ROWCNT,X)          080831ma
191300      COMPUTE OBJ-STRTCOL(ROWCNT,X) = ROW-COLUMN + 2              080831ma
191400      INITIALIZE OBJ-VALUE(ROWCNT,X) OBJ-FLDNUM(ROWCNT,X)         080831ma
191500      Move 1 to OBJ-LEN(ROWCNT,X).                                080831ma
191600*------------------------------------------------                 080813ma
191700 ADD-OBJ-SCRNMSG.                                                 080813ma
191800D    DISPLAY "ADD-OBJ-SCRNMSG".                                   080828MA
191900     ADD 1 TO OBJCNT(ROWCNT).                                     080813ma
192000     MOVE OBJCNT(ROWCNT) TO X.                                    080813ma
192100     MOVE "MW"                 TO OBJ-TYPE(ROWCNT,X).             080813ma
192200     MOVE "SCREEN-MSG"         TO OBJ-NAME(ROWCNT,X).             080813ma
192300     MOVE 0                    TO OBJ-SRNORD(ROWCNT,X).           080813ma
192400     MOVE ROWCNT               TO OBJ-STRTROW(ROWCNT,X)           080813ma
192500     MOVE 1                    TO OBJ-STRTCOL(ROWCNT,X).          080813ma
192600     INITIALIZE OBJ-VALUE(ROWCNT,X) OBJ-FLDNUM(ROWCNT,X) .        080813ma
192700     Move 80 to OBJ-LEN(ROWCNT,X).                                ma080814
192800                                                                  ma080814
192900*------------------------------------------------                 080813ma
193000 ADD-OBJ-ENHANCEMENT.                                             080813ma
193100D    DISPLAY "ADD-OBJ-ENHANCEMENT".                               080828MA
193200     ADD 1 TO OBJCNT(ROWCNT).                                     080813ma
193300     MOVE OBJCNT(ROWCNT) TO X.                                    080813ma
193400     MOVE "EN"                 TO OBJ-TYPE(ROWCNT,X).             080813ma
193500     MOVE "ENHANCEMENT"        TO OBJ-NAME(ROWCNT,X).             080813ma
193600     MOVE 0                    TO OBJ-SRNORD(ROWCNT,X).           080813ma
193700     MOVE ROWCNT               TO OBJ-STRTROW(ROWCNT,X).          MA090512
193800     MOVE ROW-COLUMN TO OBJ-STRTCOL(ROWCNT,X).                    080813ma
193900     PERFORM VARYING ENHIDX FROM 1 BY 1                           080813ma
194000      UNTIL HPENH(ENHIDX) = PARSED-STRING(4:1)                    080813ma
194100         OR ENHIDX > 18                                           MA090512
194200      CONTINUE                                                    080813ma
194300     END-PERFORM.                                                 080813ma
194400     MOVE VPLUSENH(ENHIDX) TO OBJ-VALUE(ROWCNT,X)                 080813ma
194500     INITIALIZE OBJ-FLDNUM(ROWCNT,X).                             080813ma
194600     Move 4 to OBJ-LEN(ROWCNT,X).                                 ma080814
194700*------------------------------------------------                 ma080814
194800 ADD-OBJ-text.                                                    ma080814
194900D    DISPLAY "ADD-OBJ-text".                                      080828MA
195000     IF TEXT-FLDSTR(TEXT-FLDCNT)(1:2) <> "&d"                     081114ma
195100      ADD 1 TO OBJCNT(ROWCNT)                                     081114ma
195200      MOVE OBJCNT(ROWCNT) TO X                                    081114ma
195300      MOVE "TX"                     TO OBJ-TYPE(ROWCNT,X)         081114ma
195400      MOVE "TEXT"                   TO OBJ-NAME(ROWCNT,X)         081114ma
195500      MOVE 0                        TO OBJ-SRNORD(ROWCNT,X)       081114ma
195600      MOVE TEXT-FLDROW(TEXT-FLDCNT) TO OBJ-STRTROW(ROWCNT,X)      081114ma
195700      MOVE TEXT-FLDCOL(TEXT-FLDCNT) TO OBJ-STRTCOL(ROWCNT,X)      081114ma
195800      MOVE TEXT-FLDLEN(TEXT-FLDCNT) TO OBJ-LEN(ROWCNT,X)          081114ma
195900      move TEXT-FLDENH(TEXT-FLDCNT) TO OBJ-ENH(ROWCNT,X)          081114ma
196000      If Text-Char > 80 Move 80 To Text-Char End-If               081114ma
196100      MOVE TEXT-FLDSTR(TEXT-FLDCNT)(1:TEXT-CHAR)                  081114ma
196200        TO OBJ-VALUE(ROWCNT,X)                                    081114ma
196300      INITIALIZE OBJ-FLDNUM(ROWCNT,X)                             081114ma
196400      Move TEXT-CHAR to OBJ-LEN(ROWCNT,X)                         081114ma
196500     ELSE                                                         081114ma
196600      DISPLAY "INVALID TEXT ["                                    081114ma
196700       TEXT-FLDSTR(TEXT-FLDCNT)(1:2) "]".                         081114ma
196800*------------------------------------------------                 080825MA
196900 ADD-OBJ-FKEY.                                                    080825MA
197000D    DISPLAY "ADD-OBJ-FKEY".                                      080828MA
197100     ADD 1 TO OBJCNT(ROWCNT).                                     080825MA
197200     IF HARDWARE-FKEYS MOVE 25 TO OBJ-STRTROW(ROWCNT,X).          081114ma
197300     IF PAINTED-FKEYS  MOVE  2 TO OBJ-STRTROW(ROWCNT,X).          081114ma
197400     MOVE "FK"                     TO OBJ-TYPE(ROWCNT,X).         080828MA
197500     MOVE "FKEY"                   TO OBJ-NAME(ROWCNT,X).         080828MA
197600     MOVE 0                        TO OBJ-SRNORD(ROWCNT,X).       080828MA
197700     STRING FKEY-LINE1(x) FKEY-LINE2(x)                           080830ma
197800      DELIMITED BY SIZE          INTO OBJ-VALUE(ROWCNT,X).        080828MA
197900*    MOVE ROWCNT                   TO OBJ-STRTROW(ROWCNT,X).      081114ma
198000     IF X < 5                                                     080825MA
198100      COMPUTE OBJ-STRTCOL(ROWCNT,X) = ((X * 8) - ( 8 - X))        080828MA
198200     ELSE                                                         080825MA
198300      COMPUTE OBJ-STRTCOL(ROWCNT,X) = ((X * 8) +  X).             080828MA
198400     MOVE 16                       TO OBJ-LEN(ROWCNT,X)           080828MA
198500     move "HI"                     TO OBJ-ENH(ROWCNT,X)           080828MA
198600     INITIALIZE OBJ-FLDNUM(ROWCNT,X).                             080828MA
198700                                                                  080825MA
198800                                                                  080825MA
198900*------------------------------------------------                 080813ma
199000 ADD-OBJ-LINEDRAW.                                                080813ma
199100D    DISPLAY "ADD-OBJ-LINEDRAW".                                  080831ma
199200     ADD 1 TO OBJCNT(ROWCNT).                                     080813ma
199300     MOVE OBJCNT(ROWCNT) TO X.                                    080813ma
199400     MOVE "LD"                 TO OBJ-TYPE(ROWCNT,X).             080813ma
199500     MOVE "Line"               TO OBJ-NAME(ROWCNT,X).             080813ma
199600     MOVE 0                    TO OBJ-SRNORD(ROWCNT,X).           080813ma
199700     MOVE ROWCNT               TO OBJ-STRTROW(ROWCNT,X)           080813ma
199800     MOVE ROW-COLUMN TO OBJ-STRTCOL(ROWCNT,X).                    080813ma
199900     MOVE PARSED-STRING(1:ld-len) TO OBJ-VALUE(ROWCNT,X)          080813ma
200000     INITIALIZE OBJ-FLDNUM(ROWCNT,X).                             080813ma
200100     Move ld-len to OBJ-LEN(ROWCNT,X).                            ma080814
200200*-----------------------------------------------------------      080813ma
200300 GET-ESCAPE-SEQ-LENGTH.                                           080813ma
200400D     Display "GET-ESCAPE-SEQ-LENGTH".                            080831ma
200500*                                                                 080813ma
200600* The octal value 101 thru 132 define the upper case alpha        080813ma
200700* characters in the ASCII Collating Sequence.                     080813ma
200800*                                                                 080813ma
200900* All escape sequences sent to HP teminals are terminated         080813ma
201000* with an upper case alpha character.                             080813ma
201100*                                                                 080813ma
201200     Perform Varying Esc-len from F-idx by 1                      080813ma
201300       until (Esc-len > F-xlen)                                   080813ma
201400          or (F-Design(Esc-len:1) >= %101 and                     080813ma
201500              F-Design(Esc-len:1) <= %132)                        080813ma
201600          or (F-Design(Esc-len:1) = "@" )                         080813ma
201700          or (F-Design(Esc-len:1) = %15 AND                       080813ma
201800              F-Design(Esc-len + 1:1) = %12 )                     080813ma
201900      CONTINUE                                                    080813ma
202000     End-Perform.                                                 080813ma
202100     COMPUTE ESC-LEN = (ESC-LEN - F-IDX) + 1.                     080813ma
202200     MOVE F-Design(F-idx:Esc-len) TO PARSED-STRING.               080813ma
202300     INSPECT PARSED-STRING REPLACING ALL %33 BY ".".              080813ma
202400*    Display "ESCAPE-SEQ [" PARSED-STRING(1:Esc-len) "]".         080813ma
202500     IF ESC-LEN = 4                                               080813ma
202600      IF PARSED-STRING(2:2) = "&d"                                080813ma
202700       PERFORM ADD-OBJ-ENHANCEMENT.                               080813ma
202800                                                                  080813ma
202900*-----------------------------------------------------------      080813ma
203000 GET-Linedrawing.                                                 080813ma
203100D    Display "GET-Linedrawing".                                   080831ma
203200*                                                                 080813ma
203300* The octal value 16 begins the line drawing character set.       080813ma
203400* The octal value 17 ends the line drawing character set.         080813ma
203500*    Add 1 To F-idx.                                              080828MA
203600     INITIALIZE PARSED-STRING.                                    080828MA
203700     Perform Varying LD-IDX from F-idx by 1                       080828MA
203800       until (LD-IDX > F-xlen)                                    080828MA
203900          or (F-Design(LD-IDX:1) = %0 OR %12 OR %15 OR %17)       080828MA
204000                                                                  080828MA
204100      IF (F-DESIGN(LD-IDX:1) <> %0 OR %12 OR %15 OR %17) AND      080828MA
204200         (F-DESIGN(LD-IDX:1) >= " ")                              080828MA
204300       ADD 1 TO LD-LEN                                            080828MA
204400       MOVE F-Design(F-idx:LD-IDX) TO PARSED-STRING(LD-LEN:1)     080828MA
204500      END-IF                                                      080828MA
204600     End-Perform.                                                 080813ma
204700     If ld-len > 0 and ld-len < 128                               080828MA
204800      INSPECT PARSED-STRING REPLACING ALL %16 BY "."              080828MA
204900      INSPECT PARSED-STRING REPLACING ALL %17 BY "."              080828MA
205000      Display "Line Draw [" PARSED-STRING(1:ld-len) "]"           080828MA
205100      PERFORM ADD-OBJ-LINEDRAW.                                   080828MA
205200                                                                  080813ma
205300*---------------------------------------------------------------- 080813ma
205400 GET-T-RECORDS.                                                   080813ma
205500D    DISPLAY "GET-T-RECORDS".                                     080828MA
205600*                                                                 080813ma
205700* L O A D    "T"    R E C O R D S                                 080813ma
205800*                                                                 080813ma
205900     INITIALIZE T-RECORD.                                         080813ma
206000     MOVE "0" TO VALID-T-SW.                                      080813ma
206100     Perform Varying Frdidx From 1 By 1                           080813ma
206200       Until (VALID-T) OR ( Frdidx > Frdcnt )                     080813ma
206300      Move Frdstr(Frdidx)(1:2) To Ascii-Character                 080813ma
206400      If (Frdstr(Frdidx)(4:deslen) = Design-name(1:deslen))       080813ma
206500          And (Frdstr(Frdidx)(3:1) = "T")                         080813ma
206600          And ( Ascii-Value > 0 )                                 080813ma
206700       Compute T-STRT = ((Frdidx * 256) - 255 ) End-compute       080813ma
206800       Compute T-END  = T-STRT + (Ascii-Value - 1) End-Compute    080813ma
206900       Move Ascii-Value To T-LEN                                  080813ma
207000       Move frd-table(T-STRT:T-LEN) to T-RECORD                   080813ma
207100       MOVE T-HEADER TO T-HEADER-FORMAT                           080813ma
207200       IF (( THF-LENGTH = T-LEN)) AND                             080813ma
207300          (((( THF-CNT1 * 62) + 40) = THF-LENGTH )                080813ma
207400           OR ((( THF-CNT2 * 62) + 40) = THF-LENGTH ))            080813ma
207500        MOVE "1" TO VALID-T-SW                                    080813ma
207600        PERFORM VARYING TIDX FROM 1 BY 1                          080813ma
207700          UNTIL TIDX > THF-CNT1                                   080813ma
207800         MOVE T-FIELD(TIDX) TO T-FIELD-FORMAT                     080813ma
207900         ADD 1 TO TFF-ROW                                         080813ma
208000         ADD 1 TO TFF-COL                                         080813ma
208100         MOVE T-FIELD-FORMAT TO T-FIELD(TIDX)                     080813ma
208200         MOVE %0 TO ASCII-BYTE1                                   080813ma
208300         MOVE TFF-A TO ASCII-BYTE2                                080813ma
208400*        DISPLAY TFF-FLD1 " " TFF-ENH " " TFF-ESCVAL " "          080828MA
208500*                Ascii-Value " " TFF-FLDNUM " " TFF-SCRNODR       080828MA
208600*                " " TFF-LEN " " TFF-ROW " " TFF-COL              080828MA
208700        END-PERFORM                                               080813ma
208800       END-IF                                                     080813ma
208900      END-IF                                                      080813ma
209000     END-PERFORM.                                                 080813ma
209100*---------------------------------------------------------------- 080813ma
209200 GET-D-RECORDS.                                                   080813ma
209300D    DISPLAY "GET-D-RECORDS".                                     080828MA
209400*                                                                 080813ma
209500* L O A D    "D"    R E C O R D S                                 080813ma
209600*                                                                 080813ma
209700     INITIALIZE SAVE-FLD-TABLE D-RECORD DIDX D-LEN D-STRT D-END.  MA081215
209800     MOVE "0" TO VALID-D-SW.                                      080813ma
209900*                                                                 MA090526
210000*                                                                 MA090526
210100     Perform Varying Frdidx From 1 By 1                           080813ma
210200       Until ( Frdidx > Frdcnt )                                  080813ma
210300      Move Frdstr(Frdidx)(1:2) To Ascii-Character                 080813ma
210400      If (Frdstr(Frdidx)(3:1) = "D") AND (Ascii-Value > 0)        080813ma
210500       Compute D-STRT = ((Frdidx * 256) - 255 ) End-compute       080813ma
210600       Compute D-END  = D-STRT + (Ascii-Value - 1) End-Compute    080813ma
210700       Move Ascii-Value To D-LEN                                  080813ma
210800       ADD 1 TO DIDX                                              080813ma
210900D      DISPLAY "Frdidx      =" Frdidx                             MA090323
211000D      DISPLAY "D-STRT      =" D-STRT                             MA090323
211100D      DISPLAY "D-END       =" D-END                              MA090323
211200D      DISPLAY "Ascii-Value =" Ascii-Value                        MA090323
211300D      DISPLAY "D-LEN       =" D-LEN                              MA090323
211400       Move frd-table(D-STRT:D-LEN) to D-RECORD-ENTRIES(DIDX)     080813ma
211500       MOVE D-HEADER(DIDX) TO D-HEADER-FORMAT                     080813ma
211600       IF DHF-LENGTH = 102                                        080813ma
211700        MOVE "1" TO VALID-D-SW                                    080813ma
211800        ADD 1 TO SFIDX                                            MA081219
211900        MOVE D-FIELD(DIDX) TO D-FIELD-FORMAT                      080813ma
212000        INITIALIZE NUM1 NUM2 NUMDEC NUMERR                        080813ma
212100        MOVE DFF-LEN TO NUM1                                      080813ma
212200*       DISPLAY "DFF-LEN       =" DFF-LEN                         ma080814
212300        CALL "NUMGET" USING NUM1 NUM2 NUMDEC NUMERR               080813ma
212400        IF NUM2 > 0 AND NUM2 < 62                                 080813ma
212500         DISPLAY "S A V E    F I E L D:  "                        080813ma
212600           DFF-FLD1 " " DFF-LEN " " DFF-DTYPE                     080813ma
212700           " Init [" DFF-INIT(1:NUM2) "]"                         080813ma
212800           ADD NUM2 TO SF-BUFLEN                                  MA081215
212900           MOVE DFF-FLD1         TO SF-FLD(SFIDX)                 MA081219
213000           MOVE NUM2             TO SF-LEN(SFIDX)                 MA081219
213100           MOVE DFF-DTYPE        TO SF-TYPE(SFIDX)                MA081219
213200           MOVE DFF-INIT(1:NUM2) TO SF-INIT(SFIDX)                MA081219
213300        ELSE                                                      080813ma
213400         DISPLAY "S A V E    F I E L D:  "                        080813ma
213500           DFF-FLD1 " " DFF-LEN " " DFF-DTYPE                     080813ma
213600           " Init []"                                             080813ma
213700           MOVE DFF-FLD1      TO SF-FLD(SFIDX)                    MA081219
213800           MOVE 1             TO SF-LEN(SFIDX)                    MA081219
213900           MOVE DFF-DTYPE     TO SF-TYPE(SFIDX)                   MA081219
214000           MOVE SPACES        TO SF-INIT(SFIDX)                   MA081219
214100        END-IF                                                    080813ma
214200       END-IF                                                     080813ma
214300      END-IF                                                      080813ma
214400     END-PERFORM.                                                 080813ma
214500     MOVE SFIDX TO SFCNT.                                         MA081219
214600*    IF SFCNT > 0                                                 MA090330
214700*     Move "$SAVE"             To FMMSTR-FRM-NAME                 MA090330
214800*     Move 0                   To FMMSTR-FRM-NUMBER               MA090330
214900*     Move DIDX                To FMMSTR-FLDCNT                   MA090330
215000*     Move SF-BUFLEN           To FMMSTR-BUF-LEN                  MA090330
215100*     Move SPACES              To FMMSTR-NEXT-FRM                 MA090330
215200*     Move SPACES              To FMMSTR-REPEAT-OPT               MA090330
215300*     Move SPACES              To FMMSTR-NFORM-OPT                MA090330
215400*     PERFORM GET-NEXT-FMUNIQ                                     MA090330
215500*     Move SPACES              To FMMSTR-FKEY-DEF                 MA090330
215600*     Move SPACES              To FMMSTR-REPRODUCED-FR            MA090330
215700*     Move "$SAVE, used to store save files"   To FMMSTR-COMMENT  MA090330
215800*     MOVE NXUNIQ-UNIQ-NUM     TO FMMSTR-FM-UNIQUE                MA090330
215900*     MOVE FFMSTR-VFIL-UNIQUE  TO FMMSTR-VFIL-UNIQUE              MA090330
216000*     MOVE 1                   TO FMMSTR-SVR-UNIQUE               MA090330
216100*     PERFORM LOCK-FMMSTR                                         MA090330
216200*     PERFORM PUT-FMMSTR                                          MA090330
216300*     PERFORM UNLOCK-FMMSTR                                       MA090330
216400*     INITIALIZE FFFLDS-BUFFER                                    MA090330
216500*     PERFORM VARYING SFIDX FROM 1 BY 1                           MA090330
216600*       UNTIL (IMAGE-ERRORS) OR (SFIDX > SFCNT)                   MA090330
216700*      MOVE FMMSTR-FM-UNIQUE    TO FFFLDS-FM-UNIQUE               MA090330
216800*      MOVE FFMSTR-VFIL-UNIQUE  TO FFFLDS-VFIL-UNIQUE             MA090330
216900*      MOVE 1                   TO FFFLDS-SVR-UNIQUE              MA090330
217000*      Move SF-FLD(SFIDX)       To FFFLDS-VFLD-NAME               MA090330
217100*      MOVE SF-LEN(SFIDX)       To FFFLDS-VFLD-LENGTH             MA090330
217200*      MOVE SF-TYPE(SFIDX)      TO FFFLDS-VFLD-DATATYPE           MA090330
217300*      MOVE SF-INIT(SFIDX)      To FFFLDS-VFLD-INITVAL            MA090330
217400*      MOVE "SF"                TO FFFLDS-VFLD-TYPE               MA090330
217500*      MOVE 20                  TO  FFFLDS-SRN-X                  MA090330
217600*      ADD 1                    TO  FFFLDS-SRN-Y                  MA090330
217700*      ADD 1                    TO  FFFLDS-SRN-ORD-NUM            MA090330
217800*      ADD 1                    TO  FFFLDS-VFLD-NUM               MA090330
217900*      MOVE "NONE"              TO FFFLDS-VFLD-ENHANCE            MA090330
218000*      MOVE FFFLDS-VFLD-POSITION   TO FFFLDS-BUF-X                MA090330
218100*      Compute                                                    MA090330
218200*      FFFLDS-BUF-Y = FFFLDS-BUF-X + (FFFLDS-VFLD-LENGTH - 1)     MA090330
218300*      END-COMPUTE                                                MA090330
218400*      PERFORM GET-NEXT-FFFUNIQ                                   MA090330
218500*      MOVE NXUNIQ-UNIQ-NUM     TO FFFLDS-VFLD-UNIQUE             MA090330
218600*      PERFORM LOCK-FFFLDS                                        MA090330
218700*      PERFORM PUT-FFFLDS                                         MA090330
218800*      PERFORM UNLOCK-FFFLDS                                      MA090330
218900*     END-PERFORM.                                                MA090330
219000*---------------------------------------------------------------- 080813ma
219100 GET-G-RECORDS.                                                   080813ma
219200D    DISPLAY "GET-G-RECORDS".                                     080828MA
219300*                                                                 080813ma
219400* L O A D    "G"    R E C O R D S                                 080813ma
219500*                                                                 080813ma
219600     INITIALIZE G-DATA-STORAGE.                                   080831ma
219700     IF NOT GFILE-CLOSED PERFORM CLOSE-GFILE.                     080830ma
219800     PERFORM OPEN-GFILE-OUTPUT.                                   080830ma
219900     MOVE "0" TO VALID-G-SW.                                      080813ma
220000     Perform Varying Frdidx From 1 By 1                           080813ma
220100       Until ( Frdidx > Frdcnt )                                  080813ma
220200      Move Frdstr(Frdidx)(1:2) To Ascii-Character                 080813ma
220300      If (Frdstr(Frdidx)(3:1) = "G")                              080813ma
220400       Compute G-STRT = ((Frdidx * 256) - 255 ) End-compute       080813ma
220500       Compute G-END  = G-STRT + (Ascii-Value - 1) End-Compute    080813ma
220600       Move Ascii-Value To G-LEN                                  080813ma
220700       If G-Len > 0 and G-Len < 1540                              080830ma
220800        ADD 1 TO GIDX                                             080830MA
220900        Move frd-table(G-STRT:G-LEN) to G-RECORD                  080831ma
221000        MOVE G-HEADER TO G-HEADER-FORMAT                          080830ma
221100        IF GHF-LENGTH < 1536                                      080830MA
221200         MOVE "1" TO VALID-G-SW                                   080830MA
221300         MOVE G-FIELD TO G-FIELD-FORMAT                           080830ma
221400         INITIALIZE NUM1 NUM2 NUMDEC NUMERR                       080830MA
221500         MOVE GFF-LEN TO NUM1                                     080830MA
221600         CALL "NUMGET" USING NUM1 NUM2 NUMDEC NUMERR              080830MA
221700         IF NUM2 < 1                                              080830MA
221800          MOVE 1 TO NUM2                                          080830MA
221900         END-IF                                                   080830MA
222000         IF NUM2 > 62                                             080830MA
222100          MOVE 62 TO NUM2                                         080830MA
222200         END-IF                                                   080830MA
222300         PERFORM WRITE-GFILE                                      080830ma
222400*        DISPLAY "DATA FIELD:  "                                  080830MA
222500*          GFF-FORM " " GFF-FIELD " " GFF-NUM GFF-LEN             080830MA
222600*          GFF-ENH " " GFF-FTYPE " " GFF-DTYPE                    080830MA
222700*          " Init [" GFF-INIT(1:NUM2) "]"                         080830MA
222800        END-IF                                                    080830MA
222900       End-If                                                     080830MA
223000      END-IF                                                      080813ma
223100     END-PERFORM.                                                 080813ma
223200     MOVE GIDX TO GCNT.                                           080813ma
223300*----------------------------------------------------             080813ma
223400 CHKALL-G-STRINGS.                                                080813ma
223500D    DISPLAY "CHKALL-G-STRINGS".                                  080831ma
223600     MOVE "0" TO MATCH-SW.                                        080813ma
223700     IF NOT GFILE-CLOSED PERFORM CLOSE-GFILE.                     080830ma
223800     PERFORM OPEN-GFILE-INPUT.                                    080830ma
223900     PERFORM VARYING GIDX FROM 1 BY 1                             080813ma
224000       UNTIL MATCH-FOUND OR GIDX > GCNT                           080813ma
224100      PERFORM READ-GFILE                                          080830ma
224200      IF NOT GFILE-EOF                                            080830ma
224300       MOVE G-HEADER TO G-HEADER-FORMAT                           080830ma
224400       MOVE G-FIELD  TO G-FIELD-FORMAT                            080830ma
224500       INITIALIZE NUM1 NUM2 NUMDEC NUMERR                         080830ma
224600       MOVE GFF-LEN TO NUM1                                       080830ma
224700       CALL "NUMGET" USING NUM1 NUM2 NUMDEC NUMERR                080830ma
224800       MOVE FUNCTION UPPER-CASE(FFFLDS-VFLD-NAME)                 080830ma
224900         TO NEXT-STRING                                           080830ma
225000       MOVE FUNCTION UPPER-CASE(GFF-FIELD) TO PARSED-STRING       080830ma
225100       IF  NEXT-STRING = PARSED-STRING        AND                 080830ma
225200           FFFLDS-VFLD-LENGTH  = NUM2     AND                     080830ma
225300           FFFLDS-VFLD-ENHANCE = GFF-ENH                          080830ma
225400*        DISPLAY "MATCH FOUND:  "                                 080830ma
225500*           GFF-FORM " " GFF-FIELD " " GFF-NUM GFF-LEN            080830ma
225600*           GFF-ENH " " GFF-FTYPE " " GFF-DTYPE                   080830ma
225700        MOVE "1" TO MATCH-SW                                      080830ma
225800       END-IF                                                     080830ma
225900      END-IF                                                      080813ma
226000     END-PERFORM.                                                 080813ma
226100*---------------------------------------------------------------- 080813ma
226200 GET-E-RECORDS.                                                   080813ma
226300D    DISPLAY "GET-E-RECORDS".                                     080831ma
226400*                                                                 080813ma
226500* L O A D    "E"    R E C O R D S                                 080813ma
226600*                                                                 080813ma
226700     INITIALIZE E-RECORD.                                         080813ma
226800     MOVE "0" TO VALID-G-SW.                                      080813ma
226900     Perform Varying Frdidx From 1 By 1                           080813ma
227000       Until ( Frdidx > Frdcnt )                                  080813ma
227100      Move Frdstr(Frdidx)(1:2) To Ascii-Character                 080813ma
227200      If (Frdstr(Frdidx)(3:1) = "E")                              080813ma
227300            And (Ascii-Value  > 113 and Ascii-Value < 150)        080813ma
227400       Compute E-STRT = ((Frdidx * 256) - 255 ) End-compute       080813ma
227500       Compute E-END  = E-STRT + (Ascii-Value - 1) End-Compute    080813ma
227600       Move Ascii-Value To E-LEN                                  080813ma
227700       ADD 1 TO EIDX                                              080813ma
227800       Move frd-table(E-STRT:E-LEN) to E-RECORD-ENTRIES(EIDX)     080813ma
227900       If (E-FORM1(EIDX) <> E-FORM2(EIDX)) and                    ma080814
228000          (E-FORM2(EIDX)(1:1) <= " ")                             ma080814
228100        Initialize E-RECORD-ENTRIES(EIDX)                         ma080814
228200        Subtract 1 from Eidx                                      ma080814
228300*      Else                                                       080828MA
228400*       DISPLAY E-FORM1(EIDX)                                     080828MA
228500*              E-REPEAT-OPTION(EIDX)                              080828MA
228600*              E-NFORM-OPTION(EIDX)                               080828MA
228700*              E-NFORM(EIDX)                                      080828MA
228800*              E-FKEY-DEF(EIDX)                                   080828MA
228900*              E-REPRODUCED-FR(EIDX)                              080828MA
229000*              E-COMMENTS(EIDX)(1:30)                             080828MA
229100       End-If                                                     080828MA
229200      END-IF                                                      080813ma
229300     END-PERFORM.                                                 080813ma
229400     MOVE EIDX TO ECNT.                                           080813ma
229500$PAGE "MISC. ERROR CONDITION SUBROUTINES"                         080813ma
229600 9001-FILE-ERROR.                                                 080813ma
229700D    DISPLAY "9001-FILE-ERROR".                                   080813ma
229800     MOVE SPACES TO FILE-ERROR-RECORD.                            080813ma
229900     MOVE "00" TO ERROR-NUMBER.                                   080813ma
230000*     IF FNAME = "PRINTER" MOVE PRINTER-STATUS TO ERROR-NUMBER.   080813ma
230100     IF FNAME = "FORMFILE" MOVE FORMFILE-STATUS TO ERROR-NUMBER.  080830ma
230200     IF FNAME = "GFILE"    MOVE GFILE-STATUS TO ERROR-NUMBER.     080830ma
230300     EVALUATE ERROR-NUMBER                                        080813ma
230400     WHEN "00" MOVE "0" TO ERRORS-SW                              080813ma
230500     WHEN "04" MOVE "1" TO ERRORS-SW                              080813ma
230600               STRING "Read length of record  doesn't match "     080813ma
230700                      FNAME " length."                            080813ma
230800                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
230900     WHEN "05" MOVE "0" TO ERRORS-SW                              080813ma
231000               STRING "OPEN " FNAME " not present,  created."     080813ma
231100                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
231200     WHEN "07" MOVE "1" TO ERRORS-SW                              080813ma
231300               STRING FNAME " is not a tape as the OPEN/CLOSE "   080813ma
231400                      "phrase implies."                           080813ma
231500                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
231600     WHEN "30" MOVE "1" TO ERRORS-SW                              080813ma
231700               STRING FNAME " error.  problem unknown! "          080813ma
231800                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
231900     WHEN "34" MOVE "1" TO ERRORS-SW                              080813ma
232000               STRING FNAME " boundary violation."                080813ma
232100                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
232200     WHEN "35" MOVE "1" TO ERRORS-SW                              080813ma
232300               STRING FNAME " not found."                         080813ma
232400                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
232500     WHEN "37" MOVE "1" TO ERRORS-SW                              080813ma
232600               STRING FNAME " error.  Inconsistent operation "    080813ma
232700                      "during file I/O !"                         080813ma
232800                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
232900     WHEN "39" MOVE "1" TO ERRORS-SW                              080813ma
233000               STRING "OPEN " FNAME " failed due to fixed file"   080813ma
233100                      " attribute conflict."                      080813ma
233200                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
233300     WHEN "41" MOVE "0" TO ERRORS-SW                              080813ma
233400               STRING FNAME " was already opened."                080813ma
233500                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
233600     WHEN "42" MOVE "0" TO ERRORS-SW                              080813ma
233700               STRING "CLOSE " FNAME " without openning first."   080813ma
233800                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
233900     WHEN "44" MOVE "1" TO ERRORS-SW                              080813ma
234000               STRING FNAME " error.   boundary violation, "      080813ma
234100                      " Record too big or record too small."      080813ma
234200                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
234300     WHEN "46" MOVE "1" TO ERRORS-SW                              080813ma
234400               STRING "READ " FNAME " after AT END  or   after"   080813ma
234500                      " unsuccessful READ."                       080813ma
234600                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
234700     WHEN "47" MOVE "1" TO ERRORS-SW                              080813ma
234800               STRING "READ on " FNAME " not open for INPUT."     080813ma
234900                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
235000     WHEN "48" MOVE "1" TO ERRORS-SW                              080813ma
235100               STRING "WRITE on " FNAME " not open for OUTPUT."   080813ma
235200                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
235300     WHEN "49" MOVE "1" TO ERRORS-SW                              080813ma
235400               STRING "REWRITE on " FNAME                         080813ma
235500                      " not open for I-O."                        080813ma
235600                      DELIMITED BY SIZE INTO FILE-ERROR-RECORD    080813ma
235700     WHEN OTHER MOVE "1" TO ERRORS-SW                             080813ma
235800                MOVE ERROR-NUMBER TO DECIMAL-VALUE                080813ma
235900                STRING FNAME " ERROR #" ERROR-NUMBER              080813ma
236000                             " MESSAGE UNDEFINED ."               080813ma
236100                DELIMITED BY SIZE INTO FILE-ERROR-RECORD.         080813ma
236200     MOVE ERROR-NUMBER TO ASCII-CHARACTER.                        080813ma
236300     IF ASCII-BYTE1 = "9"                                         080813ma
236400        MOVE ASCII-BYTE2 TO Ascii-Value                           080813ma
236500        MOVE Ascii-Value TO DISP-N                                080813ma
236600        DISPLAY "MPE FILE ERROR #" DISP-N                         080813ma
236700        MOVE "1" TO ERRORS-SW                                     080813ma
236800        MOVE SPACES TO FILE-ERROR-RECORD                          080813ma
236900        CALL INTRINSIC "FERRMSG" USING                            080813ma
237000            Ascii-Value FILE-ERROR-RECORD I.                      080813ma
237100     IF NOT ERRORS DISPLAY FILE-ERROR-RECORD                      080813ma
237200     ELSE GO TO 9900-ABEND.                                       080813ma
237300     MOVE FILE-ERROR-RECORD TO EDIT-MESSAGE.                      080813ma
237400     PERFORM 7805-LOG-EDIT-MESSAGE.                               080813ma
237500*--------------------------                                       080813ma
237600 7805-LOG-EDIT-MESSAGE.                                           080813ma
237700     DISPLAY EDIT-MESSAGE.                                        080813ma
237800***************************************************************** 080813ma
237900*---------------------------------------------------------------  080902ma
238000 9900-ABEND.                                                      080813ma
238100     DISPLAY "----------------------------------------".          080813ma
238200     DISPLAY "-MIG801- ABNORMAL END OF PROGRAM".                  080902ma
238300     DISPLAY "----------------------------------------".          080813ma
238400*---------------------------------------------------------------  080813ma
238500 9999-RETURN.                                                     080813ma
238600     Display " END OF PROGRAM "  WITH NO ADVANCING.               080902ma
238700     MOVE "SHOWTIME" TO CMD.                                      080902ma
238800     PERFORM MPE-COMMAND.                                         080902ma
238900     IF FILE-ERROR-RECORD NOT = SPACES DISPLAY FILE-ERROR-RECORD. 080813ma
239000     IF NOT FORMFILE-CLOSED  CLOSE FORMA-FILE.                    080813ma
239100     GOBACK.                                                      080813ma
239200*---------------------------------------------------------------- ma080814
239300 VGETINFO.                                                        ma080814
239400D    DISPLAY "VGETINFO".                                          ma080814
239500     STRING  "Adding: " SCREEN-FORMS-FILE                         081124ma
239600      DELIMITED BY SIZE INTO M.                                   081124ma
239700     PERFORM MSG-PROCESS.                                         081124ma
239800     INITIALIZE SCREEN-COMAREA.                                   080820MA
239900     MOVE 60 TO SCREEN-COMAREALEN.                                080820MA
240000     CALL "VOPENFORMF" USING SCREEN-COMAREA, SCREEN-FORMS-FILE.   080820MA
240100     IF  SCREEN-CSTATUS <> 0 PERFORM 9000-VPLUS-ERROR.            080820MA
240200     MOVE SPACES TO FILE-INFOBUF.                                 ma080814
240300     MOVE 60 TO SCREEN-COMAREALEN.                                ma080814
240400     MOVE 1 TO FILE-NUMBER-OF-ENTRIES.                            ma080814
240500     MOVE 19 TO FILE-ENTRY-LENGTH.                                ma080814
240600     INITIALIZE SCREEN-CSTATUS.                                   ma080814
240700     CALL "VGETFILEINFO" USING SCREEN-COMAREA FILE-INFOBUF        ma080814
240800                               FILE-INFOBUFLEN.                   ma080814
240900     MOVE in-FILE-VERSION(1) TO VTIMESTAMP.                       080820MA
241000     MOVE 0 TO CLOCK-DINT.                                        080820MA
241100     MOVE VTS-WORD2 TO CLK-WORD1.                                 080820MA
241200     CALL INTRINSIC "FMTDATE"   USING VTS-WORD1                   080820MA
241300                                      CLOCK-DINT                  080820MA
241400                                      MY-TIMESTAMP.               080820MA
241500     Perform Store-File-Data.                                     MA090526
241600     PERFORM NEW-XML-FILE.                                        MA090526
241700     perform File-To-Xml.                                         MA090526
241800     If FILE-SAVE-FIELDS(1) > 0                                   MA090526
241900      Perform Store-Save-Fields.                                  MA090526
242000                                                                  MA090526
242100*---- Get form info -------*                                      ma080814
242200     MOVE SPACES TO FORM-INFOBUF.                                 ma080814
242300     MOVE FILE-NUMBER-OF-FORMS(1) TO FORM-NUMBER-OF-ENTRIES       ma080814
242400     MOVE 20                      TO FORM-ENTRY-LENGTH            ma080814
242500     COMPUTE FORM-INFOBUFLEN =                                    ma080814
242600       2 + ( FORM-NUMBER-OF-ENTRIES * FORM-ENTRY-LENGTH)          ma080814
242700       END-COMPUTE                                                ma080814
242800     MOVE 1 TO FORM-FORM-NUMBER(1)                                ma080814
242900     INITIALIZE SCREEN-CSTATUS                                    ma080814
243000     CALL "VGETFORMINFO" USING SCREEN-COMAREA FORM-INFOBUF        ma080814
243100                               FORM-INFOBUFLEN.                   ma080814
243200*/\/\/\/\/\/\ WORK-AROUND                                         ma080814
243300*                                                                 ma080814
243400*   VPLUS VGETFORMINFO BUG THAT RETURNS BLANK FORM NAMES          ma080814
243500                                                                  ma080814
243600     MOVE FILE-NUMBER-OF-FORMS(1) TO ACTUAL-FORM-COUNT.           ma080814
243700     PERFORM VARYING FRMIDX FROM 1 BY 1                           ma080814
243800       UNTIL (FRMIDX > FILE-NUMBER-OF-FORMS(1))                   ma080814
243900      IF FORM-FORM-NAME(FRMIDX) = SPACES                          ma080814
244000       MOVE "!@#$%^&*()_+" TO FORM-FORM-NAME(FRMIDX)              ma080814
244100       SUBTRACT 1  FROM ACTUAL-FORM-COUNT                         ma080814
244200      END-IF                                                      ma080814
244300     END-PERFORM                                                  ma080814
244400*                                                                 ma080814
244500      DISPLAY "FORMSFILE: " SCREEN-FORMS-FILE                     081208ma
244600                                                                  081208ma
244700*\/\/\/\/\/\/ END WORK-AROUND                                     ma080814
244800     PERFORM VARYING FRMIDX FROM 1 BY 1                           ma080814
244900       UNTIL (FRMIDX > FILE-NUMBER-OF-FORMS(1))                   ma080814
245000D     DISPLAY "PROCESSING NEXT FORM IN " SCREEN-FORMS-FILE        080831ma
245100D     DISPLAY "FORM NUMBER " FRMIDX                               080831ma
245200      IF FORM-FORM-NAME(FRMIDX) <> "!@#$%^&*()_+"                 ma080814
245300       PERFORM Store-Form-Data                                    080820MA
245400       MOVE SPACES TO FIELD-INFOBUF                               ma080814
245500       MOVE FORM-NUMBER-OF-FIELDS(FRMIDX)                         ma080814
245600         TO FIELD-NUMBER-OF-ENTRIES                               ma080814
245700       MOVE 14 TO FIELD-ENTRY-LENGTH                              ma080814
245800       DISPLAY "   PROCESSING FIELDS IN "                         081208ma
245900               FORM-FORM-NAME(FRMIDX)                             081208ma
246000       COMPUTE FIELD-INFOBUFLEN =                                 ma080814
246100        10 + ( FIELD-NUMBER-OF-ENTRIES * FIELD-ENTRY-LENGTH)      ma080814
246200        END-COMPUTE                                               ma080814
246300       MOVE FORM-FORM-NAME(FRMIDX) TO FIELD-FORM-NAME             ma080814
246400       INITIALIZE SCREEN-CSTATUS                                  ma080814
246500D      DISPLAY "229.41 CALLING VGETFIELDINFO"                     080831ma
246600       CALL "VGETFIELDINFO" USING SCREEN-COMAREA,                 080831ma
246700                          FIELD-INFOBUF, FIELD-INFOBUFLEN         ma080814
246800       MOVE FORM-FORM-NAME(FRMIDX) TO SCREEN-NFNAME SCREEN-NAME   ma080814
246900D      DISPLAY "           Form: ["                               MA090526
247000D              FORM-FORM-NAME(FRMIDX) "]"                         MA081215
247100       PERFORM Store-Field-Data                                   080820MA
247200       ADD FORM-NUMBER-OF-FIELDS(FRMIDX) TO TOTAL-FIELDS          ma080814
247300D      DISPLAY "ROWCNT: " ROWCNT                                  080831ma
247400       PERFORM VARYING IROW FROM 1 BY 1                           080831ma
247500         UNTIL ( IROW > ROWCNT )                                  080831ma
247600D       DISPLAY "OBJCNT(IROW): " OBJCNT(IROW)                     080831ma
247700        PERFORM VARYING XCOL FROM 1 BY 1                          080831ma
247800          UNTIL ( XCOL > OBJCNT(IROW) )                           080831ma
247900D        DISPLAY "NEXT NON DATA FIELD"                            080831ma
248000D        DISPLAY "IROW " IROW                                     080831ma
248100D        DISPLAY "XCOL " XCOL                                     080831ma
248200         If (OBJ-TYPE(IROW,XCOL) <> "DA")                         080831ma
248300          Initialize FFFLDS-BUFFER                                080831ma
248400          Move OBJ-NAME(Irow,Xcol)    To FFFLDS-VFLD-NAME         080831ma
248500          Move 0                      To FFFLDS-BUF-X             080831ma
248600          Move 0                      To FFFLDS-BUF-Y             080831ma
248700          Move OBJ-STRTCOL(Irow,Xcol) To FFFLDS-SRN-X             080831ma
248800          Move OBJ-STRTROW(Irow,Xcol) To FFFLDS-SRN-Y             080831ma
248900          Move OBJ-SRNORD(Irow,Xcol)  To FFFLDS-SRN-ORD-NUM       080831ma
249000          Move 0                      To FFFLDS-VFLD-NUM          080831ma
249100          Move OBJ-LEN(Irow,Xcol)     To FFFLDS-VFLD-LENGTH       080831ma
249200          Move 0                      To FFFLDS-VFLD-POSITION     080831ma
249300          Move OBJ-Enh(Irow,Xcol)     To FFFLDS-VFLD-ENHANCE      080831ma
249400          Move OBJ-TYPE(IROW,XCOL)    To FFFLDS-VFLD-TYPE         080831ma
249500          Move "CHAR"                 To FFFLDS-VFLD-DATATYPE     080831ma
249600          if OBJ-LEN(Irow,Xcol) > 80                              080831ma
249700           Move 80 To OBJ-LEN(Irow,Xcol)                          080831ma
249800          End-IF                                                  080831ma
249900          IF OBJ-LEN(Irow,Xcol) > 0                               080831ma
250000           Move OBJ-VALUE(Irow,Xcol)(1:OBJ-LEN(Irow,Xcol))        080831ma
250100                                      To FFFLDS-VFLD-INITVAL      080831ma
250200          END-IF                                                  080831ma
250300D         DISPLAY "ADDING NON DATA FIELD " FFFLDS-VFLD-NAME       MA081215
250400          perform add-field                                       080831ma
250500          Perform Field-To-Xml                                    MA090526
250600D         DISPLAY "BACK FGROM ADDING NON DATA FIELD"              080831ma
250700         End-If                                                   080831ma
250800        END-PERFORM                                               080831ma
250900       END-PERFORM                                                080831ma
251000       Subtract 1 From XmlLevel                                   MA090526
251310       Move "</Form>" to XML-data                                 MA090526
251320       Perform Write-Xml                                          MA090526
251330      END-IF                                                      080831ma
251400     END-PERFORM.                                                 080831ma
251500D    DISPLAY "LEAVING VGETINFO".                                  081008ma
251630     ADD ACTUAL-FORM-COUNT TO TOTAL-FORMS.                        ma080814
251700     CALL "VCLOSEFORMF" USING SCREEN-COMAREA.                     ma080814
251800*---------------------------------------------------------        ma080814
251900*---------------------------------------------------------        ma080814
252000 9000-VPLUS-ERROR.                                                ma080814
252100D    DISPLAY "9000-VPLUS-ERROR" SCREEN-CSTATUS.                   ma080814
252200     INITIALIZE SCRIPT-STR CSTR CERR CPARM.                       ma080814
252300     MOVE 80 TO CPARM.                                            ma080814
252400     CALL "VERRMSG" USING SCREEN-COMAREA ERROR-MSG CPARM CERR.    ma080814
252500     INITIALIZE SCREEN-CSTATUS.                                   ma080814
252600     MOVE SCREEN-FORMS-FILE TO SCRIPT-STR.                        ma080814
252700     MOVE ERROR-MSG(1:CERR) TO SCRIPT-STR(30:80).                 ma080814
252800     MOVE CALLTYPE TO SCRIPT-STR(111:20).                         ma080814
252900     WRITE Script-File.                                           ma080814
253000     INITIALIZE CALLTYPE SCRIPT-STR CSTR CERR CPARM.              ma080814
253100*-------------------------------------------------------------    080820MA
253200 Store-File-Data.                                                 080820MA
253300D    Display "Store-File-Data".                                   080820MA
253400     Initialize ffmstr-buffer.                                    080830ma
253500     PERFORM Load-Form-Source.                                    MA090526
253600     MOVE SCREEN-FORMS-FILE        TO FFMSTR-VFIL-NAME.           MA090526
253700     Compute FFMSTR-VFIL-BYTES =  frdcnt * 256.                   080830ma
253800     MOVE IN-FILE-VERSION(1)       TO FFMSTR-VERSION.             080830ma
253900     MOVE FILE-NUMBER-OF-FORMS(1)  TO FFMSTR-NBR-OF-FORMS.        080830ma
254000     MOVE FILE-MAX-FIELDS(1)       TO FFMSTR-MAX-FLDS.            080830ma
254100     MOVE FILE-MAX-BUFSIZE(1)      TO FFMSTR-MAX-BUF.             080830ma
254200     MOVE FILE-SAVE-FIELDS(1)      TO FFMSTR-SAVE-FLDS.           080830ma
254300     MOVE FILE-HEAD-FORM(1)        TO FFMSTR-HEAD-FRM.            080830ma
254400     MOVE FILE-ERROR-ENHANCE(1)    TO FFMSTR-ERR-ENH.             080830ma
254500     MOVE FILE-WINDOW-ENHANCE(1)   TO FFMSTR-WIN-ENH.             080830ma
254600     MOVE FILE-WINDOW-POSITION(1)  TO FFMSTR-WIN-POS.             080830ma
254700     PERFORM GET-NEXT-FFUNIQ                                      080902ma
254800     MOVE NXUNIQ-UNIQ-NUM  TO FFMSTR-VFIL-UNIQUE.                 080902ma
254900     MOVE 1                TO FFMSTR-SVR-UNIQUE.                  080902ma
255000     PERFORM LOCK-FFMSTR.                                         080902ma
255100     PERFORM PUT-FFMSTR.                                          080902ma
255200     PERFORM UNLOCK-FFMSTR.                                       080902ma
255300     ADD 1 TO MY-NEW-FILCNT.                                      080830ma
255400     If FILE-SAVE-FIELDS(1) > 0 PERFORM GET-D-RECORDS.            080830ma
255500     PERFORM GET-E-RECORDS.                                       080830ma
255600     PERFORM GET-G-RECORDS.                                       080830ma
255700D     Display "VERSION         : " IN-FILE-VERSION(1).            081008ma
255800D     Display "NUMBER-OF-FORMS : " FILE-NUMBER-OF-FORMS(1).       081008ma
255900D     Display "MAX-FIELDS      : " FILE-MAX-FIELDS(1).            081008ma
256000D     Display "MAX-BUFSIZE     : " FILE-MAX-BUFSIZE(1).           081008ma
256100D     Display "SAVE-FIELDS     : " FILE-SAVE-FIELDS(1).           081008ma
256200D     Display "HEAD-FORM       : " FILE-HEAD-FORM(1).             081008ma
256300D     Display "FILLER          : " FILE-FILLER(1).                081008ma
256400D     Display "ERROR-ENHANCE   : " FILE-ERROR-ENHANCE(1).         081008ma
256500D     Display "WINDOW-ENHANCE  : " FILE-WINDOW-ENHANCE(1).        081008ma
256600D     Display "WINDOW-POSITION : " FILE-WINDOW-POSITION(1).       081008ma
256700D     display  "Compiled       : " MY-TIMESTAMP.                  MA081215
256800     Display FFMSTR-VFIL-NAME  "Compiled       : " MY-TIMESTAMP.  081008ma
256900*--------------------------------------------------------------   080820MA
257000 Store-Form-Data.                                                 080820MA
257100D    Display "Store-Form-Data".                                   081124ma
257200     Move FORM-FORM-NAME(FrmIdx)        To FMMSTR-FRM-NAME        080830ma
257300                                           SCREEN-NAME.           080830ma
257400     Move FORM-FORM-NUMBER(FrmIdx)      To FMMSTR-FRM-NUMBER.     080830ma
257500     Move FORM-NUMBER-OF-FIELDS(FrmIdx) To FMMSTR-FLDCNT.         080830ma
257600     Move FORM-BUF-LENGTH(FrmIdx)       To FMMSTR-BUF-LEN.        080830ma
257700     Move FORM-NEXT-FORM(FrmIdx)        To FMMSTR-NEXT-FRM.       080830ma
257800     Move FORM-REPEAT-OPTION(FrmIdx)    To FMMSTR-REPEAT-OPT.     080830ma
257900     Move FORM-NFORM-OPTION(FrmIdx)     To FMMSTR-NFORM-OPT.      080830ma
258000     MOVE 15 TO S1.                                               080830ma
258100     Perform varying S1 from 16 by -1                             080830ma
258200       until S1 < 2 or FMMSTR-FRM-NAME(S1:1) > " "                080830ma
258300      Continue                                                    080830ma
258400     End-Perform.                                                 080830ma
258500     Initialize Design-Area.                                      080830ma
258600     Move FMMSTR-FRM-NAME to Design-Name.                         080830ma
258700     Move "0" To E-Record-Found-Sw.                               080830ma
258800     Perform Varying eidx From 1 By 1                             080830ma
258900       Until ( eidx > ecnt )                                      080830ma
259000*     DISPLAY                                                     081124ma
259100*      "[ " E-FORM1(eidx)(1:S1) "]=[" FMMSTR-FRM-NAME(1:S1) "]"   081124ma
259200*     DISPLAY                                                     081124ma
259300*      "[" E-REPEAT-OPTION(eidx) "]=[" FMMSTR-REPEAT-OPT "]"      081124ma
259400*     DISPLAY                                                     081124ma
259500*      "[" E-NFORM-OPTION(eidx) "]=[" FMMSTR-NFORM-OPT "]"        081124ma
259600*     DISPLAY                                                     081124ma
259700*      "[" E-NFORM(eidx) "]=[" FMMSTR-NEXT-FRM "]"                081124ma
259800      If   ((E-FORM1(eidx)(1:S1)   = FMMSTR-FRM-NAME(1:S1))       080830ma
259900        And (E-REPEAT-OPTION(eidx) = FMMSTR-REPEAT-OPT)           080830ma
260000        And (E-NFORM-OPTION(eidx)  = FMMSTR-NFORM-OPT)            080830ma
260100        And (E-NFORM(eidx)         = FMMSTR-NEXT-FRM))            080830ma
260200       MOVE FMMSTR-BUFFER TO FMMSAV-BUFFER                        081114ma
260300       PERFORM GET-NEXT-FMUNIQ                                    081114ma
260400       IF NOT FMMSTR-FOUND                                        081114ma
260500        MOVE FMMSAV-BUFFER TO FMMSTR-BUFFER                       081114ma
260600        Move E-FKEY-DEF(eidx)       To FMMSTR-FKEY-DEF            081114ma
260700        Move E-REPRODUCED-FR(eidx)  To FMMSTR-REPRODUCED-FR       081114ma
260800        Move E-COMMENTS(eidx)       To FMMSTR-COMMENT             081114ma
260900        Move "1" To E-Record-Found-Sw                             081114ma
261000        Add 1 to My-New-FRMCNT                                    081114ma
261100        MOVE NXUNIQ-UNIQ-NUM    TO FMMSTR-FM-UNIQUE               081114ma
261200        MOVE FFMSTR-VFIL-UNIQUE TO FMMSTR-VFIL-UNIQUE             081114ma
261300        MOVE 1                  TO FMMSTR-SVR-UNIQUE              081114ma
261400        Perform Form-To-Xml                                       MA090526
261500        PERFORM LOCK-FMMSTR                                       081114ma
261600        PERFORM PUT-FMMSTR                                        081114ma
261700        PERFORM UNLOCK-FMMSTR                                     081114ma
261800       END-IF                                                     081114ma
261900      End-If                                                      080830ma
262000     End-Perform.                                                 080830ma
262100     If E-Record-Found                                            080830ma
262200      Perform Link-VF-Pointers                                    080830ma
262300      IF POINTERS-LINKED                                          080830ma
262400D      DISPLAY "VF LINKED ok"                                     081124ma
262500D      ACCEPT NUM1                                                080831ma
262600       PERFORM GET-T-RECORDS                                      080830ma
262700       PERFORM GET-SCREEN-OBJECTS                                 080830ma
262800      ELSE                                                        080830ma
262900       Display "Unable to find form design records!  "            080830ma
263000               "V= " V-DESIGN-LEN ", F= " F-DESIGN-LEN            080830ma
263100               "Form: " Design-name                               080830ma
263200      End-if                                                      080830ma
263300     Else                                                         080830ma
263400      Display "NO E-Record for Form: " Design-name.               080830ma
263500*---------------------------------------------------------------- 080820MA
263600 Store-Field-Data.                                                080820MA
263700D    Display "Store-Field-Data".                                  081124ma
263800     INITIALIZE FFFLDS-BUFFER FLDIDX THISFORM-FLDCNT.             080831ma
263900*    DISPLAY REPORT-HEADER                                        MA090323
264000     PERFORM LOAD-G-SCREEN.                                       080831ma
264100     Perform Varying Fx From 1 By 1 Until Fx > FMMSTR-FLDCNT      080830ma
264200      INITIALIZE FFFLDS-BUFFER                                    081124ma
264300      Move FIELD-FIELD-NAME(Fx)     To FFFLDS-VFLD-NAME           081124ma
264400      Move FIELD-SCREEN-ORD-NUM(Fx) To FFFLDS-SRN-ORD-NUM         080830ma
264500      Move FIELD-NUM(Fx)            To FFFLDS-VFLD-NUM            080830ma
264600      Move FIELD-LENGTH(Fx)         To FFFLDS-VFLD-LENGTH         080830ma
264700      Move FIELD-POSITION(Fx)       To FFFLDS-VFLD-POSITION       080830ma
264800      Move FIELD-ENHANCE(Fx)        To FFFLDS-VFLD-ENHANCE        080830ma
264900      INITIALIZE IROW XCOL                                        080830ma
265000      PERFORM VARYING IROW FROM 1 BY 1                            080830ma
265100        UNTIL ( IROW > ROWCNT )                                   080830ma
265200       PERFORM VARYING XCOL FROM 1 BY 1                           080830ma
265300         UNTIL ( XCOL > OBJCNT(IROW) )                            080830ma
265400        If (OBJ-TYPE(IROW,XCOL) = "DA") And                       080830ma
265500        (OBJ-SRNORD(Irow,Xcol) = FFFLDS-SRN-ORD-NUM)              080830ma
265600         PERFORM GET-FIELD-DATA                                   080830ma
265700        End-If                                                    080830ma
265800       END-PERFORM                                                080830ma
265900      END-PERFORM                                                 080830ma
266000     End-Perform.                                                 080820MA
266100*-----------------------------------------------------------      080825MA
266200 Extract-Labels.                                                  080825MA
266300d    Display "Extract-Labels".                                    080825MA
266400     Initialize btnrow-data.                                      080825MA
266500     Perform varying brwidx from 1 by 1                           080825MA
266600       Until brwcnt >= 8 or brwidx > 256                          080825MA
266700      If  Next-String(brwidx:1) = %33                             080828MA
266800       Add 1 to Brwidx                                            080825MA
266900       If Next-String(brwidx:1) = "&"                             080825MA
267000        Add 1 to Brwidx                                           080825MA
267100        If Next-String(brwidx:1) = "d"                            080825MA
267200         Add 1 to Brwidx                                          080825MA
267300         If Next-String(brwidx:1) = "J" or "B"                    080825MA
267400          Compute nxkey-x = brwidx + 1 End-Compute                080825MA
267500          Move Next-String(nxkey-x:16) to NxLbl                   080825MA
267600          Initialize nxchr-cnt Next-Label                         080825MA
267700          Perform Varying nxkey-y from 1 by 1                     080825MA
267800            until nxkey-y > 30 or nxchr-cnt >= 8                  080828MA
267900           if (NxLbl(nxkey-y:1) = %33 And                         080825MA
268000               NxLbl(nxkey-y + 1:1) = "[")                        080825MA
268100           or (NxLbl(nxkey-y:1) = %33 And                         080825MA
268200               NxLbl(nxkey-y + 1:1) = "]")                        080825MA
268300            Display "Painted FK Lbls are supported; "             080825MA
268400                    "Data fields imbedded into them is not!"      080825MA
268500            Add 2 to nxkey-y                                      080825MA
268600            If (NxLbl(nxkey-y:1) = %33 And                        080825MA
268700                NxLbl(nxkey-y + 1:1) = "&" And                    080825MA
268800                NxLbl(nxkey-y + 2:1) = "d")                       080825MA
268900            Display "Painted FK Lbls are supported; "             080828MA
269000                    "Esc Seq's imbedded into them is not!"        080828MA
269100             Add 4 TO nxkey-y                                     080825MA
269200            End-If                                                080825MA
269300           Else                                                   080825MA
269400            Add 1 To nxchr-cnt                                    080825MA
269500            Move NxLbl(nxkey-y:1) To Next-Label(nxchr-cnt:1)      080825MA
269600           End-If                                                 080825MA
269700          End-Perform                                             080825MA
269800          Add 1 to brwcnt                                         080825MA
269900          Move Next-Label To btn(brwcnt)                          080825MA
270000D         Display "                    [" btn(brwcnt) " ]"        080902ma
270100         End-If                                                   080825MA
270200        End-If                                                    080825MA
270300       End-If                                                     080825MA
270400      End-If                                                      080825MA
270500     End-Perform.                                                 080825MA
270600     IF ALL-8-LABELS <= SPACES Initialize btnrow-data.            081114ma
270700*---------------------------------------------------------------  080828MA
270800 Add-ProcSpecs.                                                   080828MA
270900D    Display "Add-ProcSpecs".                                     080828MA
271000     PERFORM LOCK-PRSPEC.                                         080902ma
271100     Initialize chrcnt chridx PRSPEC-BUFFER SPECTABLE.            081120ma
271200     Move "0" To end-of-specs-sw.                                 080828MA
271300     Perform Varying chridx from 1 by 1                           080831ma
271400      Until end-of-specs OR CHRIDX > SPECLEN                      080831ma
271500       If (GFF-PROCSPECS(chridx:1) = %15 or                       080830ma
271600           GFF-PROCSPECS(chridx:1) = %12 or                       080830ma
271700           CHRCNT > 79)  and  chrcnt > 0                          080828MA
271800        Add 1 To PRSPEC-PRSPEC-SEQ                                080828MA
271900        If PRSPEC-PRSPEC-TEXT(1:chrcnt) > Spaces                  080828MA
272000D        display PRSPEC-PRSPEC-SEQ " "                            080902ma
272100D                PRSPEC-PRSPEC-TEXT(1:chrcnt)                     080902ma
272200         MOVE PRSPEC-PRSPEC-TEXT TO SPEC(PRSPEC-PRSPEC-SEQ)       081120ma
272300         MOVE FFFLDS-VFLD-UNIQUE TO PRSPEC-VFLD-UNIQUE            080902ma
272400         PERFORM PUT-PRSPEC                                       080902ma
272500         Add 1 to MY-NEW-spcCNT                                   080828MA
272600        End-If                                                    080828MA
272700        Initialize chrcnt PRSPEC-PRSPEC-TEXT                      080828MA
272800       End-If                                                     080828MA
272900       IF GFF-PROCSPECS(chridx:1) >= space                        080830ma
273000        Add 1 To chrcnt                                           080828MA
273100        Move GFF-PROCSPECS(chridx:1)                              080830ma
273200          to PRSPEC-PRSPEC-TEXT(chrcnt:1)                         080828MA
273300       End-If                                                     080828MA
273400       If chridx >= speclen                                       080828MA
273500        Move "1" To end-of-specs-sw                               080828MA
273600        If  chrcnt > 0                                            080828MA
273700         Add 1 To PRSPEC-PRSPEC-SEQ                               080828MA
273800         If PRSPEC-PRSPEC-TEXT(1:chrcnt) > Spaces                 080828MA
273900D         display PRSPEC-PRSPEC-SEQ " "                           080902ma
274000D                 PRSPEC-PRSPEC-TEXT(1:chrcnt)                    080902ma
274100          MOVE FFFLDS-VFLD-UNIQUE TO PRSPEC-VFLD-UNIQUE           080902ma
274200          MOVE PRSPEC-PRSPEC-TEXT TO SPEC(PRSPEC-PRSPEC-SEQ)      081120ma
274300          PERFORM PUT-PRSPEC                                      080902ma
274400          Add 1 to MY-NEW-spcCNT                                  080828MA
274500         End-If                                                   080828MA
274600         Initialize chrcnt PRSPEC-PRSPEC-TEXT                     080828MA
274700        End-IF                                                    080828MA
274800       End-if                                                     080828MA
274900     End-Perform.                                                 080828MA
275000     PERFORM UNLOCK-PRSPEC.                                       080902ma
275100     PERFORM LOCK-FFFLDS.                                         081120ma
275200     IF PRSPEC-PRSPEC-SEQ > 0                                     081120ma
275300      MOVE "VFLD-UNIQUE;" TO SEARCH-ITEM                          081120ma
275400      MOVE FFFLDS-VFLD-UNIQUE TO SEARCH-KEY-I2                    081120ma
275500      PERFORM FIND-FFFLDS                                         081120ma
275600      IF NOT NO-ENTRY                                             081120ma
275700       PERFORM GET-FFFLDS-CHAINED                                 081120ma
275800       IF NOT END-OF-CHAIN                                        081120ma
275900        INITIALIZE FFFLDS-SPECS                                   MA090526
276000        PERFORM VARYING CHRCNT FROM 1 BY 1                        081120ma
276100          UNTIL CHRCNT > 15                                       081124ma
276200         MOVE SPEC(CHRCNT) TO FFFLDS-PROCSPECS(CHRCNT)            081120ma
276300        END-PERFORM                                               081120ma
276400        PERFORM UPDATE-FFFLDS.                                    081120ma
276500*     INITIALIZE FFFLDS-SPECS.                                    MA090526
276600      PERFORM UNLOCK-FFFLDS.                                      081120ma
276700*                                                                 080828MA
276800*---------------------------------------------------------------- 080828MA
276900 add-field.                                                       080828MA
277000D    DISPLAY "ADD-FIELD".                                         080831ma
277100     Add 1 To My-New-fldcnt.                                      080831ma
277200     Initialize REPORT-BUFFER.                                    080828MA
277300                                                                  080902ma
277400     MOVE  FFFLDS-VFLD-NAME         TO RPT-VFLD-NAME.             080828MA
277500     MOVE  FFFLDS-BUF-X             TO RPT-BUF-X.                 080828MA
277600     MOVE  FFFLDS-BUF-Y             TO RPT-BUF-Y.                 080828MA
277700     MOVE  FFFLDS-SRN-X             TO RPT-SRN-X.                 080828MA
277800     MOVE  FFFLDS-SRN-Y             TO RPT-SRN-Y.                 080828MA
277900     MOVE  FFFLDS-SRN-ORD-NUM       TO RPT-SRN-ORD-NUM.           080828MA
278000     MOVE  FFFLDS-VFLD-NUM          TO RPT-VFLD-NUM.              080828MA
278100     MOVE  FFFLDS-VFLD-LENGTH       TO RPT-VFLD-LENGTH.           080828MA
278200     MOVE  FFFLDS-VFLD-POSITION     TO RPT-VFLD-POSITION.         080828MA
278300     MOVE  FFFLDS-VFLD-ENHANCE      TO RPT-VFLD-ENHANCE.          080828MA
278400     Move  FFFLDS-VFLD-TYPE         TO RPT-VFLD-TYPE.             080828MA
278500     Move  FFFLDS-VFLD-DATATYPE     TO RPT-VFLD-DATATYPE.         080828MA
278600*    DISPLAY REPORT-BUFFER.                                       MA090323
278700     PERFORM GET-NEXT-FFFUNIQ.                                    080902ma
278800     MOVE FMMSTR-FM-UNIQUE   TO FFFLDS-FM-UNIQUE.                 080902ma
278900     MOVE NXUNIQ-UNIQ-NUM    TO FFFLDS-VFLD-UNIQUE.               080902ma
279000     MOVE FFMSTR-VFIL-UNIQUE TO FFFLDS-VFIL-UNIQUE.               080902ma
279100     MOVE 1                  TO FFFLDS-SVR-UNIQUE.                080902ma
279200     PERFORM LOCK-FFFLDS.                                         080902ma
279300     PERFORM PUT-FFFLDS.                                          080902ma
279400     PERFORM UNLOCK-FFFLDS.                                       080902ma
279500*                                                                 080902ma
279600D    DISPLAY FFMSTR-VFIL-NAME FMMSTR-FRM-NAME RPT-VFLD-NAME %15   081008ma
279700D      WITH NO ADVANCING.                                         081008ma
279800D    If FFFLDS-VFLD-LENGTH > 0 and                                080902ma
279900D       FFFLDS-VFLD-LENGTH < 81                                   080902ma
280000D    display "init: ["                                            080902ma
280100D     FFFLDS-VFLD-INITVAL(1:FFFLDS-VFLD-LENGTH) "]".              080902ma
280200*-----------------------------------------------------------------080831ma
280300 LOAD-G-SCREEN.                                                   080831ma
280400D     DISPLAY "LOAD-G-SCREEN".                                    080831ma
280500D     Display "FMMSTR-FRM-NAME [" FMMSTR-FRM-NAME "]"             080831ma
280600     IF NOT GFILE-CLOSED PERFORM CLOSE-GFILE.                     080831ma
280700     PERFORM OPEN-GFILE-INPUT.                                    080831ma
280800     MOVE "0" TO VALID-G-SW.                                      080831ma
280900     INITIALIZE G-SCREEN-ARRAY GSIDX GSCNT.                       080831ma
281000D     DISPLAY "GFILE COUNT: " GFILE-COUNT.                        080831ma
281100     Perform Varying GSIDX From 1 By 1                            080831ma
281200       Until ( GSIDX > GFILE-COUNT )                              080831ma
281300          OR ( GSCNT > 259 )                                      080831ma
281400      PERFORM READ-GFILE                                          080831ma
281500      IF NOT GFILE-EOF                                            080831ma
281600       MOVE G-FIELD TO G-FIELD-FORMAT                             080831ma
281700       Move G-HEADER to G-HEADER-FORMAT                           080831ma
281800       If (GFF-FORM = FMMSTR-FRM-NAME)                            080831ma
281900        ADD 1 TO GSCNT                                            080831ma
282000        MOVE G-FIELD TO GS-FIELD(GSCNT)                           080831ma
282100D        DISPLAY GFF-FORM GFF-FIELD GFF-NUM                       080831ma
282200        MOVE G-HEADER TO GS-HEADER(GSCNT)                         080831ma
282300       End-If                                                     080831ma
282400      End-If                                                      080831ma
282500     End-Perform.                                                 080831ma
282600D     DISPLAY "LOADED G-SCREEN REC: " GSCNT.                      080831ma
282700*---------------------------------------------------------------- 080902ma
282800 GET-NEXT-FFUNIQ.                                                 080902ma
282900     MOVE "FFMSTR" TO SEARCH-KEY.                                 080902ma
283000     MOVE 20 TO MYINCREMENT.                                      080902ma
283100     PERFORM  LOCK-NXUNIQ.                                        080902ma
283200     PERFORM GET-NXUNIQ-KEYED.                                    080902ma
283300     IF NO-ENTRY                                                  080902ma
283400      MOVE "FFMSTR" TO NXUNIQ-UNIQ-ID                             080902ma
283500      MOVE MYINCREMENT TO NXUNIQ-UNIQ-NUM                         080902ma
283600      PERFORM PUT-NXUNIQ                                          080902ma
283700     ELSE                                                         080902ma
283800      ADD MYINCREMENT TO NXUNIQ-UNIQ-NUM                          080902ma
283900      PERFORM UPDATE-NXUNIQ.                                      080902ma
284000     PERFORM UNLOCK-NXUNIQ.                                       080902ma
284100*---------------------------------------------------------------- 080902ma
284200 GET-NEXT-FMUNIQ.                                                 080902ma
284300D    DISPLAY "GET-NEXT-FMUNIQ".                                   081124ma
284400     MOVE "0" TO FMMSTR-SW.                                       081114ma
284500     MOVE "FRM-NAME" TO SEARCH-ITEM.                              081114ma
284600     MOVE FMMSTR-FRM-NAME to SEARCH-KEY.                          081114ma
284700     PERFORM FIND-FMMSTR.                                         081114ma
284800     IF NO-ENTRY                                                  081114ma
284900      PERFORM ACTUAL-NEXT-FMUNIQ                                  081114ma
285000     else                                                         081114ma
285100      PERFORM VARYING NEXIDX FROM 1 BY 1                          081114ma
285200        UNTIL ( END-OF-CHAIN )                                    081114ma
285300           OR ( FMMSTR-VFIL-UNIQUE = FFMSTR-VFIL-UNIQUE )         081114ma
285400       PERFORM GET-FMMSTR-CHAINED                                 081124ma
285500       IF NOT END-OF-CHAIN                                        081124ma
285600        IF ( FMMSTR-VFIL-UNIQUE = FFMSTR-VFIL-UNIQUE )            081124ma
285700         MOVE FMMSTR-FM-UNIQUE TO NXUNIQ-UNIQ-NUM                 081124ma
285800         MOVE "1" TO FMMSTR-SW                                    081124ma
285900        END-IF                                                    081124ma
286000       END-IF                                                     081124ma
286100      END-PERFORM                                                 081114ma
286200      IF END-OF-CHAIN                                             081124ma
286300       PERFORM ACTUAL-NEXT-FMUNIQ                                 081114ma
286400      END-IF.                                                     081114ma
286500*---------------------------------------------------------------  081114ma
286600 ACTUAL-NEXT-FMUNIQ.                                              081114ma
286700D    DISPLAY "ACTUAL-NEXT-FMUNIQ".                                081124ma
286800     PERFORM  LOCK-NXUNIQ.                                        081114ma
286900     MOVE "FMMSTR" TO SEARCH-KEY                                  081114ma
287000     MOVE 20 TO MYINCREMENT                                       081114ma
287100     PERFORM GET-NXUNIQ-KEYED                                     081114ma
287200     IF NO-ENTRY                                                  081114ma
287300      MOVE "FMMSTR" TO NXUNIQ-UNIQ-ID                             081114ma
287400      MOVE MYINCREMENT TO NXUNIQ-UNIQ-NUM                         081114ma
287500      PERFORM PUT-NXUNIQ                                          081114ma
287600     ELSE                                                         081114ma
287700      ADD MYINCREMENT TO NXUNIQ-UNIQ-NUM                          081114ma
287800      PERFORM UPDATE-NXUNIQ                                       081114ma
287900     End-If.                                                      081114ma
288000     PERFORM UNLOCK-NXUNIQ.                                       081114ma
288100                                                                  080902ma
288200*---------------------------------------------------------------- 080902ma
288300 GET-NEXT-FFFUNIQ.                                                080902ma
288400     MOVE "FFFLDS" TO SEARCH-KEY.                                 080902ma
288500     MOVE 20 TO MYINCREMENT.                                      080902ma
288600     PERFORM  LOCK-NXUNIQ.                                        080902ma
288700     PERFORM GET-NXUNIQ-KEYED.                                    080902ma
288800     IF NO-ENTRY                                                  080902ma
288900      MOVE "FFFLDS" TO NXUNIQ-UNIQ-ID                             080902ma
289000      MOVE MYINCREMENT TO NXUNIQ-UNIQ-NUM                         080902ma
289100      PERFORM PUT-NXUNIQ                                          080902ma
289200     ELSE                                                         080902ma
289300      ADD MYINCREMENT TO NXUNIQ-UNIQ-NUM                          080902ma
289400      PERFORM UPDATE-NXUNIQ.                                      080902ma
289500     PERFORM UNLOCK-NXUNIQ.                                       080902ma
289600*---------------------------------------------------------------- 080902ma
289700 GET-NEXT-SPECUNIQ.                                               080902ma
289800     MOVE "PRSPEC" TO SEARCH-KEY.                                 080902ma
289900     MOVE 20 TO MYINCREMENT.                                      080902ma
290000     PERFORM  LOCK-NXUNIQ.                                        080902ma
290100     PERFORM GET-NXUNIQ-KEYED.                                    080902ma
290200     IF NO-ENTRY                                                  080902ma
290300      MOVE "PRSPEC" TO NXUNIQ-UNIQ-ID                             080902ma
290400      MOVE MYINCREMENT TO NXUNIQ-UNIQ-NUM                         080902ma
290500      PERFORM PUT-NXUNIQ                                          080902ma
290600     ELSE                                                         080902ma
290700      ADD MYINCREMENT TO NXUNIQ-UNIQ-NUM                          080902ma
290800      PERFORM UPDATE-NXUNIQ.                                      080902ma
290900     PERFORM UNLOCK-NXUNIQ.                                       080902ma
291000                                                                  080902ma
291100 COPY NXUNIQ0 OF J3KLIB.                                          080902ma
291200 COPY NXUNIQ1 OF J3KLIB.                                          080902ma
291300 COPY NXUNIQ2 OF J3KLIB.                                          080902ma
291400 COPY NXUNIQ3 OF J3KLIB.                                          080902ma
291500 COPY NXUNIQ4 OF J3KLIB.                                          080902ma
291600 COPY NXUNIQ5 OF J3KLIB.                                          080902ma
291700 COPY NXUNIQ6 OF J3KLIB.                                          080902ma
291800 COPY NXUNIQ7 OF J3KLIB.                                          080902ma
291900 COPY NXUNIQ8 OF J3KLIB.                                          080902ma
292000                                                                  080902ma
292100 COPY FFFLDS0 OF J3KLIB.                                          080902ma
292200 COPY FFFLDS1 OF J3KLIB.                                          080902ma
292300 COPY FFFLDS2 OF J3KLIB.                                          080902ma
292400 COPY FFFLDS3 OF J3KLIB.                                          080902ma
292500 COPY FFFLDS4 OF J3KLIB.                                          080902ma
292600 COPY FFFLDS5 OF J3KLIB.                                          080902ma
292700 COPY FFFLDS6 OF J3KLIB.                                          080902ma
292800 COPY FFFLDS7 OF J3KLIB.                                          080902ma
292900 COPY FFFLDS8 OF J3KLIB.                                          080902ma
293000                                                                  080902ma
293100 COPY FMMSTR0 OF J3KLIB.                                          080902ma
293200 COPY FMMSTR1 OF J3KLIB.                                          080902ma
293300 COPY FMMSTR2 OF J3KLIB.                                          080902ma
293400 COPY FMMSTR3 OF J3KLIB.                                          080902ma
293500 COPY FMMSTR4 OF J3KLIB.                                          080902ma
293600 COPY FMMSTR5 OF J3KLIB.                                          080902ma
293700 COPY FMMSTR6 OF J3KLIB.                                          080902ma
293800 COPY FMMSTR7 OF J3KLIB.                                          080902ma
293900 COPY FMMSTR8 OF J3KLIB.                                          080902ma
294000                                                                  080902ma
294100 COPY FFMSTR0 OF J3KLIB.                                          080902ma
294200 COPY FFMSTR1 OF J3KLIB.                                          080902ma
294300 COPY FFMSTR2 OF J3KLIB.                                          080902ma
294400 COPY FFMSTR3 OF J3KLIB.                                          080902ma
294500 COPY FFMSTR4 OF J3KLIB.                                          080902ma
294600 COPY FFMSTR5 OF J3KLIB.                                          080902ma
294700 COPY FFMSTR6 OF J3KLIB.                                          080902ma
294800 COPY FFMSTR7 OF J3KLIB.                                          080902ma
294900 COPY FFMSTR8 OF J3KLIB.                                          080902ma
295000                                                                  080902ma
295100 COPY PRSPEC0 OF J3KLIB.                                          080902ma
295200 COPY PRSPEC1 OF J3KLIB.                                          080902ma
295300 COPY PRSPEC2 OF J3KLIB.                                          080902ma
295400 COPY PRSPEC3 OF J3KLIB.                                          080902ma
295500 COPY PRSPEC4 OF J3KLIB.                                          080902ma
295600 COPY PRSPEC5 OF J3KLIB.                                          080902ma
295700 COPY PRSPEC6 OF J3KLIB.                                          080902ma
295800 COPY PRSPEC7 OF J3KLIB.                                          080902ma
295900 COPY PRSPEC8 OF J3KLIB.                                          080902ma
296000                                                                  080902ma
296100 COPY SRVMST0 OF J3KLIB.                                          080902ma
296200 COPY SRVMST1 OF J3KLIB.                                          080902ma
296300 COPY SRVMST2 OF J3KLIB.                                          080902ma
296400 COPY SRVMST3 OF J3KLIB.                                          080902ma
296500 COPY SRVMST4 OF J3KLIB.                                          080902ma
296600 COPY SRVMST5 OF J3KLIB.                                          080902ma
296700 COPY SRVMST6 OF J3KLIB.                                          080902ma
296800 COPY SRVMST7 OF J3KLIB.                                          080902ma
296900 COPY SRVMST8 OF J3KLIB.                                          080902ma
297000*---------------------------------------------------------        080902ma
297100 9000-IMAGE-ERROR.                                                080902ma
297200D    DISPLAY "9000-IMAGE-ERROR".                                  080902ma
297300     CALL "DBEXPLAIN" USING STATUS-AREA.                          080902ma
297400     GO TO 9900-ABEND.                                            080902ma
297500                                                                  MA090323
297600*--------------------------------------------------------------   MA090323
297700 Store-Save-Fields.                                               MA090526
297800D    Display "Store-Save-Fields".                                 MA090526
297900     Move "<SaveFields>" to XML-data.                             MA090526
298000     Perform Write-Xml.                                           MA090526
298100     Add 1 To XmlLevel.                                           MA090526
298200     INITIALIZE FMMSTR-BUFFER.                                    MA090323
298300     MOVE 1                  TO FMMSTR-SVR-UNIQUE                 MA090323
298400     MOVE FFMSTR-VFIL-UNIQUE TO FMMSTR-VFIL-UNIQUE                MA090323
298500     PERFORM GET-NEXT-FMUNIQ                                      MA090323
298600     MOVE NXUNIQ-UNIQ-NUM    TO FMMSTR-FM-UNIQUE                  MA090323
298700     Move "$GLOBAL"           To FMMSTR-FRM-NAME.                 MA090323
298800     Move 0                   To FMMSTR-FRM-NUMBER.               MA090323
298900     Move SFCNT               To FMMSTR-FLDCNT.                   MA090323
299000     Move 0                   To FMMSTR-BUF-LEN.                  MA090323
299100     Move spaces              To FMMSTR-NEXT-FRM.                 MA090323
299200     Move spaces              To FMMSTR-REPEAT-OPT.               MA090323
299300     Move spaces              To FMMSTR-NFORM-OPT.                MA090323
299400     Move spaces             To FMMSTR-FKEY-DEF                   MA090323
299500     Move spaces             To FMMSTR-REPRODUCED-FR              MA090323
299600     Move "Global Settings"  To FMMSTR-COMMENT                    MA090323
299700     Add 1 to My-New-FRMCNT                                       MA090323
299800     PERFORM LOCK-FMMSTR                                          MA090323
299900     PERFORM PUT-FMMSTR                                           MA090323
300000     PERFORM UNLOCK-FMMSTR                                        MA090323
300100     INITIALIZE FFFLDS-BUFFER SFIDX.                              MA090323
300200     move 1 to bufpos.                                            MA090330
300300     Perform Varying SFIDX From 1 By 1                            MA090323
300400      Until SFIDX > SFCNT                                         MA090323
300500      Perform Savefield-To-Xml                                    MA090526
300600      INITIALIZE FFFLDS-BUFFER                                    MA090526
300700      Move 1                   to FFFLDS-SVR-UNIQUE               MA090323
300800      Move FFMSTR-VFIL-UNIQUE  to FFFLDS-VFIL-UNIQUE              MA090323
300900      Move FMMSTR-FM-UNIQUE    to FFFLDS-FM-UNIQUE                MA090323
301000      PERFORM GET-NEXT-FFFUNIQ                                    MA090323
301100      MOVE NXUNIQ-UNIQ-NUM     TO FFFLDS-VFLD-UNIQUE              MA090323
301200      Move 1                   To FFFLDS-SRN-X                    MA090330
301300      Move SFIDX               To FFFLDS-SRN-Y                    MA090330
301400      Move SFIDX               To FFFLDS-SRN-ORD-NUM              MA090330
301500      Move SF-FLD(SFIDX)       To FFFLDS-VFLD-NAME                MA090323
301600      Move SF-TYPE(SFIDX)      To FFFLDS-VFLD-DATATYPE            MA090323
301700      Move SF-INIT(SFIDX)      To FFFLDS-VFLD-INITVAL             MA090323
301800      Move SF-LEN(SFIDX)       To FFFLDS-VFLD-LENGTH              MA090323
301900      Move bufpos to FFFLDS-BUF-X                                 MA090330
302000      Compute                                                     MA090330
302100        FFFLDS-BUF-Y = FFFLDS-BUF-X + SF-LEN(SFIDX)               MA090330
302200      END-COMPUTE                                                 MA090330
302300      Move FFFLDS-BUF-Y to bufpos                                 MA090330
302400      Add 1 to My-New-FLDCNT                                      MA090323
302500      PERFORM LOCK-FFFLDS                                         MA090323
302600      PERFORM PUT-FFFLDS                                          MA090323
302700      PERFORM UNLOCK-FFFLDS                                       MA090323
302800     end-Perform.                                                 MA090323
302900     Subtract 1 From XmlLevel.                                    MA090526
303000     Move "</SaveFields>" to XML-data.                            MA090526
303100     Perform Write-Xml.                                           MA090526
303200*---------------------------------------------------------------  MA090526
303300 NEW-XML-FILE.                                                    MA090526
303400     IF XML-OPENED                                                MA090526
303500      PERFORM CLOSE-XML.                                          MA090526
303600*                                                                 MA090526
303700     INITIALIZE CMD Formname.                                     MA090526
303800     Move "FORM" TO formname-name.                                MA090526
303900     Move FFMSTR-VFIL-UNIQUE TO formname-number.                  MA090526
304000     STRING "FILE DMGXML="    DELIMITED BY SIZE                   MA090526
304100            Formname DELIMITED BY SPACE                           MA090526
304200            ".XML,OLD"                                            MA090526
304300      DELIMITED BY SIZE INTO CMD.                                 MA090526
304400     PERFORM MPE-COMMAND.                                         MA090526
304500     STRING "PURGE "          DELIMITED BY SIZE                   MA090526
304600            Formname DELIMITED BY SPACE                           MA090526
304700            ".XML"                                                MA090526
304800      DELIMITED BY SIZE INTO CMD.                                 MA090526
304900     PERFORM MPE-COMMAND.                                         MA090526
305000     STRING "BUILD " DELIMITED BY SIZE                            MA090526
305100            Formname DELIMITED BY SPACE                           MA090526
305200            ".XML;REC=-256,1,V,ASCII;DISC=1000000"                MA090526
305300      DELIMITED BY SIZE INTO CMD.                                 MA090526
305400     PERFORM MPE-COMMAND.                                         MA090526
305500     PERFORM OPEN-XML.                                            MA090526
305600     Move 1 to XmlLevel.                                          MA090526
305700     INITIALIZE XML-data                                          MA090526
305800     STRING "<?xml version="                                      MA090526
305900              QUOTE "1.0" QUOTE                                   MA090526
306000              " encoding="                                        MA090526
306100              QUOTE "ISO-8859-1" QUOTE                            MA090526
306200              " ?>"                                               MA090526
306300        DELIMITED BY SIZE INTO XML-data.                          MA090526
306400     PERFORM WRITE-XML                                            MA090526
306500     MOVE "<!-- Created by MIG801.PUB.J3K --> "                   MA090526
306600         TO XML-data                                              MA090526
306700     Perform Write-Xml.                                           MA090526
306800     Move "<File>" to XML-data.                                   MA090526
306900     PERFORM WRITE-XML.                                           MA090526
307000     Add 1 To XmlLevel.                                           MA090526
307100*---------------------------------------------------------------  MA090526
307200 File-To-Xml.                                                     MA090526
307300     String "<FileName>" Delimited by size                        MA090526
307400            Screen-forms-file Delimited by space                  MA090526
307500            "</FileName>"                                         MA090526
307600      Delimited by size into XML-data.                            MA090526
307700     Perform Write-Xml.                                           MA090526
307800*                                                                 MA090526
307900     Move FILE-NUMBER-OF-FORMS(1) To Disp-n.                      MA090526
308000     String "<NbrOfForms>" Delimited by size                      MA090526
308100            Disp-n Delimited by size                              MA090526
308200            "</NbrOfForms>"                                       MA090526
308300      Delimited by size into XML-data.                            MA090526
308400     Perform Write-Xml-Numeric.                                   MA090526
308500*                                                                 MA090526
308600     Move FILE-MAX-FIELDS(1) To Disp-n.                           MA090526
308700     String "<MaxFields>" Delimited by size                       MA090526
308800            Disp-n Delimited by size                              MA090526
308900            "</MaxFields>"                                        MA090526
309000      Delimited by size into XML-data.                            MA090526
309100     Perform Write-Xml-Numeric.                                   MA090526
309200*                                                                 MA090526
309300     Move FILE-MAX-BUFSIZE(1) To Disp-n.                          MA090526
309400     String "<MaxBufsize>" Delimited by size                      MA090526
309500            Disp-n Delimited by size                              MA090526
309600            "</MaxBufsize>"                                       MA090526
309700      Delimited by size into XML-data.                            MA090526
309800     Perform Write-Xml-Numeric.                                   MA090526
309900*                                                                 MA090526
310000     Move FILE-SAVE-FIELDS(1) To Disp-n.                          MA090526
310100     String "<SaveFieldCnt>" Delimited by size                    MA090526
310200            Disp-n Delimited by size                              MA090526
310300            "</SaveFieldCnt>"                                     MA090526
310400      Delimited by size into XML-data.                            MA090526
310500     Perform Write-Xml-Numeric.                                   MA090526
310600*                                                                 MA090526
310700     String "<HeadForm>" Delimited by size                        MA090526
310800            FILE-HEAD-FORM(1)  Delimited by space                 MA090526
310900            "</HeadForm>"                                         MA090526
311000      Delimited by size into XML-data.                            MA090526
311100     Perform Write-Xml.                                           MA090526
311200*                                                                 MA090526
311300     String "<ErrorEnhance>" Delimited by size                    MA090526
311400            FILE-ERROR-ENHANCE(1)  Delimited by space             MA090526
311500            "</ErrorEnhance>"                                     MA090526
311600      Delimited by size into XML-data.                            MA090526
311700     Perform Write-Xml.                                           MA090526
311800*                                                                 MA090526
311900     String "<WindowEnhance>" Delimited by size                   MA090526
312000            FILE-WINDOW-ENHANCE(1)  Delimited by space            MA090526
312100            "</WindowEnhance>"                                    MA090526
312200      Delimited by size into XML-data.                            MA090526
312300     Perform Write-Xml.                                           MA090526
312400*                                                                 MA090526
312500     Move FILE-WINDOW-POSITION(1) To Disp-n.                      MA090526
312600     String "<WindowPosition>" Delimited by size                  MA090526
312700            Disp-n Delimited by size                              MA090526
312800            "</WindowPosition>"                                   MA090526
312900      Delimited by size into XML-data.                            MA090526
313000     Perform Write-Xml-Numeric.                                   MA090526
313100*                                                                 MA090526
313200*---------------------------------------------------------------  MA090526
313300 Savefield-To-Xml.                                                MA090526
313400*                                                                 MA090526
313500     String "<SaveName>" Delimited by size                        MA090526
313600            SF-FLD(SFIDX)  Delimited by space                     MA090526
313700            "</SaveName>"                                         MA090526
313800      Delimited by size into XML-data.                            MA090526
313900     Perform Write-Xml.                                           MA090526
314000*                                                                 MA090526
314100     Move SF-LEN(SFIDX) To Disp-n.                                MA090526
314200     String "<SaveLength>" Delimited by size                      MA090526
314300            Disp-n Delimited by size                              MA090526
314400            "</SaveLength>"                                       MA090526
314500      Delimited by size into XML-data.                            MA090526
314600     Perform Write-Xml-Numeric.                                   MA090526
314700*                                                                 MA090526
314800     String "<SaveType>" Delimited by size                        MA090526
314900            SF-TYPE(SFIDX) Delimited by space                     MA090526
315000            "</SaveType>"                                         MA090526
315100      Delimited by size into XML-data.                            MA090526
315200     Perform Write-Xml.                                           MA090526
315300*                                                                 MA090526
315400     String "<SaveValue><![CDATA[" Delimited by size              MA090526
315500            SF-INIT(SFIDX) Delimited by space                     MA090526
315600            "]]></SaveValue>"                                     MA090526
315700      Delimited by size into XML-data.                            MA090526
315800     Perform Write-Xml.                                           MA090526
315900*                                                                 MA090526
316000*---------------------------------------------------------------  MA090526
316100 Form-To-Xml.                                                     MA090526
316200     Move "<Form>" to XML-data.                                   MA090526
316300     Perform Write-Xml.                                           MA090526
316400     Add 1 To XmlLevel.                                           MA090526
316500     String "<FmName>" Delimited by size                          MA090526
316600            FMMSTR-FRM-NAME Delimited by space                    MA090526
316700            "</FmName>"                                           MA090526
316800      Delimited by size into XML-data.                            MA090526
316900     Perform Write-Xml.                                           MA090526
317000**                                                                MA090526
317100*     String "<FmPanelName>" Delimited by size                    MA090526
317200*            FMMSTR-PAN-NAME Delimited by space                   MA090526
317300*            "</FmPanelName>"                                     MA090526
317400*      Delimited by size into XML-data.                           MA090526
317500*     Perform Write-Xml.                                          MA090526
317600**                                                                MA090526
317700     Move FMMSTR-FRM-NUMBER To Disp-n.                            MA090526
317800     String "<FmNumber>" Delimited by size                        MA090526
317900            Disp-n Delimited by size                              MA090526
318000            "</FmNumber>"                                         MA090526
318100      Delimited by size into XML-data.                            MA090526
318200     Perform Write-Xml-Numeric.                                   MA090526
318300*                                                                 MA090526
318400     Move FMMSTR-FLDCNT To Disp-n.                                MA090526
318500     String "<FmFieldCnt>" Delimited by size                      MA090526
318600            Disp-n Delimited by size                              MA090526
318700            "</FmFieldCnt>"                                       MA090526
318800      Delimited by size into XML-data.                            MA090526
318900     Perform Write-Xml-Numeric.                                   MA090526
319000*                                                                 MA090526
319100     Move FMMSTR-BUF-LEN To Disp-n.                               MA090526
319200     String "<FmBufLen>" Delimited by size                        MA090526
319300            Disp-n Delimited by size                              MA090526
319400            "</FmBufLen>"                                         MA090526
319500      Delimited by size into XML-data.                            MA090526
319600     Perform Write-Xml-Numeric.                                   MA090526
319700*                                                                 MA090526
319800     String "<FmNextFrm>" Delimited by size                       MA090526
319900            FMMSTR-NEXT-FRM Delimited by space                    MA090526
320000            "</FmNextFrm>"                                        MA090526
320100      Delimited by size into XML-data.                            MA090526
320200     Perform Write-Xml.                                           MA090526
320300*                                                                 MA090526
320400     String "<FmRepeatOpt>" Delimited by size                     MA090526
320500            FMMSTR-REPEAT-OPT Delimited by space                  MA090526
320600            "</FmRepeatOpt>"                                      MA090526
320700      Delimited by size into XML-data.                            MA090526
320800     Perform Write-Xml.                                           MA090526
320900*                                                                 MA090526
321000     String "<FmNformOpt>" Delimited by size                      MA090526
321100            FMMSTR-NFORM-OPT Delimited by space                   MA090526
321200            "</FmNformOpt>"                                       MA090526
321300      Delimited by size into XML-data.                            MA090526
321400     Perform Write-Xml.                                           MA090526
321500*                                                                 MA090526
321600     String "<FmReproduced>" Delimited by size                    MA090526
321700            FMMSTR-REPRODUCED-FR Delimited by space               MA090526
321800            "</FmReproduced>"                                     MA090526
321900      Delimited by size into XML-data.                            MA090526
322000     Perform Write-Xml.                                           MA090526
322100*                                                                 MA090526
322200     String "<FmKeyDef>" Delimited by size                        MA090526
322300            FMMSTR-FKEY-DEF Delimited by space                    MA090526
322400            "</FmKeyDef>"                                         MA090526
322500      Delimited by size into XML-data.                            MA090526
322600     Perform Write-Xml.                                           MA090526
322700*                                                                 MA090526
322800     String "<FmComment><![CDATA[" Delimited by size              MA090526
322900            FMMSTR-COMMENT Delimited by "  "                      MA090526
323000            "]]></FmComment>"                                     MA090526
323100      Delimited by size into XML-data.                            MA090526
323200     Perform Write-Xml.                                           MA090526
323300*--------------------------------------------------------------   MA090526
323400 Field-To-Xml.                                                    MA090526
323500*                                                                 MA090526
323600     Move "<Field>" To Xml-Data.                                  MA090526
323700     if FFFLDS-VFLD-NAME = "FKEY"                                 MA090526
323800      Move "<FunctionKey>" To Xml-Data.                           MA090526
323900     if FFFLDS-VFLD-NAME = "TEXT"                                 MA090526
324000      Move "<StaticText>" To Xml-Data.                            MA090526
324100     if FFFLDS-VFLD-NAME = "ENHANCEMENT"                          MA090526
324200      Move "<Enhancement>" To Xml-Data.                           MA090526
324300     if FFFLDS-VFLD-NAME = "Line"                                 MA090526
324400      Move "<LineDraw>" To Xml-Data.                              MA090526
324500     Perform Write-Xml.                                           MA090526
324600     Add 1 To XmlLevel.                                           MA090526
324700*                                                                 MA090526
324800     String "<FldName>" Delimited by size                         MA090526
324900            FFFLDS-VFLD-NAME Delimited by "  "                    MA090526
325000            "</FldName>"                                          MA090526
325100      Delimited by size into XML-data.                            MA090526
325200     Perform Write-Xml.                                           MA090526
325300*                                                                 MA090526
325400     Move FFFLDS-BUF-X To Disp-n.                                 MA090526
325500     String "<FldBufStart>" Delimited by size                     MA090526
325600            Disp-n Delimited by size                              MA090526
325700            "</FldBufStart>"                                      MA090526
325800      Delimited by size into XML-data.                            MA090526
325900     Perform Write-Xml-Numeric.                                   MA090526
326000*                                                                 MA090526
326100     Move FFFLDS-BUF-Y To Disp-n.                                 MA090526
326200     String "<FldBufEnd>" Delimited by size                       MA090526
326300            Disp-n Delimited by size                              MA090526
326400            "</FldBufEnd>"                                        MA090526
326500      Delimited by size into XML-data.                            MA090526
326600     Perform Write-Xml-Numeric.                                   MA090526
326700*                                                                 MA090526
326800     Move FFFLDS-SRN-X To Disp-n.                                 MA090526
326900     String "<FldColumn>" Delimited by size                       MA090526
327000            Disp-n Delimited by size                              MA090526
327100            "</FldColumn>"                                        MA090526
327200      Delimited by size into XML-data.                            MA090526
327300     Perform Write-Xml-Numeric.                                   MA090526
327400*                                                                 MA090526
327500     Move FFFLDS-SRN-Y To Disp-n.                                 MA090526
327600     String "<FldRow>" Delimited by size                          MA090526
327700            Disp-n Delimited by size                              MA090526
327800            "</FldRow>"                                           MA090526
327900      Delimited by size into XML-data.                            MA090526
328000     Perform Write-Xml-Numeric.                                   MA090526
328100*                                                                 MA090526
328200     Move FFFLDS-SRN-ORD-NUM To Disp-n.                           MA090526
328300     String "<FldScreenOrder>" Delimited by size                  MA090526
328400            Disp-n Delimited by size                              MA090526
328500            "</FldScreenOrder>"                                   MA090526
328600      Delimited by size into XML-data.                            MA090526
328700     Perform Write-Xml-Numeric.                                   MA090526
328800*                                                                 MA090526
328900     Move FFFLDS-VFLD-NUM To Disp-n.                              MA090526
329000     String "<FldNumber>" Delimited by size                       MA090526
329100            Disp-n Delimited by size                              MA090526
329200            "</FldNumber>"                                        MA090526
329300      Delimited by size into XML-data.                            MA090526
329400     Perform Write-Xml-Numeric.                                   MA090526
329500*                                                                 MA090526
329600     Move FFFLDS-VFLD-LENGTH To Disp-n.                           MA090526
329700     String "<FldLength>" Delimited by size                       MA090526
329800            Disp-n Delimited by size                              MA090526
329900            "</FldLength>"                                        MA090526
330000      Delimited by size into XML-data.                            MA090526
330100     Perform Write-Xml-Numeric.                                   MA090526
330200*                                                                 MA090526
330300     Move FFFLDS-VFLD-POSITION To Disp-n.                         MA090526
330400     String "<FldPosition>" Delimited by size                     MA090526
330500            Disp-n Delimited by size                              MA090526
330600            "</FldPosition>"                                      MA090526
330700      Delimited by size into XML-data.                            MA090526
330800     Perform Write-Xml-Numeric.                                   MA090526
330900*                                                                 MA090526
331000     String "<FldEnhance>" Delimited by size                      MA090526
331100            FFFLDS-VFLD-ENHANCE Delimited by "  "                 MA090526
331200            "</FldEnhance>"                                       MA090526
331300      Delimited by size into XML-data.                            MA090526
331400     Perform Write-Xml.                                           MA090526
331500*                                                                 MA090526
331600     String "<FldFtype>" Delimited by size                        MA090526
331700            FFFLDS-VFLD-TYPE Delimited by "  "                    MA090526
331800            "</FldFtype>"                                         MA090526
331900      Delimited by size into XML-data.                            MA090526
332000     Perform Write-Xml.                                           MA090526
332100*                                                                 MA090526
332200     String "<FldDataType>" Delimited by size                     MA090526
332300            FFFLDS-VFLD-DATATYPE Delimited by "  "                MA090526
332400            "</FldDataType>"                                      MA090526
332500      Delimited by size into XML-data.                            MA090526
332600     Perform Write-Xml.                                           MA090526
332700*                                                                 MA090526
332800     If FFFLDS-VFLD-INITVAL > Spaces                              MA090526
332900      String "<FldInit><![CDATA[" Delimited by size               MA090526
333000             FFFLDS-VFLD-INITVAL Delimited by "  "                MA090526
333100             "]]></FldInit>"                                      MA090526
333200       Delimited by size into XML-data                            MA090526
333300      End-String                                                  MA090526
333400      Perform Write-Xml                                           MA090526
333500     Else                                                         MA090526
333600      Move "<FldInit></FldInit>"                                  MA090526
333700        To Xml-Data                                               MA090526
333800      Perform Write-Xml.                                          MA090526
333900*                                                                 MA090526
334000     If FFFLDS-SPECS > Spaces                                     MA090526
334100      Move "<FldProcessingSpecs><![CDATA[" To Xml-Data            MA090526
334200      Perform Write-Xml                                           MA090526
334300      Add 1 To XmlLevel                                           MA090526
334400      Perform Varying xmlidx from 1 by 1                          MA090526
334500        until xmlidx > 15                                         MA090526
334600       If FFFLDS-PROCSPECS(xmlidx) > spaces                       MA090526
334700        Move FFFLDS-PROCSPECS(xmlidx) to XML-data                 MA090526
334800        Perform Write-Xml                                         MA090526
334900       End-If                                                     MA090526
335000      End-Perform                                                 MA090526
335100      Subtract 1 From XmlLevel                                    MA090526
335200      Move "]]></FldProcessingSpecs>" To Xml-Data                 MA090526
335300      Perform Write-Xml                                           MA090526
335400     Else                                                         MA090526
335500      Move "<FldProcessingSpecs></FldProcessingSpecs>"            MA090526
335600        To Xml-Data                                               MA090526
335700      Perform Write-Xml.                                          MA090526
335800                                                                  MA090526
335900     Subtract 1 From XmlLevel.                                    MA090526
336000     Move "</Field>" To Xml-Data.                                 MA090526
336100     if FFFLDS-VFLD-NAME = "FKEY"                                 MA090526
336200      Move "</FunctionKey>" To Xml-Data.                          MA090526
336300     if FFFLDS-VFLD-NAME = "TEXT"                                 MA090526
336400      Move "</StaticText>" To Xml-Data.                           MA090526
336500     if FFFLDS-VFLD-NAME = "ENHANCEMENT"                          MA090526
336600      Move "</Enhancement>" To Xml-Data.                          MA090526
336610     if FFFLDS-VFLD-NAME = "Line"                                 MA090526
336710      Move "</LineDraw>" To Xml-Data.                             MA090526
336720                                                                  MA090526
336800     Perform Write-Xml.                                           MA090526
336900*--------------------------------                                 MA090526
337000 OPEN-XML.                                                        MA090526
337100*    DISPLAY "OPEN-GFILE-OUTPUT".                                 MA090526
337200     OPEN OUTPUT DMGXML-FILE.                                     MA090526
337300     IF XML-STATUS <> "00" PERFORM 9001-FILE-ERROR.               MA090526
337400     MOVE ZERO TO XML-RCOUNT XML-COUNT.                           MA090526
337500     MOVE "02" TO XML-FLAG.                                       MA090526
337600*--------------------------------                                 MA090526
337700 Write-Xml.                                                       MA090526
337800*    DISPLAY "Write-Xml ".                                        MA090526
337900     MOVE "DMGXML" TO FNAME.                                      MA090526
338000     move LOW-VALUE To Xml-Str.                                   MA090526
338100     perform Varying XmlLen From 255 By -1                        MA090526
338200       Until Xml-Data(XmlLen:1) > Space                           MA090526
338300          or ( XmlLen < 2 )                                       MA090526
338400      Continue                                                    MA090526
338500     End-Perform.                                                 MA090526
338600     Move Spaces To Xml-Str.                                      MA090526
338700     if XmlLevel < 1 move 1 to XmlLevel.                          MA090526
338800     Move Xml-Data(1:XmlLen) To Xml-Str(XmlLevel:XmlLen).         MA090526
338900     WRITE XML-File.                                              MA090526
339000     IF XML-STATUS <> "00" PERFORM 9001-FILE-ERROR.               MA090526
339100     ADD 1 TO XML-COUNT.                                          MA090526
339200     INITIALIZE Xml-Data.                                         MA090526
339300*--------------------------------                                 MA090526
339400 CLOSE-XML.                                                       MA090526
339500*    DISPLAY "CLOSE-XML ".                                        MA090526
339600     Subtract 1 From XmlLevel.                                    MA090526
339700     Move "</File>" to XML-data.                                  MA090526
339800     PERFORM WRITE-XML.                                           MA090526
339900     MOVE "DMGXML" TO FNAME.                                      MA090526
340000     CLOSE DMGXML-FILE.                                           MA090526
340100     MOVE SPACES TO XML-FLAG.                                     MA090526
340200*--------------------------------                                 MA090526
340300 Write-Xml-CDATA.                                                 MA090526
340400*    DISPLAY "Write-Xml-CDATA ".                                  MA090526
340500     MOVE "DMGXML" TO FNAME.                                      MA090526
340600     move LOW-VALUE To Xml-Str.                                   MA090526
340700     perform Varying XmlLen From 255 By -1                        MA090526
340800       Until Xml-Data(XmlLen:1) > Space                           MA090526
340900          or ( XmlLen < 2 )                                       MA090526
341000      Continue                                                    MA090526
341100     End-Perform.                                                 MA090526
341200     Move Spaces To Xml-Str.                                      MA090526
341300     Move 0 To XmlPtr.                                            MA090526
341400     Move "0" to end-of-tag-sw                                    MA090526
341500     Move "0" to next-tag-sw                                      MA090526
341600     perform Varying Xmlidx From 1 By 1                           MA090526
341700       Until Xmlidx > XmlLen                                      MA090526
341800          or ( Xmlidx > 255 )                                     MA090526
341900      Move "0" to CD-Syntax                                       MA090526
342000      If Xmlidx < Xmllen and end-of-tag-sw Not = "1"              MA090526
342100       IF Xml-Data(Xmlidx:1) = ">"                                MA090526
342200        Move "1" to CD-Syntax                                     MA090526
342300        move "1" to end-of-tag-sw                                 MA090526
342400        Add 1 to XmlPtr XmlLen                                    MA090526
342500        Move "><![CDATA[" TO Xml-Str(XmlPtr:10)                   MA090526
342600        Add 9 To XmlPtr                                           MA090526
342700       End-If                                                     MA090526
342800      End-If                                                      MA090526
342900      If Xmlidx < Xmllen and                                      MA090526
343000        next-tag-sw Not = "1" and                                 MA090526
343100        end-of-tag-sw = "1"                                       MA090526
343200       IF Xml-Data(Xmlidx:1) = "<"                                MA090526
343300        Move "1" to CD-Syntax                                     MA090526
343400        move "1" to next-tag-sw                                   MA090526
343500        Add 1 to XmlPtr                                           MA090526
343600        Move "]]><" TO Xml-Str(XmlPtr:4)                          MA090526
343700        Add 3 To XmlPtr                                           MA090526
343800       End-If                                                     MA090526
343900      End-If                                                      MA090526
344000      If CD-Syntax = "1"                                          MA090526
344100       Add 1 to XmlPtr                                            MA090526
344200       Move Xml-Data(Xmlidx:1) TO Xml-Str(XmlPtr:1)               MA090526
344300      End-If                                                      MA090526
344400     End-Perform.                                                 MA090526
344500     Move Xml-Str To Xml-Data.                                    MA090526
344600     Move Spaces To Xml-Str.                                      MA090526
344700     Move XmlPtr To XmlLen.                                       MA090526
344800     if XmlLevel < 1 move 1 to XmlLevel.                          MA090526
344900     Move Xml-Data(1:XmlLen) To Xml-Str(XmlLevel:XmlLen).         MA090526
345000     WRITE XML-File.                                              MA090526
345100     IF XML-STATUS <> "00" PERFORM 9001-FILE-ERROR.               MA090526
345200     ADD 1 TO XML-COUNT.                                          MA090526
345300     INITIALIZE Xml-Data.                                         MA090526
345400*--------------------------------                                 MA090526
345500 Write-Xml-Numeric.                                               MA090526
345600*    DISPLAY "Write-Xml-Numeric ".                                MA090526
345700     MOVE "DMGXML" TO FNAME.                                      MA090526
345800     move LOW-VALUE To Xml-Str.                                   MA090526
345900     perform Varying XmlLen From 255 By -1                        MA090526
346000       Until Xml-Data(XmlLen:1) > Space                           MA090526
346100          or ( XmlLen < 2 )                                       MA090526
346200      Continue                                                    MA090526
346300     End-Perform.                                                 MA090526
346400     Move Spaces To Xml-Str.                                      MA090526
346500     Move 0 To XmlPtr.                                            MA090526
346600     perform Varying Xmlidx From 1 By 1                           MA090526
346700       Until Xmlidx > XmlLen                                      MA090526
346800          or ( Xmlidx > 255 )                                     MA090526
346900      If Xml-Data(Xmlidx:1) > Space                               MA090526
347000       Add 1 to XmlPtr                                            MA090526
347100       Move Xml-Data(Xmlidx:1) TO Xml-Str(XmlPtr:1)               MA090526
347200      End-If                                                      MA090526
347300     End-Perform.                                                 MA090526
347400     Move Xml-Str To Xml-Data.                                    MA090526
347500     Move Spaces To Xml-Str.                                      MA090526
347600     Move XmlPtr To XmlLen.                                       MA090526
347700     if XmlLevel < 1 move 1 to XmlLevel.                          MA090526
347800     Move Xml-Data(1:XmlLen) To Xml-Str(XmlLevel:XmlLen).         MA090526
347900     WRITE XML-File.                                              MA090526
348000     IF XML-STATUS <> "00" PERFORM 9001-FILE-ERROR.               MA090526
348100     ADD 1 TO XML-COUNT.                                          MA090526
348200     INITIALIZE Xml-Data.                                         MA090526
348300                                                                  MA090526
