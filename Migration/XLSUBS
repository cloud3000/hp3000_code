001000***************************************************************           
002100*  REQUIRED COPYLIB's                                                     
002200*  ---------------------------------------------------------              
002300*  1). J3KLIB=J3KLIB.COPYLIB.SOURCE                                       
002400*                                                                         
002500*   TABLE OF CONTENTS.                                                    
002600*  { Please update the table of contents when adding programs}            
002700*                                                                         
002800*                 Call by  Subroutine                                     
002900*  SEGMENT NAME   Driver   Descrption                                     
003000*  -------------- -------  ------------------------------------           
003100*  APPSEC         YES       STANDARD application security                 
003300*  CALEN                    Returns week-of-month                         
003500*  CKDATE                   Date Validate/calculate {yymmdd}              
003700*  DAYNUM                   Date Validate/calculate {yyyymmdd}            
003800*                           also returns day_of_week                      
004000*  DEVINFO                  Returns ldev data from SECDB.                 
004200*  GETBITS        YES       Converts 16 bits into 16 bytes.               
004400*  GETCURRENT               Returns current date with century.            
004600*  NUMGET                   Edits PIC X(14) into PIC 9(14).               
004800*  HPTYPE         YES       Returns HP model number.                      
005000*  LOADLASER                Loads laser forms, from LASDB.                
005200*  ONLINE                   Checks if SCHOOL is ONLINE.                   
005400*  PINFO          YES       Returns process information.                  
005600*  PROCNAME       YES       Returns x(36) program name.                   
005800*  PROCNUM        YES       Return Process ID Number.                     
006000*  SECURE         YES       Checks Security data, access.                 
006200*  SONCOUNT       YES       Returns number of son process's.              
006400*  TIMEOUT        YES       Returns timeout from SECDB.                   
006600*  VPROCESS                 Turns "PROCESSING" on/off.                    
006800*  WEEKNUM                  Returns week of the month.                    
007000*  NUMGET         YES       Edits PIC X(14) into PIC 9(14).               
007200*  J3KGETFD                 Returns Cobol FD filenumber.                  
007400*  GETPROC                  Returns PIN of suspended process              
007700*                           returns the PIN.                              
007900*  AMSMODE                  Returns 16 BYTE "WHO" USERMODE.               
008100*  AMSESQ                   Puts calling process in the "E" que           
008300*  AMSDSQ                   Puts calling process in the "D" que           
008500*  AMSCSQ                   Puts calling process in the "C" que           
008700*  AMSINITQ                 Returns initial sub-que value.                
008900*  TIMENUM                  For processing date-time data.                
009100*  NUMTIME                  Reverse of TIMENUM.                           
009300*  AMSSDEV                  AMS LDEV for Network Security.                
009500*  PROGSTAMP1               Initial DEBUG & Tracking stamp.               
009700*  PROGSTAMP2               Final DEBUG & Tracking stamp.                 
009800*                                                                         
009900***************************************************************           
010000$PAGE "THIS PROGRAM ---> APPSEC   "                                       
010100                                                                          
010200*                                                                         
010300*     |           |           |           |           |                   
010400*     |           |           |           |           |                   
010500*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
010600* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
010700*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
010800*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
010900*    \|/         \|/         \|/         \|/         \|/                  
011000*     Y           Y           Y           Y           Y                   
011100*                                                                         
050300                                                                          
050400                                                                          
050500$PAGE "THIS PROGRAM ---> DAYNUM   "                                       
050600                                                                          
050700*                                                                         
050800*     |           |           |           |           |                   
050900*     |           |           |           |           |                   
051000*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
051100* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
051200*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
051300*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
051400*    \|/         \|/         \|/         \|/         \|/                  
051500*     Y           Y           Y           Y           Y                   
051600*                                                                         
051700$TITLE "DAYNUM - TO CHECK VALIDITY OF A DATE"                             
051800$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
051900 IDENTIFICATION DIVISION.                                                 
052000 PROGRAM-ID. DAYNUM.                                                      
052100 AUTHOR.     MICHAEL ANDERSON.                                            
052200 DATE-COMPILED.                                                           
052300 ENVIRONMENT DIVISION.                                                    
052400 CONFIGURATION SECTION.                                                   
052500 SOURCE-COMPUTER. HP3000.                                                 
052600 OBJECT-COMPUTER. HP3000.                                                 
052700$PAGE                                                                     
052800 DATA DIVISION.                                                           
052900 WORKING-STORAGE SECTION.                                                 
053000                                                                          
053100 01  X                     PIC S9(4) COMP.                                
053200 01  JCWNAME               PIC X(8) VALUE "FLOWTEST".                     
053300 01  JCWVALUE              PIC S9(4) COMP VALUE +0.                       
053400     88 FLOWTEST           VALUE 1.                                       
053500                                                                          
053600 01  DAY-TABLE PIC X(24) VALUE "312831303130313130313031".                
053700 01  FILLER REDEFINES DAY-TABLE.                                          
053800     02  DAYS-IN-MONTH     PIC 99 OCCURS 12 TIMES.                        
053900                                                                          
054000 01  N-WORK               PIC S9(9) COMP.                                 
054100                                                                          
054200 01  MO                    PIC S9(4) COMP.                                
054300 01  DA                    PIC S9(4) COMP.                                
054400 01  YR                    PIC S9(4) COMP.                                
054500                                                                          
054600 LINKAGE SECTION.                                                         
054700                                                                          
054800 01  CAL-DATE.                                                            
054900     02  CAL-YR            PIC 9(4).                                      
055000     02  FILLER REDEFINES CAL-YR.                                         
055100         03 CAL-CE         PIC 99.                                        
055200         03 CAL-YEAR       PIC 99.                                        
055300     02  CAL-MO           PIC 99.                                         
055400     02  CAL-DA           PIC 99.                                         
055500                                                                          
055600 01  NUM-DATE             PIC S9(9) COMP.                                 
055700                                                                          
055800 01  DOW                  PIC S9(4) COMP.                                 
055900$PAGE                                                                     
056000 PROCEDURE DIVISION USING CAL-DATE NUM-DATE DOW.                          
056100                                                                          
056200 000-BEGIN.                                                               
056300     CALL INTRINSIC "FINDJCW" USING JCWNAME JCWVALUE X.                   
056400     IF FLOWTEST                                                          
056500        DISPLAY "--------------------------------------"                  
056600        DISPLAY "DAYNUM BEGIN"                                            
056700        DISPLAY "DATE = " CAL-DATE ",  NUMBER = " NUM-DATE                
056800                ", DOW   = " DOW.                                         
056900     MOVE ZERO TO DOW.                                                    
057000     INSPECT CAL-DATE REPLACING ALL " " BY "0".                           
057100     IF CAL-DATE NOT NUMERIC GO TO 900-DATE-ERROR.                        
057200     IF CAL-DATE = ALL "0" AND NUM-DATE NOT = ZERO                        
057300         GO TO 200-CAL-DATE.                                              
057400     MOVE CAL-MO TO MO.                                                   
057500     MOVE CAL-DA TO DA.                                                   
057600     MOVE CAL-YR TO YR.                                                   
057700     IF MO LESS THAN 1 OR GREATER THAN 12 GO TO 900-DATE-ERROR.           
057800     PERFORM 700-LEAP-YR.                                                 
057900     IF DA LESS THAN 1 OR GREATER THAN DAYS-IN-MONTH (MO)                 
058000         GO TO 900-DATE-ERROR.                                            
058100                                                                          
058200 100-NUM-DATE.                                                            
058300     COMPUTE NUM-DATE = (YR * 365.25 + .75) .                             
058400     PERFORM 710-ADD-MONTH VARYING X FROM 1 BY 1                          
058500         UNTIL X = MO.                                                    
058600     COMPUTE NUM-DATE = NUM-DATE + DA - 1.                                
058700     PERFORM 730-DAY-OF-THE-WEEK.                                         
058800     GO TO 999-EXIT.                                                      
058900                                                                          
059000 200-CAL-DATE.                                                            
059100     COMPUTE YR = NUM-DATE / 365.25.                                      
059200     PERFORM 700-LEAP-YR.                                                 
059300     COMPUTE N-WORK = NUM-DATE - (YR * 365.25) + 1 .                      
059400     PERFORM 720-SUB-MONTH VARYING MO FROM 1 BY 1                         
059500         UNTIL N-WORK NOT GREATER THAN DAYS-IN-MONTH (MO).                
059600     COMPUTE DA = N-WORK.                                                 
059700     MOVE MO TO CAL-MO.                                                   
059800     MOVE DA TO CAL-DA.                                                   
059900     MOVE YR TO CAL-YR.                                                   
060000     PERFORM 730-DAY-OF-THE-WEEK.                                         
060100     GO TO 999-EXIT.                                                      
060200                                                                          
060300 700-LEAP-YR.                                                             
060400     IF (YR / 4) * 4 = YR                                                 
060500         MOVE 29 TO DAYS-IN-MONTH (2)                                     
060600     ELSE                                                                 
060700         MOVE 28 TO DAYS-IN-MONTH (2).                                    
060800                                                                          
060900     IF  (YR > 1699) AND (YR / 100) * 100 = YR                            
061000         MOVE 28 TO DAYS-IN-MONTH (2).                                    
061100                                                                          
061200     IF  (YR > 1699) AND (YR / 400) * 400 = YR                            
061300         MOVE 29 TO DAYS-IN-MONTH (2).                                    
061400                                                                          
061500 710-ADD-MONTH.                                                           
061600     ADD DAYS-IN-MONTH (X) TO NUM-DATE.                                   
061700                                                                          
061800 720-SUB-MONTH.                                                           
061900     SUBTRACT DAYS-IN-MONTH (MO) FROM N-WORK.                             
062000                                                                          
062100 730-DAY-OF-THE-WEEK.                                                     
062200     COMPUTE N-WORK = NUM-DATE.                                           
062300     IF CAL-YR < 1701 ADD 1 TO N-WORK.                                    
062400     IF CAL-YR > 1800 AND < 1901 ADD 6 TO N-WORK.                         
062500     IF CAL-YR > 1900 AND < 2101 ADD 5 TO N-WORK.                         
062600     IF CAL-YR > 2100 AND < 2201 ADD 4 TO N-WORK.                         
062700     DIVIDE N-WORK   BY 7 GIVING X REMAINDER DOW.                         
062800     ADD 1 TO DOW.                                                        
062900                                                                          
063000 900-DATE-ERROR.                                                          
063100     MOVE 0  TO DOW.                                                      
063200                                                                          
063300 999-EXIT.                                                                
063400     IF FLOWTEST                                                          
063500        DISPLAY "DATE = " CAL-DATE ",  NUMBER = " NUM-DATE                
063600                ", DOW   = " DOW                                          
063700        DISPLAY "DAYNUM END"                                              
063800        DISPLAY "--------------------------------------".                 
063900     GOBACK.                                                              
064000 END PROGRAM DAYNUM.                                                      
064100                                                                          
082900$PAGE "THIS PROGRAM ---> GETBITS  "                                       
083000                                                                          
083100*                                                                         
083200*     |           |           |           |           |                   
083300*     |           |           |           |           |                   
083400*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
083500* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
083600*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
083700*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
083800*    \|/         \|/         \|/         \|/         \|/                  
083900*     Y           Y           Y           Y           Y                   
084000*                                                                         
084100$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
084200 IDENTIFICATION DIVISION.                                                 
084300 PROGRAM-ID. GETBITS.                                                     
084400 AUTHOR.     MICHAEL ANDERSON.                                            
084500 DATE-COMPILED.                                                           
084600                                                                          
084700**************************************************************            
084800*                                                            *            
084900*  - Subprogram "GETBITS" converts decimal to binary -       *            
085000*     Converting a 2 byte binary field containing a decimal  *            
085100*     value.                                                 *            
085200*     To a 16 byte numeric field containing a binary value.  *            
085300*     IMPORTANT NOTE:                                        *            
085400*     The first byte represents bit 0. The values for bits   *            
085500*     1-15 are in a 15 byte table, that can be addressed     *            
085600*     using subscripts that match the bit location.          *            
085700**************************************************************            
085800                                                                          
085900 ENVIRONMENT DIVISION.                                                    
086000                                                                          
086100 CONFIGURATION SECTION.                                                   
086200 SOURCE-COMPUTER. HP3000.                                                 
086300 OBJECT-COMPUTER. HP3000.                                                 
086400 SPECIAL-NAMES.                                                           
086500     CONDITION-CODE IS CC.                                                
086600                                                                          
086700 INPUT-OUTPUT SECTION.                                                    
086800 DATA DIVISION.                                                           
086900 FILE SECTION.                                                            
087000$PAGE "WORKING STORAGE SECTION"                                           
087100*****************************************************************         
087200 WORKING-STORAGE SECTION.                                                 
087300*****************************************************************         
087400                                                                          
087500 01  I                     PIC S9(4) COMP.                                
087600 01  N                     PIC S9(4) COMP.                                
087700 01  DEC-MASK              PIC ZZZZZ9.                                    
087800 01  QUOTIENT              PIC S9(4) COMP.                                
087900 01  DIVISOR               PIC S9(4) COMP.                                
088000 01  DIVIDEND              PIC S9(4) COMP.                                
088100 01  BINARY-DIGIT          PIC 9.                                         
088200$PAGE "LINKAGE SECTION"                                                   
088300*****************************************************************         
088400 LINKAGE SECTION.                                                         
088500*****************************************************************         
088600                                                                          
088700 01  DECIMAL-VALUE                   PIC S9(4) COMP.                      
088800 01  BINARY-VALUE.                                                        
088900     05 BIT-ZERO                     PIC 9.                               
089000     05 BIT OCCURS 15 TIMES          PIC 9.                               
089100$PAGE "ENTRY SECTION"                                                     
089200 PROCEDURE DIVISION USING DECIMAL-VALUE, BINARY-VALUE.                    
089300                                                                          
089400*****************************************************************         
089500 0000-ENTRY SECTION.                                                      
089600*****************************************************************         
089700                                                                          
089800 0000-BEGIN.                                                              
089900     MOVE ZERO TO BINARY-VALUE, BINARY-DIGIT, QUOTIENT,                   
090000     MOVE DECIMAL-VALUE TO DIVIDEND.                                      
090100     MOVE 2 TO DIVISOR.                                                   
090200     IF DIVIDEND = ZERO                                                   
090300        GO TO END-OF-PROGRAM.                                             
090400                                                                          
090500 0001-CONVERT.                                                            
090600     MOVE 16 TO I.                                                        
090700                                                                          
090800 1000-CONVERTION.                                                         
090900     SUBTRACT 1 FROM I.                                                   
091000     IF I < 0 GO TO END-OF-PROGRAM.                                       
091100     DIVIDE DIVISOR INTO DIVIDEND GIVING QUOTIENT                         
091200            REMAINDER BINARY-DIGIT.                                       
091300     IF I > 0                                                             
091400        MOVE BINARY-DIGIT TO BIT(I).                                      
091500     IF I = 0                                                             
091600        MOVE BINARY-DIGIT TO BIT-ZERO.                                    
091700     MOVE QUOTIENT TO DIVIDEND.                                           
091800     IF DIVIDEND > ZERO GO TO 1000-CONVERTION.                            
091900                                                                          
092000 END-OF-PROGRAM.                                                          
092100     MOVE DECIMAL-VALUE TO DEC-MASK.                                      
092200     IF DIVIDEND > ZERO                                                   
092300        DISPLAY "RESULTS MAYBE WRONG, BECAUSE THE"                        
092400        DISPLAY "DECIMAL VALUE " DEC-MASK, " IS TOO LARGE."               
092500        DISPLAY "EXPECTED AN INTEGER < 32768 ".                           
092600     GOBACK.                                                              
092700 END PROGRAM GETBITS.                                                     
092800                                                                          
092900$PAGE "THIS PROGRAM ---> GETCURRENT"                                      
093000                                                                          
093100*                                                                         
093200*     |           |           |           |           |                   
093300*     |           |           |           |           |                   
093400*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
093500* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
093600*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
093700*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
093800*    \|/         \|/         \|/         \|/         \|/                  
093900*     Y           Y           Y           Y           Y                   
094000*                                                                         
094100$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
094200 IDENTIFICATION DIVISION.                                                 
094300 PROGRAM-ID. GETCURRENT.                                                  
094400 AUTHOR.     MICHAEL ANDERSON.                                            
094500 DATE-COMPILED.                                                           
094600**************************************************************            
094700*   GETCURRENT                                               *            
094800*  Will return the current CALENDAR DATE as follows:         *            
094900*                  current century.  PIC 99                  *            
095000*                  current year   .  PIC 99                  *            
095100*                  current month  .  PIC 99                  *            
095200*                  current day    .  PIC 99                  *            
095300*                                                            *            
095400*  Will return the current numeric date. Which is the total  *            
095500*  number of days since 0000/00/00. PIC S9(9) COMP           *            
095600*                                                            *            
095700*  Will return the current day of the week.                  *            
095800*  A value of 1 thru 7 in the form of PIC S9(4) COMP.        *            
095900*  WITH THE FOLLOWING MEANNING... 0 = ERROR                  *            
096000*                                 1 = SUN                    *            
096100*                                 2 = MON                    *            
096200*                                 3 = TUE                    *            
096300*                                 4 = WED                    *            
096400*                                 5 = THR                    *            
096500*                                 6 = FRI                    *            
096600*                                 7 = SAT                    *            
096700**************************************************************            
096800 ENVIRONMENT DIVISION.                                                    
096900 DATA DIVISION.                                                           
097000 WORKING-STORAGE SECTION.                                                 
097100$PAGE "CALENDAR DATE  STORAGE AREA"                                       
097200 01 DATE-STORAGE.                                                         
097300    02 JULDATE.                                                           
097400       05 JULYEAR          PIC 99.                                        
097500       05 JULDAY           PIC 999.                                       
097600    02 FMT-DATE            PIC S9(4) COMP SYNC.                           
097700    02  ACTIVE-NUMDATE     PIC S9(9) COMP.                                
097800    02  DATADATE-NUM       PIC S9(9) COMP.                                
097900    02 CALENDAR-DATE.                                                     
098000       05 FMT-DAY-OF-WEEK  PIC XXXX.                                      
098100       05 FMT-FILLER1      PIC X.                                         
098200       05 FMT-MONTHNAME    PIC XXX.                                       
098300       05 FMT-DAY OCCURS 3 TIMES.                                         
098400          10 FMTDAYX       PIC X.                                         
098500       05 FMT-FILLER2      PIC XX.                                        
098600       05 FMT-YEAR         PIC 9999.                                      
098700 LINKAGE SECTION.                                                         
098800 01  CALDATE.                                                             
098900     05 CAL-YR.                                                           
099000        10 CAL-CEN      PIC 99.                                           
099100        10 CAL-YEAR     PIC 99.                                           
099200     05 CAL-MO          PIC 99.                                           
099300     05 CAL-DA          PIC 99.                                           
099400 01 NUMDATE             PIC S9(9) COMP.                                   
099500 01 N-ERR               PIC S9(4) COMP.                                   
099600 PROCEDURE DIVISION USING CALDATE NUMDATE N-ERR.                          
099700 0000-BEGIN.                                                              
099800     ACCEPT JULDATE FROM DAY.                                             
099900     COMPUTE FMT-DATE = ((JULYEAR + 100) * 512) + JULDAY.                 
100000     MOVE SPACES TO CALENDAR-DATE.                                        
100100     CALL INTRINSIC "FMTCALENDAR" USING FMT-DATE CALENDAR-DATE.           
100200     MOVE FMT-YEAR TO CAL-YR.                                             
100300     MOVE "01"    TO CAL-DA.                                              
100400     MOVE "01"    TO CAL-MO.                                              
100500     MOVE ZERO TO  NUMDATE N-ERR.                                         
100600     CALL "DAYNUM" USING CALDATE NUMDATE N-ERR.                           
100700     COMPUTE NUMDATE = ( NUMDATE - 1 ) + JULDAY.                          
100800     MOVE "00000000" TO CALDATE.                                          
100900     MOVE ZERO TO N-ERR.                                                  
101000     CALL "DAYNUM" USING CALDATE NUMDATE N-ERR.                           
101100     GOBACK.                                                              
101200 END PROGRAM GETCURRENT.                                                  
101300                                                                          
101400$PAGE "THIS PROGRAM ---> HPTYPE   "                                       
101500                                                                          
101600*                                                                         
101700*     |           |           |           |           |                   
101800*     |           |           |           |           |                   
101900*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
102000* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
102100*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
102200*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
102300*    \|/         \|/         \|/         \|/         \|/                  
102400*     Y           Y           Y           Y           Y                   
102500*                                                                         
102600$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
102700 IDENTIFICATION DIVISION.                                                 
102800 PROGRAM-ID. HPTYPE.                                                      
102900 AUTHOR.     MICHAEL ANDERSON.                                            
103000 DATE-COMPILED.                                                           
103100                                                                          
103200**************************************************************            
103300*                                                            *            
103400*  - APPLICATION SECURITY SUBROUTINE -                       *            
103500*                                                            *            
103600*  SUBPROGRAM TO RETURN TO THE CALLER,                       *            
103700*  THE HPTERMINAL MODEL or PRODUCT NUMBER.                   *            
103800*  ALSO ALL CONFIG STRAPS OF PRIMARY & SECONDARY STATUS'S.   *            
103900*                                                            *            
104000*  SCREENS: NONE                                             *            
104100*                                                            *            
104200**************************************************************            
104300                                                                          
104400 ENVIRONMENT DIVISION.                                                    
104500                                                                          
104600 CONFIGURATION SECTION.                                                   
104700 SOURCE-COMPUTER. HP3000.                                                 
104800 OBJECT-COMPUTER. HP3000.                                                 
104900 SPECIAL-NAMES.                                                           
105000     CONDITION-CODE IS CC.                                                
105100                                                                          
105200$PAGE "WORKING STORAGE SECTION"                                           
105300 DATA DIVISION.                                                           
105400*****************************************************************         
105500 WORKING-STORAGE SECTION.                                                 
105600*****************************************************************         
105700                                                                          
105800 01 I                      PIC S9(4) COMP VALUE ZERO.                     
105900 01 N                      PIC S9(4) COMP VALUE ZERO.                     
106000 01 DISP-N                 PIC 9999       VALUE ZERO.                     
106100     COPY SWITCHES OF J3KLIB.                                             
106200 01 TERMFILE               PIC X(10) VALUE "*SCREENX^".                   
106300                                                                          
106400 01  TFILE-PARMS.                                                         
106500     05  TFILE-CNTL          PIC S9(04) COMP VALUE ZERO.                  
106600     05  TFILE-LEN           PIC S9(04) COMP VALUE ZERO.                  
106700     05  TFILE-BUFF           PIC X(132) VALUE SPACES.                    
106800     05  TFILE-NUM          PIC S9(04) COMP VALUE ZERO.                   
106900 01  SEE-SCREEN-FLAG             PIC X     VALUE "1".                     
107000     88 CONCEALED VALUE "0".                                              
107100     88 REVEALED  VALUE "1".                                              
107200                                                                          
107300 01 HP-MODEL               PIC X(5)  VALUE SPACES.                        
107400 01 PRIMARY-STATUS-BYTE3.                                                 
107500    02 FILLER              PIC X(4)  VALUE SPACES.                        
107600    02 HAS-SECONDARY       PIC X     VALUE "0".                           
107700       88 SECONDARY-AVAILABLE        VALUE "1".                           
107800    02 FILLER              PIC X(3)  VALUE SPACES.                        
107900                                                                          
108000 01 SECONDARY-STATUS-BYTE8.                                               
108100    02 FILLER              PIC X(5)  VALUE SPACES.                        
108200    02 TERMID-ITSELF       PIC X     VALUE "0".                           
108300       88 TERMINAL-KNOWS             VALUE "1".                           
108400    02 FILLER              PIC X(2)  VALUE SPACES.                        
108500                                                                          
108600 01 PRIMARY-STATUS.                                                       
108700    02 FILLER              PIC XX     VALUE SPACES.                       
108800    02 TERM-STATUS0-6.                                                    
108900       03 PS-BYTE          PIC X      OCCURS 7 TIMES.                     
109000    02 FILLER              PIC X      VALUE SPACE.                        
109100                                                                          
109200 01 SECONDARY-STATUS.                                                     
109300    02 FILLER              PIC XX     VALUE SPACES.                       
109400    02 TERM-STATUS7-13.                                                   
109500       03 SS-BYTE          PIC X      OCCURS 7 TIMES.                     
109600    02 FILLER              PIC X      VALUE SPACE.                        
109700                                                                          
109800 01 DECIMAL-VALUE          PIC S9(4) COMP VALUE 0.                        
109900 01 BINARY-VALUE.                                                         
110000    02 HIBYTE              PIC X(8)  VALUE "00000000".                    
110100    02 LOWBYTE             PIC X(8)  VALUE "00000000".                    
110200                                                                          
110300 01 DECIMAL-WORK-AREA.                                                    
110400    02 WK-DECI             PIC S9(4) COMP VALUE ZERO.                     
110500    02 WK-WORD REDEFINES WK-DECI.                                         
110600       03 WK-HIBYTE        PIC X.                                         
110700       03 WK-LOWBYTE       PIC X.                                         
110800                                                                          
110900                                                                          
111000 LINKAGE SECTION.                                                         
111100                                                                          
111200 01  LINK-MODEL-NUMBER     PIC X(6).                                      
111300 01  LINK-PRIMARY-STATUS   PIC X(8).                                      
111400 01  LINK-SECONDARY-STATUS PIC X(8).                                      
111500 01  HPTYPE-MESSAGE        PIC X(80).                                     
111600                                                                          
111700$PAGE "GET TERMINALS MODEL NUMBER PROCEDURE"                              
111800 PROCEDURE DIVISION USING LINK-MODEL-NUMBER                               
111900                          LINK-PRIMARY-STATUS                             
112000                          LINK-SECONDARY-STATUS HPTYPE-MESSAGE.           
112100                                                                          
112200*--------------------------------------------------------------           
112300 0000-BEGIN.                                                              
112400     MOVE "70092"  TO LINK-MODEL-NUMBER.                                  
112500     GOBACK.                                                              
112600 END PROGRAM HPTYPE.                                                      
112700                                                                          
151200$PAGE "THIS PROGRAM ---> PINFO    "                                       
151300                                                                          
151400*                                                                         
151500*     |           |           |           |           |                   
151600*     |           |           |           |           |                   
151700*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
151800* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
151900*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
152000*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
152100*    \|/         \|/         \|/         \|/         \|/                  
152200*     Y           Y           Y           Y           Y                   
152300*                                                                         
152400$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
152500 IDENTIFICATION DIVISION.                                                 
152600 PROGRAM-ID.  PINFO.                                                      
152700 AUTHOR.  MICHAEL ANDERSON.                                               
152800 DATE-COMPILED.                                                           
152900 ENVIRONMENT DIVISION.                                                    
153000 CONFIGURATION SECTION.                                                   
153100 DATA DIVISION.                                                           
153200 WORKING-STORAGE SECTION.                                                 
153300 01  PROCINFO-ERROR1                PIC S9(04) COMP VALUE ZERO.           
153400 01  PROCINFO-ERROR2                PIC S9(04) COMP VALUE ZERO.           
153500 01  PROCINFO-PIN-NO                PIC S9(04) COMP VALUE ZERO.           
153600 01  PROCINFO-ITEMNO1               PIC S9(04) COMP VALUE ZERO.           
153700 01  P-PIN-NO                       PIC  9(04)      VALUE ZERO.           
153800 01  PROCINFO-ITEM1-AREA.                                                 
153900     05  PROCINFO-ITEM1            PIC XX VALUE SPACES.                   
154000     05  FILLER REDEFINES PROCINFO-ITEM1.                                 
154100         10  PROCINFO-PIN          PIC S9(4) COMP.                        
154200 01  PROCINFO-ITEMNO2               PIC S9(04) COMP VALUE ZERO.           
154300 01  PROCINFO-ITEM2                 PIC X(30) VALUE SPACES.               
154400*                                                                         
154500*                                                                         
154600******************************************************************        
154700 LINKAGE SECTION.                                                         
154800     COPY DRIVAREA OF J3KLIB                                              
154900          REPLACING == VALUE SPACES.== BY ==.==                           
155000                    == VALUE ZERO.==   BY ==.==                           
155100                    == VALUE 0.==      BY ==.==.                          
155200                                                                          
155300     COPY USERX OF J3KLIB                                                 
155400          REPLACING == VALUE SPACES.== BY ==.==                           
155500                    == VALUE ZERO.==   BY ==.==                           
155600                    == VALUE 0.==      BY ==.==.                          
155700*                                                                         
155800/                                                                         
155900******************************************************************        
156000 PROCEDURE DIVISION USING DRIVER-AREA, USER-AREA.                         
156100                                                                          
156200******************************************************************        
156300*                                                                         
156400*                                                                         
156500*                                                                         
156600 HSKPG-100.                                                               
156700     MOVE ZERO TO PROCINFO-PIN-NO,                                        
156800                  PROCINFO-ERROR1,                                        
156900                  PROCINFO-ERROR2.                                        
157000     MOVE SPACES TO PROCINFO-ITEM1.                                       
157100     MOVE 1 TO PROCINFO-ITEMNO1.                                          
157200 GET-PROC-PIN-200.                                                        
157300     CALL INTRINSIC "PROCINFO" USING PROCINFO-ERROR1,                     
157400                                     PROCINFO-ERROR2,                     
157500                                     PROCINFO-PIN-NO,                     
157600                                     PROCINFO-ITEMNO1,                    
157700                                     PROCINFO-ITEM1.                      
157800     IF PROCINFO-ERROR1 IS NOT EQUAL TO ZERO                              
157900     OR PROCINFO-ERROR2 IS NOT EQUAL TO ZERO                              
158000        GO TO ABNORMAL-EOJ-9999.                                          
158100 GET-PROC-NAME-300.                                                       
158200     MOVE 10 TO PROCINFO-ITEMNO2.                                         
158300     MOVE PROCINFO-PIN TO P-PIN-NO.                                       
158400     MOVE P-PIN-NO TO PROCINFO-PIN-NO.                                    
158500     MOVE SPACES TO PROCINFO-ITEM2.                                       
158600     CALL INTRINSIC "PROCINFO" USING PROCINFO-ERROR1,                     
158700                                     PROCINFO-ERROR2,                     
158800                                     PROCINFO-PIN-NO,                     
158900                                     PROCINFO-ITEMNO2,                    
159000                                     PROCINFO-ITEM2.                      
159100     IF PROCINFO-ERROR1 IS NOT EQUAL TO ZERO                              
159200     OR PROCINFO-ERROR2 IS NOT EQUAL TO ZERO                              
159300        GO TO ABNORMAL-EOJ-9999.                                          
159400 NORMAL-EOJ-9999.                                                         
159500     MOVE   PROCINFO-ITEM2 TO THE-PROGRAM-NAME.                           
159600     MOVE   P-PIN-NO TO THE-PIN-NUMBER.                                   
159700     GO TO END-OF-PROGRAM.                                                
159800 ABNORMAL-EOJ-9999.                                                       
159900     DISPLAY "ERROR ENCOUNTERED CALLING ""PROCINFO"" INTRINSIC"           
160000     MOVE PROCINFO-ERROR1 TO DISP-INTEGER.                                
160100 END-OF-PROGRAM.                                                          
160200       GOBACK.                                                            
160300 END PROGRAM PINFO.                                                       
160400                                                                          
160500$PAGE "THIS PROGRAM ---> PROCNAME "                                       
160600                                                                          
160700*                                                                         
160800*     |           |           |           |           |                   
160900*     |           |           |           |           |                   
161000*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
161100* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
161200*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
161300*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
161400*    \|/         \|/         \|/         \|/         \|/                  
161500*     Y           Y           Y           Y           Y                   
161600*                                                                         
161700$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
161800 IDENTIFICATION DIVISION.                                                 
161900 PROGRAM-ID.  PROCNAME.                                                   
162000 AUTHOR.  MICHAEL ANDERSON.                                               
162100 DATE-COMPILED.                                                           
162200 ENVIRONMENT DIVISION.                                                    
162300 CONFIGURATION SECTION.                                                   
162400 DATA DIVISION.                                                           
162500 WORKING-STORAGE SECTION.                                                 
162600 01  PROGNAME-ERROR1                PIC S9(04) COMP VALUE ZERO.           
162700 01  PROGNAME-ERROR2                PIC S9(04) COMP VALUE ZERO.           
162800 01  PROGNAME-PIN-NO                PIC S9(04) COMP VALUE ZERO.           
162900 01  PROGNAME-ITEMNO1               PIC S9(04) COMP VALUE ZERO.           
163000 01  P-PIN-NO                       PIC  9(04)      VALUE ZERO.           
163100 01  PROGNAME-ITEM1-AREA.                                                 
163200     05  PROGNAME-ITEM1            PIC XX VALUE SPACES.                   
163300     05  FILLER REDEFINES PROGNAME-ITEM1.                                 
163400         10  PROGNAME-PIN          PIC S9(4) COMP.                        
163500 01  PROGNAME-ITEMNO2               PIC S9(04) COMP VALUE ZERO.           
163600 01  PROGNAME-ITEM2                 PIC X(30) VALUE SPACES.               
163700*                                                                         
163800*                                                                         
163900******************************************************************        
164000 LINKAGE SECTION.                                                         
164100                                                                          
164200 01  THE-PROGRAM-NAME       PIC X(36).                                    
164300*                                                                         
164400/                                                                         
164500******************************************************************        
164600 PROCEDURE DIVISION USING THE-PROGRAM-NAME.                               
164700                                                                          
164800******************************************************************        
164900*                                                                         
165000*                                                                         
165100*                                                                         
165200 HSKPG-100.                                                               
165300     MOVE ZERO TO PROGNAME-PIN-NO,                                        
165400                  PROGNAME-ERROR1,                                        
165500                  PROGNAME-ERROR2.                                        
165600     MOVE SPACES TO PROGNAME-ITEM1.                                       
165700     MOVE 1 TO PROGNAME-ITEMNO1.                                          
165800 GET-PROC-PIN-200.                                                        
165900     CALL INTRINSIC "PROCINFO" USING PROGNAME-ERROR1,                     
166000                                     PROGNAME-ERROR2,                     
166100                                     PROGNAME-PIN-NO,                     
166200                                     PROGNAME-ITEMNO1,                    
166300                                     PROGNAME-ITEM1.                      
166400     IF PROGNAME-ERROR1 IS NOT EQUAL TO ZERO                              
166500     OR PROGNAME-ERROR2 IS NOT EQUAL TO ZERO                              
166600        GO TO ABNORMAL-EOJ-9999.                                          
166700 GET-PROC-NAME-300.                                                       
166800     MOVE 10 TO PROGNAME-ITEMNO2.                                         
166900     MOVE PROGNAME-PIN TO P-PIN-NO.                                       
167000     MOVE P-PIN-NO TO PROGNAME-PIN-NO.                                    
167100     MOVE SPACES TO PROGNAME-ITEM2.                                       
167200     CALL INTRINSIC "PROCINFO" USING PROGNAME-ERROR1,                     
167300                                     PROGNAME-ERROR2,                     
167400                                     PROGNAME-PIN-NO,                     
167500                                     PROGNAME-ITEMNO2,                    
167600                                     PROGNAME-ITEM2.                      
167700     IF PROGNAME-ERROR1 IS NOT EQUAL TO ZERO                              
167800     OR PROGNAME-ERROR2 IS NOT EQUAL TO ZERO                              
167900        GO TO ABNORMAL-EOJ-9999.                                          
168000 NORMAL-EOJ-9999.                                                         
168100     MOVE   PROGNAME-ITEM2 TO THE-PROGRAM-NAME.                           
168200       GOBACK.                                                            
168300 ABNORMAL-EOJ-9999.                                                       
168400     DISPLAY "ERROR ENCOUNTERED CALLING ""PROCINFO"" INTRINSIC"           
168500       GOBACK.                                                            
168600 END PROGRAM PROCNAME.                                                    
168700                                                                          
168800$PAGE "THIS PROGRAM ---> PROCNUM  "                                       
168900                                                                          
169000*                                                                         
169100*     |           |           |           |           |                   
169200*     |           |           |           |           |                   
169300*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
169400* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
169500*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
169600*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
169700*    \|/         \|/         \|/         \|/         \|/                  
169800*     Y           Y           Y           Y           Y                   
169900*                                                                         
170000$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
170100 IDENTIFICATION DIVISION.                                                 
170200 PROGRAM-ID.  PROCNUM.                                                    
170300 AUTHOR.  MICHAEL ANDERSON.                                               
170400 DATE-COMPILED.                                                           
170500 ENVIRONMENT DIVISION.                                                    
170600 CONFIGURATION SECTION.                                                   
170700 DATA DIVISION.                                                           
170800 WORKING-STORAGE SECTION.                                                 
170900 01  PROCNUM-ERROR1                PIC S9(04) COMP VALUE ZERO.            
171000 01  PROCNUM-ERROR2                PIC S9(04) COMP VALUE ZERO.            
171100 01  PROCNUM-PIN-NO                PIC S9(04) COMP VALUE ZERO.            
171200 01  PROCNUM-ITEMNO1               PIC S9(04) COMP VALUE 1.               
171300 01  DISP-N                        PIC ---9  VALUE ZERO.                  
171400 01  PROCNUM-ITEM1-AREA.                                                  
171500     05  PROCNUM-ITEM1            PIC XX VALUE %0.                        
171600     05  FILLER REDEFINES PROCNUM-ITEM1.                                  
171700         10  PROCNUM-PIN          PIC S9(4) COMP.                         
171800 LINKAGE SECTION.                                                         
171900 01  RETURN-PIN                     PIC S9(04) COMP.                      
172000******************************************************************        
172100 PROCEDURE DIVISION USING RETURN-PIN.                                     
172200 HSKPG-100.                                                               
172300     CALL INTRINSIC "PROCINFO"                                            
172400          USING PROCNUM-ERROR1 PROCNUM-ERROR2                             
172500                PROCNUM-PIN-NO PROCNUM-ITEMNO1 PROCNUM-ITEM1.             
172600     IF PROCNUM-ERROR1 IS NOT EQUAL TO ZERO                               
172700     OR PROCNUM-ERROR2 IS NOT EQUAL TO ZERO                               
172800        GO TO ABNORMAL-EOJ-9999.                                          
172900 NORMAL-EOJ-9999.                                                         
173000     MOVE PROCNUM-PIN TO RETURN-PIN.                                      
173100     GO TO END-OF-PROGRAM.                                                
173200 ABNORMAL-EOJ-9999.                                                       
173300     DISPLAY "ERROR ENCOUNTERED CALLING ""PROCINFO"" INTRINSIC"           
173400     MOVE PROCNUM-ERROR1 TO DISP-N.                                       
173500     MOVE ZERO TO RETURN-PIN.                                             
173600 END-OF-PROGRAM.                                                          
173700       GOBACK.                                                            
173800 END PROGRAM PROCNUM.                                                     
173900$PAGE "THIS PROGRAM ---> SONCOUNT "                                       
193200                                                                          
193300*                                                                         
193400*     |           |           |           |           |                   
193500*     |           |           |           |           |                   
193600*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
193700* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
193800*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
193900*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
194000*    \|/         \|/         \|/         \|/         \|/                  
194100*     Y           Y           Y           Y           Y                   
194200*                                                                         
194300$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
194400 IDENTIFICATION DIVISION.                                                 
194500 PROGRAM-ID.  SONCOUNT.                                                   
194600 AUTHOR.  MICHAEL ANDERSON.                                               
194700 DATE-COMPILED.                                                           
194800 ENVIRONMENT DIVISION.                                                    
194900 CONFIGURATION SECTION.                                                   
195000 DATA DIVISION.                                                           
195100 WORKING-STORAGE SECTION.                                                 
195200 01  SONCOUNT-ERROR1                PIC S9(04) COMP VALUE ZERO.           
195300 01  SONCOUNT-ERROR2                PIC S9(04) COMP VALUE ZERO.           
195400 01  SONCOUNT-PIN-NO                PIC S9(04) COMP VALUE ZERO.           
195500 01  SONCOUNT-ITEMNO3               PIC S9(04) COMP VALUE 3.              
195600 01  DISP-N                        PIC ---9  VALUE ZERO.                  
195700 01  SONCOUNT-ITEM3-AREA.                                                 
195800     05  SONCOUNT-ITEM3            PIC XX VALUE %0.                       
195900     05  FILLER REDEFINES SONCOUNT-ITEM3.                                 
196000         10  SONCOUNT-NBR          PIC S9(4) COMP.                        
196100 LINKAGE SECTION.                                                         
196200 01  RETURN-NBR                     PIC S9(04) COMP.                      
196300******************************************************************        
196400 PROCEDURE DIVISION USING RETURN-NBR.                                     
196500 HSKPG-100.                                                               
196600     CALL INTRINSIC "PROCINFO"                                            
196700          USING SONCOUNT-ERROR1 SONCOUNT-ERROR2                           
196800                SONCOUNT-PIN-NO SONCOUNT-ITEMNO3 SONCOUNT-ITEM3.          
196900     IF SONCOUNT-ERROR1 IS NOT EQUAL TO ZERO                              
197000     OR SONCOUNT-ERROR2 IS NOT EQUAL TO ZERO                              
197100        GO TO ABNORMAL-EOJ-9999.                                          
197200 NORMAL-EOJ-9999.                                                         
197300     MOVE SONCOUNT-NBR TO RETURN-NBR.                                     
197400     GO TO END-OF-PROGRAM.                                                
197500 ABNORMAL-EOJ-9999.                                                       
197600     DISPLAY "ERROR ENCOUNTERED CALLING ""PROCINFO"" INTRINSIC"           
197700     MOVE SONCOUNT-ERROR1 TO DISP-N.                                      
197800     MOVE ZERO TO RETURN-NBR.                                             
197900 END-OF-PROGRAM.                                                          
198000       GOBACK.                                                            
198100 END PROGRAM SONCOUNT.                                                    
198200                                                                          
198300$PAGE "THIS PROGRAM ---> TIMEOUT  "                                       
198400                                                                          
198500*                                                                         
198600*     |           |           |           |           |                   
198700*     |           |           |           |           |                   
198800*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
198900* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
199000*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
199100*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
199200*    \|/         \|/         \|/         \|/         \|/                  
199300*     Y           Y           Y           Y           Y                   
199400*                                                                         
199500$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
199600 IDENTIFICATION DIVISION.                                                 
199700 PROGRAM-ID.  TIMEOUT.                                                    
199800 AUTHOR.  MICHAEL ANDERSON.                                               
199900 ENVIRONMENT DIVISION.                                                    
200000 CONFIGURATION SECTION.                                                   
200100 SOURCE-COMPUTER. HP3000.                                                 
200200 OBJECT-COMPUTER.          HP-3000.                                       
200300 SPECIAL-NAMES.                                                           
200400         CONDITION-CODE IS COND-CODE.                                     
200500 INPUT-OUTPUT SECTION.                                                    
200600 DATA DIVISION.                                                           
200700 FILE SECTION.                                                            
200800/                                                                         
200900 WORKING-STORAGE SECTION.                                                 
201000 01 TIMEOUT-MINUTES               PIC 99 VALUE ZERO.                      
201100 01 SLDEV                         PIC 9(4) VALUE ZERO.                    
201200 01 CONNTYPE                      PIC X VALUE SPACE.                      
201300 01 RETURN-ERROR                  PIC S9(4) COMP VALUE 0.                 
201400 01 DS-DEVICES           PIC X(08)   VALUE "DEVICES;".                    
201500 01 LDEV-ARGUMENT        PIC 9(4)   VALUE ZERO.                           
201600 01 DEV-LIST             PIC X(8)   VALUE "TIMEOUT;".                     
201700 01 DB-DEVICES.                                                           
201800     03 TIMEOUT          PIC X(2).                                        
201900   COPY IMAGE   OF J3KLIB.                                                
202000   COPY AMSLINK OF J3KLIB.                                                
202100                                                                          
202200 01 RETURN-TIMEOUT  PIC S9(4) COMP .                                      
202300 PROCEDURE DIVISION USING                                                 
202400 COPY AMSITEMS OF J3KLIB.                                                 
202500      RETURN-TIMEOUT.                                                     
202600 TIMEOUT-MAIN-100.                                                        
202700*    PERFORM  LOAD-WHO-DATA-300.                                          
202800*    PERFORM  LOAD-TERMINAL-DATA-400.                                     
202900     MOVE 15 TO TIMEOUT-MINUTES.                                          
203000     MULTIPLY TIMEOUT-MINUTES BY 60 GIVING RETURN-TIMEOUT.                
203100     GOBACK.                                                              
203200*---------------------------------------------------------------          
203300*LOAD-WHO-DATA-300.                                                       
203400*    INITIALIZE SLDEV CONNTYPE RETURN-ERROR.                              
203500*    COPY AMSCALL OF J3KLIB                                               
203600*    REPLACING ==VALUE OF PROCEDURE== BY =="AMSSDEV"==.                   
203700*         SLDEV CONNTYPE RETURN-ERROR.                                    
203800*    IF RETURN-ERROR NOT = 0                                              
203900*     DISPLAY "ERROR CALLING AMSSDEV"                                     
204000*     IF RETURN-ERROR < 0                                                 
204100*      DISPLAY "IMAGE ERROR IS SUSPECTED"                                 
204200*     ELSE                                                                
204300*      DISPLAY "IP address may not be setup"                              
204400*     END-IF                                                              
204500*    ELSE                                                                 
204600*     MOVE SLDEV TO LDEV-ARGUMENT.                                        
204700*---------------------------------------------------------------          
204800*LOAD-TERMINAL-DATA-400.                                                  
204900*    COPY AMSCALL OF J3KLIB                                               
205000*    REPLACING ==VALUE OF PROCEDURE== BY =="ROPENSEC"==.                  
205100*    .                                                                    
205200*    IF IMAGE-ERRORS                                                      
205300*     CALL "DBEXPLAIN" USING STATUS-AREA                                  
205400*     MOVE ZERO TO TIMEOUT-MINUTES                                        
205500*    ELSE                                                                 
205600*     MOVE ROPENSEC TO SECDB                                              
205700*     CALL "DBGET" USING DATA-BASE-NAME(SECDB) DS-DEVICES KEYED           
205800*        STATUS-AREA DEV-LIST DB-DEVICES LDEV-ARGUMENT.                   
205900*    IF IMAGE-ERRORS                                                      
206000*     MOVE ZERO TO TIMEOUT-MINUTES                                        
206100*     CALL "DBEXPLAIN" USING STATUS-AREA.                                 
206200*    MOVE 0 TO TIMEOUT-MINUTES.                                           
206300 END PROGRAM TIMEOUT.                                                     
206400$PAGE "THIS PROGRAM ---> NUMGET   "                                       
206500                                                                          
206600*                                                                         
206700*     |           |           |           |           |                   
206800*     |           |           |           |           |                   
206900*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
207000* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
207100*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
207200*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
207300*    \|/         \|/         \|/         \|/         \|/                  
207400*     Y           Y           Y           Y           Y                   
207500*                                                                         
207600$TITLE "NUMGET - SUBROUTINE TO GET NUMBER FROM IMAGE BUFFER"              
207700$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
207800 IDENTIFICATION DIVISION.                                                 
207900 PROGRAM-ID. NUMGET.                                                      
208000 AUTHOR.     MICHAEL J ANDERSON.                                          
208100 DATE-COMPILED.                                                           
208200                                                                          
208300**************************************************************            
208400*                                                            *            
208500*  THIS SUBROUTINE CONVERTS THE NUMBERS AS ENTERED AT THE    *            
208600*  TERMINAL INTO NUMERIC, SIGNED NUMBERS THAT CAN BE USED    *            
208700*  IN THE PROGRAM.                                           *            
208800*                                                            *            
208900*  PARAMETERS:                                               *            
209000*                                                            *            
209100*  NUM-1     A 14 CHARACTER FIELD CONTAINING THE NUMBER AS   *            
209200*            THE OPERATOR TYPED IT.                          *            
209300*                                                            *            
209400*  NUM-2     THE 14 ASCII DIGIT SIGNED NUMERIC VALUE OF NUM-1*            
209500*            THAT IS RETURNED.                               *            
209600*                                                            *            
209700*  N-DEC     AN INTEGER WHICH RETURNS THE NUMBER OF DECIMAL  *            
209800*            PLACES FOUND IN THE NUMBER.                     *            
209900*                                                            *            
210000*  N-ERR     AN INTEGER WHICH RETURNS A 1 IF NUM-1 DID NOT   *            
210100*            CONTAIN VALID NUMERIC INFORMATION OR RETURNS 0  *            
210200*            IF A GOOD NUMBER WAS FOUND.                     *            
210300*                                                            *            
210400**************************************************************            
210500                                                                          
210600 ENVIRONMENT DIVISION.                                                    
210700                                                                          
210800 CONFIGURATION SECTION.                                                   
210900 SOURCE-COMPUTER. HP3000.                                                 
211000 OBJECT-COMPUTER. HP3000.                                                 
211100$PAGE                                                                     
211200 DATA DIVISION.                                                           
211300 WORKING-STORAGE SECTION.                                                 
211400                                                                          
211500 01  N                     PIC 9(4) COMP.                                 
211600 01  N1                    PIC 9(4) COMP.                                 
211700 01  N2                    PIC 9(4) COMP.                                 
211800 01  DECIMAL-SW            PIC X.                                         
211900 01  COMMA-SW              PIC X.                                         
212000 01  MINUS-SW              PIC X.                                         
212100                                                                          
212200 LINKAGE SECTION.                                                         
212300                                                                          
212400 01  NUM-1.                                                               
212500     02  X1                PIC X  OCCURS 14 TIMES.                        
212600                                                                          
212700 01  NUM-2.                                                               
212800     02  X2                PIC X  OCCURS 14 TIMES.                        
212900 01  FILLER REDEFINES NUM-2.                                              
213000     02  NUM-2N            PIC S9(14).                                    
213100                                                                          
213200 01  N-DEC                 PIC 9(4) COMP.                                 
213300 01  N-ERR                 PIC 9(4) COMP.                                 
213400$PAGE                                                                     
213500 PROCEDURE DIVISION USING NUM-1 NUM-2 N-DEC N-ERR.                        
213600                                                                          
213700 START-HERE.                                                              
213800     MOVE SPACES TO NUM-2.                                                
213900     MOVE ZERO TO N-DEC N-ERR.                                            
214000     MOVE 14 TO N.                                                        
214100                                                                          
214200 1ST-LOOP.                                                                
214300     IF N NOT = ZERO                                                      
214400         IF X1 (N) = SPACE                                                
214500             SUBTRACT 1 FROM N                                            
214600             GO TO 1ST-LOOP.                                              
214700     COMPUTE N1 = N + 1.                                                  
214800     MOVE 14 TO N2.                                                       
214900     MOVE "0" TO DECIMAL-SW COMMA-SW MINUS-SW.                            
215000                                                                          
215100 2ND-LOOP.                                                                
215200     SUBTRACT 1 FROM N1.                                                  
215300     IF N1 = ZERO GO TO FINISH-UP.                                        
215400     IF X1 (N1) = SPACE GO TO 2ND-LOOP.                                   
215500     IF X1 (N1) = "-"                                                     
215600         IF MINUS-SW = "1"                                                
215700             MOVE "1" TO N-ERR                                            
215800             GO TO 2ND-LOOP                                               
215900         ELSE                                                             
216000             MOVE "1" TO MINUS-SW                                         
216100             GO TO 2ND-LOOP.                                              
216200     IF X1 (N1) = ","                                                     
216300         MOVE "1" TO COMMA-SW                                             
216400         GO TO 2ND-LOOP.                                                  
216500     IF X1 (N1) = "."                                                     
216600         IF DECIMAL-SW = "1" OR COMMA-SW = "1"                            
216700             MOVE 1 TO N-ERR                                              
216800             GO TO 2ND-LOOP                                               
216900         ELSE                                                             
217000             MOVE "1" TO DECIMAL-SW                                       
217100             GO TO 2ND-LOOP.                                              
217200     IF X1 (N1) LESS THAN "0" OR GREATER THAN "9"                         
217300         MOVE 1 TO N-ERR                                                  
217400         GO TO 2ND-LOOP.                                                  
217500     MOVE X1 (N1) TO X2 (N2).                                             
217600     IF DECIMAL-SW NOT = "1" ADD 1 TO N-DEC.                              
217700     SUBTRACT 1 FROM N2.                                                  
217800     GO TO 2ND-LOOP.                                                      
217900                                                                          
218000 FINISH-UP.                                                               
218100     INSPECT NUM-2 REPLACING LEADING SPACES BY "0".                       
218200     IF MINUS-SW = "1" COMPUTE NUM-2N = - NUM-2N.                         
218300     IF DECIMAL-SW = "0" MOVE ZERO TO N-DEC.                              
218400     IF N-ERR NOT = ZERO MOVE ZERO TO NUM-2N N-DEC.                       
218500                                                                          
218600 ALL-DONE.                                                                
218700     EXIT PROGRAM.                                                        
218800 END PROGRAM NUMGET.                                                      
218900$PAGE  "J3KGETFD  - SUBROUTINE RETURNS FNUM FOR COBOLI FD"                
219000*                                                                         
219100*     ||           ||           ||           ||           ||              
219200*     ||           ||           ||           ||           ||              
219300*\\   ||   // \\   ||   // \\   ||   // \\   ||   // \\   ||   //         
219400* \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //          
219500*  \\ || //     \\ || //     \\ || //     \\ || //     \\ || //           
219600*   \\||//       \\||//       \\||//       \\||//       \\||//            
219700*    \  /         \  /         \  /         \  /         \  /             
219800*     \/           \/           \/           \/           \/              
219900*                                                                         
220000$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
220100 IDENTIFICATION DIVISION.                                                 
220200 PROGRAM-ID. J3KGETFD.                                                    
220300 AUTHOR.     MICHAEL ANDERSON.                                            
220400*  - AMS SYSTEMS ROUTINE -    RETURNS 'FD' FILE NUMBER       *            
220500 DATA DIVISION.                                                           
220600 WORKING-STORAGE SECTION.                                                 
220700 01  X                               PIC S9(9) COMP VALUE 0.              
220800 LINKAGE SECTION.                                                         
220900 01  FILENUM                         PIC S9(4) COMP.                      
221000 01  FDNAME                          PIC S9(4) COMP.                      
221100 PROCEDURE DIVISION USING FILENUM FDNAME.                                 
221200 0000-BEGIN.                                                              
221300     MOVE FDNAME TO FILENUM.                                              
221400     GOBACK.                                                              
221500 END PROGRAM J3KGETFD.                                                    
221600$PAGE  "GETPROC - RETREIVES/CREATES PROCESS ID NUMBERS"                   
221700*                                                                         
221800*     ||           ||           ||           ||           ||              
221900*     ||           ||           ||           ||           ||              
222000*\\   ||   // \\   ||   // \\   ||   // \\   ||   // \\   ||   //         
222100* \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //          
222200*  \\ || //     \\ || //     \\ || //     \\ || //     \\ || //           
222300*   \\||//       \\||//       \\||//       \\||//       \\||//            
222400*    \  /         \  /         \  /         \  /         \  /             
222500*     \/           \/           \/           \/           \/              
222600*                                                                         
222700$TITLE "GETPROC - PROCESS HANDELER"                                       
222800$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
222900 IDENTIFICATION DIVISION.                                                 
223000 PROGRAM-ID. GETPROC.                                                     
223100 AUTHOR.     MICHAEL ANDERSON.                                            
223200 DATE-COMPILED.                                                           
223300                                                                          
223400**************************************************************            
223500*                                                            *            
223600*  - PROCESS HANDELER -                                      *            
223700*                                                            *            
223800*  RETURNS SUSPENDED or NEWLY CREATED PIN's.                 *            
223900*                                                            *            
224000*    NOTE: This routine doesn't ACTIVATE a process.          *            
224100*                                                            *            
224200*    Pass this routine the following information:            *            
224300*     1) Program name.                                       *            
224400*        Must be a fully qualified MPE filename.grp.acct.    *            
224500*                                                            *            
224600*        If a Child process, with the same name as the one   *            
224700*        specified, is found in a suspended state, this      *            
224800*        suspened Process Id Number will be returned to the  *            
224900*        caller, A NEW PROCESS WILL NOT BE CREATED!          *            
225000*                                                            *            
225100*     2) LIB= {G, P, or S}.                                  *            
225200*        If not specified, "G" will be the default.          *            
225300*                                                            *            
225400*     3) NOCB {Y or N}.                                      *            
225500*        Y = Yes execute this process with the NOCB parm.    *            
225600*        N = No do not use the NOCB parm.                    *            
225700*        If not specified, Default is "N".                   *            
225800*                                                            *            
225900*     4) Priority {ES, DS, or CS}.                           *            
226000*        If not specified default is "CS".                   *            
226100*                                                            *            
226200*     5) $STDIN=.                                            *            
226300*        A maximum of 64 bytes, to include anything after    *            
226400*        the "=" in a file equation.                         *            
226500*        Default is the father's $STDIN.                     *            
226600*                                                            *            
226700*     6) $STDLIST=.                                          *            
226800*        A maximum of 64 bytes, to include anything after    *            
226900*        the "=" in a file equation.                         *            
227000*        Default is the father's $STDLIST.                   *            
227100*                                                            *            
227200*     7) INFO=.                                              *            
227300*        A maximum of 64 bytes. The process that is being    *            
227400*        created, must call the "GETINFO" intrinsic to access*            
227500*        this info string.                                   *            
227600*                                                            *            
227700*     8) Run parm value.                                     *            
227800*        Same as the "RUN ;PARM=" in the Run command.        *            
227900*                                                            *            
228000*    Returned will be the Process id number, and/or a message*            
228100*    of 80 bytes.                                            *            
228200*                                                            *            
228300**************************************************************            
228400                                                                          
228500 ENVIRONMENT DIVISION.                                                    
228600                                                                          
228700 CONFIGURATION SECTION.                                                   
228800 SOURCE-COMPUTER. HP3000.                                                 
228900 OBJECT-COMPUTER. HP3000.                                                 
229000 SPECIAL-NAMES.                                                           
229100     CONDITION-CODE IS CC.                                                
229200                                                                          
229300$PAGE "MAIN  - WORKING STORAGE SECTION"                                   
229400 DATA DIVISION.                                                           
229500*****************************************************************         
229600 WORKING-STORAGE SECTION.                                                 
229700*****************************************************************         
229800                                                                          
229900 01  X                     PIC S9(4) COMP.                                
230000 01  Y                     PIC S9(4) COMP.                                
230100 01  I                     PIC S9(4) COMP.                                
230200 01  DECIMAL-VALUE         PIC S9(4) COMP.                                
230300 01  BINARY-VALUE          PIC 9(16).                                     
230400 01  DISP-N                PIC ----9.                                     
230500 01  MPE-CMD               PIC X(64).                                     
230600 01  CR                    PIC X VALUE %15.                               
230700 01  CHRPTR                   PIC S9(4) COMP VALUE 0.                     
230800 01  PARENT-NAME           PIC X(36) VALUE SPACES.                        
230900 01  PARENT-PIN            PIC S9(4) COMP VALUE 0.                        
231000 01  E1                    PIC S9(4) COMP VALUE 0.                        
231100 01  E2                    PIC S9(4) COMP VALUE 0.                        
231200 01  PROCINFO-ARRAY.                                                      
231300     02 NBR-OF-CHILDREN    PIC S9(4) COMP.                                
231400     02 CHILD-PIN          PIC S9(4) COMP OCCURS 48.                      
231500 01  PROCINFO-NAME         PIC X(36) VALUE SPACES.                        
231600 01  PROCINFO-2WORDS.                                                     
231700     02 WORD1              PIC S9(4) COMP.                                
231800     02 WORD2              PIC S9(4) COMP.                                
231900 01  BINARY-VALUES.                                                       
232000     02 WORD2-PROCINFO9.                                                  
232100        05 MPE-RES1        PIC 9999.                                      
232200        05 SUBQUE          PIC 999.                                       
232300           88 ES-DS        VALUE 001.                                     
232400           88 CS           VALUE 010.                                     
232500           88 BS-AS        VALUE 100.                                     
232600        05 ACTIVATED-BY    PIC 99.                                        
232700           88 ACTBY-MPE    VALUE 00.                                      
232800           88 ACTBY-FATHER VALUE 01.                                      
232900           88 ACTBY-SON    VALUE 10.                                      
233000        05 MPE-RES2        PIC 9999.                                      
233100        05 TOBE-ACTIV-BY   PIC 99.                                        
233200           88 TOBE-ACTBY-F VALUE 01.                                      
233300           88 TOBE-ACTBY-S VALUE 10.                                      
233400        05 ACT-OR-SUSP     PIC 9.                                         
233500           88 ACTIVE-PROC  VALUE 1.                                       
233600           88 SUSP-PROC    VALUE 0.                                       
233700 01  TESTJCW               PIC X(8) VALUE "FLOWTEST".                     
233800 01  TESTJCW-VALUE         PIC S9(4) COMP VALUE 0.                        
233900     88  FLOWTEST          VALUE 1.                                       
234000                                                                          
234100 01  CHILD-PROC-DATA.                                                     
234200     02  CHILD-PROC-ERROR    PIC S9(9) COMP.                              
234300     02  CHILD-PROC-PIN      PIC S9(4) COMP.                              
234400     02  CHILD-PROC-NAME     PIC X(30) VALUE SPACES.                      
234500     02  CHILD-RUN-PARMS.                                                 
234600         03  PARMVAL-ITEM     PIC S9(9) COMP VALUE 2.                     
234700         03  LOADFLAG-ITEM    PIC S9(9) COMP VALUE 3.                     
234800         03  PRIORITY-ITEM    PIC S9(9) COMP VALUE 7.                     
234900         03  INFO-ADDR-ITEM   PIC S9(9) COMP VALUE 11.                    
235000         03  INFO-LEN-ITEM    PIC S9(9) COMP VALUE 12.                    
235100         03  STD-IO-ITEMS.                                                
235200             04  STD-IO-ITEM  PIC S9(9) COMP OCCURS 2 TIMES.              
235300         03  END-OP-ITEM      PIC S9(9) COMP VALUE 0.                     
235400     02  RUN-PARMS-TBL REDEFINES CHILD-RUN-PARMS.                         
235500         03 RPT-ITEMS OCCURS 8 TIMES.                                     
235600            04 RPT-ITEM PIC S9(9) COMP.                                   
235700     02  CHILD-RUN-PARMVALS.                                              
235800         03  CHILD-PARMVAL    PIC S9(9) COMP VALUE 0.                     
235900         03  CHILD-LOADFLAG   PIC S9(9) COMP VALUE 0.                     
236000         03  CHILD-PRIORITY   PIC S9(9) COMP VALUE 0.                     
236100         03  INFO-ADDR        PIC S9(9) COMP VALUE 0.                     
236200         03  INFO-LENGTH      PIC S9(9) COMP VALUE 0.                     
236300         03  STD-IO-ADDRES.                                               
236400             04 STD-IO-ADDR   PIC S9(9) COMP OCCURS 2 TIMES.              
236500     02  RUN-PARMVALS-TBL REDEFINES CHILD-RUN-PARMVALS.                   
236600         03 RPTV-ITEMS OCCURS 7 TIMES.                                    
236700            04 RPTV-ITEM PIC S9(9) COMP.                                  
236800                                                                          
236900 01  CHR-PRIORITY.                                                        
237000     02 ASCII-PRI   PIC XX VALUE SPACES.                                  
237100     02 BINARY-PRI  REDEFINES ASCII-PRI PIC S9(4) COMP.                   
237200 01  INFO-STRING           PIC X(64) VALUE SPACES.                        
237300 01  STD-IO-STRINGS.                                                      
237400     02 STD-IO-STRING      PIC X(64) OCCURS 2 TIMES.                      
237500                                                                          
237600 01  ACCOUNT-NAME          PIC X(8) VALUE SPACES.                         
237700 01  GROUP-NAME            PIC X(8) VALUE SPACES.                         
237800 01  USER-NAME             PIC X(8) VALUE SPACES.                         
237900                                                                          
238000 01  FLABELINFO-DATA.                                                     
238100     05  FLI-FNAME     PIC X(36).                                         
238200     05  FLI-MODE      PIC S9(4) COMP.                                    
238300     05  FLI-ERROR     PIC S9(4) COMP.                                    
238400     05  FLI-ITEMNUMLIST.                                                 
238500         10  FLI-ITEM9     PIC S9(4) COMP.                                
238600         10  FLI-ITEM0     PIC S9(4) COMP.                                
238700     05  FLI-ITEMLIST.                                                    
238800         10  FLI-FCODE     PIC S9(4) COMP.                                
238900         10  FLI-NULL0     PIC S9(4) COMP.                                
239000     05  FLI-ITEMERRORLIST.                                               
239100         10  FLI-ERROR9    PIC S9(4) COMP.                                
239200         10  FLI-IERROR0   PIC S9(4) COMP.                                
239300                                                                          
239400 LINKAGE SECTION.                                                         
239500$PAGE "LINKAGE SECTION"                                                   
239600                                                                          
239700     COPY GETPROC  OF J3KLIB.                                             
239800                                                                          
239900$PAGE "MAIN ENTRY POINT"                                                  
240000 PROCEDURE DIVISION USING GETPROC-LINKAGE.                                
240100*****************************************************************         
240200 0000-OPEN SECTION 00.                                                    
240300*****************************************************************         
240400                                                                          
240500 0000-BEGIN.                                                              
240600     CALL INTRINSIC "FINDJCW" USING TESTJCW TESTJCW-VALUE X.              
240700     CALL INTRINSIC "WHO" USING                                           
240800         \\ \\ \\ USER-NAME GROUP-NAME ACCOUNT-NAME.                      
240900*---------------------------------------------------------------          
241000 0001-LINKEDIT.                                                           
241100                                                                          
241200     INITIALIZE GETPROC-PIN GETPROC-MESSAGE.                              
241300D    DISPLAY "GETPROC BEGIN, LINKAGE EDIT:".                              
241400D    DISPLAY "GETPROC PROGRAM NAME [" GETPROC-NAME "]".                   
241500D    DISPLAY "GETPROC LIB          [" GETPROC-LIB  "]".                   
241600D    DISPLAY "GETPROC NOCB         [" GETPROC-NOCB "]".                   
241700D    DISPLAY "GETPROC PRIORITY     [" GETPROC-PRIORITY "]".               
241800D    DISPLAY "GETPROC STDIN        [" GETPROC-STDIN "]".                  
241900D    DISPLAY "GETPROC STDLIST      [" GETPROC-STDLIST "]".                
242000D    DISPLAY "GETPROC INFO         [" GETPROC-INFO "]".                   
242100D    MOVE GETPROC-PARMVAL TO DISP-N.                                      
242200D    DISPLAY "GETPROC PARM VALUE   [" DISP-N    "]".                      
242300                                                                          
242400     IF GETPROC-NAME = SPACES                                             
242500        MOVE "GETPROC ERROR, Program Name NOT Specified."                 
242600          TO GETPROC-MESSAGE                                              
242700        GO TO 9901-ERROR.                                                 
242800                                                                          
242900     MOVE SPACES TO MPE-CMD.                                              
243000     STRING "LISTF "        DELIMITED BY SIZE                             
243100            GETPROC-NAME    DELIMITED BY SPACE                            
243200            ";$NULL" %15    DELIMITED BY SIZE INTO MPE-CMD.               
243300     CALL INTRINSIC "COMMAND" USING MPE-CMD E1 E2.                        
243400     IF E1 NOT = 0                                                        
243500        MOVE SPACES TO GETPROC-MESSAGE                                    
243600        STRING "GETPROC ERROR, Prog: [" GETPROC-NAME                      
243700          "] not found." DELIMITED BY SIZE INTO GETPROC-MESSAGE           
243800        GO TO 9901-ERROR.                                                 
243900                                                                          
244000$PAGE "CHECK FOR SUSPENDED PROCESS"                                       
244100     INITIALIZE E1 E2 PROCINFO-ARRAY.                                     
244200     CALL "PROCNAME" USING PARENT-NAME.                                   
244300     CALL "PROCNUM" USING PARENT-PIN.                                     
244400     CALL "SONCOUNT" USING NBR-OF-CHILDREN.                               
244500                                                                          
244600     IF NBR-OF-CHILDREN > 0                                               
244700        ADD 1 TO NBR-OF-CHILDREN                                          
244800        CALL INTRINSIC "PROCINFO" USING E1 E2 PARENT-PIN \6\              
244900                       PROCINFO-ARRAY                                     
245000        SUBTRACT 1 FROM NBR-OF-CHILDREN                                   
245100        PERFORM VARYING X FROM 1 BY 1 UNTIL X > NBR-OF-CHILDREN           
245200          IF CHILD-PIN(X) NOT = 0                                         
245300             INITIALIZE PROCINFO-NAME                                     
245400             CALL INTRINSIC "PROCINFO" USING E1 E2 CHILD-PIN(X)           
245500                    \10\     PROCINFO-NAME                                
245600                    \9\      PROCINFO-2WORDS                              
245700             MOVE WORD2 OF PROCINFO-2WORDS TO DECIMAL-VALUE               
245800             MOVE ZERO TO BINARY-VALUE                                    
245900             CALL "GETBITS" USING DECIMAL-VALUE BINARY-VALUE              
246000             MOVE BINARY-VALUE TO WORD2-PROCINFO9                         
246100             IF ( SUSP-PROC ) AND                                         
246200                ( PROCINFO-NAME = GETPROC-NAME )                          
246300                MOVE CHILD-PIN(X) TO GETPROC-PIN                          
246400             END-IF                                                       
246500          END-IF                                                          
246600        END-PERFORM.                                                      
246700                                                                          
246800     IF GETPROC-PIN NOT = 0 GO TO 9902-END-PROGRAM.                       
246900                                                                          
247000$PAGE "CREATE CHILD PROCESS"                                              
247100                                                                          
247200 0003-CREATEPROCESS.                                                      
247300                                                                          
247400*------>> Set defaults, for call to CREATEPROCESS intrinsic.              
247500     INITIALIZE CHILD-PROC-ERROR CHILD-PROC-PIN.                          
247600     MOVE GETPROC-NAME TO CHILD-PROC-NAME.                                
247700     MOVE GETPROC-PARMVAL TO CHILD-PARMVAL.                               
247800     IF NOT VALID-LIB MOVE "G" TO GETPROC-LIB.                            
247900     IF GETPROC-NOCB NOT = "Y" AND "N" MOVE "N" TO GETPROC-NOCB.          
248000                                                                          
248100*------>> Setup RUN;LIB= parameter.                                       
248200                                                                          
248300*------>> Native Mode programs can and do point to one "XL". This         
248400*------   has been set at LINK time. CM programs depend on the            
248500*------   ";LIB=" parm at RUN time. Process must be started with          
248600*------   different LOAD OPTIONS depending on the child process           
248700*------   being a Native mode program or a CM program. The call           
248800*------   below to FLABELINFO will return the file code of the            
248900*------   child process to be created. 1029 is CM and 1030 is NM.         
249000                                                                          
249100     INITIALIZE FLABELINFO-DATA.                                          
249200     STRING GETPROC-NAME   DELIMITED BY SPACE "~"                         
249300       DELIMITED BY SIZE INTO FLI-FNAME.                                  
249400     MOVE 9 TO FLI-ITEM9.                                                 
249500     CALL INTRINSIC "FLABELINFO" USING FLI-FNAME FLI-ERROR                
249600       FLI-MODE FLI-ITEMNUMLIST FLI-ITEMLIST FLI-ITEMERRORLIST.           
249700                                                                          
249800*------>> LOAD OPTION ( bite [15:1] ) MUST BE SET TO 1.                   
249900*------>> The system will reactivate the calling process (parent)         
250000*------>> when the new process ( child ) terminates.                      
250100     MOVE 1 TO CHILD-LOADFLAG.                                            
250200                                                                          
250300     IF   FLI-FCODE = 1029                                                
250400        EVALUATE GETPROC-LIB                                              
250500         WHEN "G" ADD 32  TO CHILD-LOADFLAG                               
250600         WHEN "P" ADD 16  TO CHILD-LOADFLAG.                              
250700                                                                          
250800     IF   FLI-FCODE NOT = 1029 AND 1030                                   
250900        MOVE SPACES TO GETPROC-MESSAGE                                    
251000        STRING "GETPROC ERROR, Prog: [" GETPROC-NAME                      
251100         DELIMITED BY SPACE                                               
251200          "] not a valid program file."                                   
251300         DELIMITED BY SIZE INTO GETPROC-MESSAGE                           
251400        GO TO 9901-ERROR.                                                 
251500                                                                          
251600                                                                          
251700*------>> Caller specified NOCB=Y, so RUN;NOCB.                           
251800     IF GETPROC-NOCB = "Y" ADD 64 TO CHILD-LOADFLAG.                      
251900                                                                          
252000*------>> Process scheduling priority, "CS" is default.                   
252100     IF VALID-PRIORITY                                                    
252200        MOVE GETPROC-PRIORITY TO ASCII-PRI                                
252300     ELSE                                                                 
252400         MOVE "CS" TO ASCII-PRI.                                          
252500     MOVE BINARY-PRI TO CHILD-PRIORITY.                                   
252600                                                                          
252700*------>> Setup RUN;INFO="data" parameter.                                
252800     MOVE 0 TO INFO-LENGTH.                                               
252900     PERFORM VARYING X FROM 64 BY -1 UNTIL X < 2                          
253000       IF GETPROC-INFO(X:1) NOT = SPACE                                   
253100          MOVE X TO INFO-LENGTH                                           
253200          MOVE 1 TO X                                                     
253300       END-IF                                                             
253400     END-PERFORM.                                                         
253500                                                                          
253600     IF INFO-LENGTH > 0                                                   
253700        MOVE GETPROC-INFO TO INFO-STRING                                  
253800     ELSE                                                                 
253900        MOVE SPACES TO INFO-STRING.                                       
254000     CALL INTRINSIC ".LOC." USING @INFO-STRING GIVING INFO-ADDR.          
254100                                                                          
254200*------>> STD I/O, $STDIN $STDLIST, variably optional.                    
254300*         If both GETPROC-STDLIST and GETPROC-STDIN are empty,            
254400*         then both are omitted for the CREATEPROCESS call.               
254500*         The default is the callers STDIN or STDLIST.                    
254600*                                                                         
254700     MOVE 0 TO I.                                                         
254800     INITIALIZE I STD-IO-ITEMS STD-IO-ADDRES STD-IO-STRINGS.              
254900     IF GETPROC-STDLIST > SPACES                                          
255000        PERFORM VARYING CHRPTR FROM 64 BY -1                              
255100          UNTIL ( CHRPTR < 2 )                                            
255200             OR ( GETPROC-STDLIST(CHRPTR:1) NOT = SPACE )                 
255300         CONTINUE                                                         
255400        END-PERFORM                                                       
255500        ADD 1 TO CHRPTR                                                   
255600        MOVE %15 TO GETPROC-STDLIST(CHRPTR:1)                             
255700         ADD 1 TO I                                                       
255800        CALL INTRINSIC ".LOC." USING @STD-IO-STRING(I)                    
255900                              GIVING STD-IO-ADDR(I)                       
256000        MOVE 9 TO STD-IO-ITEM(I)                                          
256100        MOVE GETPROC-STDLIST TO STD-IO-STRING(I).                         
256200                                                                          
256300     IF GETPROC-STDIN   > SPACES                                          
256400        PERFORM VARYING CHRPTR FROM 64 BY -1                              
256500          UNTIL ( CHRPTR < 2 )                                            
256600             OR ( GETPROC-STDIN(CHRPTR:1) NOT = SPACE )                   
256700         CONTINUE                                                         
256800        END-PERFORM                                                       
256900        ADD 1 TO CHRPTR                                                   
257000        MOVE %15 TO GETPROC-STDIN(CHRPTR:1)                               
257100         ADD 1 TO I                                                       
257200        CALL INTRINSIC ".LOC." USING @STD-IO-STRING(I)                    
257300                              GIVING STD-IO-ADDR(I)                       
257400        MOVE 8 TO STD-IO-ITEM(I)                                          
257500        MOVE GETPROC-STDIN   TO STD-IO-STRING(I).                         
257600                                                                          
257700*------>> Call the CREATEPROCESS intrinsic.                               
257800D    DISPLAY "BEFORE CREATEPROCESS CALL".                                 
257900D    DISPLAY "-------------------------".                                 
258000D    PERFORM 8000-DEBUG.                                                  
258100     CALL INTRINSIC "CREATEPROCESS" USING CHILD-PROC-ERROR                
258200         CHILD-PROC-PIN CHILD-PROC-NAME CHILD-RUN-PARMS                   
258300         CHILD-RUN-PARMVALS.                                              
258400D    DISPLAY "AFTER  CREATEPROCESS CALL".                                 
258500D    DISPLAY "-------------------------".                                 
258600D    PERFORM 8000-DEBUG.                                                  
258700     IF CHILD-PROC-ERROR NOT = ZERO                                       
258800         MOVE CHILD-PROC-ERROR TO DISP-N                                  
258900         STRING "ERROR" DISP-N " STARTING CHILD PROCESS "                 
259000             DELIMITED BY SIZE                                            
259100             CHILD-PROC-NAME DELIMITED BY CR                              
259200                 INTO GETPROC-MESSAGE                                     
259300             GO TO 9901-ERROR.                                            
259400                                                                          
259500     MOVE CHILD-PROC-PIN TO GETPROC-PIN.                                  
259600     GO TO 9902-END-PROGRAM.                                              
259700                                                                          
259800*--------------------------------------------------------------           
259900 8000-DEBUG.                                                              
260000                                                                          
260100     DISPLAY "CreateProcess INTRINSIC PARMS DUMP ".                       
260200     DISPLAY "CHILD-PROC-ERROR [" CHILD-PROC-ERROR "]".                   
260300     DISPLAY "CHILD-PROC-PIN   [" CHILD-PROC-PIN "]".                     
260400     DISPLAY "CHILD-PROC-NAME  [" CHILD-PROC-NAME "]".                    
260500     DISPLAY " ".                                                         
260600     DISPLAY "ITEMNUMS           ITEMVALS".                               
260700     DISPLAY "---------        ---------".                                
260800     PERFORM VARYING X FROM 1 BY 1 UNTIL X > 7                            
260900      DISPLAY RPT-ITEM(X) "      " RPTV-ITEM(X)                           
261000     END-PERFORM.                                                         
261100     DISPLAY RPT-ITEM(8) "       Zero = End of item list".                
261200                                                                          
261300$PAGE "END PROGRAM"                                                       
261400 9901-ERROR.                                                              
261500                                                                          
261600     MOVE 0 TO GETPROC-PIN.                                               
261700     IF GETPROC-MESSAGE = SPACES                                          
261800        MOVE "GETPROC ERROR, Fall through in program logic."              
261900          TO GETPROC-MESSAGE.                                             
262000                                                                          
262100 9902-END-PROGRAM.                                                        
262200                                                                          
262300     GOBACK.                                                              
262400 END PROGRAM GETPROC.                                                     
262500$PAGE "THIS PROGRAM ---> JOBCHECK "                                       
262600                                                                          
262700*                                                                         
262800*     |           |           |           |           |                   
262900*     |           |           |           |           |                   
263000*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
263100* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
263200*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
263300*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
263400*    \|/         \|/         \|/         \|/         \|/                  
263500*     Y           Y           Y           Y           Y                   
263600*                                                                         
263700$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
263800 IDENTIFICATION DIVISION.                                                 
263900 PROGRAM-ID. JOBCHECK.                                                    
264000 AUTHOR.     MICHAEL ANDERSON.                                            
264100 DATE-COMPILED.                                                           
264200**************************************************************            
264300*  - Microfiche Control Maintenance SYSTEM -                 *            
264400*  CHECKS TO SEE IF A BATCH JOB IS STILL EXECUTING           *            
264500*  SCREENS: NONE                                             *            
264600*  PARAMETERS:     JOBNUM S9(4) COMP                         *            
264700*                  ERRNUM S9(4) COMP                         *            
264800**************************************************************            
264900 ENVIRONMENT DIVISION.                                                    
265000 CONFIGURATION SECTION.                                                   
265100 SOURCE-COMPUTER. HP3000.                                                 
265200 OBJECT-COMPUTER. HP3000.                                                 
265300 SPECIAL-NAMES.                                                           
265400     CONDITION-CODE IS CC.                                                
265500 DATA DIVISION.                                                           
265600 WORKING-STORAGE SECTION.                                                 
265700 01  NUM1                  PIC X(14)  VALUE SPACES.                       
265800 01  NUM2                  PIC S9(14) VALUE ZERO.                         
265900 01 JS-STATUS.                                                            
266000    02 JS-STAT1            PIC X.                                         
266100    02 JS-STAT2            PIC X.                                         
266200 01 JS-STATUS-N            REDEFINES JS-STATUS.                           
266300    02 JS-STAT             PIC S9(4) COMP.                                
266400 01 JSNAME                 PIC X(26) VALUE SPACES.                        
266500 01 JSNNNN                 PIC S9(9) COMP VALUE 0.                        
266600 01 ERROR-MESSAGE          PIC X(80) VALUE SPACES.                        
266700 01 E1                     PIC S9(4) COMP VALUE 0.                        
266800 01 E2                     PIC S9(4) COMP VALUE 0.                        
266900                                                                          
267000 LINKAGE SECTION.                                                         
267100 01 JOBNUM PIC S9(4) COMP.                                                
267200 01 ERRNUM PIC S9(4) COMP.                                                
267300                                                                          
267400 PROCEDURE DIVISION USING JOBNUM ERRNUM.                                  
267500                                                                          
267600 0000-BEGIN.                                                              
267700     MOVE ZERO TO NUM2 E1 E2 JSNNNN JS-STATUS-N.                          
267800     MOVE SPACES TO ERROR-MESSAGE NUM1.                                   
267900     MOVE JOBNUM TO JSNNNN.                                               
268000     MOVE SPACES TO JSNAME.                                               
268100     CALL INTRINSIC "JOBINFO" USING \2\ JSNNNN JS-STATUS                  
268200                                    \1\ JSNAME E1.                        
268300     MOVE JS-STATUS-N TO ERRNUM.                                          
268400 0000-END.                                                                
268500     GOBACK.                                                              
268600 END PROGRAM JOBCHECK.                                                    
268700$PAGE  "AMSMODE - SUBROUTINE RETURNS PREPROCESSED USER MODE"              
268800*                                                                         
268900*     ||           ||           ||           ||           ||              
269000*     ||           ||           ||           ||           ||              
269100*\\   ||   // \\   ||   // \\   ||   // \\   ||   // \\   ||   //         
269200* \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //          
269300*  \\ || //     \\ || //     \\ || //     \\ || //     \\ || //           
269400*   \\||//       \\||//       \\||//       \\||//       \\||//            
269500*    \  /         \  /         \  /         \  /         \  /             
269600*     \/           \/           \/           \/           \/              
269700*                                                                         
269800$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
269900 IDENTIFICATION DIVISION.                                                 
270000 PROGRAM-ID. AMSMODE.                                                     
270100 AUTHOR.     MICHAEL ANDERSON.                                            
270200*  - AMS SYSTEMS ROUTINE -    RETURNS PREPROCESSED USER MODE *            
270300 DATA DIVISION.                                                           
270400 WORKING-STORAGE SECTION.                                                 
270500                                                                          
270600 01 WHO-DATA.                                                             
270700    02 WHO-MODE            PIC S9(4) COMP VALUE 0.                        
270800                                                                          
270900 01 GETBITS-PARMS.                                                        
271000    05 DECIMAL-VALUE        PIC S9(4) COMP VALUE ZERO.                    
271100    05 BINARY-VALUE         PIC 9(16) VALUE ZERO.                         
271200 LINKAGE SECTION.                                                         
271300                                                                          
271400     COPY AMSMODE  OF J3KLIB.                                             
271500                                                                          
271600 PROCEDURE DIVISION USING AMSMODE.                                        
271700*---------------------------------------------------------------          
271800 0000-BEGIN.                                                              
271900     INITIALIZE AMSMODE.                                                  
272000     CALL INTRINSIC "WHO" USING WHO-MODE.                                 
272100     MOVE WHO-MODE TO DECIMAL-VALUE.                                      
272200     MOVE ALL "0" TO BINARY-VALUE.                                        
272300     CALL "GETBITS" USING DECIMAL-VALUE BINARY-VALUE.                     
272400     MOVE  BINARY-VALUE TO AMSMODE.                                       
272500     GOBACK.                                                              
272600 END PROGRAM AMSMODE.                                                     
272700$PAGE "THIS PROGRAM ---> AMSCSQ"                                          
272800$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
272900 IDENTIFICATION DIVISION.                                                 
273000 PROGRAM-ID. AMSCSQ.                                                      
273100 AUTHOR.     MICHAEL ANDERSON.                                            
273200 DATE-COMPILED.                                                           
273300**************************************************************            
273400*  - Program "AMSCSQ will change the sched-Q to "CS".       *             
273500**************************************************************            
273600 ENVIRONMENT DIVISION.                                                    
273700 CONFIGURATION SECTION.                                                   
273800 SOURCE-COMPUTER. HP3000.                                                 
273900 OBJECT-COMPUTER. HP3000.                                                 
274000 SPECIAL-NAMES.                                                           
274100     CONDITION-CODE IS CC.                                                
274200 DATA DIVISION.                                                           
274300 WORKING-STORAGE SECTION.                                                 
274400 01  NEW-QUE               PIC XX VALUE "CS".                             
274500 01  I   REDEFINES NEW-QUE PIC S9(4) COMP.                                
274600 PROCEDURE DIVISION.                                                      
274700 0000-BEGIN.                                                              
274800     CALL INTRINSIC "GETPRIORITY" USING \0\ I.                            
274900     GOBACK.                                                              
275000 END PROGRAM AMSCSQ.                                                      
275100$PAGE "THIS PROGRAM ---> AMSDSQ"                                          
275200$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
275300 IDENTIFICATION DIVISION.                                                 
275400 PROGRAM-ID. AMSDSQ.                                                      
275500 AUTHOR.     MICHAEL ANDERSON.                                            
275600 DATE-COMPILED.                                                           
275700**************************************************************            
275800*  - Program "AMSDSQ will change the sched-Q to "DS".       *             
275900**************************************************************            
276000 ENVIRONMENT DIVISION.                                                    
276100 CONFIGURATION SECTION.                                                   
276200 SOURCE-COMPUTER. HP3000.                                                 
276300 OBJECT-COMPUTER. HP3000.                                                 
276400 SPECIAL-NAMES.                                                           
276500     CONDITION-CODE IS CC.                                                
276600 DATA DIVISION.                                                           
276700 WORKING-STORAGE SECTION.                                                 
276800 01  NEW-QUE               PIC XX VALUE "DS".                             
276900 01  I   REDEFINES NEW-QUE PIC S9(4) COMP.                                
277000 PROCEDURE DIVISION.                                                      
277100 0000-BEGIN.                                                              
277200     CALL INTRINSIC "GETPRIORITY" USING \0\ I.                            
277300     GOBACK.                                                              
277400 END PROGRAM AMSDSQ.                                                      
277500$PAGE "THIS PROGRAM ---> AMSESQ"                                          
277600$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
277700 IDENTIFICATION DIVISION.                                                 
277800 PROGRAM-ID. AMSESQ.                                                      
277900 AUTHOR.     MICHAEL ANDERSON.                                            
278000 DATE-COMPILED.                                                           
278100**************************************************************            
278200*  - Program "AMSESQ will change the sched-Q to "ES".       *             
278300**************************************************************            
278400 ENVIRONMENT DIVISION.                                                    
278500 CONFIGURATION SECTION.                                                   
278600 SOURCE-COMPUTER. HP3000.                                                 
278700 OBJECT-COMPUTER. HP3000.                                                 
278800 SPECIAL-NAMES.                                                           
278900     CONDITION-CODE IS CC.                                                
279000 DATA DIVISION.                                                           
279100 WORKING-STORAGE SECTION.                                                 
279200 01  NEW-QUE               PIC XX VALUE "ES".                             
279300 01  I   REDEFINES NEW-QUE PIC S9(4) COMP.                                
279400 PROCEDURE DIVISION.                                                      
279500 0000-BEGIN.                                                              
279600     CALL INTRINSIC "GETPRIORITY" USING \0\ I.                            
279700     GOBACK.                                                              
279800 END PROGRAM AMSESQ.                                                      
279900$PAGE "THIS PROGRAM ---> AMSINITQ"                                        
280000$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
280100 IDENTIFICATION DIVISION.                                                 
280200 PROGRAM-ID. AMSINITQ.                                                    
280300 AUTHOR.     MICHAEL ANDERSON.                                            
280400 DATE-COMPILED.                                                           
280500**************************************************************            
280600*  - Program "AMSINITQ" Returns the initial Que of a process *            
280700**************************************************************            
280800 ENVIRONMENT DIVISION.                                                    
280900 CONFIGURATION SECTION.                                                   
281000 SOURCE-COMPUTER. HP3000.                                                 
281100 OBJECT-COMPUTER. HP3000.                                                 
281200 SPECIAL-NAMES.                                                           
281300     CONDITION-CODE IS CC.                                                
281400 DATA DIVISION.                                                           
281500 WORKING-STORAGE SECTION.                                                 
281600 01  I                     PIC S9(4) COMP VALUE 1000.                     
281700 01  N                     PIC S9(4) COMP VALUE 0.                        
281800 01  X                     PIC S9(4) COMP VALUE 0.                        
281900                                                                          
282000 01  ITEM-8                PIC XX.                                        
282100 01  PRI-NUMBER REDEFINES ITEM-8  PIC S9(4) COMP.                         
282200 01  DISP-N9               PIC --------9.                                 
282300 01  BITMAP                PIC X(16).                                     
282400 01  PROCESSINFO           PIC S9(9) COMP VALUE 0.                        
282500 01  TWO-WORDS REDEFINES PROCESSINFO.                                     
282600     02  PROCESSINFO-1   PIC S9(4) COMP.                                  
282700     02  PROCESSINFO-2   PIC S9(4) COMP.                                  
282800 LINKAGE SECTION.                                                         
282900 01 SUBQUE-VALUE           PIC S9(4) COMP.                                
283000 01 INITIAL-QUE REDEFINES SUBQUE-VALUE PIC XX.                            
283100 PROCEDURE DIVISION USING SUBQUE-VALUE.                                   
283200 0000-BEGIN.                                                              
283300     INITIALIZE N X PRI-NUMBER BITMAP DISP-N9.                            
283400     CALL INTRINSIC "PROCINFO" USING N X \0\ \8\ ITEM-8.                  
283500     MOVE PRI-NUMBER TO DISP-N9.                                          
283600D    DISPLAY "Numeric value of process priority:" DISP-N9.                
283700*---------------------------------------------------------------          
283800*                                                                         
283900     CALL INTRINSIC "GETPROCINFO" USING \0\ GIVING PROCESSINFO.           
284000     MOVE PROCESSINFO-1 TO DISP-N9.                                       
284100D    DISPLAY "WORD 1 VALUE: " DISP-N9.                                    
284200     CALL "GETBITS" USING PROCESSINFO-1 BITMAP.                           
284300D    DISPLAY "WORD 1 BITMAP= [" BITMAP "]".                               
284400     MOVE PROCESSINFO-2 TO DISP-N9.                                       
284500D    DISPLAY "WORD 2 VALUE: " DISP-N9.                                    
284600     CALL "GETBITS" USING PROCESSINFO-2 BITMAP.                           
284700D    DISPLAY "WORD 2 BITMAP= [" BITMAP "]".                               
284800     MOVE "CS" TO INITIAL-QUE.                                            
284900     IF BITMAP(5:3) = "010"                                               
285000        MOVE "CS" TO INITIAL-QUE                                          
285100     ELSE IF PROCESSINFO-1 > 230                                          
285200             MOVE "ES" TO INITIAL-QUE                                     
285300          ELSE                                                            
285400             MOVE "DS" TO INITIAL-QUE.                                    
285500     GOBACK.                                                              
285600 END PROGRAM AMSINITQ.                                                    
285700$PAGE "THIS PROGRAM ---> STOPSONS "                                       
285800                                                                          
285900*                                                                         
286000*     |           |           |           |           |                   
286100*     |           |           |           |           |                   
286200*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
286300* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
286400*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
286500*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
286600*    \|/         \|/         \|/         \|/         \|/                  
286700*     Y           Y           Y           Y           Y                   
286800*                                                                         
286900$TITLE "STOPSON - PROCESS HANDELER"                                       
287000$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
287100 IDENTIFICATION DIVISION.                                                 
287200 PROGRAM-ID. STOPSON.                                                     
287300 AUTHOR.     MICHAEL ANDERSON.                                            
287400 DATE-COMPILED.                                                           
287500                                                                          
287600**************************************************************            
287700*                                                            *            
287800*  - PROCESS HANDELER -                                      *            
287900*                                                            *            
288000*     Kills son processes if they are in a suspended state.  *            
288100*     IF processes exist, that are in an ACTIVE state, then  *            
288200*     this routine will display a message wait 30 seconds    *            
288300*     and try again.                                         *            
288400*                                                            *            
288500* NOTE: this program depends on a file equation, that is     *            
288600*       set by "APPSEC". So, a previous call to APPSEC is    *            
288700*       a required. The original design was that this would  *            
288800*       be call by "TERMINATE" of DRIVSUBS.                  *            
288900*                                                            *            
289000**************************************************************            
289100                                                                          
289200 ENVIRONMENT DIVISION.                                                    
289300                                                                          
289400 CONFIGURATION SECTION.                                                   
289500 OBJECT-COMPUTER. HP3000.                                                 
289600 SPECIAL-NAMES.                                                           
289700     CONDITION-CODE IS CC.                                                
289800 INPUT-OUTPUT SECTION.                                                    
289900 FILE-CONTROL.                                                            
290000     SELECT FSCREEN    ASSIGN TO "FSCREEN".                               
290100                                                                          
290200 DATA DIVISION.                                                           
290300*****************************************************************         
290400 FILE SECTION.                                                            
290500*****************************************************************         
290600                                                                          
290700 FD  FSCREEN.                                                             
290800 01  SCREEN-LINE       PIC X(80).                                         
290900                                                                          
291000 WORKING-STORAGE SECTION.                                                 
291100*****************************************************************         
291200                                                                          
291300     COPY SWITCHES OF J3KLIB.                                             
291400 01  N                     PIC S9(4) COMP.                                
291500 01  ANSWER                PIC X.                                         
291600 01  HALF-MINUTE           PIC S9(4) COMP VALUE 3000.                     
291700 01  X80                   PIC X(80) VALUE SPACES.                        
291800 01  CLEAR-SCREEN.                                                        
291900     02  FILLER            PIC X    VALUE %33.                            
292000     02  FILLER            PIC X    VALUE "X".                            
292100     02  FILLER            PIC X    VALUE %33.                            
292200     02  FILLER            PIC X    VALUE "h".                            
292300     02  FILLER            PIC X    VALUE %33.                            
292400     02  FILLER            PIC X    VALUE "J".                            
292500     02  FILLER            PIC X    VALUE %33.                            
292600     02  FILLER            PIC X(3) VALUE "&j@".                          
292700     02  FILLER            PIC X    VALUE %15.                            
292800     02  FILLER            PIC X    VALUE %12.                            
292900     02  FILLER            PIC X    VALUE %33.                            
293000     02  FILLER            PIC X    VALUE "h".                            
293100                                                                          
293200*****************************************************************         
293300 01  X                     PIC S9(4) COMP.                                
293400 01  Y                     PIC S9(4) COMP.                                
293500 01  I                     PIC S9(4) COMP.                                
293600 01  DECIMAL-VALUE         PIC S9(4) COMP.                                
293700 01  BINARY-VALUE          PIC 9(16).                                     
293800 01  DISP-N                PIC ----9.                                     
293900 01  MPE-CMD               PIC X(64).                                     
294000 01  CR                    PIC X VALUE %15.                               
294100 01  CHRPTR                   PIC S9(4) COMP VALUE 0.                     
294200 01  PARENT-NAME           PIC X(36) VALUE SPACES.                        
294300 01  PARENT-PIN            PIC S9(4) COMP VALUE 0.                        
294400 01  E1                    PIC S9(4) COMP VALUE 0.                        
294500 01  E2                    PIC S9(4) COMP VALUE 0.                        
294600 01  PROCINFO-ARRAY.                                                      
294700     02 NBR-OF-CHILDREN    PIC S9(4) COMP.                                
294800     02 CHILD-PIN          PIC S9(4) COMP OCCURS 48.                      
294900 01  PROCINFO-NAME         PIC X(36) VALUE SPACES.                        
295000 01  PROCINFO-2WORDS.                                                     
295100     02 WORD1              PIC S9(4) COMP.                                
295200     02 WORD2              PIC S9(4) COMP.                                
295300 01  BINARY-VALUES.                                                       
295400     02 WORD2-PROCINFO9.                                                  
295500        05 MPE-RES1        PIC 9999.                                      
295600        05 SUBQUE          PIC 999.                                       
295700           88 ES-DS        VALUE 001.                                     
295800           88 CS           VALUE 010.                                     
295900           88 BS-AS        VALUE 100.                                     
296000        05 ACTIVATED-BY    PIC 99.                                        
296100           88 ACTBY-MPE    VALUE 00.                                      
296200           88 ACTBY-FATHER VALUE 01.                                      
296300           88 ACTBY-SON    VALUE 10.                                      
296400        05 MPE-RES2        PIC 9999.                                      
296500        05 TOBE-ACTIV-BY   PIC 99.                                        
296600           88 TOBE-ACTBY-F VALUE 01.                                      
296700           88 TOBE-ACTBY-S VALUE 10.                                      
296800        05 ACT-OR-SUSP     PIC 9.                                         
296900           88 ACTIVE-PROC  VALUE 1.                                       
297000           88 SUSP-PROC    VALUE 0.                                       
297100*---------------------------------------------------------------          
297200 PROCEDURE DIVISION.                                                      
297300 0000-START.                                                              
297400     PERFORM OPEN-SCREEN.                                                 
297500     MOVE 99 TO NBR-OF-CHILDREN.                                          
297600     PERFORM UNTIL NBR-OF-CHILDREN = 0                                    
297700      PERFORM KILL-SUSPENDED-SONS                                         
297800      IF NBR-OF-CHILDREN > 0                                              
297900         PERFORM WAIT-DISPLAY                                             
298000      END-IF                                                              
298100     END-PERFORM.                                                         
298200     GO TO STOPSON-END.                                                   
298300$PAGE "SUB-ROUTINES"                                                      
298400*---------------------------------------------------------------          
298500 KILL-SUSPENDED-SONS.                                                     
298600     INITIALIZE E1 E2 PROCINFO-ARRAY.                                     
298700     CALL "PROCNAME" USING PARENT-NAME.                                   
298800     CALL "PROCNUM" USING PARENT-PIN.                                     
298900     CALL "SONCOUNT" USING NBR-OF-CHILDREN.                               
299000     IF NBR-OF-CHILDREN > 0                                               
299100        ADD 1 TO NBR-OF-CHILDREN                                          
299200        CALL INTRINSIC "PROCINFO" USING E1 E2 PARENT-PIN \6\              
299300                       PROCINFO-ARRAY                                     
299400        SUBTRACT 1 FROM NBR-OF-CHILDREN                                   
299500        PERFORM VARYING X FROM 1 BY 1 UNTIL X > NBR-OF-CHILDREN           
299600          IF CHILD-PIN(X) NOT = 0                                         
299700             INITIALIZE PROCINFO-NAME                                     
299800             CALL INTRINSIC "PROCINFO" USING E1 E2 CHILD-PIN(X)           
299900                    \10\     PROCINFO-NAME                                
300000                    \9\      PROCINFO-2WORDS                              
300100             MOVE WORD2 OF PROCINFO-2WORDS TO DECIMAL-VALUE               
300200             MOVE ZERO TO BINARY-VALUE                                    
300300             CALL "GETBITS" USING DECIMAL-VALUE BINARY-VALUE              
300400             MOVE BINARY-VALUE TO WORD2-PROCINFO9                         
300500             IF SUSP-PROC                                                 
300600                CALL INTRINSIC "KILL" USING CHILD-PIN(X)                  
300700             END-IF                                                       
300800          END-IF                                                          
300900        END-PERFORM.                                                      
301000     CALL "SONCOUNT" USING NBR-OF-CHILDREN.                               
301100*---------------------------------------------------------------          
301200 WAIT-DISPLAY.                                                            
301300     INITIALIZE E1 E2 PROCINFO-ARRAY.                                     
301400     CALL "PROCNAME" USING PARENT-NAME.                                   
301500     CALL "PROCNUM" USING PARENT-PIN.                                     
301600     CALL "SONCOUNT" USING NBR-OF-CHILDREN.                               
301700     IF NBR-OF-CHILDREN > 0                                               
301800        PERFORM WAIT-HEADING                                              
301900        ADD 1 TO NBR-OF-CHILDREN                                          
302000        CALL INTRINSIC "PROCINFO" USING E1 E2 PARENT-PIN \6\              
302100                       PROCINFO-ARRAY                                     
302200        SUBTRACT 1 FROM NBR-OF-CHILDREN                                   
302300        PERFORM VARYING X FROM 1 BY 1 UNTIL X > NBR-OF-CHILDREN           
302400          IF CHILD-PIN(X) NOT = 0                                         
302500             INITIALIZE PROCINFO-NAME                                     
302600             CALL INTRINSIC "PROCINFO" USING E1 E2 CHILD-PIN(X)           
302700                    \10\     PROCINFO-NAME                                
302800                    \9\      PROCINFO-2WORDS                              
302900             MOVE WORD2 OF PROCINFO-2WORDS TO DECIMAL-VALUE               
303000             MOVE ZERO TO BINARY-VALUE                                    
303100             CALL "GETBITS" USING DECIMAL-VALUE BINARY-VALUE              
303200             MOVE BINARY-VALUE TO WORD2-PROCINFO9                         
303300             PERFORM WAIT-DETAIL                                          
303400          END-IF                                                          
303500        END-PERFORM.                                                      
303600     CALL "CPAUSE" USING HALF-MINUTE.                                     
303700*---------------------------------------------------------------          
303800 OPEN-SCREEN.                                                             
303900     MOVE SPACES TO X80.                                                  
304000     STRING "FILE FSCREEN=*SCREENX" %15                                   
304100     DELIMITED BY SIZE INTO X80.                                          
304200     CALL INTRINSIC "COMMAND" USING X80 N I.                              
304300     OPEN OUTPUT FSCREEN.                                                 
304400*---------------------------------------------------------------          
304500 CLEAR-THE-SCREEN.                                                        
304600     INITIALIZE SCREEN-LINE.                                              
304700     MOVE CLEAR-SCREEN TO SCREEN-LINE(2:).                                
304800     WRITE SCREEN-LINE.                                                   
304900*---------------------------------------------------------------          
305000 WAIT-HEADING.                                                            
305100     PERFORM CLEAR-THE-SCREEN.                                            
305200     INITIALIZE X80.                                                      
305300     STRING PARENT-NAME " is waiting for the following programs "         
305400                        "to finish running."                              
305500      DELIMITED BY SIZE INTO X80.                                         
305600     MOVE X80 TO SCREEN-LINE(2:).                                         
305700     WRITE SCREEN-LINE.                                                   
305800     INITIALIZE SCREEN-LINE X80.                                          
305900     WRITE SCREEN-LINE.                                                   
306000     WRITE SCREEN-LINE.                                                   
306100     MOVE " Program Name" TO X80.                                         
306200     MOVE "State" TO X80(39:).                                            
306300     MOVE X80 TO SCREEN-LINE.                                             
306400     WRITE SCREEN-LINE.                                                   
306500     INITIALIZE X80 SCREEN-LINE.                                          
306600     MOVE ALL "-" TO X80(2:36)                                            
306700                     X80(39:8).                                           
306800     MOVE X80 TO SCREEN-LINE.                                             
306900     WRITE SCREEN-LINE.                                                   
307000     INITIALIZE X80 SCREEN-LINE.                                          
307100*---------------------------------------------------------------          
307200 WAIT-DETAIL.                                                             
307300     INITIALIZE X80 SCREEN-LINE.                                          
307400     MOVE PROCINFO-NAME TO X80(2:).                                       
307500     MOVE  "Running" TO X80(39:).                                         
307600     MOVE X80 TO SCREEN-LINE.                                             
307700     WRITE SCREEN-LINE.                                                   
307800                                                                          
307900 STOPSON-END.                                                             
308000     CLOSE FSCREEN.                                                       
308100     GOBACK.                                                              
308200 END PROGRAM STOPSON.                                                     
308300$PAGE "THIS PROGRAM ---> TIMENUM  "                                       
308400                                                                          
308500*                                                                         
308600*     |           |           |           |           |                   
308700*     |           |           |           |           |                   
308800*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
308900* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
309000*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
309100*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
309200*    \|/         \|/         \|/         \|/         \|/                  
309300*     Y           Y           Y           Y           Y                   
309400*                                                                         
309500$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
309600*================================================================*        
309700 IDENTIFICATION DIVISION.                                                 
309800*================================================================*        
309900                                                                          
310000 PROGRAM-ID. TIMENUM.                                                     
310100 AUTHOR.     MICHAEL J ANDERSON.                                          
310200                                                                          
310300******************************************************************        
310400*                                                                *        
310500*  Converts a date and time in the form YYYYMMDDHHMMSS to a      *        
310600*  nine digit number representing the number of minutes since    *        
310700*  midnight, December 31, 1899.  One minute after midnight,      *        
310800*  January 1, 1900 (19000101000100) returns 000000001, five      *        
310900*  minutes after midnight, January 1, 1900 returns 000000005,    *        
311000*  etc.  The subroutine NUMTIME converts the nine digit number   *        
311100*  back to YYYYMMDDHHMMSS.                                       *        
311200*                                                                *        
311300******************************************************************        
311400                                                                          
311500*================================================================*        
311600 ENVIRONMENT DIVISION.                                                    
311700                                                                          
311800 DATA DIVISION.                                                           
311900  WORKING-STORAGE SECTION.                                                
312000                                                                          
312100 01  I                     PIC S9(4) COMP.                                
312200 01  N                     PIC S9(4) COMP.                                
312300                                                                          
312400 01  DAYS-IN-MO-TABLE.                                                    
312500     02  FILLER        PIC X(24) VALUE "312831303130313130313031".        
312600 01  FILLER REDEFINES DAYS-IN-MO-TABLE.                                   
312700     02  DAYS-IN-MO        PIC 99 OCCURS 12.                              
312800                                                                          
312900 01  MIN-IN-MO-TABLE.                                                     
313000     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
313100     02  FILLER            PIC S9(9) COMP VALUE 40320.                    
313200     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
313300     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
313400     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
313500     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
313600     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
313700     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
313800     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
313900     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
314000     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
314100     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
314200 01  FILLER REDEFINES MIN-IN-MO-TABLE.                                    
314300     02  MIN-IN-MO         PIC S9(9) COMP OCCURS 12.                      
314400                                                                          
314500 LINKAGE SECTION.                                                         
314600                                                                          
314700 01  DATE-TIME.                                                           
314800     02  YR                PIC 9(4).                                      
314900     02  MO                PIC 99.                                        
315000     02  DA                PIC 99.                                        
315100     02  HR                PIC 99.                                        
315200     02  MIN               PIC 99.                                        
315300     02  SEC               PIC 99.                                        
315400                                                                          
315500 01  TIME-NUM              PIC S9(9) COMP.                                
315600                                                                          
315700 01  N-ERR                 PIC S9(4) COMP.                                
315800                                                                          
315900*================================================================*        
316000 PROCEDURE DIVISION USING DATE-TIME TIME-NUM N-ERR.                       
316100*================================================================*        
316200                                                                          
316300 0000-BEGIN.                                                              
316400     MOVE ZERO TO TIME-NUM N-ERR.                                         
316500     IF function mod (YR,4) = 0                                           
316600         MOVE 29 TO DAYS-IN-MO (2)                                        
316700         MOVE 41760 TO MIN-IN-MO (2)                                      
316800      else,                                                               
316900         move 28 to days-in-mo (2)                                        
317000         move 40320 to min-in-mo (2).                                     
317100                                                                          
317200*----- Check date & time -----*                                           
317300                                                                          
317400*    See if numeric                                                       
317500                                                                          
317600     IF DATE-TIME NOT NUMERIC                                             
317700         MOVE -1 TO N-ERR                                                 
317800         GO TO 9999-RETURN.                                               
317900                                                                          
318000*    See if valid date                                                    
318100                                                                          
318200     IF YR LESS THAN 1900                                                 
318300         MOVE -2 TO N-ERR                                                 
318400         GO TO 9999-RETURN.                                               
318500     IF MO LESS THAN 1 OR GREATER THAN 12                                 
318600         MOVE -3 TO N-ERR                                                 
318700         GO TO 9999-RETURN.                                               
318800     IF DA LESS THAN 1 OR GREATER THAN DAYS-IN-MO (MO)                    
318900         MOVE -4 TO N-ERR                                                 
319000         GO TO 9999-RETURN.                                               
319100                                                                          
319200*    See if valid time                                                    
319300                                                                          
319400     IF HR LESS THAN 0 OR GREATER THAN 24                                 
319500         MOVE -5 TO N-ERR                                                 
319600         GO TO 9999-RETURN.                                               
319700     IF MIN LESS THAN 0 OR GREATER THAN 59                                
319800         MOVE -6 TO N-ERR                                                 
319900         GO TO 9999-RETURN.                                               
320000     IF SEC LESS THAN 0 OR GREATER THAN 59                                
320100         MOVE -7 TO N-ERR                                                 
320200         GO TO 9999-RETURN.                                               
320300     IF HR = 24 AND (MIN NOT = 00 OR SEC NOT = 00)                        
320400         MOVE -8 TO N-ERR                                                 
320500         GO TO 9999-RETURN.                                               
320600     IF HR = 00 AND MIN = 00 AND SEC = 00                                 
320700         MOVE -9 TO N-ERR                                                 
320800         GO TO 9999-RETURN.                                               
320900                                                                          
321000*----- Convert date/time to a number -----*                               
321100                                                                          
321200*    Add year's minutes to number                                         
321300                                                                          
321400     COMPUTE I = function integer ((YR - 1900) / 4) * 4                   
321500     COMPUTE TIME-NUM = I * 525960.                                       
321600     PERFORM VARYING N FROM I BY 1 UNTIL N = (YR - 1900)                  
321700         IF function mod (N,4) = zero                                     
321800             ADD 527040 TO TIME-NUM                                       
321900         ELSE                                                             
322000             ADD 525600 TO TIME-NUM                                       
322100         END-IF                                                           
322200     END-PERFORM.                                                         
322300                                                                          
322400*    Add month's minutes to number                                        
322500                                                                          
322600     PERFORM VARYING I FROM 1 BY 1 UNTIL I = MO                           
322700         COMPUTE TIME-NUM = TIME-NUM + MIN-IN-MO (I)                      
322800     END-PERFORM.                                                         
322900                                                                          
323000*    Add day's minutes to number                                          
323100                                                                          
323200     COMPUTE TIME-NUM = TIME-NUM + ((DA - 1) * 1440).                     
323300                                                                          
323400*    Add hours' minutes to number                                         
323500                                                                          
323600     COMPUTE TIME-NUM = TIME-NUM + (HR * 60).                             
323700                                                                          
323800*    Add minutes to number                                                
323900                                                                          
324000     COMPUTE TIME-NUM = TIME-NUM + MIN.                                   
324100                                                                          
324200*----- All done - return -----*                                           
324300                                                                          
324400 9999-RETURN.                                                             
324500     GOBACK.                                                              
324600 END PROGRAM TIMENUM.                                                     
324700$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
324800*================================================================*        
324900 IDENTIFICATION DIVISION.                                                 
325000                                                                          
325100 PROGRAM-ID. NUMTIME.                                                     
325200 AUTHOR.     MICHAEL J ANDERSON.                                          
325300                                                                          
325400******************************************************************        
325500*                                                                *        
325600*  Converts a nine digit number that represents the number of    *        
325700*  minutes since midnight, December 31, 1899 to a date and time  *        
325800*  in the form YYYYMMDDHHMMSS.  The number 000000001 returns     *        
325900*  19000101000100 (one minute after midnight, January 1, 1900.   *        
326000*  The number 000000005 returns five minutes after midnight,     *        
326100*  January 1, 1900.  The subroutine TIMENUM converts a date and  *        
326200*  time (YYYYMMDDHHMMSS) to this nine digit number.              *        
326300*                                                                *        
326400******************************************************************        
326500                                                                          
326600*================================================================*        
326700 ENVIRONMENT DIVISION.                                                    
326800                                                                          
326900 DATA DIVISION.                                                           
327000                                                                          
327100  WORKING-STORAGE SECTION.                                                
327200                                                                          
327300 01  I                     PIC S9(4) COMP.                                
327400 01  N                     PIC S9(4) COMP.                                
327500                                                                          
327600 01  TIME-NUM              PIC S9(9) COMP.                                
327700                                                                          
327800 01  MIN-IN-MO-TABLE.                                                     
327900     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
328000     02  FILLER            PIC S9(9) COMP VALUE 40320.                    
328100     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
328200     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
328300     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
328400     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
328500     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
328600     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
328700     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
328800     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
328900     02  FILLER            PIC S9(9) COMP VALUE 43200.                    
329000     02  FILLER            PIC S9(9) COMP VALUE 44640.                    
329100 01  FILLER REDEFINES MIN-IN-MO-TABLE.                                    
329200     02  MIN-IN-MO         PIC S9(9) COMP OCCURS 12.                      
329300                                                                          
329400 01  MIN-IN-YR             PIC S9(9) COMP.                                
329500                                                                          
329600 01  FLOWTEST-JCW          PIC X(8) VALUE "FLOWTEST".                     
329700 01  FLOWTEST-VALUE        PIC S9(4) COMP VALUE 0.                        
329800     88  FLOWTEST            VALUE 1.                                     
329900                                                                          
330000 LINKAGE SECTION.                                                         
330100                                                                          
330200 01  LINK-NUM              PIC S9(9) COMP.                                
330300                                                                          
330400 01  DATE-TIME.                                                           
330500     02  YR                PIC 9(4).                                      
330600     02  MO                PIC 99.                                        
330700     02  DA                PIC 99.                                        
330800     02  HR                PIC 99.                                        
330900     02  MIN               PIC 99.                                        
331000     02  SEC               PIC 99.                                        
331100                                                                          
331200 01  N-ERR                 PIC S9(4) COMP.                                
331300                                                                          
331400*================================================================*        
331500 PROCEDURE DIVISION USING LINK-NUM DATE-TIME N-ERR.                       
331600*================================================================*        
331700                                                                          
331800 0000-BEGIN.                                                              
331900     MOVE ZERO TO N-ERR.                                                  
332000     MOVE ALL "0" TO DATE-TIME.                                           
332100                                                                          
332200*----- Check number -----*                                                
332300                                                                          
332400*    See if negative                                                      
332500                                                                          
332600     IF LINK-NUM NEGATIVE                                                 
332700         MOVE -1 TO N-ERR                                                 
332800         GO TO 9999-RETURN.                                               
332900     MOVE LINK-NUM TO TIME-NUM.                                           
333000                                                                          
333100*----- Convert number to date/time -----*                                 
333200                                                                          
333300*    Get year                                                             
333400                                                                          
333500     COMPUTE I = TIME-NUM / 2103840.                                      
333600     COMPUTE TIME-NUM = TIME-NUM - (I * 2103840).                         
333700     COMPUTE YR = I * 4.                                                  
333800     MOVE 527040 TO MIN-IN-YR.                                            
333900     PERFORM UNTIL TIME-NUM < MIN-IN-YR                                   
334000         SUBTRACT MIN-IN-YR FROM TIME-NUM                                 
334100         ADD 1 TO YR                                                      
334200         IF function mod (yr,4) = zero                                    
334300             MOVE 527040 TO MIN-IN-YR                                     
334400         ELSE                                                             
334500             MOVE 525600 TO MIN-IN-YR                                     
334600         END-IF                                                           
334700     END-PERFORM.                                                         
334800     ADD 1900 TO YR.                                                      
334900                                                                          
335000*    Get month                                                            
335100                                                                          
335200     IF function mod (YR,4) = zero                                        
335300        MOVE 41760 TO MIN-IN-MO (2)                                       
335400       else,                                                              
335500          move 40320 to min-in-mo (2).                                    
335600                                                                          
335700     PERFORM VARYING MO FROM 1 BY 1                                       
335800                                 UNTIL TIME-NUM <= MIN-IN-MO (MO)         
335900         COMPUTE TIME-NUM = TIME-NUM - MIN-IN-MO (MO)                     
336000     END-PERFORM.                                                         
336100                                                                          
336200*    Get day                                                              
336300                                                                          
336400     COMPUTE DA = TIME-NUM / 1440.                                        
336500     COMPUTE TIME-NUM = TIME-NUM - (DA * 1440).                           
336600     IF TIME-NUM NOT = ZERO                                               
336700         ADD 1 TO DA.                                                     
336800                                                                          
336900*    Get hour                                                             
337000                                                                          
337100     IF TIME-NUM = ZERO                                                   
337200         MOVE 24 TO HR                                                    
337300     ELSE                                                                 
337400         COMPUTE HR = TIME-NUM / 60                                       
337500         COMPUTE TIME-NUM = TIME-NUM - (HR * 60).                         
337600                                                                          
337700*    Get minute                                                           
337800                                                                          
337900     MOVE TIME-NUM TO MIN.                                                
338000                                                                          
338100*    Get second                                                           
338200                                                                          
338300     MOVE ZERO TO SEC.                                                    
338400                                                                          
338500      IF MO = 1 AND DA = 0                                                
338600          COMPUTE MO = (MO + 11)                                          
338700          COMPUTE DA = (DA + 31)                                          
338800          COMPUTE YR = (YR - 1).                                          
338900                                                                          
339000*----- All done - return -----*                                           
339100                                                                          
339200 9999-RETURN.                                                             
339300     GOBACK.                                                              
339400 END PROGRAM NUMTIME.                                                     
339500$PAGE "THIS PROGRAM ---> AMSSDEV  "                                       
339600                                                                          
339700*                                                                         
339800*     |           |           |           |           |                   
339900*     |           |           |           |           |                   
340000*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
340100* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
340200*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
340300*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
340400*    \|/         \|/         \|/         \|/         \|/                  
340500*     Y           Y           Y           Y           Y                   
340600*                                                                         
340700$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
340800**************************************************                        
340900*  Network Security routine.                                              
341000*                                                                         
341100*  Description:                                                           
341200*  Get the AMS Security Device number,                                    
341300*  instead of the "WHO" LDEV. In addition, the connection type.           
341400*                                                                         
341500*  Explaination:                                                          
341600*                                                                         
341700*  AMS has in place a device level application security system.           
341800*  In the past this security paradiam requires a "NAILED"                 
341900*  or "HARDWIRED" logical device number.                                  
342000*  For years this device was a fixed value, and based on the              
342100*  serial connection used.                                                
342200*                                                                         
342300*  Each serial connection has an asigned logical device. This             
342400*  is NOT TRUE with network connections.                                  
342500*                                                                         
342600*  To support network connection AMS has decided to                       
342700*  use the inbound IP address to "NAIL" the logical device.               
342800*                                                                         
342900*  NOTE:                                                                  
343000*  AMS is aware that IP address can be modified on the                    
343100*  client side. Therefore the client workstation must                     
343200*  have in place an administrative security level that                    
343300*  will disable the common user from changing the                         
343400*  IP address on the client side.                                         
343500*                                                                         
343600*  Definition:                                                            
343700*  This program gets the inbound IP address from a READONLY               
343800*  system variable. If the IP addres is BLANK then a serial               
343900*  connection is assumed, and the "WHO" system device number is           
344000*  returned to the caller. If the IP address is not BLANK then            
344100*  it is used as a key argument to retrive the assigned device            
344200*  number in the security database that is maintained by the              
344300*  security admin person.                                                 
344400*                                                                         
344500*  The connection type is set to "S" for serial and "N" network           
344600*  If connection type is not set to "S" or "N", or the device             
344700*  is zero, than one of two conditions may be true. The most              
344800*  likely is that the IP address has not been entered into the            
344900*  security database table (IP-ADDRESS).                                  
345000*  The other not very likely is a serious database error. If a            
345100*  database error has occured the return error number will                
345200*  be a negative integer.                                                 
345300*                                                                         
345400                                                                          
345500 IDENTIFICATION DIVISION.                                                 
345600 PROGRAM-ID. AMSSDEV.                                                     
345700 AUTHOR.     MICHAEL ANDERSON.                                            
345800 DATE-COMPILED.                                                           
345900 ENVIRONMENT DIVISION.                                                    
346000 CONFIGURATION SECTION.                                                   
346100*SOURCE-COMPUTER. HP3000.                                                 
346200 SOURCE-COMPUTER. HP3000 WITH DEBUGGING MODE.                             
346300 OBJECT-COMPUTER. HP3000.                                                 
346400 SPECIAL-NAMES.                                                           
346500     CONDITION-CODE IS CC.                                                
346600 INPUT-OUTPUT SECTION.                                                    
346700$PAGE                                                                     
346800 DATA DIVISION.                                                           
346900$PAGE                                                                     
347000 WORKING-STORAGE SECTION.                                                 
347100 01  I                                PIC S9(4) COMP.                     
347200 01  X                                PIC S9(4) COMP.                     
347300 01  Y                                PIC S9(4) COMP.                     
347400 01  J                                PIC S9(4) COMP.                     
347500 01 IP-ADDRESS                        PIC X(20) VALUE SPACES.             
347600 01  E1                               PIC S9(4) COMP.                     
347700 01  E2                               PIC S9(4) COMP.                     
347800 01 CMD-STR                           PIC X(220) VALUE SPACES.            
347900 01 HPCIVARNAME                       PIC X(20) VALUE %0.                 
348000 01 HPCIVARVAL                        PIC X(20) VALUE SPACES.             
348100 01 HPCIVARSTAT                       PIC S9(9) COMP VALUE 0.             
348200 01 MSG                               PIC X(70) VALUE SPACES.             
348300 01  OP-STATUS                        PIC XX.                             
348400 01  NETLOG-STATUS                    PIC XX.                             
348500 01  SESSION-NAME                     PIC X(16) VALUE SPACES.             
348600 01  DBPASS                          PIC X(8) VALUE SPACES.               
348700 01  DBNAME     PIC X(28) VALUE "  SECDB.SECURE.SYS;".                    
348800 01  DBLIST     PIC XX    VALUE "@;".                                     
348900                                                                          
349000 COPY IMAGE     OF J3KLIB.                                                
349100                                                                          
349200 01  USER-NAME                     PIC X(8).                              
349300 01  ACCT-NAME                     PIC X(8).                              
349400 01 IPMSTR                PIC X(7)   VALUE "IPMSTR;".                     
349500 01 IPMSTR-BUFFER.                                                        
349600    02 IPMSTR-IPADDR           PIC X(20).                                 
349700    02 IPMSTR-LDEV             PIC X(4).                                  
349800    02 IPMSTR-DEVACTDATE       PIC X(6).                                  
349900                                                                          
350000   COPY AMSLINK OF J3KLIB.                                                
350100                                                                          
350200                                                                          
350300 01 LINK-SDEV                         PIC 9(4).                           
350400 01 LINK-CONNTYPE                     PIC X.                              
350500 01 LINK-RETURNERR                    PIC S9(4) COMP.                     
350600                                                                          
350700                                                                          
350800$PAGE                                                                     
350900 PROCEDURE DIVISION USING                                                 
351000    COPY AMSITEMS OF J3KLIB.                                              
351100        LINK-SDEV LINK-CONNTYPE LINK-RETURNERR.                           
351200 1000-MAIN-LOGIC.                                                         
351300     INITIALIZE LINK-RETURNERR LINK-CONNTYPE LINK-SDEV.                   
351400     MOVE  %0 TO HPCIVARNAME.                                             
351500     STRING "HPREMIPADDR" DELIMITED BY SIZE INTO HPCIVARNAME.     050901MA
351600     CALL INTRINSIC "HPCIGETVAR" USING HPCIVARNAME HPCIVARSTAT            
351700                                    \2\ HPCIVARVAL.                       
351800     MOVE HPCIVARVAL TO IP-ADDRESS.                                       
351900     MOVE "N" TO LINK-CONNTYPE.                                           
352000     CALL INTRINSIC "WHO" USING \\ \\ \\ \\ \\ \\ \\ I.                   
352100     MOVE I TO LINK-SDEV.                                                 
352200     MOVE 0 TO LINK-RETURNERR.                                            
352300 END-OF-SUB.                                                              
352400     IF MSG > SPACES DISPLAY MSG.                                         
352500     GOBACK.                                                              
352600 END PROGRAM AMSSDEV.                                                     
352700***************************************************************           
352800$PAGE "THIS PROGRAM ---> PROGSTAMP1   "                                   
352900                                                                          
353000*                                                                         
353100*     |           |           |           |           |                   
353200*     |           |           |           |           |                   
353300*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
353400* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
353500*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
353600*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
353700*    \|/         \|/         \|/         \|/         \|/                  
353800*     Y           Y           Y           Y           Y                   
353900*                                                                         
354000$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
354100 IDENTIFICATION DIVISION.                                                 
354200 PROGRAM-ID. PROGSTAMP1.                                                  
354300 AUTHOR.     MICHAEL ANDERSON.                                            
354400 DATE-COMPILED.                                                           
354500                                                                          
354600************************************************************              
354700*                                                                         
354800*  - APPLICATION MANAGEMENT SUBROUTINE -                                  
354900*                                                                         
355000*  STANDARD AMS PROGRAM.                                                  
355100*                                                                         
355200*  Maintains DEBUG flow levels, by program names.                         
355300*  Maintains Program statistics, by program  & user name.                 
355400*                                                                         
355500*  Program statistics include, and not limited to;                        
355600*   . CPU usage, max, min, and averages.                                  
355700*   . Run times dates, First-time, min/max-cpu-date, last-time            
355800*   . Statistics of program usage.                                        
355900*                                                                         
356000*PROGRAM MAINTENANCE DOCUMENTATION                                        
356100*Date     Author           Description                                    
356200*-------- ---------------- ---------------------------------              
356300************************************************************              
356400                                                                          
356500 ENVIRONMENT DIVISION.                                                    
356600                                                                          
356700 CONFIGURATION SECTION.                                                   
356800 SOURCE-COMPUTER. HP3000.                                                 
356900 OBJECT-COMPUTER. HP3000.                                                 
357000 SPECIAL-NAMES.                                                           
357100     CONDITION-CODE IS CC.                                                
357200                                                                          
357300$PAGE "MISC. WORKING STORAGE SECTION"                                     
357400 DATA DIVISION.                                                           
357500***************************************************************           
357600 WORKING-STORAGE SECTION.                                                 
357700***************************************************************           
357800 01 MISC-STORAGE.                                                         
357900    02 PGM                 PIC X(16).                                     
358000    02 LVL                 PIC --9.                                       
358100                                                                          
358200 01 HPCIVARNAME                       PIC X(20) VALUE %0.                 
358300 01 HPCIVARVAL                        PIC S9(9) COMP VALUE 0.             
358400 01 HPCIVARSTAT                       PIC S9(9) COMP VALUE 0.             
358500 01 XX                                PIC S9(9) COMP VALUE 0.             
358600                                                                          
358700        COPY IMAGE     OF J3KLIB.                                         
358800        COPY SWITCHES  OF J3KLIB.                                         
358900        COPY AMSLINK   OF J3KLIB.                                         
359000*                                                                         
359100$PAGE "MAIN PROGRAM LOGIC"                                                
359200************************************************************              
359300        COPY AMSPROC   OF J3KLIB.                                         
359400        .                                                                 
359500 BEGIN-PROGSTAMP1.                                                        
359600     MOVE "FLOWLEVEL~" TO HPCIVARNAME.                                    
359700     INITIALIZE HPCIVARSTAT HPCIVARVAL.                                   
359800     CALL INTRINSIC "HPCIGETVAR" USING HPCIVARNAME HPCIVARSTAT            
359900                                    \1\ HPCIVARVAL.                       
360000*                                                                         
360100*    MOVE HPCIVARVAL TO LINKPROG-FLOW-VALUE.                              
360200*    MOVE "01" TO FLOWVAR-SW.                                             
360300*    ADD 1 TO LINKPROG-FLOW-LEVEL.                                        
360400*    MOVE LINKPROG-FLOW-LEVEL TO LVL.                                     
360500*    MOVE LINKPROG-FLOW-LEVEL TO xx.                                      
360600*                                                                         
360700*    MOVE LINKPROG-NAME   TO LINKPROG-NAMES(xx).                          
360800*    MOVE LINKPROG-NAME   TO PGM.                                         
360900*    MOVE LINKPROG-FLOW-LEVEL TO LVL.                                     
361000*    MOVE "1" TO X-FLOWTEST-VALUE.                                        
361100*     DISPLAY LVL "/" PGM ": BEGIN".                                      
361200     GOBACK.                                                              
361300 END PROGRAM PROGSTAMP1.                                                  
361400***************************************************************           
361500$PAGE "THIS PROGRAM ---> PROGSTAMP2   "                                   
361600                                                                          
361700*                                                                         
361800*     |           |           |           |           |                   
361900*     |           |           |           |           |                   
362000*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
362100* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
362200*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
362300*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
362400*    \|/         \|/         \|/         \|/         \|/                  
362500*     Y           Y           Y           Y           Y                   
362600*                                                                         
362700$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
362800 IDENTIFICATION DIVISION.                                                 
362900 PROGRAM-ID. PROGSTAMP2.                                                  
363000 AUTHOR.     MICHAEL ANDERSON.                                            
363100 DATE-COMPILED.                                                           
363200                                                                          
363300************************************************************              
363400*                                                                         
363500*  - APPLICATION MANAGEMENT SUBROUTINE -                                  
363600*                                                                         
363700*  STANDARD AMS PROGRAM.                                                  
363800*                                                                         
363900*  Maintains DEBUG flow levels, by program names.                         
364000*  Maintains Program statistics, by program  & user name.                 
364100*                                                                         
364200*  Program statistics include, and not limited to;                        
364300*   . CPU usage, max, min, and averages.                                  
364400*   . Run times dates, First-time, min/max-cpu-date, last-time            
364500*   . Statistics of program usage.                                        
364600*                                                                         
364700*PROGRAM MAINTENANCE DOCUMENTATION                                        
364800*Date     Author           Description                                    
364900*-------- ---------------- ---------------------------------              
365000************************************************************              
365100                                                                          
365200 ENVIRONMENT DIVISION.                                                    
365300                                                                          
365400 CONFIGURATION SECTION.                                                   
365500 SOURCE-COMPUTER. HP3000.                                                 
365600 OBJECT-COMPUTER. HP3000.                                                 
365700 SPECIAL-NAMES.                                                           
365800     CONDITION-CODE IS CC.                                                
365900                                                                          
366000$PAGE "MISC. WORKING STORAGE SECTION"                                     
366100 DATA DIVISION.                                                           
366200***************************************************************           
366300 WORKING-STORAGE SECTION.                                                 
366400***************************************************************           
366500 01 MISC-STORAGE.                                                         
366600    02 PGM                 PIC X(16).                                     
366700    02 LVL                 PIC --9.                                       
366800                                                                          
366900 01 HPCIVARNAME                       PIC X(20) VALUE %0.                 
367000 01 HPCIVARVAL                        PIC S9(9) COMP VALUE 0.             
367100 01 HPCIVARSTAT                       PIC S9(9) COMP VALUE 0.             
367200 01 XX                                PIC S9(9) COMP VALUE 0.             
367300                                                                          
367400        COPY IMAGE     OF J3KLIB.                                         
367500        COPY SWITCHES  OF J3KLIB.                                         
367600        COPY AMSLINK   OF J3KLIB.                                         
367700*                                                                         
367800$PAGE "MAIN PROGRAM LOGIC"                                                
367900************************************************************              
368000        COPY AMSPROC   OF J3KLIB.                                         
368100        .                                                                 
368200 BEGIN-PROGSTAMP2.                                                        
368300     MOVE LINKPROG-FLOW-LEVEL        TO XX LVL.                           
368400*    MOVE LINKPROG-NAMES(XX)         TO PGM.                              
368500*    MOVE "1"                        TO X-FLOWTEST-VALUE.                 
368600*    SUBTRACT 1                    FROM LINKPROG-FLOW-LEVEL.              
368700*     DISPLAY LVL "/" PGM ": END"                                         
368800     GOBACK.                                                              
368900 END PROGRAM PROGSTAMP2.                                                  
369100$PAGE "THIS PROGRAM ---> CHGLOGON  "                                      
369200                                                                          
369300*                                                                         
369400*     |           |           |           |           |                   
369500*     |           |           |           |           |                   
369600*>>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<< >>>>\|/<<<<              
369700* >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<   >>>\|/<<<               
369800*  >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<     >>\|/<<                
369900*   >\|/<       >\|/<       >\|/<       >\|/<       >\|/<                 
370000*    \|/         \|/         \|/         \|/         \|/                  
370100*     Y           Y           Y           Y           Y                   
370200*                                                                         
370300$CONTROL RLFILE,LIST,DYNAMIC,BOUNDS,POST85                                
370310*$CONTROL OPTIMIZE=1,VALIDATE,BOUNDS,CROSSREF,SYNC32,POST85               
370320*$CONTROL ERRORS=5                                                        
370420*================================================================*        
370500 IDENTIFICATION DIVISION.                                                 
370600*================================================================*        
370700                                                                          
370800 PROGRAM-ID. CHGLOGON.                                                    
370910 AUTHOR.     MICHAEL J ANDERSON.                                          
371000                                                                          
371700 ENVIRONMENT DIVISION.                                                    
371800 DATA DIVISION.                                                           
371900 WORKING-STORAGE SECTION.                                                 
372000 01  WS-BYTEMAP              PIC  X(32)      VALUE SPACES.                
372100 01  WS-NUMBYTES             PIC S9(04) COMP VALUE ZEROES.                
372200 01  WS-FUNCTION             PIC S9(04) COMP VALUE ZEROES.                
372300 01  WS-CNVERR               PIC S9(04) COMP VALUE ZEROES.                
372400 01  WS-BUFLEN               PIC S9(04) COMP VALUE +80.                   
372500 01  WS-DISPLAY-CODE         PIC S9(09) COMP VALUE ZEROES.                
372600 01  WS-ERROR-STATUS           USAGE IS COMP.                             
372700     05  WS-ES-1             PIC S9(04) COMP.                             
372800     05  WS-ES-2             PIC S9(04) COMP.                             
372900 01  WS-OVERALL-STATUS         USAGE IS COMP.                             
373000     05  WS-OS-1             PIC S9(04) COMP.                             
373100     05  WS-OS-2             PIC S9(04) COMP.                             
373200 01  WS-OPTIONS              PIC S9(09) COMP.                             
373300 01  WS-PROC-NO              PIC S9(04) COMP.                             
373400 01  WS-AIF-ERROR-MSG-TABLE.                                              
373401     05  FILLER              PIC  X(34) VALUE                             
373402               "Error Getting Acct Password".                             
373403     05  FILLER              PIC  X(34) VALUE                             
373404               "Error Getting User.Acct Password".                        
373405     05  FILLER              PIC  X(34) VALUE                             
373406               "Error Getting Group.Acct Password".                       
373407     05  FILLER              PIC  X(34) VALUE                             
373408               "Error Changing Logon".                                    
373409 01  WS-AIF-ERROR-MSG-TABEL  REDEFINES                                    
373410     WS-AIF-ERROR-MSG-TABLE.                                              
373411     05  WS-AIF-MT           PIC  X(34) OCCURS 4.                         
373412                                                                          
373500 01  WS-LOGON-CMD            PIC  X(128) VALUE SPACES.                    
373600 01  WS-LOGON-COMMAND-STRING PIC  X(128) VALUE SPACES.                    
373601                                                                          
373610 LINKAGE SECTION.                                                         
373700 01  WS-LOGON-DESC.                                                       
373800     05  WS-LD-JOB-NAME      PIC  X(16).                                  
373900     05  WS-LD-ACCT-NAME     PIC  X(16).                                  
374000     05  WS-LD-ACCT-PASS     PIC  X(16).                                  
374100     05  WS-LD-USER-NAME     PIC  X(16).                                  
374200     05  WS-LD-USER-PASS     PIC  X(16).                                  
374300     05  WS-LD-GROUP-NAME    PIC  X(16).                                  
374400     05  WS-LD-GROUP-PASS    PIC  X(16).                                  
374500 01 WS-LOGON-ERROR           PIC  S9(4) COMP.                             
374600 01 WS-LOGON-MSG             PIC  X(80).                                  
374700                                                                          
375800 PROCEDURE DIVISION USING WS-LOGON-DESC WS-LOGON-ERROR                    
375810                          WS-LOGON-MSG.                                   
375900 A100-MAINLINE.                                                           
376000     INITIALIZE WS-LOGON-ERROR WS-LOGON-MSG.                              
376600     MOVE SPACES TO WS-LD-USER-PASS.                                      
377000     MOVE SPACES TO WS-LD-ACCT-PASS.                                      
377400     MOVE SPACES TO WS-LD-GROUP-PASS.                                     
377700     MOVE SPACES     TO WS-LOGON-CMD.                                     
377800     MOVE ZEROES     TO WS-BYTEMAP.                                       
377900     MOVE "1"        TO WS-BYTEMAP(5:1)                                   
378000                        WS-BYTEMAP(6:1)                                   
378100                        WS-BYTEMAP(8:1).                                  
378200     MOVE +2         TO WS-FUNCTION.                                      
378300     COMPUTE WS-NUMBYTES = FUNCTION LENGTH(WS-BYTEMAP).                   
378400     MOVE ZEROES TO WS-OPTIONS.                                           
378500     CALL "BITMAPCNV" USING WS-OPTIONS,                                   
378600                            WS-BYTEMAP,                                   
378700                            WS-NUMBYTES,                                  
378800                            WS-FUNCTION,                                  
378900                            WS-CNVERR.                                    
379100     MOVE SPACES TO WS-LOGON-COMMAND-STRING.                              
379200     STRING WS-LD-JOB-NAME   DELIMITED BY " "                             
379300              ","            DELIMITED BY SIZE                            
379400            WS-LD-USER-NAME  DELIMITED BY " "                             
379500            "/"              DELIMITED BY SIZE                            
379600            WS-LD-USER-PASS  DELIMITED BY " "                             
379700            "."              DELIMITED BY SIZE                            
379800            WS-LD-ACCT-NAME  DELIMITED BY " "                             
379900            "/"              DELIMITED BY SIZE                            
380000            WS-LD-ACCT-PASS  DELIMITED BY " "                             
380100            ", "             DELIMITED BY SIZE                            
380200            WS-LD-GROUP-NAME DELIMITED BY " "                             
380300            "/"              DELIMITED BY SIZE                            
380400            WS-LD-GROUP-PASS DELIMITED BY " "                             
380500            %0               DELIMITED BY SIZE                            
380600       INTO WS-LOGON-COMMAND-STRING.                                      
380800     INITIALIZE WS-ERROR-STATUS                                           
380900                WS-OVERALL-STATUS                                         
381000                WS-PROC-NO.                                               
381100     CALL "j3k_logon" USING WS-OVERALL-STATUS,                            
381200                               WS-LOGON-COMMAND-STRING,                   
381300                               WS-LOGON-DESC,                             
381400                               WS-OPTIONS,                                
381500                               WS-ERROR-STATUS,                           
381600                               WS-PROC-NO                                 
381700     END-CALL.                                                            
381800     IF WS-OS-1 NOT = ZEROES THEN                                         
381810        MOVE WS-OS-1 TO WS-LOGON-ERROR                                    
381900        DISPLAY "1) ERROR IN SUB 'change_logon'"                          
382000        DISPLAY "   ERROR CODE:=>" WS-OS-1 "<"                            
382100        DISPLAY "   PROC NO   :=>" WS-PROC-NO "<"                         
382200        DISPLAY "WS-ES-1      :=>" WS-ES-1 "<"                            
382300        DISPLAY "WS-ES-2      :=>" WS-ES-2 "<"                            
382400        DISPLAY WS-AIF-MT (WS-PROC-NO)                                    
382500        MOVE 1 TO WS-DISPLAY-CODE                                         
382600        CALL INTRINSIC "HPERRMSG" USING WS-DISPLAY-CODE,                  
382700                                        \\ \\                             
382800                                        WS-ERROR-STATUS,                  
382900                                        WS-LOGON-CMD,                     
383000                                        WS-BUFLEN,                        
383100                                        WS-OVERALL-STATUS                 
383200        END-CALL                                                          
383300        DISPLAY "LOGON-CMD [" WS-LOGON-CMD "]"                            
383400        GOBACK                                                            
383500     END-IF.                                                              
383600     IF WS-ES-1 NOT = ZEROES THEN                                         
383610        MOVE WS-ES-1 TO WS-LOGON-ERROR                                    
383700        DISPLAY "2) ERROR IN SUB 'change_logon'"                          
383800        DISPLAY "   ERROR CODE:=>" WS-OS-1 "<"                            
383900        DISPLAY "   PROC NO   :=>" WS-PROC-NO "<"                         
384000        DISPLAY "WS-ES-1      :=>" WS-ES-1 "<"                            
384100        DISPLAY "WS-ES-2      :=>" WS-ES-2 "<"                            
384200        DISPLAY WS-AIF-MT (WS-PROC-NO)                                    
384300        MOVE 1 TO WS-DISPLAY-CODE                                         
384400        CALL INTRINSIC "HPERRMSG" USING WS-DISPLAY-CODE,                  
384500                                        \\ \\                             
384600                                        WS-ERROR-STATUS,                  
384700                                        WS-LOGON-CMD,                     
384800                                        WS-BUFLEN,                        
384900                                        WS-OVERALL-STATUS                 
385000        END-CALL                                                          
385100        DISPLAY "LOGON-CMD [" WS-LOGON-CMD "]"                            
385210        GOBACK                                                            
385300     END-IF.                                                              
385400                                                                          
385500     GOBACK.                                                              
385600 END PROGRAM CHGLOGON.                                                    
385700$TITLE "SHOWDATA SUBROUTINE"                                              
385800$PAGE "SHOWDATA  - Display's databuffer 40 bytes per line."               
385900*                                                                         
386000*     ||           ||           ||           ||           ||              
386100*     ||           ||           ||           ||           ||              
386200*\\   ||   // \\   ||   // \\   ||   // \\   ||   // \\   ||   //         
386300* \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //   \\  ||  //          
386400*  \\ || //     \\ || //     \\ || //     \\ || //     \\ || //           
386500*   \\||//       \\||//       \\||//       \\||//       \\||//            
386600*    \\//         \\//         \\//         \\//         \\//             
386700*     \/           \/           \/           \/           \/              
386800*                                                                         
386900$CONTROL SYNC32,RLFILE,LIST,DYNAMIC                                       
387000*================================================================*        
387100 IDENTIFICATION DIVISION.                                                 
387200*================================================================*        
387300 PROGRAM-ID. SHOWDATA.                                                    
387400******************************************************************        
387500*                                                                *        
387600*  Display data buffer.                                          *        
387700*                                                                *        
387800******************************************************************        
387900*================================================================*        
388000 ENVIRONMENT DIVISION.                                                    
388100*================================================================*        
388200 CONFIGURATION SECTION.                                                   
388300 SOURCE-COMPUTER. HP3000.                                                 
388400*SOURCE-COMPUTER. HP3000 WITH DEBUGGING MODE.                             
388500 OBJECT-COMPUTER. HP3000.                                                 
388600 SPECIAL-NAMES.                                                           
388700     CONDITION-CODE IS CC.                                                
388800*================================================================*        
388900 DATA DIVISION.                                                           
389000*================================================================*        
389100 WORKING-STORAGE SECTION.                                                 
389200 01  THIS-PROGRAM.                                                        
389300     02 THIS-PROG          PIC X(8) VALUE SPACES.                         
389400     02 RESTOF-THISPROG    PIC X(28) VALUE SPACES.                        
389500 01  SUB-PROG              PIC X(12) VALUE " SHOWDATA   ".                
389600 01  I                     PIC S9(4) COMP.                                
389700 01  J                     PIC S9(4) COMP.                                
389800 01  K                     PIC S9(4) COMP.                                
389900 01  L                     PIC S9(4) COMP.                                
390000 01  N                     PIC S9(4) COMP.                                
390100 01  LEN                   PIC S9(4) COMP.                                
390200 01  LOC                   PIC S9(4) COMP.                                
390300                                                                          
390400 01  BUFF                  PIC X(80).                                     
390500 01  DISP-SN4              PIC ----9.                                     
390600 01  DATA-LEN-MAX          PIC S9(4) COMP.                                
390700 01  NUM-X.                                                               
390800     02  NUM               PIC 9(4) COMP.                                 
390900 LINKAGE SECTION.                                                         
391000 01  DATA-REC              PIC X(4096).                                   
391100 01  LINK-LEN              PIC S9(4) COMP.                                
391200*================================================================*        
391300 PROCEDURE DIVISION USING DATA-REC LINK-LEN.                              
391400*================================================================*        
391500 1000-BEGIN.                                                              
391600     CALL "PROCNAME" USING THIS-PROGRAM.                                  
391700                                                                          
391800D    DISPLAY THIS-PROG SUB-PROG "1000-BEGIN ".                            
391900     CALL INTRINSIC ".LEN." USING DATA-REC GIVING DATA-LEN-MAX.           
392000     MOVE 1 TO LOC.                                                       
392100     MOVE LINK-LEN TO LEN.                                                
392200     MOVE LEN TO DISP-SN4.                                                
392300     DISPLAY THIS-PROG  " Data length=" DISP-SN4.                         
392400     IF LEN GREATER THAN DATA-LEN-MAX MOVE DATA-LEN-MAX TO LEN.           
392500     PERFORM UNTIL LEN < 1                                                
392600         IF LEN > 40                                                      
392700             MOVE 40 TO N                                                 
392800         ELSE                                                             
392900             MOVE LEN TO N                                                
393000         END-IF                                                           
393100         MOVE SPACES TO BUFF                                              
393200         PERFORM VARYING I FROM 1 BY 1 UNTIL I > N                        
393300             COMPUTE J = LOC + I - 1                                      
393400             COMPUTE K = I * 2                                            
393500             IF DATA-REC(J:1) LESS THAN SPACE                             
393600                 MOVE "" TO BUFF(K:1)                                    
393700             ELSE                                                         
393800                 MOVE DATA-REC(J:1) TO BUFF(K:1)                          
393900             END-IF                                                       
394000         END-PERFORM                                                      
394100         IF N = 40                                                        
394200             DISPLAY BUFF WITH NO ADVANCING                               
394300         ELSE                                                             
394400             COMPUTE L = N * 2                                            
394500             DISPLAY BUFF(1:L)                                            
394600         END-IF                                                           
394700         MOVE SPACES TO BUFF                                              
394800         PERFORM VARYING I FROM 1 BY 1 UNTIL I > N                        
394900             COMPUTE J = LOC + I - 1                                      
395000             IF (I / 2) * 2 = I                                           
395100                 MOVE DATA-REC(J:1) TO NUM-X(2:1)                         
395200             ELSE                                                         
395300                 MOVE ZERO TO NUM                                         
395400                 MOVE DATA-REC(J:1) TO NUM-X(1:1)                         
395500             END-IF                                                       
395600             COMPUTE K = (I - 1) / 2 * 4 + 1                              
395700             CALL INTRINSIC "ASCII" USING NUM \16\ BUFF(K:)               
395800         END-PERFORM                                                      
395900         IF N = 40                                                        
396000             DISPLAY BUFF WITH NO ADVANCING                               
396100         ELSE                                                             
396200             COMPUTE J = LEN * 2                                          
396300             DISPLAY BUFF(1:J)                                            
396400         END-IF                                                           
396500         ADD N TO LOC                                                     
396600         SUBTRACT N FROM LEN                                              
396700     END-PERFORM.                                                         
396800*========== Return to caller ==========*                                  
396900 9999-RETURN.                                                             
397000D    DISPLAY THIS-PROG SUB-PROG "9999-RETURN".                            
397100     GOBACK.                                                              
397200 END PROGRAM SHOWDATA.                                                    
397300                                                                          
