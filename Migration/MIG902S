001000$CONTROL POST85, BOUNDS, LINES=59, LIST                                   
001010******************************************************************080702ma
001110*   COPYRIGHT 2007 - 2009 J3K Solutions All rights reserved.      080702ma
001120*            Turbo Image Migration PREP System                    080702ma
001130*              Detailed MetaData collection.                      080702ma
001140*                                                                 080702ma
001150*   http://www.j3ksolutions.com                                   080702ma
001160*   mailto:support@j3ksolutions.com                               080702ma
001300******************************************************************060614MA
001400 IDENTIFICATION DIVISION.                                                 
001500 PROGRAM-ID.     MIG902.                                          060706MA
001600 AUTHOR.     MICHAEL ANDERSON.                                            
001700 ENVIRONMENT DIVISION.                                            060615MA
001800 CONFIGURATION SECTION.                                           060615MA
001900 SOURCE-COMPUTER. HP-3000.                                        060705MA
002000*  SOURCE-COMPUTER. HP-3000 WITH DEBUGGING MODE.                  060705MA
002100 OBJECT-COMPUTER. HP-3000.                                        060615MA
002200*                                                                 060615MA
002300 INPUT-OUTPUT SECTION.                                            060615MA
002400 FILE-CONTROL.                                                    060615MA
002500*                                                                 060615MA
002600     SELECT PRINT-FILE      ASSIGN TO "DMG014,,,LP(SDTL)".        060706MA
002700     SELECT SORTFILE        ASSIGN TO "DMG01SRT,,,,9000000".      060706MA
002800     SELECT EXTFILE1        ASSIGN TO "DMG01A1,,,,9000000".       060706MA
002900     SELECT EXTFILE2        ASSIGN TO "DMG01A2,,,,9000000".       060706MA
003000     SELECT DMG01A3-FILE    ASSIGN TO "ERR902,,,,9000000".        060713MA
003100     SELECT DMGFTP-FILE     ASSIGN TO "DMGFTP".                   060713MA
003200                                                                  060713MA
003300*                                                                 060615MA
003400 DATA DIVISION.                                                   060615MA
003500 FILE SECTION.                                                    060615MA
003600                                                                  060615MA
003700                                                                  060615MA
003800 FD  PRINT-FILE                                                   060615MA
003900     RECORD CONTAINS 132 CHARACTERS                               060615MA
004000     BLOCK CONTAINS 1 RECORDS                                     060615MA
004100     LABEL RECORDS ARE OMITTED.                                   060615MA
004200 01  PRINT-LINE.                                                  060615MA
004300     02  CLEAR-OUT                   PIC X(132).                  060615MA
004400                                                                  060615MA
004500 FD  EXTFILE2 DATA RECORD IS EXT-REC                              060615MA
004600     RECORD CONTAINS 62 CHARACTERS.                               060615MA
004700 01  EXT-REC2.                                                    060615MA
004800     05  FILLER                PIC X(62).                         060615MA
004900                                                                  060615MA
005000 FD  EXTFILE1 DATA RECORD IS EXT-REC                              060615MA
005100     RECORD CONTAINS 62 CHARACTERS.                               060615MA
005200 01  EXT-REC.                                                     060615MA
005300     05  FILLER                PIC X(62).                         060615MA
005400                                                                  060615MA
005500 SD  SORTFILE DATA RECORD IS SORT-REC                             060615MA
005600          RECORD CONTAINS 62 CHARACTERS.                          060615MA
005700 01  SORT-REC.                                                    060615MA
005800     02 SORT-KEY PIC X(62).                                       060615MA
005900 FD  DMG01A3-FILE                                                 060713MA
006000     RECORD CONTAINS 4096 CHARACTERS                              060713MA
006100     DATA RECORD IS Script-File.                                  060713MA
006200 01  Script-File.                                                 060619MA
006300     05  Script-Str                     PIC X(4096).              060619MA
006400                                                                  060713MA
006500 FD  DMGFTP-FILE                                                  060713MA
006600     RECORD CONTAINS 256 CHARACTERS                               060713MA
006700     DATA RECORD IS FTP-File.                                     060713MA
006800 01  FTP-File.                                                    060713MA
006900     05  FTP-Str                     PIC X(256).                  060713MA
007000                                                                  060713MA
007100$PAGE "WORKING STORAGE"                                           060615MA
007200 WORKING-STORAGE SECTION.                                         060615MA
007300 01  HPVAR-NAME        PIC X(20) VALUE "ITOSQLS_STATUS~  ".       060614MA
007400 01  HPVAR-ITEM        PIC S9(9) COMP VALUE -1.                           
007500 01  HPVAR-ITEMNUM     PIC S9(9) COMP VALUE 1.                            
007600 01  HPVAR-STAT        PIC S9(9) COMP VALUE 0.                            
007700 01  DS-IDX            PIC S9(9) COMP VALUE 0.                    060621MA
007800 01  DI-IDX            PIC S9(9) COMP VALUE 0.                    060621MA
007900 01  MYINCREMENT       PIC S9(4) COMP  VALUE 0.                           
008000 01  GETINFO-DATA.                                                        
008100    05  GINFO-LEN                PIC S9(4) COMP.                          
008200    05  GINFO-STR                PIC X(128).                              
008300    05  GINFO-PARM               PIC S9(4) COMP.                          
008400 01  PARSED-DATA.                                                         
008500    05  ITEMS-PARSED             PIC S9(4) COMP.                          
008600        88 PARSE-IS-COMPLETE VALUES ARE 8 THRU 99.                        
008700    05  PARSED-STRING            PIC X(128).                              
008800    05  NEXT-STRING              PIC X(128).                              
008900    05  STRING-POINTER             PIC S9(4) COMP.                        
009000    05  GX                       PIC S9(4) COMP.                          
009100    05  GY                       PIC S9(4) COMP.                          
009200    05  PX                       PIC S9(4) COMP.                          
009300 01 SETX PIC S9(4) COMP VALUE 0.                                          
009400 01 SETY PIC S9(4) COMP VALUE 0.                                          
009500 01  FULL-CURRENT-DATE.                                                   
009600         05  C-DATE.                                                      
009700             10  C-YEAR       PIC 9(4).                                   
009800             10  C-MONTH      PIC 99.                                     
009900             10  C-DAY        PIC 99.                                     
010000         05  C-TIME.                                                      
010100             10  C-HOUR       PIC 99.                                     
010200             10  C-MINUTES    PIC 99.                                     
010300             10  C-SECONDS    PIC 99.                                     
010400             10  C-SEC-HUND   PIC 99.                                     
010500         05  C-TIME-DIFF.                                                 
010600             10  O-GMT-DIR    PIC X.                              060621MA
010700             10  O-HOUR       PIC 99.                             060621MA
010800             10  O-MINUTES    PIC 99.                             060621MA
010900 01 ERROR-MSG                PIC X(80) VALUE SPACES.                      
011000 01 NUMDEC                 PIC S9(4) COMP.                        060615MA
011100 01 NUMERR                 PIC S9(4) COMP.                        060615MA
011200 01 NUM1                   PIC X(14).                             060615MA
011300 01 NUM2                   PIC S9(14). 01  DB-MISC.               060615MA
011400     02  RE-READ           PIC S9(4) COMP VALUE 1.                060615MA
011500     02  MAX-DB            PIC S9(4) COMP VALUE 100.              060615MA
011600     02  SERIAL            PIC S9(4) COMP VALUE 2.                060615MA
011700     02  BACKWARD          PIC S9(4) COMP VALUE 3.                060615MA
011800     02  DIRECT            PIC S9(4) COMP VALUE 4.                060615MA
011900     02  CHAINED           PIC S9(4) COMP VALUE 5.                060615MA
012000     02  BACK-CHAINED      PIC S9(4) COMP VALUE 6.                060615MA
012100     02  KEYED             PIC S9(4) COMP VALUE 7.                060615MA
012200     02  MODE-1            PIC S9(4) COMP VALUE 1.                060615MA
012300     02  MODE-3            PIC S9(4) COMP VALUE 3.                060615MA
012400     02  MODE-4            PIC S9(4) COMP VALUE 4.                060621MA
012500     02  MODE-20           PIC S9(4) COMP VALUE 20.               060621MA
012600     02  MODE-104          PIC S9(4) COMP VALUE 104.              060621MA
012700     02  MODE-102          PIC S9(4) COMP VALUE 102.              060621MA
012800     02  MODE-103          PIC S9(4) COMP VALUE 103.              060621MA
012900     02  MODE-202          PIC S9(4) COMP VALUE 202.              060621MA
013000     02  MODE-203          PIC S9(4) COMP VALUE 203.              060621MA
013100     02  MODE-301          PIC S9(4) COMP VALUE 301.              060621MA
013200     02  MODE-406          PIC S9(4) COMP VALUE 406.              060621MA
013300     02  MODE-5            PIC S9(4) COMP VALUE 5.                060615MA
013400     02  MODE-N            PIC S9(4) COMP VALUE 0.                060615MA
013500     02  IREAD-LEN         PIC S9(4) COMP VALUE 0.                060615MA
013600     02  IMAGE-ERRNUM      PIC S9(4) COMP VALUE 0.                060615MA
013700     02  CALL-STRING       PIC X(80) VALUE SPACES.                060615MA
013800     02  CSLEN             PIC S9(4) COMP VALUE 0.                060615MA
013900     02  ERROR-STRING      PIC X(80) VALUE SPACES.                060615MA
014000     02  ESLEN             PIC S9(4) COMP VALUE 0.                060615MA
014100     02  NULL-ITEM         PIC XXXX VALUE "; ".                   060615MA
014200     02  ALL-ITEMS         PIC XX VALUE "@;".                     060615MA
014300     02  SEARCH-ITEM       PIC X(18).                             060615MA
014400     02  SEARCH-KEY.                                                      
014500         03 SEARCH-KEYI32     PIC S9(9) COMP.                             
014600         03 SEARCH-32         PIC X(32).                                  
014700     02  STATUS-AREA.                                             060615MA
014800         03  CONDITION-WORD    PIC S9(4) COMP VALUE  0.           060615MA
014900             88  NO-IMAGE-ERRORS         VALUE  0.                060615MA
015000             88  IMAGE-ERRORS                                     060615MA
015100                 VALUES ARE -9999 THRU -1, 1 THRU  9999.          060615MA
015200             88  END-OF-FILE             VALUE 11.                060615MA
015300             88  BEG-OF-FILE             VALUE 12.                060615MA
015400             88  BEG-OF-CHAIN            VALUE 14.                060615MA
015500             88  END-OF-CHAIN            VALUE 15.                060615MA
015600             88  NO-ENTRY                VALUE 17.                060615MA
015700         03  RECORD-LENGTH     PIC S9(4) COMP VALUE  0.           060615MA
015800         03  RECORD-NUMBER     PIC S9(9) COMP VALUE  0.           060615MA
015900         03  ENTRIES-IN-CHAIN  PIC S9(9) COMP VALUE  0.           060615MA
016000         03  PREV-RECORD-NO    PIC S9(9) COMP VALUE  0.           060615MA
016100         03  NEXT-RECORD-NO    PIC S9(9) COMP VALUE  0.           060615MA
016200 01  FIRST-TIME-SW         PIC X.                                 060615MA
016300     88  FIRST-TIME        VALUE "1".                             060615MA
016400                                                                  060615MA
016500 01  ERRORS-SW             PIC X.                                 060615MA
016600     88  ERRORS            VALUE "1".                             060615MA
016700                                                                  060615MA
016800 01  EDIT-ERRORS-SW        PIC X.                                 060615MA
016900     88  EDIT-ERRORS       VALUE "1".                             060615MA
017000                                                                  060615MA
017100 01  BAD-KEY-SW            PIC X.                                 060615MA
017200     88  BAD-KEY           VALUE "1".                             060615MA
017300                                                                  060615MA
017400 01  Last-Column-SW       PIC X.                                  060622MA
017500     88  Last-Column      VALUE "1".                              060622MA
017600                                                                  060615MA
017700 01  X-FLOWTEST-JCW          PIC X(8) VALUE "FLOWTEST".           060615MA
017800 01  X-FLOWTEST-VALUE        PIC S9(4) COMP VALUE 0.              060615MA
017900     88  X-FLOWTEST          VALUE 1.                             060615MA
018000                                                                  060615MA
018100 01 TARGET-FIELD                    PIC X(64) VALUE SPACES.       060706MA
018200 01 DWNSHFT-SW                      PIC X.                        060706MA
018300    88 OK-TO-DOWNSHIFT VALUE "1".                                 060706MA
018400 01 MYIDX                           PIC S9(4) COMP VALUE 0.       060706MA
018500 01 SOURCE-FIELD                    PIC X(64) VALUE SPACES.       060706MA
018600 01 ASCII-CHARACTERS.                                             060706MA
018700    02 TWO-BYTES                    PIC XX VALUE SPACES.          060706MA
018800    02 SIXTEEN-BITS REDEFINES TWO-BYTES.                          060706MA
018900       05 ASCII-INT                 PIC S9(4) COMP.               060706MA
019000    02 TWO-CHARS    REDEFINES TWO-BYTES.                          060706MA
019100       05 FILLER                    PIC X.                        060706MA
019200       05 ASCII-CHAR                PIC X.                        060706MA
019300                                                                  060706MA
019400                                                                  060706MA
019500 01 ABORT-SWITCHES.                                               060615MA
019600    02 ON-IMAGE-ERRORS     PIC X VALUE "0".                       060615MA
019700       88 ABORT-ON-IMAGE-ERRORS  VALUE "9".                       060615MA
019800                                                                  060615MA
019900 01  DATA-BASE-COMMON.                                            060615MA
020000     02  DB-PTR                    PIC S9(4) COMP.                060615MA
020100     02  DB-CNT                    PIC S9(4) COMP.                060615MA
020200     02  DB-MAX                    PIC S9(4) COMP.                060615MA
020300     02  DB-IDX                    PIC S9(4) COMP.                060615MA
020400     02  DB-POINTER-STORAGE.                                      060615MA
020500         03 DB-POINTER-ENTRIES OCCURS 100 TIMES.                  060615MA
020600            04 DBPTR               PIC S9(4) COMP.                060615MA
020700                                                                  060615MA
020800     02  SAVE-STATUS.                                             060615MA
020900         03  CONDITION-SAVED   PIC S9(4) COMP.                    060615MA
021000         03  SAVED-LENGTH      PIC S9(4) COMP.                    060615MA
021100         03  SAVED-NUMBER      PIC S9(9) COMP.                    060615MA
021200         03  SAVED-IN-CHAIN    PIC S9(9) COMP.                    060615MA
021300         03  PREV-SAVED-NO     PIC S9(9) COMP.                    060615MA
021400         03  NEXT-SAVED-NO     PIC S9(9) COMP.                    060615MA
021500                                                                  060615MA
021600     02 DATABASE-TABLE value spaces.                              060621MA
021700         03 DATA-BASE-NAMES            OCCURS 512 TIMES.          060621MA
021800            05 DATA-BASE-NAME.                                    060621MA
021900             10 IMAGE-WORD           PIC XX.                      060621MA
022000             10 DBNAME               PIC X(26).                   060621MA
022100               88 END-OF-DB-TABLE VALUE "LAST-DBN-ENTRY".         060615MA
022200            05 DATA-BASE-PASS          PIC X(08).                 060621MA
022300                                                                  060615MA
022400 01 A-TABLE-SW               PIC X VALUE "0".                     060615MA
022500    88 ITS-A-TABLE    VALUE "1".                                          
022600 01 DOW                      PIC S9(4) COMP  VALUE 0.                     
022700 01  MIGDB    PIC S9(4) COMP VALUE  9.                                    
022800 01  MYDB     PIC S9(4) COMP VALUE  9.                                    
022900 01  MIGDB-STATUS.                                                        
023000     03  FILLER    PIC S9(4) COMP VALUE  0.                               
023100     03  FILLER    PIC S9(4) COMP VALUE  0.                               
023200     03  FILLER    PIC S9(9) COMP VALUE  0.                               
023300     03  FILLER    PIC S9(9) COMP VALUE  0.                               
023400     03  FILLER    PIC S9(9) COMP VALUE  0.                               
023500     03  FILLER    PIC S9(9) COMP VALUE  0.                               
023600 01 INSPECT-IDX              PIC S9(4) COMP  VALUE 0.                     
023700 01 NUMDATE                  PIC S9(9) COMP  VALUE 0.                     
023800                                                                  060713MA
023900 01 WHO-INTRINSIC-PARMS.                                          060713MA
024000    15  WHO-TERM-DEV-NO        PIC S9999 COMP.                    060713MA
024100    15  WHO-MODE               PIC S9999 COMP.                    060713MA
024200    15  WHO-CAPABILITY         PIC S9(6) COMP.                    060713MA
024300    15  WHO-LATTR              PIC S9(6) COMP.                    060713MA
024400    15  WHO-USERN.                                                060713MA
024500        20 BYTE1-6             PIC X(6).                          060713MA
024600        20 SCHOOL-NUMBER       PIC XX.                            060713MA
024700    15  WHO-GROUPN             PIC X(8).                          060713MA
024800    15  WHO-ACCTN              PIC X(8).                          060713MA
024900    15  WHO-HOMEN              PIC X(8).                          060713MA
025000 COPY SRVMST OF J3KLIB.                                           060713MA
025100 COPY DBMSTR OF J3KLIB.                                                   
025200 COPY DSMSTR OF J3KLIB.                                                   
025300 COPY DBFLDS OF J3KLIB.                                                   
025400 COPY NXUNIQ OF J3KLIB.                                                   
025500                                                                          
025600 01 DP-IDX                  PIC S9(9) COMP  VALUE 0.              060705MA
025700 01 MyHpSusan               PIC S9(9) COMP  VALUE 0.                      
025800 01 LINK-USER  PIC X(8) VALUE SPACES.                                     
025900 01 LINK-UPASS PIC X(8) VALUE SPACES.                                     
026000 01 LINK-ACCT  PIC X(8) VALUE SPACES.                                     
026100 01 LINK-APASS PIC X(8) VALUE SPACES.                                     
026200 01 LINK-GROUP PIC X(8) VALUE SPACES.                                     
026300 01 LINK-GPASS PIC X(8) VALUE SPACES.                                     
026400                                                                          
026500 01 MYCOST              PIC S9(18) COMP VALUE 0.                          
026600 01 MY-SVR-DBCNT       PIC S9(18) COMP VALUE 0.                           
026700 01 MY-SVR-DSCNT       PIC S9(18) COMP VALUE 0.                           
026800 01 MY-SVR-FLDCNT      PIC S9(18) COMP VALUE 0.                           
026900 01 MY-SVR-RECCNT      PIC S9(18) COMP VALUE 0.                           
027000 01 MY-SVR-SUSAN       PIC S9(09) COMP VALUE 0.                           
027100 01 MY-SVR-REC-COST    PIC S9(18) COMP VALUE 0.                           
027200 01 MY-DB-BYTES        PIC S9(18) COMP VALUE 0.                           
027300 01 MY-DB-SETCNT       PIC S9(18) COMP VALUE 0.                           
027400 01 MY-DB-RECCNT       PIC S9(18) COMP VALUE 0.                           
027500 01 MY-DB-COST         PIC S9(18) COMP VALUE 0.                           
027600 01 MYMSG                   PIC X(79) VALUE SPACES.                       
027700 01 SI-IDX                  PIC S9(9) COMP  VALUE 0.              060705MA
027800 01 M                     PIC X(78)      VALUE SPACES.                    
027900 01 CMD                     PIC X(255)      VALUE SPACES.                 
028000 01 CSTR                     PIC X(255)      VALUE SPACES.                
028020 01 CERR                     PIC S9(4) COMP  VALUE 0.                     
028100 01 CPARM                    PIC S9(4) COMP  VALUE 0.                     
028200 01 CMSG                     PIC S9(4) COMP  VALUE 2.                     
028300 01 STR-PTR                  PIC S9(4) COMP  VALUE 0.                     
028400 01 OCCURS-VALUE             PIC S9(4) COMP  VALUE 0.                     
028500 01  EXTFILE-STATUS            PIC X   VALUE "0".                 060619MA
028600     88 EXTFILE-EOF                    VALUE "9".                 060619MA
028700 01 OCCURS-LAST              PIC S9(4) COMP  VALUE 0.                     
028800 01 My-BaseName              Pic X(6) Value Spaces.               060705MA
028900 01 OCCURS-PTR               PIC S9(4) COMP  VALUE 0.                     
029000 01 NUM-X                    PIC S9(4) COMP  VALUE 0.                     
029100 01 My-Bytes                  pic S9(4) Comp  Value 0.                    
029200 01 DASH-PTR                 PIC S9(4) COMP  VALUE 0.                     
029300 01 VAR-LEN                  PIC S9(4) COMP  VALUE 0.                     
029400 01 SHOWTIME-STR.                                                         
029500    02 FILLER PIC X(8) VALUE "SHOWTIME".                                  
029600    02 FILLER PIC X    VALUE %15.                                         
029700 01 DATE-EDITING.                                                 060621MA
029800    05 RAW-DATE.                                                  060621MA
029900       10 D1     PIC X   VALUE SPACES.                            060621MA
030000       10 D2     PIC X   VALUE SPACES.                            060621MA
030100       10 D3     PIC X   VALUE SPACES.                            060621MA
030200       10 D4     PIC X   VALUE SPACES.                            060621MA
030300       10 D5     PIC X   VALUE SPACES.                            060621MA
030400       10 D6     PIC X   VALUE SPACES.                            060621MA
030500       10 D7     PIC X   VALUE SPACES.                            060621MA
030600       10 D8     PIC X   VALUE SPACES.                            060621MA
030700    05 EDITED-DATE.                                               060621MA
030800       10 D5     PIC X   VALUE SPACES.                            060621MA
030900       10 D6     PIC X   VALUE SPACES.                            060621MA
031000       10 FILLER PIC X   VALUE "/".                               060621MA
031100       10 D7     PIC X   VALUE SPACES.                            060621MA
031200       10 D8     PIC X   VALUE SPACES.                            060621MA
031300       10 FILLER PIC X   VALUE "/".                               060621MA
031400       10 D1     PIC X   VALUE SPACES.                            060621MA
031500       10 D2     PIC X   VALUE SPACES.                            060621MA
031600       10 D3     PIC X   VALUE SPACES.                            060621MA
031700       10 D4     PIC X   VALUE SPACES.                            060621MA
031800                                                                  060621MA
031900* 1: Database new limits (# of sets = 240,                        060619MA
032000*                         # of items = 1200,                      060619MA
032100*                         # paths per masters = 64)               060619MA
032200* 0: Database old limits (# of sets = 199,                        060619MA
032300*                         # of items = 1024,                      060619MA
032400*                         # paths per master = 16)                060619MA
032500                                                                  060619MA
032600 01 Db-Info-406-Word-17.                                          060621MA
032700    05  BIT1             PIC 9.                                   060619MA
032800    05  BIT2             PIC 9.                                   060619MA
032900    05  BIT3             PIC 9.                                   060619MA
033000    05  BIT4             PIC 9.                                   060619MA
033100    05  BIT5             PIC 9.                                   060619MA
033200    05  BIT6             PIC 9.                                   060619MA
033300    05  BIT7             PIC 9.                                   060619MA
033400    05  BIT8             PIC 9.                                   060619MA
033500    05  BIT9             PIC 9.                                   060619MA
033600        88 Database-Newlimits Value 1.                            060621MA
033700        88 Database-Oldlimits Value 0.                            060621MA
033800    05  BIT10            PIC 9.                                   060619MA
033900        88 Database-Entrynumber-Format Value 1.                   060621MA
034000        88 Database-Entryname-Format   Value 0.                   060621MA
034100    05  BIT11            PIC 9.                                   060619MA
034200    05  BIT12            PIC 9.                                   060619MA
034300        88 Expandable-Master-Dataset     Value 1.                 060621MA
034400        88 No-Expandable-Master-Dataset   Value 0.                060621MA
034500    05  BIT13            PIC 9.                                   060619MA
034600        88 B-Tree      Value 1.                                   060621MA
034700        88 No-B-Tree   Value 0.                                   060621MA
034800    05  BIT14            PIC 9.                                   060619MA
034900    05  BIT15            PIC 9.                                   060619MA
035000    05  BIT16            PIC 9.                                   060619MA
035100 01  BINARY-VALUE.                                                060621MA
035200     05 BIT-ZERO                     PIC 9.                       060621MA
035300     05 BIT OCCURS 15 TIMES          PIC 9.                       060621MA
035400                                                                  060621MA
035500 01 NUMERIC-EDITS.                                                060621MA
035600    02 Split-Word        Pic S9(4) Comp.                          060621MA
035700    02 Splating-a-word Redefines Split-Word.                      060621MA
035800       05 Split-Word-1 Pic x.                                     060621MA
035900       05 Split-Word-2 Pic x.                                     060621MA
036000    02 CHR3              PIC XXX.                                         
036100    02 Y1                PIC 9.                                   060621MA
036200    02 Y2                PIC 99.                                  060621MA
036300    02 Y3                PIC 999.                                 060621MA
036400    02 Y4                PIC 9999.                                060621MA
036500    02 Y5                PIC 99999.                               060621MA
036600    02 CHR6              PIC XXXXXX.                              060621MA
036700    02 Z1                PIC 9.                                           
036800    02 Z2                PIC 99.                                          
036900    02 Z3                PIC 999.                                         
037000    02 Z4                PIC 9999.                                        
037100    02 Z5                PIC 99999.                                       
037200    02 COLUMN-BYTES    PIC S9(4) COMP.                                    
037300                                                                          
037400 01 Collate-Str          Pic x(64).                               060621MA
037500 01 Db-Info-406.                                                  060619MA
037600    02 DBI-406-DbName   Pic X(28).                                060619MA
037700    02 DBI-406-OpenMode Pic S9(4) Comp.                           060619MA
037800    02 DBI-406-Version  Pic S9(4) Comp.                           060619MA
037900    02 DBI-406-Options  Pic S9(4) Comp.                           060619MA
038000    02 Filler           Pic X(256).                               060621MA
038100 01 Db-Info-203.                                                  060619MA
038200    02 DBI-203-SetCount Pic S9(4) Comp.                           060619MA
038300    02 DBI-203-SetList.                                           060619MA
038400       05 DBI-203-SetEntries OCCURS 256 Times.                    060619MA
038500          10 DBI-203-SetNumber Pic S9(4) Comp.                    060619MA
038600 01 Db-Info-202.                                                  060619MA
038700    02 DBI-SetName      Pic X(16).                                060619MA
038800    02 DBI-SetType      Pic XX.                                   060619MA
038900    02 DBI-SetEntryLen  Pic S9(4) Comp.                           060619MA
039000    02 DBI-SetBlkFactor Pic S9(4) Comp.                           060619MA
039100    02 DBI-SetUnused    Pic S9(9) Comp.                           060619MA
039200    02 DBI-SetEntryCnt  Pic S9(9) Comp.                           060619MA
039300    02 DBI-SetCapacity  Pic S9(9) Comp.                           060619MA
039400 01 Ms-Info-202.                                                          
039500    02 MSI-SetName      Pic X(16).                                        
039600    02 MSI-SetType      Pic XX.                                           
039700    02 MSI-SetEntryLen  Pic S9(4) Comp.                                   
039800    02 MSI-SetBlkFactor Pic S9(4) Comp.                                   
039900    02 MSI-SetUnused    Pic S9(9) Comp.                                   
040000    02 MSI-SetEntryCnt  Pic S9(9) Comp.                                   
040100    02 MSI-SetCapacity  Pic S9(9) Comp.                                   
040200 01 Db-Info-103.                                                  060619MA
040300    02 DBI-103-ItemCount Pic S9(4) Comp.                          060619MA
040400    02 DBI-103-ItemList.                                          060619MA
040500       05 DBI-103-ItemEntries OCCURS 1280 Times.                  060619MA
040600          10 DBI-103-ItemNumber Pic S9(4) Comp.                   060619MA
040700 01 Db-Info-104.                                                  060619MA
040800    02 DBI-104-ItemCount Pic S9(4) Comp.                          060619MA
040900    02 DBI-104-ItemList.                                          060619MA
041000       05 DBI-104-ItemEntries OCCURS 1280 Times.                  060619MA
041100          10 DBI-104-ItemNumber Pic S9(4) Comp.                   060619MA
041200 01 Db-Info-102.                                                  060619MA
041300    02 DBI-ItemName      Pic X(16).                               060619MA
041400    02 DBI-ItemType      Pic XX.                                  060619MA
041500    02 DBI-ItemSubLen    Pic S9(4) Comp.                          060619MA
041600    02 DBI-ItemSubCount  Pic S9(4) Comp.                          060619MA
041700    02 DBI-ItemUnused    Pic S9(9) Comp.                          060619MA
041800 01 Sr-Info-102.                                                          
041900    02 SrI-ItemName      Pic X(16).                                       
042000    02 SrI-ItemType      Pic XX.                                          
042100    02 SrI-ItemSubLen    Pic S9(4) Comp.                                  
042200    02 SrI-ItemSubCount  Pic S9(4) Comp.                                  
042300    02 SrI-ItemUnused    Pic S9(9) Comp.                                  
042400 01 Db-Info-301.                                                  060619MA
042500    02 DBI-301-ItemCount Pic S9(4) Comp.                          060619MA
042600    02 DBI-301-ItemList.                                          060619MA
042700       05 DBI-301-ItemEntries OCCURS 64 Times.                    060619MA
042800          10 DBI-301-SetNumber    Pic S9(4) Comp.                 060619MA
042900          10 DBI-301-SearchNumber Pic S9(4) Comp.                 060619MA
043000          10 DBI-301-SortNumber   Pic S9(4) Comp.                 060619MA
043100 01 Master-Info-202.                                              060619MA
043200    02 MI-SetName      Pic X(16).                                 060619MA
043300    02 MI-SetType      Pic XX.                                    060619MA
043400    02 MI-SetEntryLen  Pic S9(4) Comp.                            060619MA
043500    02 MI-SetBlkFactor Pic S9(4) Comp.                            060619MA
043600    02 MI-SetUnused    Pic S9(9) Comp.                            060619MA
043700    02 MI-SetEntryCnt  Pic S9(9) Comp.                            060619MA
043800    02 MI-SetCapacity  Pic S9(9) Comp.                            060619MA
043900 01  WS-LOGON-DESC                       VALUE SPACES.            060619MA
044000     05  WS-LD-JOB-NAME      PIC  X(16).                                  
044100     05  WS-LD-ACCT-NAME     PIC  X(16).                                  
044200     05  WS-LD-ACCT-PASS     PIC  X(16).                                  
044300     05  WS-LD-USER-NAME     PIC  X(16).                                  
044400     05  WS-LD-USER-PASS     PIC  X(16).                                  
044500     05  WS-LD-GROUP-NAME    PIC  X(16).                                  
044600     05  WS-LD-GROUP-PASS    PIC  X(16).                                  
044700 01  WS-ERR PIC S9(4) COMP VALUE 0.                                       
044800 01  WS-ERR-MSG PIC X(80) VALUE SPACES.                                   
044900 01  LAST-CREATOR  PIC X(30) VALUE SPACES.                                
045000 01  THIS-CREATOR  PIC X(30) VALUE SPACES.                                
045100 01  IDX           PIC S9(4) COMP VALUE 0.                                
045200 01  DBMSTR-RECNO  PIC S9(9) COMP VALUE 0.                                
045300 01  TDAY                PIC X(8)  VALUE SPACES.                          
045400 01  TNUMDAY             PIC S9(9) COMP VALUE 0.                          
045500 01  TDOW                PIC S9(4) COMP VALUE 0.                          
045600 01  DDAY                PIC X(8)  VALUE SPACES.                          
045700 01  DNUMDAY             PIC S9(9) COMP VALUE 0.                          
045800 01  DDOW                PIC S9(4) COMP VALUE 0.                          
045900 01  DCNT                PIC S9(4) COMP VALUE 0.                          
046000 COPY AMSMODE OF J3KLIB.                                                  
046100                                                                          
046200*=================================================================060620MA
046300$PAGE  "Main logical flow"                                                
046400*=================================================================060620MA
046500 PROCEDURE DIVISION.                                                      
046600 BEGIN-0000.                                                              
046700     CALL   INTRINSIC "WHO"                                               
046800     USING  WHO-MODE WHO-CAPABILITY WHO-LATTR WHO-USERN                   
046900            WHO-GROUPN WHO-ACCTN WHO-HOMEN WHO-TERM-DEV-NO.               
046910     MOVE WHO-MODE TO AMSMODE.                                            
047010     IF WHO-ACCTN(1:3) <> "SYS" OR                                        
047100        WHO-USERN(1:7) <> "MANAGER" OR                                    
047200        WHO-GROUPN(1:3) <> "J3K"                                          
047300       DISPLAY "PLEASE LOGON AS MANAGER.SYS,J3K"                          
047400       DISPLAY "This program will not run as "                            
047500               WHO-USERN "." WHO-ACCTN "," WHO-GROUPN                     
047600       STOP RUN.                                                          
047610     Open OUTPUT DMG01A3-FILE.                                            
047710     MOVE "Turbo Image/SQL Documentation Tool version C.7.3" TO M.        
047800      PERFORM MSG-PROCESS                                                 
047900     MOVE "-----------------------------------------------" TO M.         
048000      PERFORM MSG-PROCESS                                                 
048100     MOVE "***             MIG902.PUB.J3K              ***" TO M.         
048200      PERFORM MSG-PROCESS                                                 
048300     MOVE "***                                         ***" TO M.         
048400      PERFORM MSG-PROCESS                                                 
048500     MOVE "***    Turbo Image Structural Examination   ***" TO M.         
048600      PERFORM MSG-PROCESS                                                 
048700     MOVE "***                                         ***" TO M.         
048800      PERFORM MSG-PROCESS                                                 
048900     MOVE "-----------------------------------------------" TO M.         
049000      PERFORM MSG-PROCESS                                                 
049100     MOVE "Copyright 2007 J3K Solutions" TO M.                            
049200      PERFORM MSG-PROCESS                                                 
049300     CALL "GETCURRENT" USING TDAY TNUMDAY TDOW.                           
049400*    INITIALIZE DDAY DNUMDAY DDOW.                                        
049500*    MOVE "20070520" TO DDAY.                                             
049600*    CALL "DAYNUM" USING DDAY DNUMDAY DDOW.                               
049700*    COMPUTE DCNT = DNUMDAY - TNUMDAY.                                    
049800*    IF DCNT < 0                                                          
049900*     MOVE "-----------------------------------------------" TO M         
050000*     PERFORM MSG-PROCESS                                                 
050100*     MOVE "***                                         ***" TO M         
050200*     PERFORM MSG-PROCESS                                                 
050300*     MOVE "***                                         ***" TO M         
050400*     PERFORM MSG-PROCESS                                                 
050500*     MOVE "***   This DEMO version has expired         ***" TO M         
050600*     PERFORM MSG-PROCESS                                                 
050700*     MOVE "***   Email: Support@J3KSolutions.com       ***" TO M         
050800*     PERFORM MSG-PROCESS                                                 
050900*     MOVE "***                                         ***" TO M         
051000*     PERFORM MSG-PROCESS                                                 
051100*     MOVE "***                                         ***" TO M         
051200*     PERFORM MSG-PROCESS                                                 
051300*     MOVE "-----------------------------------------------" TO M         
051400*     PERFORM MSG-PROCESS                                                 
051500*     CALL INTRINSIC "QUIT" USING \0\                                     
051600*    ELSE                                                                 
051700*     MOVE DCNT TO Z2                                                     
051800*     STRING "DEMO Period has " z2 " days remaining."                     
051900*      DELIMITED BY SIZE INTO M                                           
052000*     PERFORM MSG-PROCESS                                                 
052100*     MOVE "Expiration date is: May 20, 2007" TO M                        
052200*     PERFORM MSG-PROCESS.                                                
052300     PERFORM INITIALIZATION.                                      060615MA
052400     INITIALIZE WS-LOGON-DESC WS-ERR WS-ERR-MSG LAST-CREATOR.             
052500     MOVE ALL "x" TO THIS-CREATOR.                                        
052600     MOVE 1 TO DB-IDX                                             060615MA
052700     MOVE DB-IDX TO DB-PTR                                        060615MA
052800     PERFORM REWIND-DBMSTR.                                               
052900     PERFORM VARYING IDX FROM 1 BY 1                                      
053000       UNTIL (END-OF-FILE)                                                
053100          OR (IMAGE-ERRORS)                                               
053200      PERFORM GET-DBMSTR-SERIAL                                           
053300      IF NOT END-OF-FILE                                                  
053400       MOVE RECORD-NUMBER TO DBMSTR-RECNO                                 
053500       STRING DBMSTR-DB-CREATOR DELIMITED BY SPACE                        
053600              DBMSTR-DB-ACCT    DELIMITED BY SPACE                        
053610              DBMSTR-DB-GROUP   DELIMITED BY SPACE                        
053700                   INTO THIS-CREATOR                                      
053800       END-STRING                                                         
053900       IF THIS-CREATOR <> LAST-CREATOR                                    
054000        INITIALIZE WS-LOGON-DESC WS-ERR WS-ERR-MSG                        
054100        MOVE THIS-CREATOR TO LAST-CREATOR                                 
054200        MOVE "J3KDIAG" TO WS-LD-JOB-NAME                                  
054300        MOVE DBMSTR-DB-CREATOR TO WS-LD-USER-NAME                         
054400        MOVE DBMSTR-DB-ACCT    TO WS-LD-ACCT-NAME                         
054500        MOVE DBMSTR-DB-GROUP   TO WS-LD-GROUP-NAME                        
054600        CALL "CHGLOGON"                                                   
054700         USING WS-LOGON-DESC WS-ERR WS-ERR-MSG                            
054800        END-CALL                                                          
054900        IF WS-ERR <> 0                                                    
055000         DISPLAY "UNABLE TO CHANGE LOGON"                                 
055100         DISPLAY WS-ERR-MSG                                               
055200         CALL INTRINSIC "QUIT" USING \3\ END-CALL                         
055300        ELSE                                                              
055400         CALL   INTRINSIC "WHO"                                           
055500          USING  WHO-MODE WHO-CAPABILITY WHO-LATTR WHO-USERN              
055600                 WHO-GROUPN WHO-ACCTN WHO-HOMEN WHO-TERM-DEV-NO           
055700         END-CALL                                                         
055800        END-IF                                                            
055900        INITIALIZE WS-ERR-MSG                                             
056000        STRING "J3KDIAG," DELIMITED BY SIZE                               
056100                WHO-USERN DELIMITED BY SPACE                              
056200                "."       DELIMITED BY SIZE                               
056300                WHO-ACCTN DELIMITED BY SPACE                              
056400                ","       DELIMITED BY SIZE                               
056500                WHO-GROUPN DELIMITED BY SPACES                            
056600             INTO WS-ERR-MSG                                              
056700        END-STRING                                                        
056800        MOVE  ws-err-msg(1:79) TO M                                       
056900        PERFORM MSG-PROCESS                                               
057000       END-IF                                                             
057100       MOVE DBMSTR-DB-NAME TO  DbName(Db-Ptr)                             
057200*       Display " Opening " DbName(Db-Ptr)                        060713MA
057300       PERFORM OPEN-IMAGE-DB                                              
057400       If Not No-Image-Errors                                     060622MA
057500        Display "* Image Error occured " Condition-Word           060622MA
057600        If Condition-Word = -92                                   060622MA
057700         Display "* Virgin Database Root File (NO DATASETS)"      060622MA
057800        End-if                                                    060622MA
057900        Display "* Skipping Database"                             060622MA
058000        MOVE 0 TO CONDITION-WORD                                          
058100       Else                                                       060622MA
058200        PERFORM GET-BASE-INFO                                     060622MA
058300        PERFORM OUTPUT-CREATE-BASE                                060622MA
058400        Perform GET-BASE-ITEMS                                    060622MA
058500        PERFORM VARYING DS-IDX FROM 1 BY 1                        060622MA
058600          UNTIL ( IMAGE-ERRORS )                                  060622MA
058700             OR ( DS-IDX > DBI-203-SetCount )                     060622MA
058800         Perform GET-SET-INFO                                     060622MA
058900         Perform GET-SET-ITEMS                                    060622MA
059000         PERFORM GET-SET-PATHS                                    060622MA
059100         PERFORM OUTPUT-CREATE-TABLE                              060622MA
059200         PERFORM OUTPUT-CREATE-INDEXES                            060818MA
059300        End-Perform                                               060622MA
059400        PERFORM GET-DBMSTR-REREAD                                         
059500        PERFORM LOCK-DBMSTR                                               
059600        MOVE MY-DB-COST TO DBMSTR-DB-COST                                 
059700        MOVE MY-DB-BYTES TO DBMSTR-DB-BYTES                               
059800        MOVE MY-DB-RECCNT TO DBMSTR-DB-RECCNT                             
059900        PERFORM UPDATE-DBMSTR                                             
060000        PERFORM UNLOCK-DBMSTR                                             
060100        INITIALIZE MY-DB-RECCNT MY-DB-BYTES MY-DB-COST                    
060200        Perform CLOSE-IMAGE-DB                                    060621MA
060300       End-If                                                             
060400      END-IF                                                              
060500     End-perform.                                                         
060600     Move 0 To Condition-Word.                                    060622MA
060700     Go To 9999-RETURN.                                           060620MA
060800*=================================================================060620MA
060900$PAGE  "Major SubParagraphs"                                      060620MA
061000*=================================================================060615MA
061100 INITIALIZATION.                                                  060615MA
061200D    DISPLAY "INITIALIZATION".                                    060621MA
061300     MOVE FUNCTION CURRENT-DATE TO FULL-CURRENT-DATE.             060615MA
061400     MOVE C-DATE TO RAW-DATE.                                     060615MA
061500     MOVE CORR RAW-DATE TO EDITED-DATE.                           060615MA
061600     CALL   INTRINSIC "WHO"                                       060713MA
061700     USING  WHO-MODE WHO-CAPABILITY WHO-LATTR WHO-USERN           060713MA
061800            WHO-GROUPN WHO-ACCTN WHO-HOMEN WHO-TERM-DEV-NO.       060713MA
061900     INITIALIZE CSTR.                                             060713MA
062000     Perform ShowTime.                                            060615MA
062100     PERFORM GET-HPSUSAN.                                                 
062200     Initialize DATABASE-TABLE My-BaseName.                               
062300     MOVE 128 TO GINFO-LEN.                                               
062400     INITIALIZE GINFO-STR GINFO-PARM.                                     
062500     MOVE 9 TO MIGDB.                                                     
062600     MOVE "MIGDB.PUB.J3K" TO DbName(MIGDB)                                
062700     MOVE "J3K;" TO NULL-ITEM.                                            
062800     CALL "DBOPEN" USING                                                  
062900      DATA-BASE-NAME(MIGDB) NULL-ITEM MODE-1 STATUS-AREA.                 
063000     IF IMAGE-ERRORS PERFORM 9000-IMAGE-ERROR.                            
063100     MOVE STATUS-AREA TO MIGDB-STATUS.                                    
063200     INITIALIZE SrvMST-BUFFER.                                            
063300     MOVE ";" TO NULL-ITEM.                                               
063400     Move 1 to Search-keyI32.                                             
063500     Perform Get-SRVMST-Keyed.                                            
063600     If No-Entry                                                          
063700      Display "SERVER #1 IS MISSING"                                      
063800      Call Intrinsic "QUIT" Using \1\.                                    
063900     IF SRVMST-SVR-SUSAN <> MYHPSUSAN                                     
064000      Display "The HPSUSAN " MyHpSusan " is not valid"                    
064100      Call Intrinsic "QUIT" Using \2\.                                    
064200     MOVE FUNCTION CURRENT-DATE TO FULL-CURRENT-DATE.                     
064300     MOVE C-DATE TO RAW-DATE.                                             
064400     MOVE CORR RAW-DATE TO EDITED-DATE.                                   
064500     CALL   INTRINSIC "WHO"                                               
064600     USING  WHO-MODE WHO-CAPABILITY WHO-LATTR WHO-USERN                   
064700            WHO-GROUPN WHO-ACCTN WHO-HOMEN WHO-TERM-DEV-NO.               
064800     Display  "Server: " SRVMST-SVR-NAME.                                 
064900     Display  "Databases: " SRVMST-SVR-DSCNT.                             
065000     Display  "HPSUSAN: " SRVMST-SVR-SUSAN.                               
065100     Display  "MPE/iX version: " SRVMST-SVR-MPEVERSION.                   
065200     Initialize MYCOST MY-DB-COST MY-DB-BYTES                     060615MA
065300                CSTR CERR CPARM CMSG.                                     
065400     Initialize Script-Str.                                       060622MA
065500                                                                  060622MA
065600*-----------------------------------------------------------------060619MA
065700 OUTPUT-CREATE-BASE.                                              060619MA
065800D    DISPLAY "OUTPUT-CREATE-BASE".                                060621MA
065900     Perform GET-BASE-SETS.                                               
066000     INITIALIZE DBMSTR-BUFFER SEARCH-KEY.                                 
066100     MOVE DBI-406-DbName TO SEARCH-KEY.                                   
066200     MOVE "DB-NAME;" TO SEARCH-ITEM.                                      
066300     PERFORM FIND-DBMSTR.                                                 
066400     IF NO-ENTRY                                                          
066500      DISPLAY DBI-406-DbName "NOT FOUND"                                  
066600     ELSE                                                                 
066700      PERFORM GET-DBMSTR-CHAINED.                                         
066800     MOVE DBI-203-SetCount TO DBMSTR-DB-SETCNT.                           
066900     MOVE  0 TO DBMSTR-DB-RECCNT.                                         
067000     COMPUTE DBMSTR-DB-COST = DBI-203-SetCount * 100.                     
067100*     DISPLAY "LOCKING DBMSTR"                                            
067200     PERFORM LOCK-DBMSTR.                                                 
067300     PERFORM UPDATE-DBMSTR.                                               
067400*     DISPLAY "UN LOCKING DBMSTR"                                         
067500     PERFORM UNLOCK-DBMSTR.                                               
067600     MOVE DBI-203-SetCount TO MY-DB-SETCNT.                               
067700     INITIALIZE MY-DB-COST MY-DB-BYTES.                                   
067800                                                                          
067900*-----------------------------------------------------------------060619MA
068000 OUTPUT-CREATE-TABLE.                                             060619MA
068100D    DISPLAY "OUTPUT-CREATE-TABLE".                               060621MA
068200     INITIALIZE DSMSTR-BUFFER SEARCH-KEY.                                 
068300     PERFORM GET-NEXT-DSUNIQ.                                             
068400     MOVE NXUNIQ-UNIQ-NUM TO DSMSTR-DS-UNIQUE.                            
068500     MOVE DSMSTR-DS-UNIQUE TO SEARCH-KEYI32.                              
068600     MOVE "DS-UNIQUE;" TO SEARCH-ITEM.                                    
068700     PERFORM FIND-DSMSTR.                                                 
068800     IF NOT NO-ENTRY                                                      
068900*      DISPLAY "LOCKING DSMSTR"                                           
069000      PERFORM LOCK-DSMSTR                                                 
069100      PERFORM DELETE-DSMSTR                                               
069200*      DISPLAY "UN LOCKING DSMSTR"                                        
069300      PERFORM UNLOCK-DSMSTR.                                              
069400     INITIALIZE DSMSTR-BUFFER SEARCH-KEY.                                 
069500     MOVE 1                        TO DSMSTR-SVR-UNIQUE.                  
069600     MOVE DBMSTR-DB-UNIQUE         TO DSMSTR-DB-UNIQUE.                   
069700     MOVE NXUNIQ-UNIQ-NUM          TO DSMSTR-DS-UNIQUE.                   
069800     MOVE DBI-SETNAME              TO DSMSTR-DS-NAME.                     
069900     MOVE DBI-SetName              TO SOURCE-FIELD.                       
070000     PERFORM SET-TITLE-CASE.                                              
070100     MOVE TARGET-FIELD TO DBI-SetName.                                    
070200     MOVE DBI-SetName              TO DSMSTR-SQL-NAME.                    
070300     MOVE DBI-SetType              TO DSMSTR-DS-TYPE.                     
070400     MOVE DBI-SetEntryCnt          TO DSMSTR-DS-RECCNT.                   
070500     COMPUTE DSMSTR-DS-RECLEN = DBI-SetEntryLen * 2.                      
070600     COMPUTE DSMSTR-DS-BYTES = DBI-SetEntryCnt * DSMSTR-DS-RECLEN.        
070700     COMPUTE DSMSTR-DS-COST = DBI-SetEntryCnt * 0.015.                    
070800     ADD DSMSTR-DS-COST   TO MY-DB-COST  MY-SVR-REC-COST .                
070900     ADD DSMSTR-DS-BYTES  TO MY-DB-BYTES.                                 
071000     ADD DSMSTR-DS-RECCNT TO MY-DB-RECCNT MY-SVR-RECCNT.                  
071100     ADD 1                TO MY-SVR-DSCNT.                                
071200*     DISPLAY "LOCKING DSMSTR".                                           
071300     PERFORM LOCK-DSMSTR.                                                 
071400     PERFORM PUT-DSMSTR.                                                  
071500*     DISPLAY "UN LOCKING DSMSTR".                                        
071600     PERFORM UNLOCK-DSMSTR.                                               
071700     Move "0" TO Last-Column-Sw.                                          
071800     MOVE 1 TO SETX                                                       
071900     MOVE 0 TO SETY.                                                      
072000     ADD DBI-104-ItemCount TO  MY-SVR-FLDCNT.                             
072100     Perform Varying DI-Idx From 1 By 1                                   
072200       Until ( DI-Idx > DBI-104-ItemCount )                               
072300      Initialize Z5 Z4 Z3 Z2 Z1 Db-Info-102                               
072400      CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR)                          
072500       DBI-104-ItemNumber(DI-IDX) MODE-102                                
072600        STATUS-AREA Db-Info-102                                           
072700      END-CALL                                                            
072800      IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR END-IF                       
072900      IF DBI-ItemSubCount = 1                                             
073000       Perform DBPUT-ITEM-INFO                                            
073100      ELSE                                                                
073200       PERFORM DBPUT-SUBITEM-INFO                                         
073300      END-IF                                                              
073400     END-PERFORM.                                                         
073500*-----------------------------------------------------------------        
073600 OUTPUT-CREATE-INDEXES.                                                   
073700D    DISPLAY "OUTPUT-CREATE-INDEXES".                                     
073800     Perform Varying DP-Idx From 1 By 1                                   
073900       Until ( DP-Idx > DBI-301-ItemCount )                               
074000      Perform GET-MSet-INFO                                               
074100      Perform GET-SearchItem-INFO                                         
074200      Move SrI-ItemSubLen To Z1 Z2 Z3 Z4 Z5                               
074300      Move Z1 To Chr6                                                     
074400      If SrI-ItemSubLen >    9 Move Z2 To Chr6 End-If                     
074500      If SrI-ItemSubLen >   99 Move Z3 To Chr6 End-If                     
074600      If SrI-ItemSubLen >  999 Move Z4 To Chr6 End-If                     
074700      If SrI-ItemSubLen > 9999 Move Z5 To Chr6 End-If                     
074800      Initialize Script-Str                                               
074900      String "CREATE  INDEX `"     Delimited By Size                      
075000             SrI-ItemName          Delimited By Space                     
075100             SrI-ItemType          Delimited By Space                     
075200             Chr6                  Delimited By Space                     
075300             "` ON `dbo`.`"        Delimited By Size                      
075400             DBI-SetName           Delimited By Space                     
075500             "`(`"                 Delimited By Size                      
075600             SrI-ItemName          Delimited By Space                     
075700             "`)"                  Delimited By Size                      
075800        InTo Script-Str                                                   
075900      End-String                                                          
076000*      Write Script-File                                                  
076100      Initialize Script-Str                                               
076200      Move "GO" To Script-Str                                             
076300*     Write Script-File                                                   
076400      Initialize Script-Str                                               
076500      IF MSI-SETTYPE = "M"                                                
076600       STRING "ALTER TABLE `dbo`.`" Delimited By Size                     
076700              DBI-SetName           Delimited By Space                    
076800                "` ADD "            Delimited By Size                     
076900        InTo Script-Str                                                   
077000       End-String                                                         
077100*       Write Script-File                                                 
077200       Initialize Script-Str                                              
077300                                                                          
077400       STRING "CONSTRAINT `PK_"     Delimited By Size                     
077500              DBI-SetName           Delimited By Space                    
077600               "_"                  Delimited By Size                     
077700              MSI-SETNAME           Delimited By Space                    
077800               "` FOREIGN KEY"      Delimited By Size                     
077900        InTo Script-Str                                                   
078000       End-String                                                         
078100*       Write Script-File                                                 
078200       Initialize Script-Str                                              
078300                                                                          
078400       MOVE "( " To Script-Str                                            
078500*       Write Script-File                                                 
078600       Initialize Script-Str                                              
078700                                                                          
078800       STRING " `"                  Delimited By Size                     
078900       SrI-ItemName                 Delimited By Space                    
079000       "`"                          Delimited By Size                     
079100        InTo Script-Str                                                   
079200       End-String                                                         
079300*       Write Script-File                                                 
079400       Initialize Script-Str                                              
079500                                                                          
079600       STRING ") REFERENCES `dbo`.`" Delimited By Size                    
079700       MSI-SETNAME                   Delimited By Space                   
079800       "` ("                         Delimited By Size                    
079900        InTo Script-Str                                                   
080000       End-String                                                         
080100*       Write Script-File                                                 
080200       Initialize Script-Str                                              
080300                                                                          
080400       STRING "`"                    Delimited By Size                    
080500       SrI-ItemName                  Delimited By Space                   
080600       "`"                           Delimited By Size                    
080700        InTo Script-Str                                                   
080800       End-String                                                         
080900*       Write Script-File                                                 
081000       Initialize Script-Str                                              
081100                                                                          
081200       MOVE ")" To Script-Str                                             
081300*       Write Script-File                                                 
081400       Initialize Script-Str                                              
081500                                                                          
081600       MOVE "GO" To Script-Str                                            
081700*       Write Script-File                                                 
081800       Initialize Script-Str                                              
081900      END-IF                                                              
082000     End-Perform.                                                         
082100*=================================================================        
082200$page "MISC SubParagraphs"                                                
082300*=================================================================        
082400 GET-NUM.                                                                 
082500D    DISPLAY "GET-NUM".                                                   
082600     INITIALIZE NUM2 NUMDEC NUMERR.                                       
082700     CALL "NUMGET" USING NUM1 NUM2 NUMDEC NUMERR.                         
082800     IF NUMERR NOT = 0 MOVE 0 TO NUM2.                                    
082900     IF NUMDEC NOT = 0 MOVE 0 TO NUM2.                                    
083000*---------------------------------------------------------                
083100 MPE-COMMAND.                                                             
083200D    DISPLAY "MPE-COMMAND".                                               
083300     Move 2 To CMSG.                                              060713MA
083400     CALL INTRINSIC "HPCICOMMAND" USING                                   
083500          CSTR CERR CPARM CMSG.                                           
083600*---------------------------------------------------------                
083700 SHOWTIME.                                                                
083800     CALL INTRINSIC "HPCICOMMAND" USING                                   
083900          SHOWTIME-STR CERR CPARM CMSG.                                   
084000*---------------------------------------------------------                
084100 GET-SearchItem-INFO.                                                     
084200D    DISPLAY "GET-SearchItem-INFO".                                       
084300     Initialize SI-IDX Z5 Z4 Z3 Z2 Z1 Db-Info-102.                060705MA
084400     CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR)                           
084500      DBI-301-SearchNumber(DP-IDX) MODE-102                       060705MA
084600       STATUS-AREA Sr-Info-102.                                           
084700     IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                              
084800     MOVE SrI-ItemName TO SOURCE-FIELD.                           060706MA
084900     PERFORM SET-TITLE-CASE.                                      060706MA
085000     MOVE TARGET-FIELD TO SrI-ItemName.                           060706MA
085100     Move SrI-ItemSubLen To Z5 Z4 Z3 Z2 Z1 .                              
085200                                                                          
085300*---------------------------------------------------------                
085400 GET-SET-PATHS.                                                           
085500D    DISPLAY "GET-SET-PATHS".                                             
085600* Mode 301 identifies paths in a set.                                     
085700     Initialize Db-Info-301.                                              
085800     CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR)                           
085900      DBI-203-SetNumber(DS-IDX) MODE-301 STATUS-AREA Db-Info-301.         
086000     IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                              
086100*-----------------------------------------------------------------        
086200 GET-SET-ITEMS.                                                           
086300D    DISPLAY "GET-SET-ITEMS".                                             
086400*       Mode 104 identifies data items in a set                           
086500       Initialize Db-Info-104                                             
086600       CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR)                         
086700       DBI-203-SetNumber(DS-IDX) MODE-104                                 
086800        STATUS-AREA Db-Info-104                                           
086900       IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                            
087000*-----------------------------------------------------------------        
087100 GET-SET-INFO.                                                            
087200D    DISPLAY "GET-SET-INFO".                                              
087300*       Mode 202 describes a specific data set.                           
087400       Initialize Db-Info-202                                             
087500       CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR)                         
087600        DBI-203-SetNumber(DS-IDX) MODE-202                        060705MA
087700         STATUS-AREA Db-Info-202                                          
087800       IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                            
087900*-----------------------------------------------------------------        
088000 GET-MSET-INFO.                                                           
088100D    DISPLAY "GET-MSET-INFO".                                     060705MA
088200*       Mode 202 describes a specific data set.                           
088300       Initialize Ms-Info-202                                     060705MA
088400       CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR)                         
088500        DBI-301-SetNumber(DP-IDX) MODE-202                        060705MA
088600         STATUS-AREA Ms-Info-202                                          
088700       IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                            
088800     MOVE MSI-SetName TO SOURCE-FIELD.                            060706MA
088900     PERFORM SET-TITLE-CASE.                                      060706MA
089000     MOVE TARGET-FIELD TO MSI-SetName.                            060706MA
089100                                                                  060705MA
089200*-----------------------------------------------------------------        
089300 GET-BASE-ITEMS.                                                          
089400D    DISPLAY "GET-BASE-ITEMS".                                            
089500*  Mode 103 Identifies data items available in the database               
089600      Initialize Db-Info-103                                              
089700      CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR) NULL-ITEM                
089800                   MODE-103 STATUS-AREA Db-Info-103                       
089900      IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                             
090000*-----------------------------------------------------------------        
090100 GET-BASE-SETS.                                                           
090200D    DISPLAY "GET-BASE-SETS".                                             
090300*  Mode 203 Identifies all data sets available in a database              
090400      Initialize Db-Info-203.                                             
090500      CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR) NULL-ITEM                
090600                  MODE-203 STATUS-AREA Db-Info-203                        
090700      IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                             
090800*-----------------------------------------------------------------        
090900 OPEN-IMAGE-DB.                                                           
091000     STRING  "Examining: " DbName(Db-Ptr)                                 
091010      DELIMITED BY SIZE INTO M.                                           
091020     PERFORM MSG-PROCESS.                                                 
091100     CALL "DBOPEN" USING                                                  
091200      DATA-BASE-NAME(DB-PTR) NULL-ITEM MODE-5 STATUS-AREA.                
091300*     IF IMAGE-ERRORS PERFORM 9000-IMAGE-ERROR.                           
091400*-----------------------------------------------------------------        
091500 GET-BASE-INFO.                                                           
091600*  DbControl mode 20 Disables an Error Message, ref New Limits            
091700D    DISPLAY "DBCONTROL 20".                                              
091800     CALL "DBCONTROL" USING DATA-BASE-NAME(DB-PTR) NULL-ITEM              
091900                MODE-20  STATUS-AREA.                                     
092000*  Mode 406 Returns information about the database                        
092100     Initialize Db-Info-406.                                              
092200D    DISPLAY "DBINFO 406".                                                
092300     CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR) NULL-ITEM                 
092400                   MODE-406 STATUS-AREA Db-Info-406.                      
092500     IF IMAGE-ERRORS PERFORM 9000-IMAGE-ERROR.                            
092600     Move DBI-406-Version To Split-Word.                                  
092700     Move Split-Word-1 To Chr3.                                           
092800     Move %0 To Split-Word-1.                                             
092900     Move Split-Word To DBI-406-Version.                                  
093000     Move DBI-406-Version To z2.                                          
093100     Move DBI-406-OpenMode To z1.                                         
093200*     Display "Image DataBase Version: " Chr3(1:1) "." z2.        060713MA
093300     CALL "GETBITS" USING DBI-406-Options BINARY-VALUE.                   
093400     MOVE BINARY-VALUE TO Db-Info-406-Word-17.                            
093500     IF Database-Newlimits                                                
093600      DISPLAY "This database is using the *NEW* "                         
093700              "MPE 7.0 Tubor Image Limits.".                      060705MA
093800*-----------------------------------------------------------------        
093900 CLOSE-IMAGE-DB.                                                          
094000D    DISPLAY "CLOSE-IMAGE-DB".                                            
094100      CALL "DBCLOSE" USING DATA-BASE-NAME(DB-PTR)                         
094200                           NULL-ITEM MODE-1 STATUS-AREA.                  
094300*---------------------------------------------------------                
094400*---------------------------------------------------------                
094500 COPY SRVMST0 OF J3KLIB.                                                  
094600 COPY SRVMST1 OF J3KLIB.                                                  
094700 COPY SRVMST2 OF J3KLIB.                                                  
094800 COPY SRVMST3 OF J3KLIB.                                                  
094900 COPY SRVMST4 OF J3KLIB.                                                  
095000 COPY SRVMST5 OF J3KLIB.                                                  
095100 COPY SRVMST6 OF J3KLIB.                                                  
095200 COPY SRVMST7 OF J3KLIB.                                                  
095300 COPY SRVMST8 OF J3KLIB.                                                  
095400                                                                          
095500 COPY DBMSTR0 OF J3KLIB.                                                  
095600 COPY DBMSTR1 OF J3KLIB.                                                  
095700 COPY DBMSTR2 OF J3KLIB.                                                  
095800 COPY DBMSTR3 OF J3KLIB.                                                  
095900 COPY DBMSTR4 OF J3KLIB.                                                  
096000 COPY DBMSTR5 OF J3KLIB.                                                  
096100 COPY DBMSTR6 OF J3KLIB.                                                  
096200 COPY DBMSTR7 OF J3KLIB.                                                  
096300 COPY DBMSTR8 OF J3KLIB.                                                  
096400 COPY DBMSTR9 OF J3KLIB.                                                  
096500                                                                          
096600 COPY DSMSTR0 OF J3KLIB.                                                  
096700 COPY DSMSTR1 OF J3KLIB.                                                  
096800 COPY DSMSTR2 OF J3KLIB.                                                  
096900 COPY DSMSTR3 OF J3KLIB.                                                  
097000 COPY DSMSTR4 OF J3KLIB.                                                  
097100 COPY DSMSTR5 OF J3KLIB.                                                  
097200 COPY DSMSTR6 OF J3KLIB.                                                  
097300 COPY DSMSTR7 OF J3KLIB.                                                  
097400 COPY DSMSTR8 OF J3KLIB.                                                  
097500                                                                          
097600 COPY DBFLDS0 OF J3KLIB.                                                  
097700 COPY DBFLDS1 OF J3KLIB.                                                  
097800 COPY DBFLDS2 OF J3KLIB.                                                  
097900 COPY DBFLDS3 OF J3KLIB.                                                  
098000 COPY DBFLDS4 OF J3KLIB.                                                  
098100 COPY DBFLDS5 OF J3KLIB.                                                  
098200 COPY DBFLDS6 OF J3KLIB.                                                  
098300 COPY DBFLDS7 OF J3KLIB.                                                  
098400 COPY DBFLDS8 OF J3KLIB.                                                  
098500                                                                          
098600 COPY NXUNIQ0 OF J3KLIB.                                                  
098700 COPY NXUNIQ1 OF J3KLIB.                                                  
098800 COPY NXUNIQ2 OF J3KLIB.                                                  
098900 COPY NXUNIQ3 OF J3KLIB.                                                  
099000 COPY NXUNIQ4 OF J3KLIB.                                                  
099100 COPY NXUNIQ5 OF J3KLIB.                                                  
099200 COPY NXUNIQ6 OF J3KLIB.                                                  
099300 COPY NXUNIQ7 OF J3KLIB.                                                  
099400 COPY NXUNIQ8 OF J3KLIB.                                                  
099500*---------------------------------------------------------                
099600*9000-IMAGE-ERROR.                                                        
099700*D    DISPLAY "9000-IMAGE-ERROR".                                         
099800*     CALL "DBEXPLAIN" USING STATUS-AREA.                                 
099900*---------------------------------------------------------                
099910 9000-IMAGE-ERROR.                                                        
100010D    DISPLAY "9000-IMAGE-ERROR".                                          
100020     MOVE 132 TO STRING-POINTER.                                          
100030     INITIALIZE ERROR-MSG SCRIPT-STR.                                     
100040     CALL "DBERROR" USING STATUS-AREA ERROR-MSG STRING-POINTER.           
100050     MOVE DATA-BASE-NAME(DB-PTR)(3:) TO SCRIPT-STR.                       
100060     MOVE ERROR-MSG(1:STRING-POINTER) TO SCRIPT-STR(28:).                 
100070     WRITE Script-File.                                                   
100080*---------------------------------------------------------                
100100 9999-RETURN.                                                             
100200D    DISPLAY "9999-RETURN".                                               
100300     GOBACK.                                                              
100400*-----------------------------------------------------------------060706MA
100500 SET-TITLE-CASE.                                                  060706MA
100600     INITIALIZE TARGET-FIELD.                                     060706MA
100700     MOVE "0" TO DWNSHFT-SW.                                      060706MA
100800     PERFORM VARYING MYIDX FROM 1 BY 1  UNTIL MYIDX > 63          060706MA
100900      INITIALIZE ASCII-INT                                        060706MA
101000      MOVE SOURCE-FIELD(MYIDX:1) TO ASCII-CHAR                    060706MA
101100      IF ASCII-INT > 32 AND ASCII-INT < 48                        060706MA
101200       MOVE 95 TO ASCII-INT                                       060706MA
101300      END-IF                                                      060706MA
101400      IF OK-TO-DOWNSHIFT                                          060706MA
101500       IF ASCII-INT >= 65 AND ASCII-INT <= 90                     060706MA
101600        ADD 32 TO ASCII-INT                                       060706MA
101700       END-IF                                                     060706MA
101800       IF ASCII-INT = 95                                          060706MA
101900        MOVE "0" TO DWNSHFT-SW                                    060706MA
102000       END-IF                                                     060706MA
102100      ELSE                                                        060706MA
102200       MOVE "1" TO DWNSHFT-SW                                     060706MA
102300      END-IF                                                      060706MA
102400      MOVE ASCII-CHAR TO TARGET-FIELD(MYIDX:1)                    060706MA
102500     END-PERFORM.                                                 060706MA
102600     INSPECT TARGET-FIELD REPLACING ALL "-" BY "_".               060818MA
102700*------------------------------------------------                         
102800 7500-INFO-PARSE.                                                         
102900     INITIALIZE STRING-POINTER PARSED-STRING NEXT-STRING                  
103000               GX GY PX  ITEMS-PARSED.                                    
103100     PERFORM VARYING STRING-POINTER FROM 1 BY 1                           
103200       UNTIL ( PARSE-IS-COMPLETE )                                        
103300          OR ( STRING-POINTER > GINFO-LEN )                               
103400      IF GINFO-STR(STRING-POINTER:1) = "~"                                
103500         MOVE 1 TO GX                                                     
103600         COMPUTE GY = ( STRING-POINTER - 1 ) END-COMPUTE                  
103700         COMPUTE PX = ( STRING-POINTER + 1 ) END-COMPUTE                  
103800         MOVE GINFO-STR(GX:GY) TO PARSED-STRING                           
103900         MOVE GINFO-STR(PX:) TO NEXT-STRING                               
104000         MOVE NEXT-STRING TO GINFO-STR                                    
104100         ADD 1 TO ITEMS-PARSED                                            
104200D        DISPLAY "POINTER:" STRING-POINTER                                
104300D        DISPLAY "PARSED: " ITEMS-PARSED                                  
104400D        DISPLAY "STRING [" PARSED-STRING(1:GINFO-LEN) "]"                
104500D        DISPLAY "NEXT   [" NEXT-STRING(1:GINFO-LEN) "]"                  
104600         EVALUATE ITEMS-PARSED                                            
104700          WHEN 1 MOVE PARSED-STRING TO My-BaseName                        
104800         END-EVALUATE                                                     
104900         MOVE 1 TO STRING-POINTER                                         
105000      END-IF                                                              
105100     END-PERFORM.                                                         
105200*--------------------------------------------------------                 
105300 GET-HPSUSAN.                                                             
105400     MOVE "HPSUSAN~" TO HPVAR-NAME.                                       
105500     MOVE 1 TO HPVAR-ITEMNUM.                                             
105600     INITIALIZE HPVAR-ITEM HPVAR-STAT.                                    
105700     CALL INTRINSIC "HPCIGETVAR" USING HPVAR-NAME                         
105800         HPVAR-STAT HPVAR-ITEMNUM MYHPSUSAN.                              
105900     DISPLAY "HPSUSAN: " MYHPSUSAN.                                       
106000*----------------------------------------------------------------         
106100 GET-NEXT-DSUNIQ.                                                         
106200     MOVE "DSMSTR" TO SEARCH-KEY.                                         
106300     MOVE 20 TO MYINCREMENT.                                              
106400*     DISPLAY "LOCKING NXUNIQ".                                           
106500     PERFORM  LOCK-NXUNIQ.                                                
106600     PERFORM GET-NXUNIQ-KEYED.                                            
106700     IF NO-ENTRY                                                          
106800      MOVE "DSMSTR" TO NXUNIQ-UNIQ-ID                                     
106900      MOVE MYINCREMENT TO NXUNIQ-UNIQ-NUM                                 
107000      PERFORM PUT-NXUNIQ                                                  
107100     ELSE                                                                 
107200      ADD MYINCREMENT TO NXUNIQ-UNIQ-NUM                                  
107300      PERFORM UPDATE-NXUNIQ.                                              
107400*     DISPLAY "UN LOCKING NXUNIQ".                                        
107500     PERFORM UNLOCK-NXUNIQ.                                               
107600*----------------------------------------------------------------         
107700 GET-NEXT-FLDUNIQ.                                                        
107800     MOVE "FLDUNIQ" TO SEARCH-KEY.                                        
107900     MOVE 200 TO MYINCREMENT.                                             
108000*     DISPLAY "LOCKING NXUNIQ".                                           
108100     PERFORM  LOCK-NXUNIQ.                                                
108200     PERFORM GET-NXUNIQ-KEYED.                                            
108300     IF NO-ENTRY                                                          
108400      MOVE "FLDUNIQ" TO NXUNIQ-UNIQ-ID                                    
108500      MOVE MYINCREMENT TO NXUNIQ-UNIQ-NUM                                 
108600      PERFORM PUT-NXUNIQ                                                  
108700     ELSE                                                                 
108800      ADD MYINCREMENT TO NXUNIQ-UNIQ-NUM                                  
108900      PERFORM UPDATE-NXUNIQ.                                              
109000*     DISPLAY "UN LOCKING NXUNIQ".                                        
109100     PERFORM UNLOCK-NXUNIQ.                                               
109200*---------------------------------------------------------                
109300 DBPUT-SUBITEM-INFO.                                                      
109400D    DISPLAY "DBPUT-SUBITEM-INFO".                                        
109500     MOVE 1                 TO DBFLDS-SVR-UNIQUE.                         
109600     MOVE DSMSTR-DS-UNIQUE  TO DBFLDS-DS-UNIQUE.                          
109700     MOVE DBMSTR-DB-UNIQUE  TO DBFLDS-DB-UNIQUE.                          
109800     PERFORM GET-NEXT-FLDUNIQ.                                            
109900     MOVE NXUNIQ-UNIQ-NUM   TO DBFLDS-IFLD-UNIQUE.                        
110000     MOVE DBFLDS-IFLD-UNIQUE TO SEARCH-KEYI32.                            
110100     MOVE "IFLD-UNIQUE;" TO SEARCH-ITEM.                                  
110200     PERFORM FIND-DBFLDS.                                                 
110300     IF NOT NO-ENTRY                                                      
110400      PERFORM GET-DBFLDS-CHAINED                                          
110500*      DISPLAY "LOCKING DBFLDS"                                           
110600      PERFORM LOCK-DBFLDS                                                 
110700      PERFORM DELETE-DBFLDS                                               
110800*      DISPLAY "UN LOCKING DBFLDS"                                        
110900      PERFORM UNLOCK-DBFLDS.                                              
111000     INITIALIZE DBFLDS-BUFFER SEARCH-KEY.                                 
111100     MOVE 1                             TO DBFLDS-SVR-UNIQUE.             
111200     MOVE DSMSTR-DS-UNIQUE              TO DBFLDS-DS-UNIQUE.              
111300     MOVE NXUNIQ-UNIQ-NUM               TO DBFLDS-IFLD-UNIQUE.            
111400     MOVE DBMSTR-DB-UNIQUE              TO DBFLDS-DB-UNIQUE.              
111500     MOVE DBI-ItemName                  TO DBFLDS-IFLD-NAME.              
111600     INITIALIZE COLUMN-BYTES.                                             
111700     IF DBI-ItemType = "I" OR "J" OR "K" OR "R" OR "E"                    
111800      COMPUTE COLUMN-BYTES = ( DBI-ItemSubLen * 2 )                       
111900     ELSE                                                                 
112000      MOVE DBI-ItemSubLen TO COLUMN-BYTES.                                
112100                                                                          
112200     IF DBI-ItemType = "P"                                                
112300      COMPUTE COLUMN-BYTES = DBI-ItemSubLen / 2.                          
112400     MOVE COLUMN-BYTES               TO DBFLDS-IFLD-LEN.                  
112410     MOVE DBI-ItemSubLen                TO DBFLDS-IFLD-LEN.               
112510     MOVE DBI-ItemSubCount           TO DBFLDS-IFLD-SUBLEN.               
112600     MOVE DBI-ItemName TO SOURCE-FIELD.                                   
112700     PERFORM SET-TITLE-CASE.                                              
112800     MOVE TARGET-FIELD TO DBI-ItemName.                                   
112900     MOVE DBI-ItemType                  TO DBFLDS-IFLD-TYPE.              
113000     MOVE SPACES                        TO DBFLDS-SQL-TYPE.               
113100     MOVE "REDEFINED"                   TO DBFLDS-IFLD-CVT-METHD.         
113200     MOVE SPACES                        TO DBFLDS-IFLD-MAX-VAL.           
113300     MOVE SPACES                        TO DBFLDS-IFLD-MIN-VAL.           
113400     MOVE 0                     TO DBFLDS-IFLD-X.                         
113500     MOVE 0                     TO DBFLDS-IFLD-Y.                         
113600     Move DBI-ItemSubLen To Z5 Z4 Z3 Z2 Z1.                               
113700*     DISPLAY "LOCKING DBFLDS".                                           
113800     PERFORM LOCK-DBFLDS.                                                 
113900     PERFORM PUT-DBFLDS.                                                  
114000*     DISPLAY "UN LOCKING DBFLDS".                                        
114100     PERFORM UNLOCK-DBFLDS.                                               
114200     Perform Varying Si-Idx From 1 By 1                                   
114300       Until (Si-Idx > DBI-ItemSubCount)                                  
114400          Move Si-Idx TO Y1 Y2 Y3                                         
114410      PERFORM GET-NEXT-FLDUNIQ                                            
114510      MOVE NXUNIQ-UNIQ-NUM   TO DBFLDS-IFLD-UNIQUE                        
114520      Move Y1 To Chr3                                                     
114600      IF SI-IDX > 9 MOVE Y2 TO CHR3 END-IF                                
114700      IF SI-IDX > 99 MOVE Y3 TO CHR3 END-IF                               
114800      Initialize Script-Str                                               
114900      String                                                              
115000        DBI-ItemName            Delimited By Space                        
115100        "_"                     Delimited by Size                         
115200        Chr3                    Delimited By Space                        
115300        Into Script-Str                                                   
115400      END-STRING                                                          
115500      MOVE SCRIPT-STR                   TO DBFLDS-SQL-NAME                
115600      Evaluate DBI-ItemType Also DBI-ItemSubLen                           
115700       When "U "  Also Any                                                
115800       When "Z "  Also Any                                                
115900        MOVE "VARCHAR"                  TO DBFLDS-SQL-TYPE                
116000        MOVE "asciicopy"                TO DBFLDS-IFLD-CVT-METHD          
116100       When "X "  Also Any                                                
116200        MOVE "VARCHAR"                  TO DBFLDS-SQL-TYPE                
116300        MOVE "asciicopy"                TO DBFLDS-IFLD-CVT-METHD          
116400       When "J "  Also 1                                                  
116500        MOVE "SMALLINT"                 TO DBFLDS-SQL-TYPE                
116600        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
116700       When "J "  Also 2                                                  
116800        MOVE "INT"                      TO DBFLDS-SQL-TYPE                
116900        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
117000       When "J "  Also 4                                                  
117100        MOVE "BIGINT"                   TO DBFLDS-SQL-TYPE                
117200        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
117300       When "I "  Also 1                                                  
117400        MOVE "SMALLINT"                 TO DBFLDS-SQL-TYPE                
117500        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
117600       When "I "  Also 2                                                  
117700        MOVE "INT"                      TO DBFLDS-SQL-TYPE                
117800        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
117900       When "I "  Also 4                                                  
118000        MOVE "BIGINT"                   TO DBFLDS-SQL-TYPE                
118100        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
118200       When "K "  Also 1                                                  
118300        MOVE "INT"                      TO DBFLDS-SQL-TYPE                
118400        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
118500       When "K "  Also 2                                                  
118600        MOVE "BIGINT"                   TO DBFLDS-SQL-TYPE                
118700        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
118800       When "R "  Also 4                                                  
118900        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
119000        MOVE "X8R4V18"                  TO DBFLDS-IFLD-CVT-METHD          
119100       When "R "  Also 2                                                  
119200        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
119300        MOVE "X4R2V18"                  TO DBFLDS-IFLD-CVT-METHD          
119400       When "E "  Also 4                                                  
119500        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
119600        MOVE "X8E4V18"                  TO DBFLDS-IFLD-CVT-METHD          
119700       When "E "  Also 2                                                  
119800        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
119900        MOVE "X4E2V18"                  TO DBFLDS-IFLD-CVT-METHD          
120000       When "P "  Also ANY                                                
120100        MOVE "DECIMAL(18,0)"            TO DBFLDS-SQL-TYPE                
120200        MOVE "pacdec"                   TO DBFLDS-IFLD-CVT-METHD          
120300       When OTHER                                                         
120400        MOVE "VARBINARY"                TO DBFLDS-SQL-TYPE                
120500        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
120600      END-EVALUATE                                                        
120700      MOVE SPACES                        TO DBFLDS-IFLD-MAX-VAL           
120800      MOVE SPACES                        TO DBFLDS-IFLD-MIN-VAL           
120900      MOVE 1                        TO DBFLDS-IFLD-SUBLEN                 
121000      MOVE COLUMN-BYTES TO SETY                                           
121100      MOVE SETX                     TO DBFLDS-IFLD-X                      
121200      MOVE SETY                     TO DBFLDS-IFLD-Y                      
121300      ADD SETY TO SETX                                                    
121400      Move DBI-ItemSubLen To Z5 Z4 Z3 Z2 Z1                               
121500*     DISPLAY "LOCKING DBFLDS"                                            
121600      PERFORM LOCK-DBFLDS                                                 
121700      PERFORM PUT-DBFLDS                                                  
121800*     DISPLAY "UN LOCKING DBFLDS"                                         
121900      PERFORM UNLOCK-DBFLDS                                               
122000     END-Perform.                                                         
122100*---------------------------------------------------------                
122200 DBPUT-ITEM-INFO.                                                         
122300D    DISPLAY "DBPUT-ITEM-INFO".                                           
122400     Initialize Z5 Z4 Z3 Z2 Z1 Db-Info-102.                               
122500     CALL "DBINFO" USING DATA-BASE-NAME(DB-PTR)                           
122600      DBI-104-ItemNumber(DI-IDX) MODE-102                                 
122700       STATUS-AREA Db-Info-102.                                           
122800     IF IMAGE-ERRORS GO TO 9000-IMAGE-ERROR.                              
122900     INITIALIZE DBFLDS-BUFFER SEARCH-KEY.                                 
123000     MOVE 1                 TO DBFLDS-SVR-UNIQUE.                         
123100     MOVE DSMSTR-DS-UNIQUE  TO DBFLDS-DS-UNIQUE.                          
123200     MOVE DBMSTR-DB-UNIQUE  TO DBFLDS-DB-UNIQUE.                          
123300     PERFORM GET-NEXT-FLDUNIQ.                                            
123400     MOVE NXUNIQ-UNIQ-NUM   TO DBFLDS-IFLD-UNIQUE.                        
123500     MOVE DBFLDS-IFLD-UNIQUE TO SEARCH-KEYI32.                            
123600     MOVE "IFLD-UNIQUE;" TO SEARCH-ITEM.                                  
123700     PERFORM FIND-DBFLDS.                                                 
123800     IF NOT NO-ENTRY                                                      
123900      PERFORM GET-DBFLDS-CHAINED                                          
124000*      DISPLAY "LOCKING DBFLDS"                                           
124100      PERFORM LOCK-DBFLDS                                                 
124200      PERFORM DELETE-DBFLDS                                               
124300*      DISPLAY "UN LOCKING DBFLDS"                                        
124400      PERFORM UNLOCK-DBFLDS.                                              
124500     INITIALIZE DBFLDS-BUFFER SEARCH-KEY.                                 
124600     MOVE 1                             TO DBFLDS-SVR-UNIQUE.             
124700     MOVE DSMSTR-DS-UNIQUE              TO DBFLDS-DS-UNIQUE.              
124800     MOVE NXUNIQ-UNIQ-NUM               TO DBFLDS-IFLD-UNIQUE.            
124900     MOVE DBMSTR-DB-UNIQUE              TO DBFLDS-DB-UNIQUE.              
125000     MOVE DBI-ItemName                  TO DBFLDS-IFLD-NAME.              
125100     INITIALIZE COLUMN-BYTES.                                             
125200     IF DBI-ItemType = "I" OR "J" OR "K" OR "R" OR "E"                    
125300      COMPUTE COLUMN-BYTES = ( DBI-ItemSubLen * 2 )                       
125400     ELSE                                                                 
125500      MOVE DBI-ItemSubLen TO COLUMN-BYTES.                                
125600                                                                          
125700     IF DBI-ItemType = "P"                                                
125800      COMPUTE COLUMN-BYTES = DBI-ItemSubLen / 2.                          
125900                                                                          
126000     MOVE DBI-ItemSubLen                TO DBFLDS-IFLD-LEN.               
126100     MOVE DBI-ItemSubCount              TO DBFLDS-IFLD-SUBLEN.            
126200     MOVE DBI-ItemName TO SOURCE-FIELD.                                   
126300     PERFORM SET-TITLE-CASE.                                              
126400     MOVE TARGET-FIELD TO DBI-ItemName.                                   
126500     MOVE DBI-ItemName                  TO DBFLDS-SQL-NAME.               
126600     MOVE DBI-ItemType                  TO DBFLDS-IFLD-TYPE.              
126700     Evaluate DBI-ItemType Also DBI-ItemSubLen                            
126800      When "U "  Also Any                                                 
126900        MOVE "VARCHAR"                  TO DBFLDS-SQL-TYPE                
127000        MOVE "asciicopy"                TO DBFLDS-IFLD-CVT-METHD          
127100      When "Z "  Also Any                                                 
127200        MOVE "VARCHAR"                  TO DBFLDS-SQL-TYPE                
127300        MOVE "asciicopy"                TO DBFLDS-IFLD-CVT-METHD          
127400      When "X "  Also Any                                                 
127500        MOVE "VARCHAR"                  TO DBFLDS-SQL-TYPE                
127600        MOVE "asciicopy"                TO DBFLDS-IFLD-CVT-METHD          
127700      When "J "  Also 1                                                   
127800        MOVE "SMALLINT"                 TO DBFLDS-SQL-TYPE                
127900        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
128000      When "J "  Also 2                                                   
128100        MOVE "INT"                      TO DBFLDS-SQL-TYPE                
128200        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
128300      When "J "  Also 4                                                   
128400        MOVE "BIGINT"                   TO DBFLDS-SQL-TYPE                
128500        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
128600      When "I "  Also 1                                                   
128700        MOVE "SMALLINT"                 TO DBFLDS-SQL-TYPE                
128800        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
128900      When "I "  Also 2                                                   
129000        MOVE "INT"                      TO DBFLDS-SQL-TYPE                
129100        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
129200      When "I "  Also 4                                                   
129300        MOVE "BIGINT"                   TO DBFLDS-SQL-TYPE                
129400        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
129500      When "K "  Also 1                                                   
129600        MOVE "INT"                      TO DBFLDS-SQL-TYPE                
129700        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
129800      When "K "  Also 2                                                   
129900        MOVE "BIGINT"                   TO DBFLDS-SQL-TYPE                
130000        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD          
130100      When "R "  Also 4                                                   
130200        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
130300        MOVE "X8R4V18"                  TO DBFLDS-IFLD-CVT-METHD          
130400      When "R "  Also 2                                                   
130500        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
130600        MOVE "X4R2V18"                  TO DBFLDS-IFLD-CVT-METHD          
130700      When "E "  Also 4                                                   
130800        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
130900        MOVE "X8E4V18"                  TO DBFLDS-IFLD-CVT-METHD          
131000      When "E "  Also 2                                                   
131100        MOVE "Float"                    TO DBFLDS-SQL-TYPE                
131200        MOVE "X4E2V18"                  TO DBFLDS-IFLD-CVT-METHD          
131300      When "P "  Also ANY                                                 
131400        MOVE "DECIMAL(18,0)"            TO DBFLDS-SQL-TYPE                
131500        MOVE "decpac"                   TO DBFLDS-IFLD-CVT-METHD          
131600      When OTHER                                                          
131700        MOVE "VARBINARY"                TO DBFLDS-SQL-TYPE                
131800        MOVE "bitcopy"                  TO DBFLDS-IFLD-CVT-METHD.         
131900     MOVE SPACES                        TO DBFLDS-IFLD-MAX-VAL.           
132000     MOVE SPACES                        TO DBFLDS-IFLD-MIN-VAL.           
132100     MOVE COLUMN-BYTES TO SETY                                            
132200     MOVE SETX                     TO DBFLDS-IFLD-X.                      
132300     MOVE SETY                     TO DBFLDS-IFLD-Y.                      
132400     ADD SETY TO SETX.                                                    
132500     Move DBI-ItemSubLen To Z5 Z4 Z3 Z2 Z1.                               
132600*     DISPLAY "LOCKING DBFLDS".                                           
132700     PERFORM LOCK-DBFLDS.                                                 
132800     PERFORM PUT-DBFLDS.                                                  
132900*     DISPLAY "UN LOCKING DBFLDS".                                        
133000     PERFORM UNLOCK-DBFLDS.                                               
133100*------------------------------------------------------------             
133200 MSG-PROCESS.                                                             
133300     DISPLAY M.                                                           
133400     INITIALIZE CSTR.                                                     
133500     STRING "TELLOP " M  %15 DELIMITED BY SIZE INTO CSTR.                 
133600     Move 2 To CMSG.                                                      
133700     IF BATCH-PROCESS OR NOT-INTERACTIVE                                  
133800      CALL INTRINSIC "HPCICOMMAND" USING                                  
133900           CSTR CERR CPARM CMSG.                                          
134000     INITIALIZE M CMD.                                                    
134100                                                                          
